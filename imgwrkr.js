const a=a=>new Promise(t=>{const e=new FileReader;e.onloadend=()=>t(e.result),e.readAsDataURL(a)}),t=async(a,t)=>(await(async(a,t)=>{let e;(t=t||{}).credentials="include";try{e=await fetch(a,t)}catch(a){throw console.log(a),a}if(!e.ok)throw 401===e.status&&alert("You have to relogin."),new Error;return e})(`https://api.dgrm.net/api/s/i/${a}/${t}`)).blob(),e=(a,t,e,o)=>a.put(s(t,e),new Response(o)),o=async(a,t,e)=>(await a.match(s(t,e)))?.text(),s=(a,t)=>`${a}${t}`;onmessage=async function(s){const n=await caches.open("dgrmimg"),c=s.data[0];for(const i of s.data[1]){let s=await o(n,c,i);if(!s)try{s=await a(await t(c,i)),e(n,c,i,s)}catch(a){console.log(a)}self.postMessage([i,s])}};
