const a=async(a,t)=>(await(async(a,t)=>{let e;(t=t||{}).credentials="include";try{e=await fetch(a,t)}catch(a){throw console.log(a),a}if(!e.ok)throw 401===e.status&&alert("You have to relogin."),new Error;return e})(`https://api.dgrm.net/api/s/i/${a}/${t}`)).blob(),t=(a,t)=>`${a}${t}`;onmessage=async function(e){if(2!==e.data?.length||!e.data[1]?.length)return;const n=e.data[0],s=await caches.open("dgrmimg");await Promise.allSettled(e.data[1].map(async e=>{let o=await(async(a,e,n)=>(await a.match(t(e,n)))?.text())(s,n,e);if(!o)try{o=await(i=await a(n,e),new Promise(a=>{const t=new FileReader;t.onloadend=()=>a(t.result),t.readAsDataURL(i)})),((a,e,n,s)=>{a.put(t(e,n),new Response(s))})(s,n,e,o)}catch(a){console.log(a)}var i;self.postMessage([e,o])}))};
