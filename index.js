const t=(t,e)=>t.querySelector(`[data-key="${e}"]`),e=(t,e)=>t.querySelector(`[${e}]`),n=t=>document.getElementById(t);function a(t,e){t.style.transform=`translate(${e.x}px, ${e.y}px)`}const i=(t,...e)=>t?.classList.add(...e),s=(t,...e)=>t?.classList.remove(...e),o=(t,e)=>t?.classList.contains(e),l=(t,e)=>{t.style.pointerEvents=e?"all":"none"},r=(t,e,n,a,i)=>(t.addEventListener(e,n,{passive:!0,once:a,signal:i}),n),c=(t,e,n,a)=>r(e,n,a,void 0,t),d=(t,e,n,a)=>t?.removeEventListener(e,n,{capture:a}),p=(t,e,n)=>t.querySelectorAll(e).forEach(t=>r(t,"click",n)),h=(t,e)=>t.currentTarget.getAttribute(e),u=t=>t.target.isContentEditable||"TEXTAREA"===t.target.tagName.toUpperCase()||"INPUT"===t.target.tagName.toUpperCase(),g=t=>"mouse"===t.pointerType,y=t=>({x:t.clientX,y:t.clientY});function m(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&(n.innerHTML=e),n}const f=(t,e)=>{const n=document.createElement("div");return t&&(n.innerHTML=t),n.style.cssText=e,n},w=(...t)=>document.body.append(...t);function v(t){const e={x:1/0,y:1/0},n={x:-1/0,y:-1/0};for(const a of t){const t=a.getBoundingClientRect();e.x>t.x&&(e.x=t.x),e.y>t.y&&(e.y=t.y),n.x<t.right&&(n.x=t.right),n.y<t.bottom&&(n.y=t.bottom)}return{x:e.x,y:e.y,height:n.y-e.y,width:n.x-e.x}}const x=t=>t.clientHeight-parseInt(t.style.paddingTop),b=async(t,e)=>{let n;(e=e||{}).credentials="include";try{n=await fetch(t,e)}catch(t){throw console.log(t),t}if(!n.ok)throw 401===n.status&&alert("You have to relogin."),new Error;return n},k=(t,e,n)=>b(t,{method:"POST",body:e,headers:n}),E=(t,e)=>b(t,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:e?q(e):null}),$=(t,e)=>{const n=new URL(window.location.href);return n.searchParams.set(t,e),n.toString()},C=(...t)=>{const e=new URL(window.location.href);t?.forEach(t=>e.searchParams.delete(t)),history.replaceState(null,null,e.toString())};function M(t,e,n,a){function i(e){d(t,"pointercancel",i),d(t,"pointerup",i),d(t,"wheel",i),d(document,"pointerdown",i),d(t,"pointermove",n),a(e)}r(t,"pointercancel",i,!0),r(t,"pointerup",i,!0),r(t,"wheel",i,!0),r(document,"pointerdown",i,!0),r(t,"pointermove",n),t.setPointerCapture(e.pointerId)}const L=(t,e)=>H(t.ownerSVGElement,t,e);function H(t,e,n,a){const i=()=>{d(t,"pointercancel",s),d(t,"wheel",s),d(t,"pointerdown",s)},s=t=>{a&&a(t),e.contains(t.target)||(i(),n(t))};return r(t,"pointercancel",s),r(t,"pointerdown",s),r(t,"wheel",t=>{i(),n(t)},!0),i}const T=t=>{const e=e=>{"Escape"===e.key&&t()};return r(document,"keydown",e),()=>d(document,"keydown",e)},S=(t,e,n)=>new CustomEvent(t,{detail:e,cancelable:n}),V=(t,e)=>t.dispatchEvent(e),z=(t,e)=>{let n,a,i=!1;return function s(){if(i)return n=arguments,void(a=this);t.apply(this,arguments),i=!0,setTimeout(function(){i=!1,n&&(s.apply(a,n),n=a=null)},e)}};function I(t,e,n){return t??=0,n<=t?t:t+Math.ceil((n-t)/e)*e}const A=t=>Math.round(100*(t+Number.EPSILON))/100,D=(t,e,n)=>{let a=!1;return e>n?e>t&&(a=!0,n*=t/e,e=t):n>t&&(a=!0,e*=t/n,n=t),{w:e,h:n,c:a}};function B(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}function P(t,e){for(let n=t.length-1;n>=0;--n)e(t[n])}const j=(t,e,n,a)=>{if(t?.length){e(t[0]);for(let e=1;e<t.length-1;e++)n(t[e]);t.length>1&&a(t[t.length-1])}},Z=t=>t?[...t]:t,R=t=>t.values().next().value;function O(t,e,n){const a=n??1;return t.x+=a*e.x,t.y+=a*e.y,t}const F=(t,e)=>({x:t.x+e,y:t.y+e}),U=(t,e)=>N(t,e.x,e.y),N=(t,e,n)=>(t.x=e,t.y=n,t),Y=t=>({x:t.x,y:t.y});function G(){const t=new Uint8Array(4);return window.crypto.getRandomValues(t),Array.from(t,t=>t.toString(16).padStart(2,"0")).join("")}const X=t=>t?.substring(0,t.lastIndexOf("."))||t,K=t=>t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"),W=t=>{const e=new Set;return t.split(/[\s,]+/)?.forEach(n=>{(n.startsWith("http://")||n.startsWith("https://"))&&!e.has(n)&&URL.canParse(n)&&(t=t.replaceAll(n,`<a href="${n}" target="_blank" contenteditable="false" class="dg-lnk">${new URL(n).hostname}</a>âžœ`),e.add(n))}),t},_=t=>Q(q(t)),q=t=>JSON.stringify(t),Q=t=>JSON.parse(t),J=(t,e)=>{Object.hasOwn(t,e)&&(t[e](),delete t[e])},tt=(t,e,n)=>{Object.hasOwn(t,e)||(t[e]=n())},et=t=>new Promise(e=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.readAsDataURL(t)}),nt=(t,e)=>t?e:"",at=t=>nt(t,"disabled"),it=(t,e,n)=>t?.length?t.map(e).join(" "):n??"",st=()=>screen.width>768;function ot(t,e,n){t.x+=n[lt]/e,t.y+=n[rt]/e}const lt=Symbol("movementX"),rt=Symbol("movementY"),ct=Symbol("Canvas");let dt;function pt(t){t&&!dt?(dt=f("<style>@keyframes blnk{0%{opacity:0}50%{opacity:.7}100%{opacity:0}}.blnk{animation:blnk 1.6s linear infinite}</style>","z-index: 2; position: fixed; left: 0; top: 0; width:100%; height:100%; background: #fff; opacity: 0"),dt.classList.add("blnk"),w(dt)):t||(dt?.remove(),dt=null)}const ht=async t=>{try{return pt(!0),await t()}catch(t){console.log(t),alert("Error")}finally{pt(!1)}},ut="ap-modal",gt=()=>`[${ut}]`;function yt(t,e,n,a,i){const s=f(null,"position: fixed; left: 50%; top: 30%; box-shadow: 0 4px 24px rgba(0,0,0,.12); border-radius: 8px; background-color: rgb(255,255,255);");function o(t,e){s&&(a?(s.style.right="0",s.style.left="unset",s.style.marginRight=`${t}px`):s.style.left=`${t}px`,s.style.top=i?`${window.scrollY+e}px`:window.scrollY+e-s.getBoundingClientRect().height+"px")}return s.setAttribute(ut,""),s.append(t),w(s),null!=e?o(e,n):s.style.transform="translate(-50%, -30%)",s[Et]={position:o,del:()=>{s?.remove()}},s}const mt=t=>((t,e)=>{const n=t=>t&&t!==document&&t!==window?t.closest(e)||n(t.getRootNode().host):null;return n(t)})(t,gt()),ft=()=>{for(;;){const t=document.querySelector(gt());if(!t)return;t[Et]?.del()}};function wt(t,e,n,a,i,s){const o=f(null,"z-index: 2; position: fixed; left: 0; top: 0; width:100%; height:100%; "+(a?"background-color: rgba(52,71,103,.05);":""));w(o);const l=yt(t,e,n,i,s);o.append(l);const c=xt(o,l,t=>{"pointerdown"===t?.type?r(o,"click",t=>{t.stopImmediatePropagation(),p()},!0):p()},t=>t.stopImmediatePropagation()),d=l[Et].del,p=()=>{d(),c(),o.remove()};return l[Et].del=p,l}function vt(t,e,n){const a=yt(t,e,n),i=a[Et].del,s=xt(document,a,()=>o()),o=()=>{i(),s()};return a[Et].del=o,a}function xt(t,e,n,a){const i=((t,e,n,a)=>H(t,e,n,a))(t,e,n,a),s=T(()=>{((t,e)=>{const n=t.querySelectorAll(e);return n?.length?n[n?.length-1]:null})(document,gt())===e&&(n(),o())}),o=()=>{i(),s()};return o}function bt(t,e,n,a,i){const s=f(`<style>.btn,button,input{cursor:pointer;color:#0d6efd;text-decoration:none;font-size:16px;padding:10px;border-radius:8px;border:none;background-color:#f2f2f2;display:flex;align-items:center;justify-content:center}button[disabled]{color:rgba(52,71,103,.6)}input{background-color:#fff;border:solid rgba(52,71,103,.4) 1px;color:unset;cursor:auto}input:focus{outline:0 none}.btn-del{color:#e74c3c;text-decoration:none}.w100{width:100%;box-sizing:border-box}.mb20{margin-bottom:20px}.mb10{margin-bottom:10px}.mb5{margin-bottom:5px}.mt10{margin-top:10px}.dsb{display:block}.txt-c{text-align:center}.nwp{overflow:hidden;white-space:nowrap}.mds{width:85vw;max-width:220px}.mdm{width:85vw;max-width:370px}.hdr{display:flex;align-items:center;justify-content:space-between;height:24px}</style>${nt(!a,`<div class="mb20"><div class="hdr"><a class="dg-a" ap-close>Close</a> <b class="nwp" style="margin-right:40px">${i??""}</b> <span></span></div></div>`)}`,"display: flex; flex-flow: column; padding: 15px;");s.className=e??"mds",a?s.append(a):p(s,"[ap-close]",()=>o[Et].del()),s.append(t);const o=n?wt(s,null,null,!0):vt(s);return o}function kt(t,e,n,a){const s=bt(f(`<style>.mdhc{display:flex;flex-flow:column;height:100%;max-height:670px;padding:15px;box-sizing:border-box;width:100%;max-width:450px}.mdh{padding:0!important;height:100%}.cnt{overflow-y:overlay;margin-bottom:15px;scrollbar-width:thin}a[disabled]{opacity:.6;pointer-events:none}@media only screen and (max-height:700px){.mdhc{transform:unset!important;top:0!important;left:0!important;border-radius:unset!important;max-height:unset}}@media only screen and (max-width:700px){.mdhc{max-height:unset;max-width:unset}}.cnt .itm{display:flex;border-bottom:1px solid rgba(52,71,103,.3)}.cnt .itm:last-child{border-bottom:none}.tcl{color:#344767}</style>${t}`,"display: flex; flex-flow: column; height: 100%; overflow-y: overlay;"),"mdh",a,e,n);return i(mt(s),"mdhc"),s}const Et=Symbol(0);function $t(t,e){const n=t.getBoundingClientRect(),a=window.innerHeight-n.bottom<40*e.length;!function(t,e,n,a){const i=wt(f(`<style>.ctxm a{padding:5px 10px;cursor:pointer;display:block;line-height:22px}.ctxm a:first-child{padding-top:10px}.ctxm a:last-child{padding-bottom:10px}</style><div class="ctxm">${it(t,t=>t[0])}</div>`),e,n,!1,!0,!a);p(i,"a",e=>{i[Et].del(),t[s(e.currentTarget)][1]()});const s=t=>Array.prototype.indexOf.call(t.parentNode.children,t)}(e,window.innerWidth-n.right-5,a?n.top:n.bottom,a)}const Ct=(t,e)=>[`<a class="dg-a">${t}</a>`,e],Mt=(t,e)=>[`<a class="dg-a" style="color:#e74c3c">${t}</a>`,()=>{confirm("Delete?")&&e()}];function Lt(t){const e=f(`<style>.toast{visibility:visible;animation:fadein .5s,fadeout .5s 2.5s}@keyframes fadein{from{top:0;opacity:0}to{top:30px;opacity:1}}@keyframes fadeout{from{top:30px;opacity:1}to{top:0;opacity:0}}</style>${t}`,"min-width: 150px; background-color: rgb(52,71,103); color: #fff; text-align: center; border-radius: 8px; padding: 10px; position: fixed; z-index: 2; left: 50%; top: 30px; transform: translate(-50%, -30%)");e.className="toast",w(e),setTimeout(()=>e.remove(),2800)}const Ht=()=>Lt("Link copied to clipboard"),Tt="https://api.dgrm.net/api/",St=`${Tt}s/`,Vt=`${Tt}r/d/`,zt=`${Tt}r/f/`,It=`${Tt}sb/`,At=async t=>{const e=await b(`${St}${t}`),n=e.headers.get("X-Dgrm-loc");return{e:e.headers.has("X-Dgrm-edit"),m:e.headers.has("X-Dgrm-manage"),n:decodeURIComponent(e.headers.get("X-Dgrm-name")),l:n?decodeURIComponent(n):null,d:await e.json()}},Dt=async t=>{const e=await b(`${St}a/l/${t??""}`);let n;try{const t=await e.json();n={f:new Map(t.f.map(t=>[t.i,t])),d:new Map(t.d.map(t=>[t.i,t]))}}catch{}return n};async function Bt(t,e,n,a){const i=new URL(`${St}a/c`);return Ft(i,"k",t),e&&Ft(i,"f",e.toString()),Ft(i,"n",n),(await E(i.toString(),a)).text()}const Pt=(t,e,n)=>k(`${St}i/${t}/${e}`,n,{"Content-Type":n.type}),jt=async(t,e)=>parseInt(await(await k(`${It}${t}`,e.toString())).text()),Zt=t=>jt("d",t),Rt=t=>jt("dp",t);function Ot(){const t=new Date;return`${t.getUTCFullYear()}${(t.getUTCMonth()+1).toString().padStart(2,"0")}${G()}`}const Ft=(t,e,n)=>t.searchParams.set(e,n),Ut=(t,e,n)=>({x:(e-t.position.x)/t.scale,y:(n-t.position.y)/t.scale}),Nt=(t,e)=>Ut(t,e.clientX,e.clientY);function Yt(t,e){const n=e/2;function a(t){const a=Math.round(t/e)*e;return t-a>=0?a+n:a-n}return t.x=a(t.x),t.y=a(t.y),t}const Gt=Symbol(0),Xt=t=>tt(t,Gt,()=>function(t){const e=t[ct].data,n=function(t,e){let n;const a=e=>{n!==e&&(n=e,t.style.backgroundImage=`radial-gradient(rgb(73 80 87 / ${e}) 1px, transparent 0)`)},i=()=>{const n=e.cell*e.scale;e.scale<.5?a(0):e.scale<=.9?a(.2):a(.6),t.style.backgroundSize=`${n}px ${n}px`,t.style.backgroundPosition=`${e.position.x}px ${e.position.y}px`};return i(),i}(t.ownerSVGElement,e);function a(){t.style.transform=`matrix(${e.scale}, 0, 0, ${e.scale}, ${e.position.x}, ${e.position.y})`,n()}function i(t,n){if(t<.25||t>4)return;const i=t/e.scale;e.scale=t,e.position.x=i*(e.position.x-n.x)+n.x,e.position.y=i*(e.position.y-n.y)+n.y,a()}const s=function(t,e,n,a){let i,s,o,l,c=!1;function p(t){o=null,l=null,i?.id===t.pointerId&&(i=null),s?.id===t.pointerId&&(s=null),i||s||(d(document,"pointermove",h),d(document,"pointercancel",p),d(document,"pointerup",p),c=!1)}function h(t){if(c){if(i&&!s||!i&&s)return e.position.x=t.clientX+(i||s).shift.x,e.position.y=t.clientY+(i||s).shift.y,void a();if(!s||!i||s?.id!==t.pointerId&&i?.id!==t.pointerId)return;const r=Math.hypot(i.pos.x-s.pos.x,i.pos.y-s.pos.y),c={x:(i.pos.x+s.pos.x)/2,y:(i.pos.y+s.pos.y)/2};o&&(e.position.x=e.position.x+c.x-l.x,e.position.y=e.position.y+c.y-l.y,n(e.scale/o*r,c)),o=r,l=c}i?.id===t.pointerId&&(i=Wt(t,e)),s?.id===t.pointerId&&(s=Wt(t,e))}const u=t=>{!i&&!t.isPrimary||i&&s||(i||(r(document,"pointermove",h),r(document,"pointercancel",p),r(document,"pointerup",p),i=Wt(t,e)),s||i?.id===t.pointerId||(s=Wt(t,e)))};return r(t.ownerSVGElement,"pointerdown",u),t[ct].moveCapture=()=>{c=!0},()=>{d(t.ownerSVGElement,"pointerdown",u),t[ct].moveCapture=void 0}}(t,e,i,a),o=t=>{e.position.x-=t.deltaX,e.position.y-=t.deltaY,a()},l=t=>i(e.scale+(Math.abs(t.deltaY)>20?t.deltaY<0?.25:-.25:-.01*t.deltaY),y(t)),c=t=>{t.ctrlKey?l(t):o(t)};let p=t=>{0===t.deltaY&&(p=c),l(t)};const h=t=>{t.preventDefault(),p(t)};return t.ownerSVGElement.addEventListener("wheel",h),t[ct].move=function(t,n,i){e.position.x=t,e.position.y=n,e.scale=i,a()},t[ct].scale=i,()=>{s(),t.ownerSVGElement.removeEventListener("wheel",h),t[ct].move=void 0,t[ct].scale=void 0}}(t)),Kt=t=>J(t,Gt);function Wt(t,e){return{id:t.pointerId,pos:y(t),shift:{x:e.position.x-t.clientX,y:e.position.y-t.clientY}}}const _t=new Map,qt=(t,e)=>_t.set(t,e);function Qt(t){return te(t).find(t=>!t.hasAttribute("data-evt-no"))}function Jt(t){return te(t)[0]}function te(t){return document.elementsFromPoint(t.clientX,t.clientY).sort((t,e)=>{const n=t.getAttribute("data-evt-index"),a=e.getAttribute("data-evt-index");return n===a?0:n>a?-1:1})}const ee=Symbol("path"),ne=Symbol("shape"),ae="1.2",ie=()=>({v:ae,s:{}}),se=t=>oe([...t.children],!1);function oe(t,e,n){const a=ie();if(!t?.length)return a;const i=new Map,s=t=>{let n=i.get(t);if(!n){const s=_(t[ne].data);e&&(s.id=G(),n=s.id),i.set(t,n),a.s[s.id]=s}return n},o=i=>{if(a.s[i[ee].data.id])return;const o=a=>{return e?(i=a.shape?.shapeEl,-1!==t.indexOf(i)?{s:s(a.shape.shapeEl),k:a.shape.connectorKey}:{p:_(a.data)}):a.shape?(n&&s(a.shape.shapeEl),{s:a.shape.shapeEl[ne].data.id,k:a.shape.connectorKey}):{p:_(a.data)};var i},l=i[ee].data,r={id:e?G():l.id,type:0,s:o(l.s),e:o(l.e)};l.styles&&(r.c=_(l.styles)),a.s[r.id]=r};for(const e of t)e[ne]?(s(e),n&&e[ne].paths?.forEach(o)):o(e);return a}function le(t){return{v:ae,s:{[t.id]:0!==t.type?t:(e=t,{id:e.id,type:0,s:{p:e.s.data},e:{p:e.e.data},c:e.styles})}};var e}function re(t,e){if(e.v!==ae)return alert("Wrong format"),null;const a=new Map;function i(e){let n=a.get(e);return n||(n=de(t,e),a.set(e,n)),n}const s=t=>e.s[t]?i(e.s[t]):n(t),o=[];for(const n in e.s)switch(e.s[n].type){case 0:{const a=pe(t,e.s[n],s);a&&o.push(a);break}default:i(e.s[n])}return[...a.values(),...o]}function ce(t,e){const a=n(e.id);return a?((a[ne]||a[ee]).patch(e),a):t[ct].shapeMap[e.type].create(e)}const de=(t,e)=>ce(t,_(e)),pe=(t,e,n)=>{const a=function(t,e){const n=t=>{const n=e(t.s);return n?{shape:{shapeEl:n,connectorKey:t.k}}:null},a=t=>t.p?{data:{dir:t.p.dir,position:Y(t.p.position)}}:n(t),i={type:0,id:t.id,styles:t.c,s:a(t.s),e:a(t.e)};return i.e&&i.s?i:null}(e,n);return a?ce(t,a):null};const he=0,ue=6,ge=7;function ye(t){for(const e in t.s)me(t.s[e]);return t}function me(t){switch(t.type){case 0:fe(t.s),fe(t.e);break;case 6:delete t.d,delete t.r;break;case 7:delete t.d}}function fe(t){t.p?(t.k=null,t.s=null):t.p=null}const we="dgrmn",ve="dgrmc",xe="dgrmd",be="dgrmu",ke="dgrmdc",Ee=(t,e,n)=>V(t,$e(e,n)),$e=(t,e)=>S(ve,{newIds:t,shapesToCreateData:e}),Ce=(t,e)=>S(xe,{delIds:t,shapesToDelData:e}),Me=(t,e,n)=>V(t,Le(ye(e),ye(n))),Le=(t,e)=>S(be,{shapesBeforeUpdData:t,shapesToUpdData:e}),He=(t,e,n,a)=>S(ke,{delIds:t,shapesToDelData:e,newIds:n,shapesToCreateData:a});function Te(t,e,n,a){const i=O(((t,e,n)=>{const a=Ut(t,e,n);return Yt(a,t.cell),a})(t[ct].data,n,a),function(t){const e=function(t){const e={x:1/0,y:1/0},n={x:-1/0,y:-1/0};return Se(t,t=>{t&&(e.x>t.x&&(e.x=t.x),e.y>t.y&&(e.y=t.y),n.x<t.x&&(n.x=t.x),n.y<t.y&&(n.y=t.y))}),{min:e,max:n}}(t);return{x:e.min.x+(e.max.x-e.min.x)/2,y:e.min.y+(e.max.y-e.min.y)/2}}(e),-1);Se(e,e=>{e&&Yt(O(e,i),t[ct].data.cell)})}function Se(t,e){for(const n in t.s)0===t.s[n].type?(e(t.s[n].s.p?.position),e(t.s[n].e.p?.position)):e(t.s[n].position)}const Ve=(t,e)=>t[ct].select(ze(t,oe(e,!0),!0));function ze(t,e,n,a,i){return Te(t,e,null==a?window.innerWidth/2:a,null==i?window.innerHeight/2:i),Ie(t,e,n)}function Ie(t,e,n){return n&&Ee(t,je(e),_(e)),Ae(t,e)}function Ae(t,e){return t[ct].select(null),re(t,e)}function De(t,e){((t,e,n)=>{V(t,Ce(e,n))})(t,Pe(e),oe(e,!1,!0)),Ze(e)}function Be(t,e,n){((t,e,n,a,i)=>{V(t,He(e,n,a,i))})(t,Pe(e),oe(e,!1,!0),je(n),_(n)),Ze(e),Ae(t,n)}const Pe=t=>t.map(t=>(t[ne]||t[ee]).data.id),je=t=>Object.keys(t.s),Ze=t=>t.forEach(t=>(t[ne]||t[ee]).del()),Re='<svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 19h18v2H3v-2zm10-5.828L19.071 7.1l1.414 1.414L12 17 3.515 8.515 4.929 7.1 11 13.17V2h2v11.172z" fill="rgb(52,71,103)"/></svg>',Oe='<svg viewBox="0 0 24 24" width="24" height="24" fill="rgb(52,71,103)"><path d="M10 3V5H5V19H19V14H21V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H10ZM17.5858 5H13V3H21V11H19V6.41421L12 13.4142L10.5858 12L17.5858 5Z"></path></svg>',Fe="highlight-s",Ue="highlight-e",Ne="highlight",Ye="select",Ge="resize",Xe="dg-connect",Ke="resizer",We="data-connect",_e="bg",qe="k",Qe="l",Je=(t,e)=>({id:G(),type:t,position:{x:0,y:0},title:"Title",styles:e});function tn(t,e){const n=t.getBoundingClientRect(),a=yt(e,n.left+10,n.top+10);return{del:a[Et].del,updPos:()=>{const e=t.getBoundingClientRect();a[Et].position(e.left+10,e.top+10)}}}const en=(t,e)=>({del:yt(t,e.clientX-66,e.clientY-10)[Et].del}),nn=(t,e,n)=>{const a=oe([e],!1,!1);(e[ne]??e[ee]).patch(n),Me(t,a,oe([e],!1,!1))};function an(t,e){return function(t,e){const n=t.el[ne].data;(null!=e.title&&n.title!==e.title||null!=e.p&&n.p!==e.p)&&(n.title=e.title,n.p=e.p,t.drawTxtInit());e.styles&&(n.styles=e.styles,rn(t.el))}(t,e),sn(t,e)}function sn(t,e){const n=e.position&&(a=t.el[ne].data.position,i=e.position,!(a?.x===i?.x&&a?.y===i?.y));var a,i;return n&&U(t.el[ne].data.position,e.position),n}const on=t=>t.forEach(t=>{const e=n(t);e&&ln(e)}),ln=t=>(t[ne]||t[ee]).del();function rn(t){const e=(t[ne]??t[ee]).data;e.styles||(e.styles=[]),P(t.classList,e=>{e?.startsWith("d-")&&t.classList.remove(e)}),i(t,...e.styles)}const cn=(t,e,n)=>nn(t,e,dn(e,n)),dn=(t,e)=>{const n=(t[ne]??t[ee]).data;n.styles||(n.styles=[]);return function(t,e){const n=t.styles.findIndex(t=>t.startsWith("d-cl-"));n>-1&&t.styles.splice(n,1);e&&t.styles.push(e);return t}({styles:_(n.styles)},e)};function pn(t,e,n){return e.setAttribute(_e,n.toString()),hn(t,e),e}function hn(t,e){const n=Number(e.getAttribute(_e));if(4===n)return void t.append(e);const a=t.querySelector(un(n+1,4).map(t=>`[${_e}="${t}"]`).join());a?a.before(e):t.append(e)}const un=(t,e)=>[...Array(e-t+1).keys()].map(e=>e+t);class gn extends HTMLElement{#t;#e;constructor(t,e){super(),this.#t=e,this.#e=t}connectedCallback(){const t=t=>this.#t[ee].data.styles?.includes(t)?'class="actv"':"",e=this.attachShadow({mode:"closed"});e.innerHTML=`<style>.ln{display:flex}.ln>*{height:24px;padding:10px;fill-opacity:.3;stroke-opacity:.3}[data-cmd]{cursor:pointer}.actv{fill-opacity:1;stroke-opacity:1}</style><ap-shape-edit id="edit" edit-btn="true" clr-btn="true"><div class="ln"><svg data-cmd data-cmd-arg="d-arw-s" ${t("d-arw-s")} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="d-arw-e" ${t("d-arw-e")} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="d-dash" ${t("d-dash")} viewBox="0 0 24 24" width="24" height="24"><path d="M 2,11 L 20,11" stroke="rgb(52,71,103)" style="stroke-dasharray:4,3;stroke-width:3"></path></svg></div></ap-shape-edit>`,r(e.getElementById("edit"),"cmd",t=>{switch(t.detail.cmd){case"style":cn(this.#e,this.#t,t.detail.arg);break;case"del":De(this.#e,[this.#t]);break;case"copy":Ve(this.#e,[this.#t])}}),p(e,"[data-cmd]",t=>{const e=h(t,"data-cmd-arg"),n={styles:this.#t[ee].data.styles?_(this.#t[ee].data.styles):[]},a=n.styles.indexOf(e);a>-1?(n.styles.splice(a,1),s(t.currentTarget,"actv")):(n.styles.push(e),i(t.currentTarget,"actv")),nn(this.#e,this.#t,n)})}}function yn(t,e,n,a){const i=bn(t,e);i.shape={shapeEl:n,connectorKey:a},wn(t,i)}function mn(t,e,n){const a=bn(t,e);a.shape.shapeEl!==kn(t,a)&&vn(t,a),a.shape=null,a.data={dir:a.data.dir,position:n}}function fn(t,e){const n=t[ee].data,a=a=>{const i=n[a],s=e[a];i.shape?null==s.shape||i.shape.shapeEl===s.shape.shapeEl&&i.shape.connectorKey===s.shape.connectorKey?s.data&&mn(t,a,s.data.position):function(t,e,n,a){const i=bn(t,e);if(i.shape.shapeEl===n&&i.shape.connectorKey===a)return;i.shape.shapeEl!==n&&i.shape.shapeEl!==kn(t,i)&&vn(t,i);i.shape={shapeEl:n,connectorKey:a},wn(t,i)}(t,a,s.shape.shapeEl,s.shape.connectorKey):null!=s.shape?yn(t,a,s.shape.shapeEl,s.shape.connectorKey):U(i.data.position,s.data.position)};a("s"),a("e")}function wn(t,e){e.data=xn(e.shape).pathAdd(e.shape.connectorKey,t)}customElements.define("ap-path-settings",gn);const vn=(t,e)=>xn(e.shape)?.pathDel(t),xn=t=>t?.shapeEl[ne],bn=(t,e)=>t[ee].data[e],kn=(t,e)=>(t[ee].data.e===e?t[ee].data.s:t[ee].data.e).shape?.shapeEl;let En;const $n=(t,e)=>({id:G(),type:0,s:t,e:e,styles:Z(En)});qt(0,()=>$n({data:{dir:"right",position:{x:-24,y:0}}},{data:{dir:"right",position:{x:24,y:0}}}));function Cn(e,n){const a=m("g",'<path data-key="outer" d="M0 0" stroke="transparent" stroke-width="20" fill="none" style="cursor:pointer;pointer-events:stroke"/><path data-key="path" class="path" d="M0 0" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"/><path data-key="selected" class="dg-selected dg-selected-path" d="M0 0" stroke="transparent" stroke-width="10" style="pointer-events:none;fill:none"/><g data-key="start" class="dg-start" style="cursor:move"><circle data-evt-index="1" class="path-end" r="10" stroke-width="0" fill="transparent"/><path class="arr arr-s" d="M 0 0 -8 -4 -8 4 z" stroke="#495057" stroke-width="1.8" fill="#495057" style="pointer-events:none"></path></g><g data-key="end" class="dg-end" style="cursor:move"><circle data-evt-index="1" class="path-end" r="10" stroke-width="0" fill="transparent"/><path class="arr arr-e" d="M 0 0 -8 -4 -8 4 z" stroke="#495057" stroke-width="1.8" fill="#495057" style="pointer-events:none"></path></g>');a.id=n.id,i(a,"shpath"),n.s.el=t(a,"start"),n.e.el=t(a,"end"),n.styles=n.styles??["d-arw-e"];const o=zn(a,"path","outer","selected");function l(){if(!n.s.shape||!n.e.shape){const t=function(t,e){const n=Math.atan2(e.y-t.y,e.x-t.x);return In(n,-.8,.8)?"left":In(n,.8,2.4)?"top":In(n,2.4,3.2)||In(n,-3.2,-2.4)?"right":"bottom"}(n.s.data.position,n.e.data.position);n.e.shape||(n.e.data.dir=t),n.s.shape||(n.s.data.dir=Vn(t))}const t=function(t){let e=.5*Math.hypot(t.s.data.position.x-t.e.data.position.x,t.s.data.position.y-t.e.data.position.y);function n(t){return"right"===t.dir||"left"===t.dir?"right"===t.dir?t.position.x+e:t.position.x-e:t.position.x}function a(t){return"right"===t.dir||"left"===t.dir?t.position.y:"bottom"===t.dir?t.position.y+e:t.position.y-e}e=e>70?70:e<15?15:e;const i=(e,n,a,i)=>t.styles.includes(a)?e.position[n]+(i[e.dir]??0):e.position[n],s=(t,e)=>i(t,"x",e,{left:-6,right:6}),o=(t,e)=>i(t,"y",e,{top:-6,bottom:6});return`M ${s(t.s.data,"d-arw-s")} ${o(t.s.data,"d-arw-s")} C ${n(t.s.data)} ${a(t.s.data)}, ${n(t.e.data)} ${a(t.e.data)}, ${s(t.e.data,"d-arw-e")} ${o(t.e.data,"d-arw-e")}`}(n);o.forEach(e=>e.setAttribute("d",t)),Hn(n.s),Hn(n.e)}let r,c;let d,p,h=0;const u=()=>{p&&(p(),p=null)},y=t=>{u(),p=T(t)};function f(t){switch(h){case 0:v();break;case 1:h=2,d=L(a,()=>w(!0)),y(()=>{w(!0),v()}),function(t){r||(r=en(new gn(e,a),t))}(t)}}function w(t){t||(c=null),h=0,s(a,Ye,Fe,Ue),Tn(n.s,1),Tn(n.e,1),r?.del(),r=null,d&&(d(),d=null),u()}function v(){h=1,i(a,"s"===c?Fe:"e"===c?Ue:Ye),Tn(n.s,2),Tn(n.e,2),hn(e,a),y(()=>{w(!0)})}return a[ee]={data:n,drawPosition:l,click:(t,e)=>{if(0===h||c){const a=e||t?An(n,e??Qt(t)):null;Dn(c,a)||w(),c=a}f(t)},patch:t=>{var e;n.styles&&(n.styles=t.styles,rn(a),e=[...t.styles],En=e,B(En,"d-arw-s")),t.s&&fn(a,t),l()},moveCapture:(t,i,s)=>{w(!0);const o=s?null:oe([a],!1,!0),r=t=>{w(!0),o?Me(e,o,oe([a],!1,!0)):Ee(e,[n.id],oe([a],!1,!0)),g(t)||f()},c=An(n,i);c?Ln(e,a,l,t,c,r):function(t,e,n,a,i){M(e,a,a=>{!function(t,e,n,a){const i=e=>ot(e,t.scale,a);Mn(e.s,i),e.s.shape?.shapeEl&&e.s.shape?.shapeEl===e.e.shape?.shapeEl||Mn(e.e,i);e.s.shape||e.e.shape||n()}(t[ct].data,e[ee].data,n,a)},a=>{!function(t,e,n){const a=e=>Yt(e,t.cell);Mn(e.s,a),Mn(e.e,a),e.s.shape&&e.e.shape||n()}(t[ct].data,e[ee].data,n),i(a)})}(e,a,l,t,r)},unselect:w,del:function(){w(),vn(a,n.s),vn(a,n.e),a.remove()}},n.styles&&i(a,...n.styles),n.s.shape&&wn(a,n.s),n.e.shape&&wn(a,n.e),l(),a}function Mn(t,e){t.shape?(e(xn(t.shape).data.position),xn(t.shape).drawPosition()):e(t.data.position)}const Ln=(t,e,n,a,c,p)=>{e[ee].data[c].shape&&mn(e,c,Nt(t[ct].data,a)),l(e);const h=function(t){let e=null;const n=t=>{o(t,"hover")||(i(t,"hover"),t.dispatchEvent(new CustomEvent("hoverenter")))},a=t=>{o(t,"hover")&&(s(t,"hover"),t.dispatchEvent(new CustomEvent("hoverleave")))};function l(t){const i=Jt(t);if(e!==i){o(i,"hovertrack")&&n(i);let t=!1;o(i?.parentElement,"hovertrack")&&(n(i.parentElement),t=!0),a(e),e?.parentElement===i?.parentElement&&t||a(e?.parentElement),e=i}}return r(t,"pointermove",l),function(){d(t,"pointermove",l),a(e),a(e?.parentElement),e=null}}(e.parentElement);M(e[ee].data[c].el,a,a=>{ot(e[ee].data[c].data.position,t[ct].data.scale,a),n()},a=>{const i=Jt(a),s=i?.getAttribute(We);s?yn(e,c,i.parentElement,s):Yt(e[ee].data[c].data.position,t[ct].data.cell),n(),h(),l(e,!0),p(a)})};function Hn(t){t.el.style.transform=`translate(${t.data.position.x}px, ${t.data.position.y}px) rotate(${Sn(t.data.dir)}deg)`}function Tn(t,e){t.el.firstElementChild.setAttribute("data-evt-index",e.toString())}const Sn=t=>"right"===t?180:"left"===t?0:"bottom"===t?270:90,Vn=t=>"left"===t?"right":"right"===t?"left":"top"===t?"bottom":"top";const zn=(e,...n)=>n.map(n=>t(e,n)),In=(t,e,n)=>e<=t&&t<=n,An=(t,e)=>t.e.el.contains(e)?"e":t.s.el.contains(e)?"s":null,Dn=(t,e)=>!t||t===e,Bn=(t,e)=>tn(e,Zn(t,e)),Pn=(t,e,n)=>en(Zn(t,e),n),jn=(t,e,n)=>en(Zn(t,e,!1),n);function Zn(t,e,n=!0){const a=new Rn;return n&&a.setAttribute("clr-btn","true"),r(a,"cmd",n=>{switch(n.detail.cmd){case"style":cn(t,e,n.detail.arg);break;case"del":De(t,[e]);break;case"copy":Ve(t,[e])}}),a}class Rn extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML=`<style>.ln{display:flex}.ln>*{height:24px;padding:10px;cursor:pointer}#prop{padding-bottom:10px}.crcl{width:24px;height:24px;border-radius:50%}</style><div id="pnl"><div id="clr" style="display:none"><div class="ln"><div data-cmd="style" data-cmd-arg="d-cl-red"><div class="crcl" style="background:#e74c3c"></div></div><div data-cmd="style" data-cmd-arg="d-cl-orange"><div class="crcl" style="background:#f60"></div></div><div data-cmd="style" data-cmd-arg="d-cl-green"><div class="crcl" style="background:#19bc9b"></div></div></div><div class="ln"><div data-cmd="style" data-cmd-arg="d-cl-blue"><div class="crcl" style="background:#1aaee5"></div></div><div data-cmd="style" data-cmd-arg="d-cl-dblue"><div class="crcl" style="background:#1d809f"></div></div><div data-cmd="style" data-cmd-arg="d-cl-dgray"><div class="crcl" style="background:#495057"></div></div></div></div><div id="prop" style="display:none"><slot id="slot"></slot></div></div><div class="ln"><svg data-toggle="clr" ${this.getAttribute("clr-btn")?"":'style="display: none;"'} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M19.228 18.732l1.768-1.768 1.767 1.768a2.5 2.5 0 1 1-3.535 0zM8.878 1.08l11.314 11.313a1 1 0 0 1 0 1.415l-8.485 8.485a1 1 0 0 1-1.414 0l-8.485-8.485a1 1 0 0 1 0-1.415l7.778-7.778-2.122-2.121L8.88 1.08zM11 6.03L3.929 13.1 11 20.173l7.071-7.071L11 6.029z" fill="rgb(52,71,103)"/></svg> <svg data-toggle="prop" ${this.getAttribute("edit-btn")?"":'style="display: none;"'} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12.9 6.858l4.242 4.243L7.242 21H3v-4.243l9.9-9.9zm1.414-1.414l2.121-2.122a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414l-2.122 2.121-4.242-4.242z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="copy" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7 6V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1h-3v3c0 .552-.45 1-1.007 1H4.007A1.001 1.001 0 0 1 3 21l.003-14c0-.552.45-1 1.007-1H7zM5.003 8L5 20h10V8H5.003zM9 6h8v10h2V4H9v2z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="del" style="margin-left:auto" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z" fill="rgb(52,71,103)"/></svg></div>`;{const e=t.getElementById("pnl");let n;p(t,"[data-toggle]",a=>{const i=t=>{const n=mt(this),a=n.getBoundingClientRect().top,i=e.getBoundingClientRect().height;n.style.top=`${a+window.scrollY+t*i}px`};n&&(i(1),On(n,!1));const s=t.getElementById(h(a,"data-toggle"));n!==s?(On(s,!0),i(-1),n=s):n=null})}p(t,"[data-cmd]",t=>{this.dispatchEvent(new CustomEvent("cmd",{detail:{cmd:h(t,"data-cmd"),arg:h(t,"data-cmd-arg")}}))})}}function On(t,e){t.style.display=e?"unset":"none"}customElements.define("ap-shape-edit",Rn);const Fn=(t,e)=>{t.innerHTML=W(K(e))},Un=t=>{const e=t.parentElement.clientHeight/2,n=e,a=Math.round(n/10);let i=!1;return()=>{if(i)return;i=!0,t.style.paddingTop="0px";let n=t.clientHeight,s=e-n/2,o=0;for(let i=1;i<10;i++){const l=i*a;t.style.paddingTop=i*a+"px";const r=t.clientHeight-l;if(r>n)break;n=r;const c=Math.abs(e-r/2-l);s>c&&(s=c,o=l)}return t.style.paddingTop=`${o}px`,i=!1,o}};function Nn(e,n,a,i,s,o,l,c,d,p,h,u){const g=Gn(n.id,a),y=t(g,"text");r(y,"pointerdown",t=>{t.stopPropagation()});const m=function(t,e,n,a,i,s,o,l,r,c,d,p,h,u){const g=c(n,d,v);let y,m;const f=()=>oe([e],!1,!1);function w(){g.enabled()&&(g.disable(),p(!0)),y&&m!==n.title&&Me(t,y,f()),y=null,m=null,u&&u()}function v(t){n.title=t,p()}const x=qn(t,e,n,a,(a,i)=>{h&&h(a,i),1===i&&hn(t,e),2===i&&(g.enabled()||(m=n.title,y=f(),g.enable(),p()),Jn(d))},w,i,s,o,l,r);return{draw:x,drawTxtInit:g.drawTxtInit,drawTxt:g.drawTxt}}(e,g,n,i,s,o,l,null,d??Bn,p??Xn,y,t=>c(y,t),h,u);return{el:g,cons:i,draw:m.draw,drawTxtInit:m.drawTxtInit,drawTxt:m.drawTxt}}function Yn(t,e,n,a,i,s,o,l,r,c,d){const p=Gn(e.id,n);return{el:p,cons:a,draw:qn(t,p,e,a,c??(()=>{}),d??(()=>{}),i,s,o,r,l??Pn)}}const Gn=(t,e)=>{const n=m("g",e);return n.id=t,n};const Xn=(t,e,n)=>{let a;return{enable:()=>{e.textContent=t.title,a=Kn(e,n)},enabled:()=>!!a,disable:()=>{a&&(Fn(e,t.title),a?.dispose(),a=null)},drawTxtInit:()=>{null==t.p?setTimeout(()=>{var n,a;t.p=(n=e,a=t.title,Fn(n,a),Un(n)())}):(Fn(e,t.title),e.style.paddingTop=`${t.p}px`)},drawTxt:()=>{t.p=a?a?.draw():Un(e)()}}},Kn=(t,e)=>{let n=Un(t);const a=Wn(t,()=>{n(),e(t.textContent)});return{dispose:()=>a(),draw:()=>(n=Un(t),n())}},Wn=(t,e)=>{const n=new AbortController;return Qn(t,n.signal),l(t,!0),c(n.signal,t,"input",()=>e()),()=>{l(t),t.blur(),document.getSelection().empty(),n.abort()}},_n=(t,e,n)=>{let a;return{enable:()=>{e.textContent=t.title,a=Wn(e,()=>n(e.textContent))},enabled:()=>!!a,disable:()=>{a&&(Fn(e,t.title),a(),a=null)},drawTxtInit:()=>Fn(e,t.title),drawTxt:()=>{}}};function qn(t,e,n,o,l,c,d,p,h,u,y){let f;n.styles??=[];const w=function(t,e,n,o,l,c,d,p,h,u){i(e,"hovertrack");const y=()=>{e.insertAdjacentHTML("beforeend",Object.entries(o).map(t=>`<circle data-key="${t[0]}" ${We}="${t[1].dir}" class="hovertrack ${Xe}" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(${t[1].position.x}px,${t[1].position.y}px);cursor:move;fill:rgb(108 187 247);stroke:rgb(108 187 247);opacity:.51"/>`).join(""))},f=()=>e.querySelectorAll(`.${Xe}`).forEach(t=>t.remove());r(e,"hoverenter",y),r(e,"hoverleave",f);const w=_(o),v=new Set;let x,b,k,E=0;function $(){x?.remove(),x=null}const C=()=>{k&&(k(),k=null)},H=t=>{C(),k=T(t)};function S(){e.style.transform=`translate(${n.position.x}px, ${n.position.y}px)`;for(const t in o)w[t].position={x:o[t].position.x+n.position.x,y:o[t].position.y+n.position.y};for(const t of v)t[ee].drawPosition()}function V(){E=1,i(e,Ye),y(),d&&(x=function(t,e){const n=m("circle");return n.setAttribute("data-evt-index","2"),n.style="r: 10px; opacity: 0.51; stroke: rgb(25, 188, 155); fill: rgb(25, 188, 155); cursor: nwse-resize;",i(n,Ke),a(n,e),t.append(n),n}(e,d())),H(()=>z())}function z(t){c(),E=0,s(e,Ye,Ne),f(),t||$(),b&&(b(),b=null),C()}const I=t=>{switch(E){case 0:V();break;case 1:E=2,s(e,Ye),i(e,Ne),$(),f(),b=L(e,()=>z()),H(()=>{z(),V()})}l(t,E)},A=(n,a,o)=>{if(a===x){z(!0);const a=oe([e],!1,!1);return i(e,Ge),void M(x,n,p,()=>{s(e,Ge),h&&h(),$(),V(),Me(t,a,oe([e],!1,!1))})}z();const l=a.getAttribute(We);if(l){const a=((t,e,n)=>pn(t,Cn(t,$n(e,n)),3))(t,{shape:{shapeEl:e,connectorKey:l}},{data:{dir:Vn(w[l].dir),position:Nt(t[ct].data,n)}});return t[ct].select(g(n)?null:[a]),a[ee].moveCapture(n,a[ee].data.e.el,!0),void v.add(a)}D(n,o)};u??=()=>Yt(n.position,t[ct].data.cell);const D=(a,i)=>{const s=i?null:oe([e],!1,!1);M(e,a,e=>{ot(n.position,t[ct].data.scale,e),S()},a=>{u(),S(),s?Me(t,s,oe([e],!1,!1)):Ee(t,[n.id],oe([e],!1)),g(a)||V()})};return e[ne]={data:n,drawPosition:S,click:I,moveCapture:A,unselect:z,del:function(){z();for(const t of v)t[ee].del();e.remove()},paths:v,pathAdd:function(t,e){return v.add(e),w[t]},pathDel:function(t){v.delete(t)}},S}(t,e,n,o,(n,a)=>{l(n,a),1===a&&hn(t,e),2===a&&(f||(f=y(t,e,n)))},()=>{f?.del(),f=null,c()},d,p,h,u);return n.styles&&i(e,...n.styles),()=>{w(),f?.updPos&&f?.updPos()}}const Qn=(t,e)=>{c(e,t,"pointerdown",t=>t.stopPropagation()),c(e,t,"paste",t=>t.stopPropagation()),c(e,t,"keydown",t=>{"Escape"!==t.key&&t.stopPropagation()})},Jn=t=>{t.focus();const e=document.getSelection();e.selectAllChildren(t),e.collapseToEnd()};let ta;qt(1,()=>Je(1,Z(ta)));const ea=(e,n,a)=>{a??=n,e.height.baseVal.value=a,e.width.baseVal.value=n,e.x.baseVal.value=-n/2,e.y.baseVal.value=-a/2;const i=t(e,"dv");i.style.height=`${a}px`,i.style.width=`${n}px`},na=(t,e)=>{t.r.baseVal.value=e},aa=(t,e)=>ia(t,e,24),ia=(t,e,n)=>I(e,n,x(t)/2);let sa;function oa(e,n){n.w??=96,n.h??=48;const a={w:n.w,h:n.h};let s;const o=Nn(e,n,'<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="96" x="-72" y="-48" fill="transparent" stroke="transparent" stroke-width="0"/><rect data-key="main" class="dg-main" width="96" height="48" x="-48" y="-24" rx="15" ry="15" fill="#1aaee5" stroke="#fff" stroke-width="1"/><foreignObject data-key="frg" width="96" height="48" x="-48" y="-24" style="cursor:pointer"><div data-key="dv" style="height:48px;width:96px;text-align:center;align-content:center"><span contenteditable="plaintext-only" class="txt-edit" data-key="text" style="padding-top:0;overflow-wrap:break-word"></span></div></foreignObject>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:24}},top:{dir:"top",position:{x:0,y:-24}}},()=>{const t=function(t){const e=t.w/2,n=t.h/2;return{t:{x:t.position.x-e,y:t.position.y-n},b:{x:e,y:n}}}(n);return s=t.t,t.b},t=>{const i={w:n.w,h:n.h,p:Y(n.position)},o=function(t,e,n,a){const i=O(Nt(t[ct].data,a),e,-1);let s=!1;function o(t){i[t]<48&&(i[t]=48);const a=48*Math.round(i[t]/48),o="x"===t?"w":"h";n[o]!==a&&(n[o]=a,n.position[t]=e[t]+a/2,s=!0)}return o("x"),o("y"),da(n,i,a.target),s?i:null}(e,s,n,t);o&&(p(),n.h<r.clientHeight&&(ra(n,i),U(n.position,i.p),p(),da(n,o,t.target)),ra(a,n))},null,()=>c(),null,_n);i(o.el,"shrect");const l=e=>t(o.el,e);l("dv").addEventListener("pointerdown",t=>t.preventDefault());const r=l("text"),c=()=>{const t=ca(r,a.h);n.h!==t&&(n.h=t,p())};function d(){!function(t,e){const n=e.w/-2,a=e.h/-2;t.cons.right.position.x=-n,t.cons.left.position.x=n,t.cons.bottom.position.y=-a,t.cons.top.position.y=a,pa(t.el,"main",e.w,e.h,n,a),pa(t.el,"outer",e.w+48,e.h+48,n-24,a-24)}(o,n),ea(l("frg"),n.w,n.h)}const p=()=>{d(),o.draw()};return 96!==n.w||48!==n.h?(d(),o.draw(),o.drawTxtInit()):(o.draw(),o.drawTxtInit()),o.el[ne].patch=t=>{let e=an(o,t);null==t.w&&null==t.h||la(n,t)||(ra(n,t),a.h=n.h,a.w=n.w,d(),e=!0),e&&o.draw(),t.styles&&(sa=[...t.styles])},o.el}qt(2,()=>Je(2,Z(sa)));const la=(t,e)=>t.w===e.w&&t.h===e.h,ra=(t,e)=>{t.h=e.h,t.w=e.w},ca=(t,e)=>I(e,48,t.clientHeight);const da=(t,e,n)=>{a(n,{x:e.x-t.w/2,y:e.y-t.h/2})};const pa=(e,n,a,i,s,o)=>{const l=t(e,n);l.width.baseVal.value=a,l.height.baseVal.value=i,l.x.baseVal.value=s,l.y.baseVal.value=o};let ha;function ua(t,e,n,i,s=48,o=48){const l=O(Nt(t[ct].data,i),e,-1);n.w=l.x<s?s:l.x;const r=n.w/2;n.position.x=e.x+r,n.h=l.y<o?o:l.y;const c=n.h/2;return n.position.y=e.y+c,a(i.target,{x:r,y:c}),{x:-r,y:-c}}function ga(t,e){const n=t=>24*Math.round(t/24);t.w=n(t.w),t.h=n(t.h);const a=ya(t);return t.position.x=e.x-a.tInner.x,t.position.y=e.y-a.tInner.y,a.tInner}function ya(t){const e=ma(t.w),n=ma(t.h);return{tCanvas:{x:t.position.x-e,y:t.position.y-n},tInner:{x:-e,y:-n},bInner:{x:t.w-e,y:t.h-n}}}qt(5,()=>({id:G(),type:5,position:{x:0,y:0},styles:Z(ha)}));const ma=t=>24*Math.floor(t/2/24);function fa(t,e){return xa?async function(t,e){try{const n=await window.showSaveFilePicker({suggestedName:e,types:[ba]}),a=await n.createWritable();return await a.write(t),await a.close(),n}catch(t){"AbortError"!==t.name&&alert("File not saved")}}(t,e):function(t,e){const n=document.createElement("a");n.download=e,n.href=URL.createObjectURL(t),n.click(),URL.revokeObjectURL(n.href),n.remove()}(t,e)}async function wa(t){const e="AbortError";try{return va?await async function(t){const[e]=await window.showOpenFilePicker({types:[t]});return{h:e,f:await e.getFile()}}(t):await new Promise((n,a)=>{!function(t,e,n){const a=document.createElement("input");a.type="file",a.multiple=!1,a.accept=t,a.style.display="none",document.body.appendChild(a);const i=()=>{a?.remove()};r(a,"cancel",t=>{n(t),i()},!0),r(a,"change",async()=>{e(a.files?.length?a.files[0]:null),i()},!0),a.click()}(t.inputAccept,t=>{n({f:t})},()=>a(Error(e)))})}catch(t){if(t.name===e||t.message===e)return null;throw t}}const va="showOpenFilePicker"in window,xa="showSaveFilePicker"in window,ba={accept:{"image/png":[".png"]},inputAccept:"image/png"},ka={accept:{"image/*":[".png",".gif",".jpeg",".jpg",".webp"]},inputAccept:"image/*"};function Ea(t,e,n,a){$a(e,e=>t[ct].select(ze(t,le(e),!0,n,a)))}function $a(t,e){!function(t,e,n){const a=new Image;a.onload=function(){const i=D(e,a.width,a.height);if(!i.c)return URL.revokeObjectURL(a.src),void et(t).then(t=>n(t,i.w,i.h));const s=document.createElement("canvas");s.width=i.w,s.height=i.h;const o=s.getContext("2d");o.imageSmoothingEnabled=!1,o.imageSmoothingQuality="high",o.drawImage(a,0,0,i.w,i.h),URL.revokeObjectURL(a.src),n(s.toDataURL(),i.w,i.h)},a.src=URL.createObjectURL(t)}(t,4096,(t,n,a)=>{const i=D(Math.min(document.body.clientHeight/2,264),n,a),s={id:G(),type:6,position:{x:0,y:0},w:i.w,h:i.h,r:A(a/n),d:t};Ma(s),e(s)})}function Ca(e,n){let s;const o=Yn(e,n,`<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="120" x="-72" y="-48" fill="transparent" stroke="transparent" stroke-width="0" />\n\t\t <rect data-key="selected" class="dg-selected" width="96" height="72" x="-48" y="-24" rx="15" ry="15" fill="none" stroke="transparent" stroke-width="20" style="pointer-events: stroke;" />\n\t\t <image data-key="main" class="dg-main" x="-48" y="-24" style="clip-path: inset(0% round 15px);" preserveAspectRatio="none" decoding="async" width="96" height="72" href="${n.d??"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIGZpbGw9IiNGMkYyRjIiLz48L3N2Zz4="}" />`,{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-24}}},()=>{const t=ya(n);return s=t.tCanvas,t.bInner},t=>l(function(t,e,n,i){const s=O(Nt(t[ct].data,i),e,-1);n.w=s.x<48?48:s.x;const o=n.w/2;n.position.x=e.x+o,n.h=n.r*n.w;const l=n.h/2;return n.position.y=e.y+l,a(i.target,{x:o,y:l}),{x:-o,y:-l}}(e,s,n,t)),()=>l(function(t,e){Ma(t);const n=ya(t);return t.position.x=e.x-n.tInner.x,t.position.y=e.y-n.tInner.y,n.tInner}(n,s)),jn);i(o.el,"shimg");const l=t=>{o.cons.right.position.x=n.w+t.x,o.cons.left.position.x=t.x,o.cons.bottom.position.y=n.h+t.y,o.cons.top.position.y=t.y,pa(o.el,"main",n.w,n.h,t.x,t.y),pa(o.el,"selected",n.w,n.h,t.x,t.y),pa(o.el,"outer",n.w+48,n.h+48,t.x-24,t.y-24),o.draw()};return l(ya(n).tInner),o.el[ne].patch=e=>{const a=sn(o,e),i=(null!=e.w||null!=e.h)&&!la(n,e);i&&ra(n,e),i?l(ya(n).tInner):a&&o.draw(),e.d&&n.d!==e.d&&(n.d=e.d,t(o.el,"main").setAttribute("href",n.d))},o.el}function Ma(t){t.w=24*Math.round(t.w/24),t.h=A(t.r*t.w)}const La=(t,e)=>tn(e,new Ha(t,e));class Ha extends HTMLElement{#n;#e;constructor(t,e){super(),this.#n=e,this.#e=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.ln{display:flex}.ln>*{height:24px;padding:10px;fill-opacity:.3;stroke-opacity:.3}[data-cmd]{cursor:pointer}.d-b [data-cmd-arg=d-b],.d-h [data-cmd-arg=d-h],.ta-1 [data-cmd-arg="1"],.ta-2 [data-cmd-arg="2"],.ta-3 [data-cmd-arg="3"]{fill-opacity:1;stroke-opacity:1}</style><ap-shape-edit id="edit" edit-btn="true" clr-btn="true"><div class="ln"><svg data-cmd="s" data-cmd-arg="d-h" viewBox="0 0 24 24" width="24" height="24"><path d="M17 11V4H19V21H17V13H7V21H5V4H7V11H17Z" fill="rgb(52,71,103)"></path></svg> <svg data-cmd="s" data-cmd-arg="d-b" viewBox="0 0 24 24" width="24" height="24"><path d="M8 11H12.5C13.8807 11 15 9.88071 15 8.5C15 7.11929 13.8807 6 12.5 6H8V11ZM18 15.5C18 17.9853 15.9853 20 13.5 20H6V4H12.5C14.9853 4 17 6.01472 17 8.5C17 9.70431 16.5269 10.7981 15.7564 11.6058C17.0979 12.3847 18 13.837 18 15.5ZM8 13V18H13.5C14.8807 18 16 16.8807 16 15.5C16 14.1193 14.8807 13 13.5 13H8Z" fill="rgb(52,71,103)"></path></svg></div><div class="ln"><svg data-cmd="a" data-cmd-arg="1" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 15h14v2H3v-2zm0-5h18v2H3v-2zm0-5h14v2H3V9z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="a" data-cmd-arg="2" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm2 15h14v2H5v-2zm-2-5h18v2H3v-2zm2-5h14v2H5V9z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="a" data-cmd-arg="3" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm4 15h14v2H7v-2zm-4-5h18v2H3v-2zm4-5h14v2H7V9z" fill="rgb(52,71,103)"/></svg></div></ap-shape-edit>';const e=this.#n[ne].data,n=t.getElementById("edit");r(n,"cmd",t=>{switch(t.detail.cmd){case"style":cn(this.#e,this.#n,t.detail.arg);break;case"del":De(this.#e,[this.#n]);break;case"copy":Ve(this.#e,[this.#n])}});const a=t=>nn(this.#e,this.#n,t);i(n,`ta-${e.a}`),p(t,'[data-cmd="a"]',t=>{const o=Number.parseInt(h(t,"data-cmd-arg"));o!==e.a&&(s(n,`ta-${e.a}`),i(n,`ta-${o}`),a({a:o}))}),["d-h","d-b"].forEach(t=>{e.styles?.includes(t)&&i(n,t)}),p(t,'[data-cmd="s"]',t=>{const o=h(t,"data-cmd-arg"),l={styles:e.styles?_(e.styles):[]};l.styles?.includes(o)?(B(l.styles,o),s(n,o)):(l.styles??=[],l.styles.push(o),i(n,o)),a(l)})}}let Ta;function Sa(e,n){n.w??=96,n.h??=48,n.a??=1;const a={w:n.w,h:n.h};let o;const l=t=>{c("dv").style.display=t},r=Nn(e,n,'<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="96" x="-72" y="-48" fill="transparent" stroke="transparent" stroke-width="0"/><rect data-key="main" class="dg-main" width="96" height="48" x="-48" y="-24" rx="15" ry="15" stroke-width="1"/><foreignObject data-key="frg" width="96" height="48" x="-48" y="-24" style="pointer-events:none"><div style="pointer-events:none;padding:12px 6px 0 6px;height:100%;box-sizing:border-box" class="frg"><div data-key="dv" style="pointer-events:all;display:inline;cursor:pointer;height:100%;box-sizing:border-box"><span contenteditable="plaintext-only" class="txt-edit" data-key="text" style="overflow-wrap:break-word">Title</span></div></div></foreignObject>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:24}},top:{dir:"top",position:{x:0,y:-24}}},()=>{const t=ya(n);return o=t.tCanvas,t.bInner},t=>u(ua(e,o,n,t,48,48)),()=>{u(ga(n,o)),ra(a,n),l("block")},()=>{o=ya(n).tCanvas,h()},La,_n,(t,e)=>{1===e&&l("block")},()=>{l("inline"),a.h=48,h()});i(r.el,"shtxt"),i(r.el,`ta-${n.a}`);const c=e=>t(r.el,e);c("dv").addEventListener("pointerdown",t=>t.preventDefault());const d=c("text"),p=t=>{const e=t.y+24;r.cons.right.position.x=n.w+t.x,r.cons.right.position.y=e,r.cons.left.position.x=t.x,r.cons.left.position.y=e,r.cons.bottom.position.y=n.h+t.y,r.cons.top.position.y=t.y,pa(r.el,"main",n.w,n.h,t.x,t.y),pa(r.el,"outer",n.w+48,n.h+48,t.x-24,t.y-24);const a=c("frg");a.height.baseVal.value=n.h,a.width.baseVal.value=n.w,a.x.baseVal.value=t.x,a.y.baseVal.value=t.y},h=()=>{const t=Va(d,a.h,e[ct].data.scale);n.h!==t&&(n.h=t,p(ga(n,o??ya(n).tCanvas)),r.draw())},u=t=>{p(t),r.draw()};return 96!==n.w||48!==n.h?(p(ya(n).tInner),r.draw(),r.drawTxtInit()):(r.draw(),r.drawTxtInit()),r.draw(),r.el[ne].patch=t=>{var e,o,l;null==t.w&&null==t.h||la(n,t)||(ra(n,t),ra(a,n),p(ya(n).tInner)),an(r,t)&&r.draw(),null!=t.a&&n.a!==t.a&&(e=r.el,o=n.a,l=t.a,s(e,`ta-${o}`),i(e,`ta-${l}`),n.a=t.a),t.styles&&(Ta=[...t.styles])},r.el}customElements.define("ap-rect-txt-settings",Ha),qt(3,()=>Je(3,Z(Ta)));const Va=(t,e,n)=>{const a=t.getClientRects();return a?.length?I(e,24,(a[a.length-1].bottom-a[0].top)/n+15):0};let za;function Ia(e,n,a){t(e,n).setAttribute("d",`M${a.l.x} ${a.l.y} L${a.t.x} ${a.t.y} L${a.r.x} ${a.r.y} L${a.b.x} ${a.b.y} Z`)}function Aa(t,e){const n=t/2,a=e-n,i=n-e;return{l:{x:a,y:0},t:{x:0,y:a},r:{x:i,y:0},b:{x:0,y:i}}}qt(4,()=>Je(4,Z(za)));const Da=(t,e)=>I(e,48,x(t));async function Ba(t,e,n){return function(t,e,n){let a,i;const s=Pa(t,e);if(s)a=new DataView(t,0,s.byteOffset-8),i=new DataView(t,s.byteOffset+s.byteLength+4);else{const e=t.byteLength-12;a=new DataView(t,0,e),i=new DataView(t,e)}const o=new DataView(new ArrayBuffer(8));return o.setUint32(0,n.length),o.setUint32(4,e),new Blob([a,o,n,new Uint32Array([0]),i],{type:"image/png"})}(await t.arrayBuffer(),ja(e),n)}function Pa(t,e){const n=new DataView(t,8);let a,i=0,s=n.getUint32(4);for(;1229278788!==s;){if(a=n.getUint32(i),s===e)return new DataView(t,i+16,a);i=i+12+a,s=n.getUint32(i+4)}return null}function ja(t){return new DataView((new TextEncoder).encode(t).buffer).getUint32(0)}function Za(t,e,n,a){const i=D(Ra()?4096:10836,e.width*n*window.devicePixelRatio,e.height*n*window.devicePixelRatio);0===i.w&&(i.w=1,i.h=1);const s=new Image;s.width=e.width,s.height=e.height,s.crossOrigin="anonymous",s.onload=async function(){Oa()&&await Fa(250);const t=document.createElement("canvas");t.width=i.w,t.height=i.h,t.style.width=`${i.w}px`,t.style.height=`${i.h}px`;const n=t.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(s,e.x,e.y,e.width,e.height,0,0,i.w,i.h),URL.revokeObjectURL(s.src),t.toBlob(a,"image/png")},t.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,s.width),t.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,s.height),et(new Blob([(new XMLSerializer).serializeToString(t)],{type:"image/svg+xml"})).then(t=>{s.src=t})}const Ra=()=>"undefined"!=typeof navigator&&(/iPad|iPhone|iPod/.test(navigator.userAgent||"")||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1),Oa=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Fa=t=>new Promise(e=>setTimeout(e,t)),Ua=[Ye,Ne],Na=[Ye,Ne,Ue,Fe],Ya=(t,e,n)=>Ga(t,q(e),null,n),Ga=(t,e,n,a)=>{const i=Wa(t,n);Ka(t,i)?Xa(t,e,n,i,a):Za((new DOMParser).parseFromString('<svg width="96" height="96" viewBox="0 0 96 96" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="96" height="96" fill="#1AAEE5"/><path d="M51.598 27.4182L68.5684 44.3889L28.9706 83.9869H12V67.0161L51.598 27.4182ZM57.2548 21.7613L65.74 13.2761C67.3024 11.714 69.8348 11.714 71.3968 13.2761L82.7108 24.5898C84.2728 26.1519 84.2728 28.6845 82.7108 30.2466L74.2252 38.7319L57.2548 21.7613Z" fill="#fff"/></svg>',"text/html").body.childNodes[0],{x:0,y:0,height:96,width:96},1,async t=>a(e?await Ba(t,"dgRm",(new TextEncoder).encode(e)):t))},Xa=(t,e,n,a,i)=>{const s=t.ownerSVGElement.cloneNode(!0),l=s.querySelector("#canvas");s.style.backgroundImage=null,n?P(l.children,t=>((t,e)=>e.some(e=>o(t,e)))(t,Ua)?(_a(t),!0):(t.remove(),!1)):qa(l,Na).forEach(t=>_a(t)),P(s.getElementsByTagName("foreignObject"),t=>{t.hasAttribute("data-key")||t.remove()});const r=t[ct].data,c=1/r.scale;l.style.transform=`matrix(1, 0, 0, 1, ${c*(r.position.x-a.x)}, ${c*(r.position.y-a.y)})`,Za(s,{x:0,y:0,height:a.height/r.scale,width:a.width/r.scale},1.5,async t=>i(e?await Ba(t,"dgRm",(new TextEncoder).encode(e)):t))},Ka=(t,e)=>Math.max(e.width/t[ct].data.scale,e.height/t[ct].data.scale)<4e3,Wa=(t,e)=>e?v(qa(t,Ua)):t.getBoundingClientRect(),_a=t=>{s(t,...Na),qa(t,[Ke,Xe]).forEach(t=>t.remove())},qa=(t,e)=>t.querySelectorAll(`.${e.join(", .")}`),Qa=async t=>{const e=await async function(t,e){return Pa(await t.arrayBuffer(),ja(e))}(t,"dgRm");return e?(new TextDecoder).decode(e):null},Ja=navigator.clipboard?.readText,ti="web application/x-dgrm";async function ei(t,e){const n=`${ti}${q(oe(e,!0))}`;await async function(t){try{await navigator.clipboard.writeText(t)}catch(t){alert(t)}}(n),window.ClipboardItem&&Ga(t,null,!0,async t=>{try{try{await navigator.clipboard.write([new window.ClipboardItem({[t.type]:Promise.resolve(t),[ti]:Promise.resolve(new Blob([n],{type:ti}))})])}catch{await navigator.clipboard.write([new window.ClipboardItem({[t.type]:Promise.resolve(t),"text/plain":Promise.resolve(new Blob([n],{type:"text/plain"}))})])}}catch{}})}const ni=async()=>{let t;try{t=await(navigator.clipboard?.read())}catch{}if(!t?.length)return null;const e=t[0],n=await ai(e,ti)??await ai(e,"text/plain"),a=ii(n);if(a)return{data:a};const i=e.types.find(t=>t.startsWith("image/"));return i?{img:await e.getType(i)}:n?{txt:n}:null},ai=async(t,e)=>t.types.includes(e)?await(await t.getType(e)).text():null,ii=t=>{if(!t?.startsWith(ti))return null;try{return Q(t.slice(22))}catch{return null}};function si(t,e,n){const a=function(t,e){async function n(n){if(document.activeElement===t.ownerSVGElement){const a=e();if(a?.length)return n.preventDefault(),ei(t,a),a}return null}async function a(e){const a=await n(e);a&&oi(t,a)}return document.addEventListener("copy",n),document.addEventListener("cut",a),function(){d(document,"copy",n),d(document,"cut",a)}}(t,e);function i(a){if(!u(a)&&("Delete"===a.key||"Backspace"===a.key)){const n=e();return void(n?.length&&oi(t,n))}"Escape"===a.key&&n()}return r(document,"keydown",i),function(){a(),d(document,"keydown",i)}}function oi(t,e){t[ct].select(null),De(t,e)}const li=(t,e,n,a,i,s)=>{t[gi]={i:e,n:n,e:a,m:i},hi(t,0,s,null)},ri=(t,e,n)=>{const a=X(e.name);t[gi]={f:e,n:a},hi(t,1,null,n)},ci=(t,e,n,a=null)=>{t[gi]={n:e},hi(t,1,a,n)},di=t=>{t[gi]=void 0,hi(t,null,null,null)},pi=t=>t[gi],hi=(t,e,n,a)=>t[ct].f(t,t[gi],e,n,a),ui=t=>t?.replace(/[/\\?%*:|"<>]/g,"-"),gi=Symbol(0),yi=(t,e,n)=>{((t,e)=>Ka(t,Wa(t,e)))(t,e)?((t,e,n,a)=>{Xa(t,e,n,Wa(t,n),a)})(t,q(n),e,async e=>mi(t,e)):alert("The image is too big. Select fewer objects.")},mi=async(t,e)=>{const n=`${pi(t)?.n??"dgrm"}.png`;if(st())return void await fa(e,n);const a={files:[new File([e],n,{type:e.type})]};navigator.canShare&&navigator.canShare(a)?await navigator.share(a):await fa(e,n)};class fi extends HTMLElement{#e;#a;constructor(t,e){super(),this.#e=t,this.#a=e}connectedCallback(){const t=this.#a(),e=new Set([6,7]),n=t.some(t=>!e.has((t[ne]||t[ee]).data.type)),a=this.attachShadow({mode:"closed"});a.innerHTML=`<style>.lnf{display:flex}.lnf>*{height:24px;padding:10px;cursor:pointer}.ln{display:flex;align-items:center;color:#0d6efd;line-height:25px;padding:5px 10px;cursor:pointer;white-space:nowrap}.ln>*{margin-right:10px}</style><ap-shape-edit id="edit" ${nt(n,'clr-btn="true"')}></ap-shape-edit><div id="clb" class="ln"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"></path><path d="M7 6V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1h-3v3c0 .552-.45 1-1.007 1H4.007A1.001 1.001 0 0 1 3 21l.003-14c0-.552.45-1 1.007-1H7zm2 0h8v10h2V4H9v2z" fill="rgb(52,71,103)"></path></svg>Copy to clipboard</div><div id="save" class="ln">${st()?Re+"Download":Oe+"Send"} image</div>`;const i=()=>mt(this)[Et].del(),s=t=>{i(),t()};r(a.getElementById("edit"),"cmd",e=>{switch(e.detail.cmd){case"style":s(()=>((t,e,n)=>{const a=oe(e,!1,!1);e.forEach(t=>{(t[ne]??t[ee]).patch(dn(t,n))}),Me(t,a,oe(e,!1,!1))})(this.#e,t,e.detail.arg));break;case"del":s(()=>De(this.#e,t));break;case"copy":s(()=>Ve(this.#e,t))}});const o=(t,e)=>r(a.getElementById(t),"click",()=>s(e));o("clb",async()=>await ei(this.#e,t)),o("save",()=>yi(this.#e,!0,oe(t,!1)))}}customElements.define("ap-grp-settings",fi);const wi=Symbol("p"),vi=Symbol(0),xi=Symbol(0),bi=(t,e)=>tt(t,xi,()=>function(t,e){const n=t.ownerSVGElement;let a,i=Hi();const s=()=>{a&&(a[Et]?.del(),a=null)},o=t=>{s(),a=t};let l,c;const p=a=>{if(s(),!a.isPrimary||e)return d(n,"pointermove",l),d(n,"pointerup",c),void t[ct].moveCapture();c=e=>{d(n,"pointermove",l),o(Ei(t,i,e))},r(n,"pointerup",c,!0),l=e=>{d(n,"pointerup",c),$i(t,i,e,Qt(a))},0===a.button&&r(n,"pointermove",l,!0)};r(n,"pointerdown",p);const h=si(t,()=>Ii(i),()=>{a?s():Ri(i)&&!ji(i)&&t[ct].select(null)}),u=t=>{zi(i),i=t??Hi(),Ai(i,null)};return t[ct].selectedSet=u,t[ct].select=t=>{s();const e=Hi();if(t?.length)for(const n of t)Ti(e,Oi(n));u(e)},()=>{d(n,"pointerdown",p),h(),s(),t[ct].selectedSet=void 0,t[ct].select=void 0}}(t,e)),ki=t=>J(t,xi);const Ei=(t,e,n)=>{if(n[wi])return null;if("a"===(n?.target)?.tagName)return null;const a=Qt(n),i=Oi(a);if(!i)return zi(e),null;const s=Bi(e,a),o=Zi(e);if(o&&s)return Fi(i,n),null;if(n.shiftKey||n.ctrlKey){if(o){const t=ji(e);Ui(t),Ti(e,t)}return s?Si(e,i):Ti(e,i),Ai(e,n),null}return s?vt(new fi(t,()=>Ii(e)),n.clientX-10,n.clientY-10):(zi(e),Ti(e,i),Ai(e,n),null)},$i=(t,e,n,a)=>{if(n[wi])return;if(t[vi]?.size)for(const e of t[vi])if(e(n,a))return;if(a===t.ownerSVGElement)return void t[ct].moveCapture();const i=Bi(e,a);if(!i&&!g(n))return void t[ct].moveCapture();if(!i&&g(n))return zi(e),void Ni(Oi(a),n,a);const s=Zi(e);i&&s?Ni(Oi(a),n,a):i&&!s&&Ci(t,e,n)},Ci=(t,e,n)=>{const a=()=>Mi(e),i=(t,e)=>{e(t[ne].data.position),t[ne].drawPosition()},s=t=>e.shapesToMove.forEach(e=>i(e,t)),o=t=>e.pathEndsToMove.forEach(e=>{t(e.data.position),Gi(e)[ee].drawPosition()}),l=e.shapesToMove?.size&&e.pathEndsToMove?.size?t=>{s(t),o(t)}:e.shapesToMove?.size?t=>{s(t)}:t=>{o(t)},r=a();M(t.ownerSVGElement,n,e=>l(n=>ot(n,t[ct].data.scale,e)),()=>{const n=e=>Yt(e,t[ct].data.cell);e.pathEndsToMove?.size&&o(n),e.shapesToMove?.size&&e.shapesToMove.forEach(t=>{7!==t[ne].data.type&&i(t,n)}),Me(t,r,a())})},Mi=t=>oe([...t.shapesToMove,...Yi(t.pathEndsToMove)],!1,!0),Li=t=>{t[ct].select(null),t[ct].select(t.children)},Hi=()=>({shapes:new Set,paths:new Set,pathEnds:new Set,shapesToMove:new Set,pathEndsToMove:new Set}),Ti=(t,e)=>{if(e.shape)t.shapes.add(e.shape),i(e.shape,Ne);else if(e.path)t.paths.add(e.path),i(e.path,Ne),s(e.path,Fe,Ue),t.pathEnds.delete(e.path[ee].data.s),t.pathEnds.delete(e.path[ee].data.e);else if(e.pathEnd){const n=Gi(e.pathEnd);if(t.paths.has(n))return;t.pathEnds.add(e.pathEnd),i(n,Wi(e.pathEnd))}},Si=(t,e)=>{if(e.shape)t.shapes.delete(e.shape),s(e.shape,Ne);else if(e.path)t.paths.delete(e.path),t.pathEnds.delete(e.path[ee].data.s),t.pathEnds.delete(e.path[ee].data.e),s(e.path,Ne,Fe,Ue);else if(e.pathEnd){const n=Gi(e.pathEnd);if(t.paths.delete(n)){s(n,Ne,Fe,Ue);const a=Ki(e.pathEnd);t.pathEnds.add(a),i(n,Wi(a))}else t.pathEnds.delete(e.pathEnd),s(n,Wi(e.pathEnd))}},Vi=t=>{const e=t=>s(t,Ne,Fe,Ue);t.shapes.forEach(t=>e(t)),t.paths.forEach(t=>e(t)),t.pathEnds.forEach(t=>e(Gi(t)))},zi=t=>{Vi(t);const e=ji(t);e&&Ui(e),t.pathEnds.clear(),t.pathEndsToMove.clear(),t.paths.clear(),t.shapes.clear(),t.shapesToMove.clear()},Ii=t=>[...t.shapes,...t.paths,...Yi(t.pathEnds)],Ai=(t,e)=>{Di(t);const n=Pi(t);n&&(Vi(t),Fi(n,e))},Di=t=>{t.shapesToMove=new Set(t.shapes),t.pathEndsToMove=new Set;const e=e=>{e.shape?t.shapesToMove.add(e.shape.shapeEl):t.pathEndsToMove.add(e)};t.paths?.forEach(t=>{e(t[ee].data.s),e(t[ee].data.e)}),t.pathEnds?.forEach(e)},Bi=(t,e)=>[...t.shapes,...[...t.pathEnds].map(t=>t.el),...t.paths].some(t=>t.contains(e)),Pi=t=>Ri(t)?ji(t):{},ji=t=>1!==t.shapes.size||t.paths.size||t.pathEnds.size?t.shapes.size||1!==t.paths.size||t.pathEnds.size?t.shapes.size||t.paths.size||1!==t.pathEnds.size?null:{pathEnd:R(t.pathEnds)}:{path:R(t.paths)}:{shape:R(t.shapes)},Zi=t=>!!ji(t),Ri=t=>t.shapes.size||t.pathEnds.size||t.paths.size,Oi=t=>{const e=t[ne]?{shape:t}:t.parentElement[ne]?{shape:t.parentElement}:t.parentElement.parentElement[ne]?{shape:t.parentElement.parentElement}:(t.parentElement.parentElement?.parentElement||{})[ne]?{shape:t.parentElement.parentElement.parentElement}:null;if(e)return e;const n=t[ee]?{path:t}:t.parentElement[ee]?{path:t.parentElement}:null;if(n)return n;const a=Xi(t);return a?{pathEnd:a}:null},Fi=(t,e)=>{t.shape?t.shape[ne].click(e):t.path?t.path[ee].click(e):t.pathEnd&&Gi(t.pathEnd)[ee].click(e,t.pathEnd.el)},Ui=t=>{t.shape?t.shape[ne].unselect():t.path?t.path[ee].unselect():t.pathEnd&&Gi(t.pathEnd)[ee].unselect()},Ni=(t,e,n)=>{t.shape?t.shape[ne].moveCapture(e,n):t.path?t.path[ee].moveCapture(e,n):t.pathEnd&&Gi(t.pathEnd)[ee].moveCapture(e,n)},Yi=t=>[...t].map(Gi),Gi=t=>t.el.parentNode,Xi=t=>{const e=t.hasAttribute("data-key")?t:t.parentElement.hasAttribute("data-key")?t.parentElement:null;if(!e)return null;const n=e.parentNode[ee].data;return n.s.el===e?n.s:n.e},Ki=t=>{const e=Gi(t)[ee].data;return e.s===t?e.e:e.s},Wi=t=>Gi(t)[ee].data.s===t?Fe:Ue;function _i(t){const e=(e,n)=>(function(t,e,n){const a=m("path");l(a),i(a,"mrkp"),t.append(a);const s=[],r=e=>s.push(Ut(t[ct].data,e.clientX,e.clientY)),c=new Set,d=t=>{o(t,"mrkt")&&c.add(t)};d(n),r(e),M(a,e,t=>{r(t),a.setAttribute("d",ns(s)),d(document.elementFromPoint(t.clientX,t.clientY))},()=>{let e=as(v([a,...c]));a.remove(),e=is(Ut(t[ct].data,e.x,e.y));const n={id:G(),type:7,position:e,d:""},i=[{position:{x:0,y:0},d:ns(s)}],o=[];c.forEach(t=>{const e=t.parentNode;o.push(e),i.push(e[ne].data)});for(const t of i)Qi(n,t);o.length?Be(t,o,le(n)):Ie(t,le(n),!0)})}(t,e,n),!0);return((t,e)=>{t[vi]??=new Set,t[vi].add(e)})(t,e),()=>{((t,e)=>{t[vi]?.delete(e)})(t,e)}}const qi=t=>`<path data-key="selected" class="dg-selected dg-selected-path" d="${t.d}" stroke="transparent" stroke-width="18" fill="none" style="pointer-events:none"/><path data-key="main" class="mrkp mrkt dg-main" d="${t.d}" stroke="#495057" stroke-width="10" fill="none"/>`;function Qi(t,e){const n=Ji(e.d),a=Y(e.position);O(a,t.position,-1);let i=e.d;for(const t of n){const e=Y(t);is(O(t,a)),i=es(i,e,t)}t.d+=i}const Ji=t=>t.match(/M(.*?)l/g).map(t=>{const e=t.split(" ");return{x:Number.parseFloat(e[0].substring(1)),y:Number.parseFloat(e[1].substring(0,e[1].length-1))}}),ts=t=>`M${t.x} ${t.y}l`,es=(t,e,n)=>t.replaceAll(ts(e),ts(n));function ns(t,e=5,n=2){const a=t.length,i=a-e-1==0;let s="M",o=[t[0].x,t[0].y];const[l,r]=o.map(t=>+t.toFixed(n));let c=`${s}${l} ${r}`,d=l,p=r;const[h,u]=[t[1].x,t[1].y],[g,y]=[(l+h)/2,(r+u)/2],[m,f]=[g-d,y-p].map(t=>+t.toFixed(n));c+=`l${m} ${f}`,d+=m,p+=f;for(let i=1;i<t.length;i+=1+e){const[l,r]=[t[i].x,t[i].y],[h,u]=[l-d,r-p],[g,y]=t[i+1+e]?[t[i+1+e].x,t[i+1+e].y]:[t[a-1].x,t[a-1].y],[m,f]=[g-d,y-p],[w,v]=[(h+m)/2,(u+f)/2];s="q",o=[h,u,w,v],i>1&&(s="t",o=[w,v]),c+=`${s}${o.map(t=>+t.toFixed(n)).join(" ")} `,d+=w,p+=v}return i||(o=[t[a-1].x-d,t[a-1].y-p],c+=`l${o.map(t=>+t.toFixed(n)).join(" ")}`),c}const as=t=>({x:Math.round(t.x+t.width/2),y:Math.round(t.y+t.height/2)}),is=t=>(t.x=Math.round(t.x),t.y=Math.round(t.y),t);let ss;qt(8,()=>({id:G(),type:8,position:{x:0,y:0},styles:Z(ss)}));const os=(t,e)=>{if(t.innerHTML=null,e=e?.trim(),!e?.length)return null;e=K(e.trim());const n=(e,n)=>{const a=t.insertRow(),i=(t,e)=>{const i=a.insertCell();var s,o;i.innerHTML=W(t?.trim()),s=i,o=[n,e].filter(Boolean),s?.classList.add(...o)};j(e.split("|"),t=>i(t,"shtbl-cl-first"),t=>i(t,"shtbl-cl"),t=>i(t,"shtbl-cl-last"))};return j(e.split("\n"),t=>n(t,"shtbl-hdr"),t=>n(t,"shtbl-row"),t=>n(t,"shtbl-row-last")),t},ls=(t,e)=>{const n=t.getBoundingClientRect(),a=document.createElement("textarea");return a.style.left=n.left+10+"px",a.style.top=n.top+18+"px",a.value=e,w(a),a.focus(),a};function rs(t){return!!ps(t)&&(t.c[t.i].u(),t.i-=1,!0)}function cs(t){const e=ds(t);return null!==e&&(t.i=e,t.c[e].r(),!0)}const ds=t=>{if(!t)return null;const e=t.i+1;return e<=t.c.length-1?e:null},ps=t=>t&&t.i>=0,hs=(t,e,n)=>ws(t,()=>{ms(t,Ce(e,n)),re(t,n),on(e)},()=>{ms(t,$e(e,n)),re(t,n)}),us=(t,e,n)=>ws(t,()=>{ms(t,$e(e,n)),re(t,n)},()=>{ms(t,Ce(e,n)),on(e)}),gs=(t,e,n)=>ws(t,()=>{ms(t,Le(n,e)),re(t,e)},()=>{ms(t,Le(e,n)),re(t,n)}),ys=(t,e,n,a,i)=>ws(t,()=>{ms(t,$e(e,n)),re(t,n),ms(t,Ce(a,i)),re(t,i),on(a)},()=>{ms(t,Ce(e,n)),on(e),ms(t,$e(a,i)),re(t,i)}),ms=(t,e)=>{e[fs]=!0,V(t,e)},fs=Symbol(0);function ws(t,e,n){t[$s]??={c:[],i:-1},function(t,e,n){15===t.c.length&&(t.c.splice(0,1),t.i--),t.c.splice(t.i+1),t.i=t.c.push({u:e,r:n})-1}(t[$s],e,n),ks(t)}function vs(t,e){e(t[$s])&&(t[ct].select(null),ks(t))}const xs=t=>vs(t,rs),bs=t=>vs(t,cs);const ks=t=>{return V(t,S(Es,(e=t[$s],{u:ps(e),r:null!==ds(e)})));var e},Es="dgrmh",$s=Symbol("h");class Cs extends HTMLElement{#e;constructor(t){super(),this.#e=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{position:fixed;top:5px;left:60px;white-space:nowrap;display:flex;flex-direction:row}svg{padding:10px;fill:#344767;opacity:.4}.actv{opacity:1;cursor:pointer}</style><div class="menu"><svg id="u" width="24" height="24" viewBox="0 0 24 24"><path d="m6.907 6.68 2.734-2.73a6.66 6.66 0 1 1 9.42 9.42l-8.338 8.338a1 1 0 0 1-1.415-1.415l8.339-8.336A4.66 4.66 0 0 0 11.229 5.2l-.174.166-3.641 3.633H12a1 1 0 0 1 .993.884L13 10a1 1 0 0 1-.883.993l-.117.006-7.06-.001-.095-.01-.112-.024-.131-.047-.082-.04-.102-.064a.996.996 0 0 1-.125-.107l-.092-.105-.074-.114-.046-.093-.038-.105-.016-.058-.016-.081-.007-.062L4 10V3.002a1 1 0 0 1 1.993-.116L6 3.002v4.584l3.641-3.635L6.907 6.68Z"></path></svg> <svg id="r" width="24" height="24" fill="none" viewBox="0 0 24 24"><path d="M18 7.586 14.36 3.951a6.66 6.66 0 1 0-9.42 9.42l8.339 8.337a1 1 0 0 0 1.414-1.415l-8.339-8.336A4.66 4.66 0 0 1 12.771 5.2l.174.166 3.64 3.633H12a1 1 0 0 0-.993.884L11 10a1 1 0 0 0 .883.993l.117.006h7a1 1 0 0 0 .993-.883L20 10V3.002a1 1 0 0 0-1.993-.116L18 3.002v4.584L14.36 3.951 18 7.586Z"/></svg></div>';const e=t.getElementById("u"),n=t.getElementById("r");r(this.#e,Es,t=>{const a=(t,e)=>e?i(t,"actv"):s(t,"actv");a(e,t.detail.u),a(n,t.detail.r)}),r(e,"click",()=>xs(this.#e)),r(n,"click",()=>bs(this.#e))}}function Ms(t,e){re(t,e),Ls(t)}function Ls(t){const e=t.getBoundingClientRect(),n=window.innerWidth/2,a=window.innerHeight/2;t[ct].move(n-e.width/2-e.x,a-e.height/2-e.y,1);const i=t=>t>1?1:Math.max(t,.25),s=Math.min(i(window.innerWidth/e.width),i(window.innerHeight/e.height));s<1&&t[ct].scale(s,{x:n,y:a})}customElements.define("ap-history",Cs);const Hs=async()=>{const t=await ht(()=>(async()=>(await b(`${It}l`)).json())()),n=!!t.b,a=kt(`<style>.cnt .itm a,.cnt .itm span{padding:10px 0;text-wrap:nowrap}.tcl{overflow:hidden}</style><div class="cnt"><div class="mb20">Your monthly payment is <big><span pay>${t.p}<span> ${t.c}</span></span></big>.</div><div class="itm"><span class="tcl w100"><div class="nwp">Your subscription</div>${nt(n,`<small>is paid for by ${t.b}</small>`)} </span><span style="display:inline-block;text-align:right;padding-left:10px"><a href="${Tt}login/del" onclick='return confirm("Delete account and data?")' style="display:block;padding:0" class="btn-del">Delete account</a> <small>Delete account and all data</small></span></div>${it(t.u,t=>`<div class="itm" usr="${t.i}"><span class="tcl w100"><div class="nwp">${t.n}</div></span><a del="${t.i}" class="btn-del" style="padding-left:10px">Delete</a></div>`)}</div><div style="margin-top:auto"><button inv class="w100" ${nt(n,"disabled")}>Buy subscription for person</button> ${nt(n,`<small style="display:block;margin-top:5px">Your subscription is paid for by ${t.b}.<br/>To buy a subscription for a person you have to get your own subscription. <a class="dg-a" href="https://dgrm.net/en/price.html">Buy a subscription here.</a></small>`)}</div>`,null,"Team subscriptions",!1),i=async(t,n)=>{e(a,"pay").innerText=(await ht(()=>n(t))).toString(),a.querySelector(`[usr="${t}"]`).remove()};p(a,"[del]",t=>{const e=Number.parseInt(h(t,"del"));Ts(()=>i(e,Zt),()=>i(e,Rt))}),p(a,"[inv]",()=>Ss(()=>ht(async()=>{const t=Ot();await navigator.clipboard.writeText(`${Tt}subscription-invite/${t}`),await(t=>k(`${It}a`,t))(t),Ht()})))},Ts=(t,e)=>{const n=bt(f('\n\t\t\t<button del class="w100 mb10 btn-del">Delete subscription</button>\n\t\t\t<button dpr class="w100 mb5 btn-del">Delete with permissions</button>\n\t\t\t<small>Person will lose access for all your diagrams and folders.</small>'),null,!0),a=t=>{n[Et].del(),t()};p(n,"[del]",()=>a(t)),p(n,"[dpr]",()=>a(e))},Ss=t=>{const e=bt(f('<div class="mb20">Send the link to the person you want to buy a subscription to.<p>Subscription fees will be included in your monthly payment. You can cancel person subscription at any time.</p><p>Subscription fee is<br/><big>270 â‚½</big> per month.</p></div><button crt class="w100 mb5">Create subscription link</button> <small>The subscription link is one-time only and is active for 24 hours.</small>'),null,!0);p(e,"[crt]",()=>{e[Et].del(),t()})};const Vs=()=>{if(!document.cookie.includes("dgrma=1"))return null;const t=Q(localStorage.getItem("dgrm"));return t&&new Date(t.e)>new Date?t:null},zs=(t,e,n,a,i)=>{e&&Ds(Is(),n,a,e.n,0===n?e.i:e.n,e.i,new Date,i)},Is=()=>`dgrm${Vs()?.l}`,As=(t,e)=>Rs(t,t=>Bs(t.transaction("r","readonly").objectStore("r"),e)),Ds=(t,e,n,a,i,s,o,l)=>Rs(t,t=>{const r=t.transaction("r","readwrite").objectStore("r");Bs(r,c=>{const d=c.find(t=>t.k===i);c.length>=5&&!d&&Ps(t,r,c[c.length-1]);const p=d?.i??s??Ot();r.put({t:e,i:p,k:i,n:a,l:n,d:o}),l&&t.transaction("d","readwrite").objectStore("d").put({i:p,d:l})})}),Bs=(t,e)=>{t.getAll().onsuccess=t=>{e((t.target.result??[]).sort((t,e)=>e.d.getTime()-t.d.getTime()))}},Ps=(t,e,n,a)=>{let i=0;const s=()=>{1!==i?i++:a&&a()};e.delete(n.i).onsuccess=s,1===n.t?t.transaction("d","readwrite").objectStore("d").delete(n.i).onsuccess=s:s()},js=(t,e,n)=>Rs(t,t=>{let a=null,i=null;const s=(t,e)=>{t&&(a=t),e&&(i=e),a&&i&&(a.s=i.d,n(a))};t.transaction("r","readonly").objectStore("r").get(e).onsuccess=t=>{s(t.target.result,null)},t.transaction("d","readonly").objectStore("d").get(e).onsuccess=t=>{s(null,t.target.result)}}),Zs=(t,e,n)=>Rs(t,t=>{const a=t.transaction("r","readwrite").objectStore("r");Bs(a,i=>{const s=i.find(t=>t.k===e);s?Ps(t,a,s,n):n()})}),Rs=(t,e)=>{const n=indexedDB.open(t);n.onerror=()=>console.error(n.error),n.onupgradeneeded=()=>{const t=n.result;t.createObjectStore("d",{keyPath:"i"}),t.createObjectStore("r",{keyPath:"i"})},n.onsuccess=()=>{n.result.onerror=t=>console.error("indexedDB error",t),e(n.result)}},Os=t=>$(qe,t);function Fs(t){V(t,S(we,null,!0))&&(!function(t){for(t[ct].select(null);t.firstChild;)ln(t.firstChild);t[ct].move(0,0,1)}(t),function(t){var e;(e=t[$s])&&(e.c=[],e.i=-1),ks(t)}(t),di(t))}async function Us(t,e){if(!t?.i)return void Ys({a:0,u:[]},!0,!0,e);const n=await ht(()=>(async t=>(await b(`${Vt}${t}`)).json())(t.i)),a=Ys(n,!1,!t.m,e);t.m&&(qs(a,"[anon]",[Qs[0],Qs[1],Qs[2]],e=>ht(async()=>{var a,i;n.a!==e[1]&&(n.a=e[1],await(a=t.i,i=e[1],k(`${Vt}a/${a}`,i.toString())))})),qs(a,"[org]",[Qs[0],Qs[1],Qs[3]],e=>ht(async()=>{const a=n.u.find(t=>-2===t.i);var i,s;a.r!==e[1]&&(a.r=e[1],await(i=t.i,s=e[1],k(`${Vt}o/${i}`,s.toString())))})),Ns(a,n.u,[Qs[1],Qs[3]],(e,n)=>{return a=t.i,E(`${Vt}${a}`,{i:e,r:n});var a}),p(a,"[inv]",()=>Xs(e=>ht(async()=>{const n=Ot();var a,i,s;await navigator.clipboard.writeText(`${Tt}invite/${n}`),await(a=t.i,i=n,s=e,E(`${Vt}i/${a}`,{i:i,r:s})),Ht()})))),p(a,"[cop]",async()=>{await navigator.clipboard.writeText(Os(t.i)),Ht(),a[Et].del()})}const Ns=(t,e,n,a)=>p(t,"[uu]",i=>{const s=i.currentTarget,o=Number(i.currentTarget.getAttribute("uu")),l=n.map(t=>Ct(t[0],()=>{return n=t,ht(async()=>{const t=e.find(t=>t.i===o);t.r!==n[1]&&(s.textContent=n[0],await a(o,n[1]),t.r=n[1])});var n}));l.push(Mt("Delete",()=>ht(async()=>{await a(o,Qs[0][1]),t.querySelector(`[uitm="${o}"]`).remove()}))),_s(i,l)}),Ys=(t,e,n,a)=>kt(`<style>.cnt .itm a,.cnt .itm span{padding:10px 0;text-wrap:nowrap}.cnt .itm a{padding-left:10px}.tcl{overflow:hidden}.disabled .itm a{opacity:.6;pointer-events:none}</style><div class="cnt ${at(e||n)}">${Gs({i:0,n:"Anyone with the link",r:t.a,e:!0})} ${it(t?.u,Gs)}</div><div style="margin-top:auto">${nt(e,'<small class="mb5 dsb">To share, save diagram to the cloud.</small>')} ${nt(n&&!e,'<small class="mb5 dsb">You do not have access to manage permissions.</small>')} <button inv class="w100 mb10" ${at(e||n)}>Invite person</button> <button cop class="w100" ${at(e)}>Copy diagram link</button></div>`,null,"Permissions",a),Gs=t=>`<div class="itm" uitm="${t.i}"><span class="tcl w100"><div class="nwp">${t.n}</div></span><a class="dg-a" ${0===t.i?"anon":-2===t.i?"org":`uu=${t.i}`} ${at(!t.e)}>${Qs[t.r][0]}</a></div>`,Xs=t=>{const e=bt(f('<div class="mb20">Send a link to the person you want to invite.<p>Person must have a DGRM subscription.<br/>You can <a sub class="dg-a">buy subscription for the person</a>.</p></div><div class="mb20" style="display:flex"><span class="w100">Permissions:</span> <a prm class="dg-a">Viewer</a></div><button crt class="w100 mb5">Create invitation link</button> <small>The invitation link is one-time only and is active for 24 hours.</small>'),null,!0);let n=1;qs(e,"[prm]",[Qs[1],Qs[3]],t=>{n=t[1]}),p(e,"[crt]",()=>{e[Et].del(),t(n)}),p(e,"[sub]",()=>{ft(),Hs()})};async function Ks(t){const e=await ht(()=>(async t=>(await b(`${zt}${t}`)).json())(t)),n=Ws(e);qs(n,"[org]",[Qs[0],Qs[1],Qs[3]],n=>ht(async()=>{const a=e.find(t=>-2===t.i);a.r!==n[1]&&(a.r=n[1],await((t,e)=>k(`${zt}o/${t}`,e.toString()))(t,n[1]))})),Ns(n,e,[Qs[1],Qs[3]],(e,n)=>((t,e,n)=>E(`${zt}${t}`,{i:e,r:n}))(t,e,n)),p(n,"[inv]",()=>Xs(e=>ht(async()=>{const n=Ot();await navigator.clipboard.writeText(`${Tt}invite-folder/${n}`),await((t,e,n)=>E(`${zt}i/${t}`,{i:e,r:n}))(t,n,e),Ht()})))}const Ws=t=>kt(`<style>.cnt .itm a,.cnt .itm span{padding:10px 0;text-wrap:nowrap}.cnt .itm a{padding-left:10px}.tcl{overflow:hidden}.disabled .itm a{opacity:.6}</style><div class="cnt">${it(t,Gs)}</div><div style="margin-top:auto"><button inv class="w100">Invite person</button></div>`,null,"Permissions",!0),_s=(t,e)=>$t(t.currentTarget,e),qs=(t,e,n,a)=>p(t,e,t=>{const e=t.currentTarget;_s(t,n.map(t=>Ct(t[0],()=>(async t=>{e.textContent=t[0],a(t)})(t))))}),Qs=[["No access",0],["Viewer",1],["Editor (except permissions)",2],["Editor",3]],Js=async t=>{const n=to(`<div ftr style="margin-top:auto;display:none">${Vs()?'<button cld class="w100 mb10">Open from cloud</button>':'<div class="mb10"><div style="margin-bottom:5px"><small>Log in to access cloud storage.</small></div><button class="w100" disabled="disabled">Open from cloud</button></div>'} <button dvc class="w100">Open from device</button></div>`);n.s();const a=t=>{e(n.m,"ftr").style.display=t?"unset":"none"},i=async()=>{await eo(n.h,n.b,()=>n.m[Et].del()),a(!0)};await i(),p(n.m,"[cld]",()=>ht(async()=>{a(!1),await no(t,n.h,n.b,!0,async()=>await i())})),p(n.m,"[dvc]",async()=>{n.m[Et].del(),await async function(t){try{const e=await wa(ba);if(!e)return;const n=await go(t,e.f);if(!n)return void yo();e.h?ri(t,e.h,n):ci(t,X(e.f.name),n)}catch(t){console.log(t),yo()}}(t)})};const to=t=>{const n=kt(`<style>.mdhc{display:none}.cnt.flp .itm{height:58px}.cnt.flp .itm a{padding:10px 0}.tcl{overflow:hidden;text-decoration:none}.fld{display:flex;align-items:center;gap:8px}</style><div class="cnt flp" cnt></div>${t}`,f('<div class="mb20 hdr" hdr></div>')),a=t=>e(n,t);return{m:n,h:a("hdr"),b:a("cnt"),s:()=>{mt(n).style.display="flex"}}},eo=async(t,e,n)=>{t.innerHTML='<a c class="dg-a">Close</a><b class="nwp" style="margin-right:40px">Recent</b><span></span>',p(t,"[c]",n);const a=await new Promise(t=>As(Is(),t));e.innerHTML=a?.length?it(a,t=>`<div class="itm"><a class="tcl w100" href="${0===t.t?Os(t.k):$(Qe,t.i)}"><div class="nwp">${t.n}</div><div style="display:flex;margin-top:4px">${0===t.t?wo:""} <small style="opacity:.9"><span style="overflow:hidden;text-wrap:nowrap;margin-right:15px">${0===t.t?t.l??"Cloud":t.l??"Device"}</span>${t.d.toLocaleDateString()}</small></div></a></div>`):vo},no=async(t,e,n,a,i)=>{let s=await Dt(),o={i:null,n:"Cloud",m:!0,r:!1};const l=[],r=e=>{s.d.delete(e),e===pi(t)?.i&&di(t),d()},c=(e,n)=>{n&&di(t),s.f.delete(e),d()},d=()=>io(n,o,s,(e,n)=>ht(async()=>{s.d.get(e).n=await(async(t,e)=>(await k(`${St}a/n/${t}`,e)).text())(e,n),e===pi(t)?.i&&((t,e,n)=>{t[gi].n=e,hi(t,0,n,null)})(t,s.d.get(e).n,o?.n),d()}),t=>ht(async()=>{var e;await(e=t,E(`${St}a/d/${e}`)),r(t)}),t=>ht(async()=>{var e;await(e=t,E(`${Vt}r/${e}`)),r(t)}),t=>ht(async()=>{l.push(o),o=s.f.get(t),p(),s=await Dt(t),d()}),(t,e)=>ht(async()=>{s.f.get(t).n=await(async(t,e)=>(await k(`${St}f/n/${t}`,e)).text())(t,e),d()}),e=>ht(async()=>c(e,await(async(t,e)=>{const n=new URL(`${St}f/d/${t}`);return Ft(n,"k",e),(await E(n.toString())).json()})(e,pi(t)?.i))),e=>ht(async()=>c(e,await(async(t,e)=>(await k(`${zt}r/${t}`,e)).json())(e,pi(t)?.i)))),p=()=>ao(e,o,a,i,()=>ht(async()=>{const t=l.pop();o=t,p(),s=await Dt(t.i),d()}),t=>ht(async()=>{const e=await(async t=>(await k(`${St}f/a`,t)).json())(t);e.m=!0,s.f.set(e.i,e),d()}),(t,e)=>ht(async()=>{const n=Ot();s.d.set(n,{i:n,n:await Bt(n,t,e,ie()),d:Date.now(),m:!0,r:!1}),d()}));return d(),p(),()=>({f:o,d:s})},ao=(t,e,n,a,i,s,o)=>{t.innerHTML=`${e.i||n?`<a c class="dg-a" style="display:flex;align-items:center;margin-left:-8px">${fo}</a>`:'<a c class="dg-a">Close</a>'}\n\t\t<b class="nwp">${e.n??""}</b>\n\t\t${e.m?`<a af class="dg-a" style="display:flex">${mo}</a>`:'<span style="width:42px"></span>'}`,p(t,"[c]",()=>e.i?i():a());const l=Ct("Add diagram",()=>ro("New diagram",t=>o(e.i,t)));p(t,"[af]",t=>so(t,e.i?[l,lo(e.i)]:[l,Ct("Add folder",()=>ro("New folder",s))]))},io=(t,e,n,a,i,s,o,l,r,c)=>{t.innerHTML=`${it([...n.f],t=>`<div class="itm"><a class="tcl w100 fld dg-a" fld="${t[0]}"><span><svg width="36" height="36" viewBox="0 0 36 36" fill="none"><path d="M18.6213 7.5H31.5C32.3284 7.5 33 8.17158 33 9V30C33 30.8284 32.3284 31.5 31.5 31.5H4.5C3.67158 31.5 3 30.8284 3 30V6C3 5.17158 3.67158 4.5 4.5 4.5H15.6213L18.6213 7.5ZM31.5 15.5H4.5V30H31.5V15.5ZM31.5 14V9H17.726L14.5 6H4.5V14H31.5Z" fill="#0D6EFD"/></svg></span><div><div class="nwp">${t[1].n}</div>${nt(!!t[1].l,`<small style="opacity: 0.9; overflow: hidden; text-wrap: nowrap; margin-right: 15px;">${t[1].l}</small>`)}</div></a><a class="dg-a" fedt="${t[0]}">${mo}</a></div>`)}\n\t\t${it([...n.d],t=>`<div class="itm"><a class="tcl w100 dg-a" href="${Os(t[0])}"><div nm class="nwp">${t[1].n}</div><div style="display:flex;margin-top:4px">${nt(!!t[1].l,wo)} <small style="opacity:.9">${nt(!!t[1].l,`<span style="overflow: hidden; text-wrap: nowrap; margin-right: 15px;">${t[1].l}</span>`)} ${new Date(t[1].d).toLocaleDateString()}</small></div></a>${nt(t[1].m||t[1].r,`<a class="dg-a" edt="${t[0]}">${mo}</a>`)}</div>`)}\n\t${n.f.size||n.d.size?"":vo}`,p(t,"[fld]",t=>o(Number(t.currentTarget.getAttribute("fld")))),p(t,"[fedt]",t=>{const e=n.f.get(Number(t.currentTarget.getAttribute("fedt"))),a=[];e.m&&a.push(oo(e.n,t=>l(e.i,t)),lo(e.i)),e.r&&a.push(Mt("Exclude from my cloud",()=>c(e.i))),e.m&&a.push(Mt(e.r?"Delete for all":"Delete",()=>r(e.i))),so(t,a)}),p(t,"[edt]",t=>{const e=n.d.get(t.currentTarget.getAttribute("edt")),o=[];e.m&&o.push(oo(e.n,t=>a(e.i,t)),Ct("Share",()=>Us(e,!0))),e.r&&o.push(Mt("Exclude from my cloud",()=>s(e.i))),e.m&&o.push(Mt(e.r?"Delete for all":"Delete",()=>i(e.i))),so(t,o)})},so=(t,n)=>$t(e(t.currentTarget,"dts"),n),oo=(t,e)=>Ct("Rename",()=>ro(t,n=>{t!==n&&e(n)})),lo=t=>Ct("Share",()=>Ks(t));function ro(t,n){const a=bt(f(`<div class="mb20"><input nm type="text" class="w100" placeholder="Name" minlength="4" maxlength="45" value="${t??""}"></div><div><button sv class="w100">Save</button></div>`),"mdm",!0);p(a,"[sv]",()=>{a[Et].del(),n(ui(e(a,"nm").value))})}const co=Symbol(0),po=t=>J(t,co);function ho(t,e){const n=new AbortController;return document.body.addEventListener("dragover",t=>t.preventDefault(),{signal:n.signal}),document.body.addEventListener("drop",async n=>{if(n.preventDefault(),1===n.dataTransfer?.items?.length&&"file"===n.dataTransfer.items[0].kind&&n.dataTransfer.items[0].type.startsWith("image/"))if("getAsFileSystemHandle"in n.dataTransfer.items[0]){const a=await n.dataTransfer.items[0].getAsFileSystemHandle(),i=await e(t,await a.getFile(),n);i&&ri(t,a,i)}else{const a=n.dataTransfer.items[0].getAsFile(),i=await e(t,a,n);i&&ci(t,X(a.name),i)}else yo()},{signal:n.signal}),()=>n.abort()}async function uo(t,e,n){const a=await go(t,e);return a||(Ea(t,e,n.clientX,n.clientY),null)}async function go(t,e){if("image/png"!==e.type)return null;const n=await Qa(e);if(n){Fs(t);const e=Q(n);return Ms(t,e),e}return null}const yo=()=>alert("File cannot be read. Use the exact image file you got from the application."),mo='<svg style="padding-left:10px" dts viewBox="0 0 24 24" width="24" height="24"><path d="M4.5 10.5C3.675 10.5 3 11.175 3 12C3 12.825 3.675 13.5 4.5 13.5C5.325 13.5 6 12.825 6 12C6 11.175 5.325 10.5 4.5 10.5ZM19.5 10.5C18.675 10.5 18 11.175 18 12C18 12.825 18.675 13.5 19.5 13.5C20.325 13.5 21 12.825 21 12C21 11.175 20.325 10.5 19.5 10.5ZM12 10.5C11.175 10.5 10.5 11.175 10.5 12C10.5 12.825 11.175 13.5 12 13.5C12.825 13.5 13.5 12.825 13.5 12C13.5 11.175 12.825 10.5 12 10.5Z" fill="rgb(13,110,253)"></path></svg>',fo='<svg style="padding-right:18px" viewBox="0 0 24 24" width="24" height="24" fill="rgb(13,110,253)"><path d="M10.8284 12.0007L15.7782 16.9504L14.364 18.3646L8 12.0007L14.364 5.63672L15.7782 7.05093L10.8284 12.0007Z"></path></svg>',wo='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;"><path d="M8.27581 3.33333H13.9997C14.3679 3.33333 14.6663 3.63181 14.6663 4V13.3333C14.6663 13.7015 14.3679 14 13.9997 14H1.99967C1.63149 14 1.33301 13.7015 1.33301 13.3333V2.66667C1.33301 2.29848 1.63149 2 1.99967 2H6.94247L8.27581 3.33333ZM13.333 7.33333H2.66634V12.6667H13.333V7.33333ZM13.333 6V4.66667H7.72354L6.3902 3.33333H2.66634V6H13.333Z" fill="#344767"/></svg>',vo='<div class="txt-c" style="border-bottom:none; padding-top:10px;">No items</div>',xo=(t,e,n,a)=>t.put(ko(e,n),new Response(a)),bo=async(t,e,n)=>t.match(ko(e,n)),ko=(t,e)=>`${t}${e}`,Eo=(t,e)=>{const n=[...e.c,...e.u],a=oe(zo(t,n),!1);!function(t,e){for(const n in t.s)e.has(n)&&me(t.s[n])}(a,e.u);const i=Co(a);return e.d.forEach(t=>{a.s[t]=null}),[a,i]},$o=t=>{const e=se(t);return[e,Co(e)]},Co=t=>{const e=new Map;return Object.values(t.s).filter(t=>6===t.type&&t.d).forEach(t=>{e.set(t.id,t.d),delete t.d}),e},Mo=async(t,e)=>{const n=await caches.open("dgrmimg");for(const[a,i]of e)await Pt(t,a,Vo(i)),await bo(n,t,a)||xo(n,t,a,i)},Lo=(t,e,n)=>{re(t,n);let a=Object.values(n.s)?.filter(t=>6===t.type&&!t.d).map(t=>t.id);a.length&&(a=zo(t,a).filter(t=>!t[ne].data.d).map(t=>t[ne].data.id),a.length&&To(t,e,a))};let Ho;const To=(t,e,n)=>{Ho||(Ho=new Worker("/imgwrkr.js",{type:"module"}),r(Ho,"message",e=>So(t,e.data[0],e.data[1]))),Ho.postMessage([e,n])},So=(t,e,n)=>{if(!n?.length)return;const a=zo(t,[e]);a?.length&&a[0][ne].patch({d:n})},Vo=t=>{const e=t.split(";base64,"),n=e[0].split(":")[1],a=e[1],i=atob(a),s=new Array(i.length);for(let t=0;t<i.length;t++)s[t]=i.charCodeAt(t);const o=new Uint8Array(s);return new Blob([o],{type:n})},zo=(t,e)=>e?.length?[...t.querySelectorAll(e.map(t=>`[id="${t}"]`).join(","))]:null,Io=()=>`User${Math.floor(100*Math.random())}`,Ao=(t,e)=>{if(e?.length)return e.forEach(e=>{t.s[e]=null}),t},Do=t=>{const e=Bo(t),n=document.createElement("div");return n.innerHTML=`<svg viewBox="0 0 24 24" width="24" height="24"><path d="M2.89945 2.30007L21.7052 8.56867C21.9672 8.65599 22.1088 8.93915 22.0215 9.20112C21.975 9.34065 21.8694 9.45262 21.7328 9.50725L13.0002 13.0003L8.57501 21.8506C8.45151 22.0976 8.15118 22.1977 7.90419 22.0742C7.77883 22.0115 7.68553 21.8991 7.64703 21.7644L2.26058 2.91177C2.18472 2.64626 2.33846 2.36951 2.60398 2.29365C2.70087 2.26597 2.80386 2.26821 2.89945 2.30007Z" fill="${e}"></path></svg> <span style="background-color:rgba(255,255,255,.5);border-radius:5px;padding:2px">${t}</span>`,n.style.cssText=`position: fixed; top:0; color:${e}; pointer-events: none;`,n.style.transform="translate(-9999px, 0px)",w(n),n},Bo=t=>`hsl(${[...t].reduce((t,e)=>e.charCodeAt(0)+((t<<5)-t),0)%360}, 97%, 47%)`,Po=(t,e,n,a)=>{const i=((t,e,n)=>({x:t.position.x+e*t.scale,y:t.position.y+n*t.scale}))(t[ct].data,n,a);e.style.transform=`translate(${i.x}px, ${i.y}px)`},jo=async t=>{const e=pi(t);if(e?.f){const n=se(t);Ya(t,n,async a=>{const i=await e.f.createWritable();await i.write(a),await i.close(),zs(0,e,1,null,n),No(t)})}else if(e?.i)if(e.e){if(tl(t))return void Lt("Autosave is enabled. Manual saving is not necessary.");ht(async()=>{await Uo(t,e.i,!0),No(t),Qo(t,e,!1)})}else alert('You do not have access to edit this diagram.\r\nUse "Save As" to make your own copy.');else Zo(t)},Zo=async t=>Vs()?Ro(t):Oo(t),Ro=async t=>{const n=await ht(()=>(async(t,e)=>{const n=to(e),a=await no(t,n.h,n.b,!1,()=>n.m[Et].del());return n.s(),{m:n.m,d:()=>a()}})(t,`<div style="margin-top:auto"><input snm type="text" class="w100 mb10" placeholder="Name" minlength="4" maxlength="45" value="${pi(t)?.n??""}"> <button cld class="w100 mb10">Save to cloud</button> <button dvc class="w100">Save to device</button></div>`)),a=()=>n.m[Et].del(),i=()=>ui(e(n.m,"snm").value);p(n.m,"[dvc]",()=>{a(),Fo(t,i())}),p(n.m,"[cld]",async()=>{const e=n.d();if(e.d.d.size>29&&(alert("Maximum number of diagrams in folder exceeded"),1))return;const s=async t=>{ht(t),a()},o=(n,a)=>{li(t,n,a,!0,!0,e?.f?.n),No(t)},l=i(),r=Object.entries(e.d.d).find(t=>t[1].n===l);if(r){const e=pi(t);return r[0]===e?.i&&e.m?void s(async()=>{await Uo(t,e.i,!0),No(t)}):void(confirm("Overwrite existing file?")&&s(async()=>{const[e,n]=$o(t),a=r[0],i=await(async(t,e)=>(await E(`${St}a/o/${t}`,e)).text())(a,e);await Mo(a,n),o(a,i)}))}s(async()=>{const[n,a]=$o(t),i=Ot(),s=await Bt(i,e.f.i,l,n);await Mo(i,a),o(i,s)})})},Oo=t=>{const n=bt(f(`<div class="mb20"><input nm type="text" class="w100" placeholder="Name" minlength="4" maxlength="45" value="${pi(t)?.n??""}"></div><div class="mb10"><div style="margin-bottom:5px"><small>Log in to access cloud storage.</small></div><button class="w100" disabled="disabled">Save to cloud</button></div><div><button dvc class="w100">Save to device</button></div>`),"mdm");p(n,"[dvc]",()=>{Fo(t,ui(e(n,"nm").value)),n[Et].del()})},Fo=(t,e)=>{const n=se(t);Ya(t,n,async a=>{const i=fa(a,e?.length?e:Yo());if(i){const e=await i;e&&(ri(t,e,n),No(t))}else ci(t,e,n),No(t)})},Uo=async(t,e,n)=>{let a;if(n&&Ko(t)){const[n,i]=Eo(t,_o(t));a=await(async(t,e)=>(await E(`${St}u/${t}`,e)).json())(e,n),await Mo(e,i)}else a=(await At(e)).d;Lo(t,e,a),P(t.children,t=>{Object.prototype.hasOwnProperty.call(a.s,t.id)||ln(t)})},No=(t,e)=>{Wo(t),Lt("Saved")},Yo=()=>{const t=t=>t<10?`0${t}`:t.toString(),e=new Date;return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}.${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}.png`},Go=t=>{t[qo]?.r(),t[qo]=void 0},Xo=t=>{if(t[qo])return;const e=new AbortController;t[qo]={c:new Set,u:new Set,d:new Set,r:()=>{e.abort(),Wo(t)}};const n=e=>{t[qo].c.add(e),t[qo].u.delete(e),t[qo].d.delete(e)},a=e=>{t[qo].c.has(e)||t[qo].u.add(e),t[qo].d.delete(e)},i=e=>e?.forEach(e=>{t[qo].d.add(e),t[qo].c.delete(e),t[qo].u.delete(e)}),s=(n,a)=>c(e.signal,t,n,a);s(ve,t=>{t.detail.newIds?.forEach(n)}),s(be,t=>{return e=t.detail.shapesToUpdData,Object.keys(e.s).forEach(a);var e}),s(xe,t=>i(t.detail.delIds)),s(ke,t=>{i(t.detail.delIds),t.detail.newIds?.forEach(n)}),t.addEventListener(we,e=>{!Ko(t)||window.confirm("Changes you made may not be saved. Continue?")?Wo(t):e.preventDefault()},{signal:e.signal}),window.addEventListener("beforeunload",e=>{Ko(t)&&e.preventDefault()},{signal:e.signal})},Ko=t=>t[qo]?.c.size||t[qo]?.u.size||t[qo]?.d.size,Wo=t=>{t[qo]?.c.clear(),t[qo]?.u.clear(),t[qo]?.d.clear()},_o=t=>t[qo],qo=Symbol(0),Qo=(t,e,n)=>{const a=()=>{t[Jo]&&t[Jo](),delete t[Jo],Xo(t),el(!1),al()};a(),!n&&e?.i&&(pt(!0),t[Jo]=((t,e,n,a)=>{const i=G(),s=new AbortController,o=new Map,l=new WebSocket(`${Tt}w/${e.i}/${i}/${Vs()?.n??Io()}`),r=(t,e)=>c(s.signal,l,t,e);let d=t=>l.send(q(t));return r("open",()=>{if(e.e){const n=t=>d([2,t]),a=(e,n)=>c(s.signal,t,e,n),i=async t=>await Mo(e.i,Co(t));a(ve,async t=>{await i(t.detail.shapesToCreateData),n(t.detail.shapesToCreateData)}),a(be,t=>n(t.detail.shapesToUpdData)),a(xe,t=>n(Ao(ie(),t.detail.delIds))),a(ke,async t=>{let e;t.detail.shapesToCreateData?(e=t.detail.shapesToCreateData,await i(e)):e=ie(),n(Ao(e,t.detail.delIds))})}c(s.signal,t.ownerSVGElement,"pointermove",z(e=>{const n=Ut(t[ct].data,e.clientX,e.clientY);d([1,i,Math.round(n.x),Math.round(n.y)])},60)),n()}),r("message",n=>{const a=Q(n.data);switch(a[0]){case 1:Po(t,o.get(a[1]),a[2],a[3]);break;case 2:{const n=a[1],i=[];for(const[t,e]of Object.entries(n.s))e||(i.push(t),delete n.s[t]);i.length&&on(i),Lo(t,e.i,n)}break;case 3:o.set(a[1],Do(a[2]));break;case 4:o.get(a[1]).remove(),o.delete(a[1])}}),r("close",t=>{console.log(t),a(t.reason)}),()=>{d=()=>{},s.abort(),l?.readyState===WebSocket.OPEN&&l?.close(),o.forEach(t=>t.remove())}})(t,e,()=>{Go(t),e.e&&el(!0),pt(!1)},()=>{a(),pt(!1),nl(t,e)}))},Jo=Symbol(0),tl=t=>t[Jo],el=t=>{n("menu").a=t},nl=(t,e)=>{const n=f('<div id="rcn" style="position:fixed;top:0;right:0;margin:15px;color:#e74c3c;cursor:pointer" class="dg-a">Working offline. <a>Connect.</a></div>');n.onclick=()=>ht(async()=>{await Uo(t,e.i,e.e),Qo(t,e,!1)}),w(n)},al=()=>n("rcn")?.remove();class il extends HTMLElement{#e;constructor(t){super(),this.#e=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{position:fixed;top:5px;left:5px;cursor:pointer;padding:10px}[options]{position:fixed;padding:10px 15px 15px 15px;box-shadow:0 4px 24px rgba(0,0,0,.12);border-radius:8px;background-color:#fff;top:0;left:0;z-index:1;max-height:100%;overflow-y:overlay;box-sizing:border-box}[options] a,[options] div{color:#0d6efd;cursor:pointer;padding:5px 0;display:flex;align-items:center;line-height:25px}[options] a svg,[options] div svg{margin-right:10px}.about{margin-left:auto;font-size:smaller}[options] .hr{border-bottom:solid rgba(52,71,103,.4) 1px;padding-bottom:15px;margin-bottom:10px}@media only screen and (min-width:700px){.about{display:none!important}}</style><div menu class="menu"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgb(52,71,103)"/></svg></div>';const n=t=>{this.contains(t.target)||s()};let a;let i=null;const s=()=>{i.remove(),i=null,d(document,"pointerdown",n),a&&a()},o=()=>{r(document,"pointerdown",n,!0),a=T(s),i=function(t,e,n){const a=Vs(),i=pi(t),s=a||va||i?.i&&i?.e,o=e?"Save (autosave enabled)":i?.i?"Save and sync with cloud":"Save",l=f(`<div menu2><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgb(52,71,103)"/></svg><a class="about" href="https://dgrm.net/en/hints.html" target="_blank">Help</a></div><div new><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M9 2.003V2h10.998C20.55 2 21 2.455 21 2.992v18.016a.993.993 0 0 1-.993.992H3.993A1 1 0 0 1 3 20.993V8l6-5.997zM5.83 8H9V4.83L5.83 8zM11 4v5a1 1 0 0 1-1 1H5v10h14V4h-8z" fill="rgb(52,71,103)"/></svg>New</div><div open><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 21a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h7.414l2 2H20a1 1 0 0 1 1 1v3h-2V7h-7.414l-2-2H4v11.998L5.5 11h17l-2.31 9.243a1 1 0 0 1-.97.757H3zm16.938-8H7.062l-1.5 6h12.876l1.5-6z" fill="rgb(52,71,103)"/></svg>Open</div>${s?'<div save><svg viewBox="0 0 24 24" width="24" height="24"><path d="M7 19V13H17V19H19V7.82843L16.1716 5H5V19H7ZM4 3H17L21 7V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM9 15V19H15V15H9Z" fill="rgba(52,71,103,1)"></path></svg>'+o+"</div>":""}<div saveas class="hr"><svg viewBox="0 0 24 24" width="24" height="24" fill="rgb(52,71,103)"><path d="M18 21V13H6V21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H17L21 7V20C21 20.5523 20.5523 21 20 21H18ZM16 21H8V15H16V21Z"></path></svg>Save${xa||s?" as":""}</div><div down>${st()?Re+"Download":Oe+"Send"} image</div><div link class="hr"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13.06 8.11l1.415 1.415a7 7 0 0 1 0 9.9l-.354.353a7 7 0 0 1-9.9-9.9l1.415 1.415a5 5 0 1 0 7.071 7.071l.354-.354a5 5 0 0 0 0-7.07l-1.415-1.415 1.415-1.414zm6.718 6.011l-1.414-1.414a5 5 0 1 0-7.071-7.071l-.354.354a5 5 0 0 0 0 7.07l1.415 1.415-1.415 1.414-1.414-1.414a7 7 0 0 1 0-9.9l.354-.353a7 7 0 0 1 9.9 9.9z" fill="rgb(52,71,103)"/></svg>Share</div><div login><svg viewBox="0 0 24 24" width="24" height="24"><path d="M10 11V8L15 12L10 16V13H1V11H10ZM2.4578 15H4.58152C5.76829 17.9318 8.64262 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C8.64262 4 5.76829 6.06817 4.58152 9H2.4578C3.73207 4.94289 7.52236 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C7.52236 22 3.73207 19.0571 2.4578 15Z" fill="rgba(52,71,103,1)"></path></svg> ${a?a.n:"Log in"}</div>`);l.setAttribute("options","");const r=(t,e)=>p(l,t,async t=>{n(),await e(t)});p(l,"[menu2]",()=>n()),r("[new]",()=>{Fs(t)}),s&&r("[save]",async()=>await jo(t));return r("[saveas]",()=>Zo(t)),r("[open]",async()=>await Js(t)),r("[login]",()=>function(){const t=Vs(),e=bt(f(t?`<div class="mb20 txt-c">${t.n}<br/><small>${t.l}</small></div><div>${nt(t.s,'<button sbs class="mb10 w100">Team subscriptions</button>')} <a href="${Tt}login/out" class="btn">Log out</a> ${nt(t.s,`<a href="${Tt}login/del" onclick='return confirm("Delete account and data?")' class="btn btn-del mb5 mt10">Delete account</a><small>Delete account and all data. Disable auto payment for subscription.</small>`)}</div>`:`<div class="mb20 txt-c">Log in to access<br/>cloud storage</div><div><a href="https://accounts.google.com/o/oauth2/auth?client_id=1070629747786-dii6fkdmqhvoccdoqp2h5oul96sknjac.apps.googleusercontent.com&prompt=select_account&response_type=code&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile&redirect_uri=https%3A%2F%2Fapi.dgrm.net%2Fapi%2Flogin%2Fg" class="btn mb10"><svg height="24" viewBox="0 0 24 24" width="24" style="margin-right:5px"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/><path d="M1 1h22v22H1z" fill="none"/></svg> Log in with Google </a><a href="https://oauth.yandex.ru/authorize?response_type=code&client_id=97eecc7396ca470bb10e92b12f11bab8&force_confirm=yes" class="btn mb10"><svg width="24" height="24" fill="none" style="margin-right:5px"><path d="M2.04 12c0-5.523 4.476-10 10-10 5.522 0 10 4.477 10 10s-4.478 10-10 10c-5.524 0-10-4.477-10-10z" fill="#FC3F1D"></path><path d="M13.32 7.666h-.924c-1.694 0-2.585.858-2.585 2.123 0 1.43.616 2.1 1.881 2.959l1.045.704-3.003 4.487H7.49l2.695-4.014c-1.55-1.111-2.42-2.19-2.42-4.015 0-2.288 1.595-3.85 4.62-3.85h3.003v11.868H13.32V7.666z" fill="#fff"></path></svg> Log in with Yandex </a><a href="https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize?client_id=3f4ce2db-a37b-4bb4-b8aa-66ba4af2005b&response_type=code%20id_token&redirect_uri=https%3A%2F%2Fapi.dgrm.net%2Fapi%2Flogin%2Fms%2Flogin&response_mode=form_post&scope=openid%20profile&nonce=${G()}" class="btn"><svg width="21" height="21" style="margin-right:5px" viewBox="0 0 21 21"><rect x="1" y="1" width="9" height="9" fill="#f25022"/><rect x="1" y="11" width="9" height="9" fill="#00a4ef"/><rect x="11" y="1" width="9" height="9" fill="#7fba00"/><rect x="11" y="11" width="9" height="9" fill="#ffb900"/></svg> Log in with Microsoft</a></div>`));p(e,"[sbs]",()=>{e[Et].del(),Hs()})}()),r("[link]",()=>(t=>Us(pi(t),!1))(t)),r("[down]",()=>yi(t,!1,se(t))),l}(this.#e,this.a,()=>s()),t.append(i)};r(e(t,"menu"),"click",()=>o())}a=!1}customElements.define("ap-menu",il);class sl extends HTMLElement{#e;#i;#s;#o;#l;constructor(t){super(),this.#e=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{overflow-x:auto;padding:0;position:fixed;top:50%;left:5px;transform:translateY(-50%);box-shadow:0 4px 24px rgba(0,0,0,.12);border-radius:8px;background-color:rgba(255,255,255,.9)}.content{white-space:nowrap;display:flex;flex-direction:column}[data-cmd]{cursor:move}.menu svg{padding:10px}.stroke{stroke:#344767;stroke-width:2px;fill:transparent}.menu .big{width:62px;min-width:62px}.mrk{cursor:pointer;opacity:.4}.tbl{border-top:1px solid #c2c8d1}@media only screen and (max-width:700px){.menu{width:100%;border-radius:0;bottom:0;display:flex;flex-direction:column;top:unset;left:unset;transform:unset}.content{align-self:center;flex-direction:row}.tbl{border-top:none;border-left:1px solid #c2c8d1}}</style><div id="smenu" class="menu" style="touch-action:none"><div class="content"><svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="1" viewBox="0 0 24 24" width="24" height="24"><circle r="9" cx="12" cy="12"></circle></svg> <svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="4" viewBox="0 0 24 24" width="24" height="24"><path d="M2 12 L12 2 L22 12 L12 22 Z" stroke-linejoin="round"></path></svg> <svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="2" viewBox="0 0 24 24" width="24" height="24"><rect x="2" y="4" width="20" height="16" rx="3" ry="3"></rect></svg> <svg data-cmd="shapeAdd" data-cmd-arg="0" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13 8v8a3 3 0 0 1-3 3H7.83a3.001 3.001 0 1 1 0-2H10a1 1 0 0 0 1-1V8a3 3 0 0 1 3-3h3V2l5 4-5 4V7h-3a1 1 0 0 0-1 1z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="shapeAdd" data-cmd-arg="3" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13 6v15h-2V6H5V4h14v2z" fill="rgb(52,71,103)"/></svg> <svg id="m" class="mrk" viewBox="0 0 24 24" width="24" height="24" fill="rgb(52,71,103)"><path d="M15.2427 4.51149L8.50547 11.2487L7.79836 13.37L6.7574 14.411L9.58583 17.2394L10.6268 16.1985L12.7481 15.4913L19.4853 8.75413L15.2427 4.51149ZM21.6066 8.04702C21.9972 8.43755 21.9972 9.07071 21.6066 9.46124L13.8285 17.2394L11.7071 17.9465L10.2929 19.3607C9.90241 19.7513 9.26925 19.7513 8.87872 19.3607L4.63608 15.1181C4.24556 14.7276 4.24556 14.0944 4.63608 13.7039L6.0503 12.2897L6.7574 10.1683L14.5356 2.39017C14.9261 1.99964 15.5593 1.99964 15.9498 2.39017L21.6066 8.04702ZM15.2427 7.33992L16.6569 8.75413L11.7071 13.7039L10.2929 12.2897L15.2427 7.33992ZM4.28253 16.8859L7.11096 19.7143L5.69674 21.1285L1.4541 19.7143L4.28253 16.8859Z"></path></svg> <svg class="tbl" data-cmd="shapeAdd" data-cmd-arg="8" viewBox="0 0 24 24" width="24" height="24" fill="rgba(52,71,103,1)"><path d="M21 3C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3H21ZM11 13H4V19H11V13ZM20 13H13V19H20V13ZM11 5H4V11H11V5ZM20 5H13V11H20V5Z"></path></svg> <svg data-cmd="shapeAdd" data-cmd-arg="5" viewBox="0 0 24 24" width="24" height="24"><path d="M7.82929 20C7.41746 21.1652 6.30622 22 5 22C3.34315 22 2 20.6569 2 19C2 17.6938 2.83481 16.5825 4 16.1707V7.82929C2.83481 7.41746 2 6.30622 2 5C2 3.34315 3.34315 2 5 2C6.30622 2 7.41746 2.83481 7.82929 4H16.1707C16.5825 2.83481 17.6938 2 19 2C20.6569 2 22 3.34315 22 5C22 6.30622 21.1652 7.41746 20 7.82929V16.1707C21.1652 16.5825 22 17.6938 22 19C22 20.6569 20.6569 22 19 22C17.6938 22 16.5825 21.1652 16.1707 20H7.82929ZM7.82929 18H16.1707C16.472 17.1476 17.1476 16.472 18 16.1707V7.82929C17.1476 7.52801 16.472 6.85241 16.1707 6H7.82929C7.52801 6.85241 6.85241 7.52801 6 7.82929V16.1707C6.85241 16.472 7.52801 17.1476 7.82929 18ZM5 6C5.55228 6 6 5.55228 6 5C6 4.44772 5.55228 4 5 4C4.44772 4 4 4.44772 4 5C4 5.55228 4.44772 6 5 6ZM19 6C19.5523 6 20 5.55228 20 5C20 4.44772 19.5523 4 19 4C18.4477 4 18 4.44772 18 5C18 5.55228 18.4477 6 19 6ZM19 20C19.5523 20 20 19.5523 20 19C20 18.4477 19.5523 18 19 18C18.4477 18 18 18.4477 18 19C18 19.5523 18.4477 20 19 20ZM5 20C5.55228 20 6 19.5523 6 19C6 18.4477 5.55228 18 5 18C4.44772 18 4 18.4477 4 19C4 19.5523 4.44772 20 5 20Z" fill="rgb(52,71,103)"></path></svg></div></div>';const e=t.getElementById("smenu");e.querySelectorAll('[data-cmd="shapeAdd"]').forEach(t=>{r(t,"pointerdown",this),r(t,"click",this)}),r(e,"pointerleave",this),r(e,"pointerup",this),r(e,"pointermove",this);const n=t.getElementById("m");let a;r(n,"click",()=>{a?(a(),a=null,n.style.opacity="0.4"):(a=_i(this.#e),n.style.opacity="1")})}handleEvent(t){switch(t.type){case"pointermove":if(!this.#i){const e=document.elementFromPoint(t.clientX,t.clientY);if(e===this.#s)return;this.#o===this.#s&&this.#e.ownerSVGElement.setPointerCapture(t.pointerId),this.#s=e}break;case"pointerleave":if(this.#i=!0,null!=this.#l){const e=ol(this.#e,this.#l,!1,t.clientX,t.clientY)[0];g(t)||this.#e[ct].select([e]),e[ne]?e[ne]?.moveCapture(t,e,!0):e[ee]?.moveCapture(t,e,!0)}this.#r();break;case"pointerdown":this.#l=parseInt(h(t,"data-cmd-arg")),this.#o=document.elementFromPoint(t.clientX,t.clientY),this.#s=this.#o,this.#i=null;break;case"pointerup":this.#r();break;case"click":this.#e.ownerSVGElement.focus(),this.#e[ct].select(ol(this.#e,parseInt(h(t,"data-cmd-arg")),!0))}}#r(){this.#l=null,this.#o=null,this.#s=null}}customElements.define("ap-menu-shape",sl);const ol=(t,e,n,a,i)=>{return ze(t,le((s=e,_t.get(s)())),n,a,i);var s};const ll=Symbol(0),rl=t=>tt(t,ll,()=>function(t){const e=new AbortController;c(e.signal,document,"paste",async e=>{if(!u(e)){const n=(t=>{const e=t.getData("text/plain"),n=ii(e);return n?{data:n}:t.files?.length&&t.files.item(0).type?.startsWith("image/")?{img:t.files.item(0)}:e?{txt:e}:null})(e.clipboardData);cl(t,await ni()??n)}});const n=z(async()=>await jo(t),500);return document.addEventListener("keydown",async e=>{if((e.ctrlKey||e.metaKey)&&"KeyS"===e.code&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&!e.repeat&&!u(e))switch(e.code){case"KeyZ":ft(),xs(t);break;case"KeyY":ft(),bs(t);break;case"KeyS":ft(),e.shiftKey?Zo(t):n();break;case"KeyA":ft(),Li(t)}},{signal:e.signal}),()=>e.abort()}(t));function cl(t,e,n,a){const i=e=>t[ct].select(ze(t,e,!0,n,a));if(e?.data)i(function(t){if(!t)return null;const e=new Map,n=t=>{const n=G();return e.set(t,n),n},a=[];for(const e in t.s){const i=n(t.s[e].id);t.s[i]=t.s[e],t.s[i].id=i,delete t.s[e],0===t.s[i].type&&a.push(t.s[i])}return a.forEach(t=>{t.s.s=e.get(t.s.s),t.e.s=e.get(t.e.s)}),t}(e.data));else if(e?.img)$a(e.img,t=>i(le(t)));else{if(e?.txt){const n=function(t,e){const n=f(null,"padding: 15px 8px 0 8px; width:96px; visibility:hidden;");Fn(n,t),w(n);const a=Va(n,48,e);return n.remove(),{w:96,h:a}}(e.txt,t[ct].data.scale);return void i(le({id:G(),type:3,position:{x:0,y:0},title:e.txt,w:n.w,h:n.h}))}Lt("Clipboard is empty")}}const dl=Symbol(0),pl=t=>tt(t,dl,()=>function(t){const e=t.ownerSVGElement,n=t.ownerDocument;let a,i,s,o;function l(e){d(n,"pointermove",y),d(n,"pointerup",u),s||(s=function(t,e,n,a){const i=f(`<style>.ln{display:flex;align-items:center;color:#0d6efd;line-height:25px;padding:5px 10px;cursor:pointer;white-space:nowrap}.ln>*{margin-right:10px}</style>${Ja?'<div p class="ln" style="padding-top: 10px;"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7 4V2h10v2h3.007c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 21.007V4.993C3 4.445 3.445 4 3.993 4H7zm0 2H5v14h14V6h-2v2H7V6zm2-2v2h6V4H9z" fill="rgb(52,71,103)"/></svg>Paste</div>':""}<div s class="ln" ${Ja?"":'style="padding-top: 10px;"'}><svg viewBox="0 0 24 24" width="24" height="24" fill="rgba(52,70,103,1)"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM11.0026 16L6.75999 11.7574L8.17421 10.3431L11.0026 13.1716L16.6595 7.51472L18.0737 8.92893L11.0026 16Z"></path></svg>Select all</div><div i class="ln" style="padding-bottom:10px"><svg viewBox="0 0 24 24" width="24" height="24" fill="rgba(52,71,103,1)"><path d="M2.9918 21C2.44405 21 2 20.5551 2 20.0066V3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44495 22 3.9934V20.0066C22 20.5552 21.5447 21 21.0082 21H2.9918ZM20 15V5H4V19L14 9L20 15ZM20 17.8284L14 11.8284L6.82843 19H20V17.8284ZM8 11C6.89543 11 6 10.1046 6 9C6 7.89543 6.89543 7 8 7C9.10457 7 10 7.89543 10 9C10 10.1046 9.10457 11 8 11Z"></path></svg>Add image</div>`),s=(t,e)=>p(i,t,async()=>{await e(),a()});Ja&&s("[p]",async()=>cl(n,await ni(),t,e));s("[s]",async()=>Li(n)),s("[i]",async()=>async function(t,e,n){const a=await wa(ka);a&&Ea(t,a.f,e,n)}(n,t,e));return{del:vt(i,t-10,e-10)[Et].del,el:i}}(e.clientX,e.clientY,t,u),r(n,"pointerdown",g))}function h(){s?.del(),s=null}function u(){clearTimeout(a),a=null,h(),d(n,"pointerdown",g),d(n,"pointerup",u),d(n,"wheel",u),d(n,"keydown",u),d(n,"pointerup",w),d(n,"pointercancel",w),d(n,"pointermove",m),i=!1,o=!1}function g(t){s.el.contains(t.target)||u()}function y(){u(),i=!0}function m(){o||u(),i=!0}function w(){o=!0}const v=new AbortController;async function x(t){t.isPrimary&&Qt(t)===e?(u(),r(n,"pointermove",y,!0),r(n,"pointerup",u,!0),r(n,"wheel",u,!0),r(n,"keydown",u,!0),2!==t.button&&(a=setTimeout(()=>{l(t),r(n,"pointerup",w,!0),r(n,"pointercancel",w,!0),r(n,"pointermove",m,!0)},500))):u()}return c(v.signal,e,"pointerdown",x),e.addEventListener("contextmenu",async t=>{e===Qt(t)&&(t.preventDefault(),i||l(t))},{signal:v.signal}),()=>{v.abort(),u()}}(t));const hl=Symbol(0),ul=t=>tt(t,hl,()=>function(t){const e=t.ownerSVGElement;let n,s,o,l,p;const h=()=>{p?.remove(),p=null};let u=!1;function g(t){if(t[wi]||!o)return void f();t[wi]=!0,u&&(h(),u=!1);const e=t.clientX-s.x,n=t.clientY-s.y;o.width.baseVal.value=Math.abs(e),o.height.baseVal.value=Math.abs(n),e<0&&(l.x=t.clientX),n<0&&(l.y=t.clientY),o.style.transform=`translate(${l.x}px, ${l.y}px)`}function y(e){if(o&&!u){e[wi]=!0;const n=e=>fl(Ut(t[ct].data,l.x,l.y),o.width.baseVal.value/t[ct].data.scale,o.height.baseVal.value/t[ct].data.scale,e.x,e.y);!function(t,e,n,a){const i=Hi(),s=t=>Ti(i,t),o=t=>t.shape&&n(t.shape.shapeEl)||a(t);for(const t of e)if(t[ne])n(t)&&s({shape:t});else if(t[ee]){const e=o(t[ee].data.s),n=o(t[ee].data.e);e&&n?s({path:t}):e?s({pathEnd:t[ee].data.s}):n&&s({pathEnd:t[ee].data.e})}t[ct].selectedSet(i)}(t,t.children,t=>n(t[ne].data.position),t=>n(t.data.position))}f()}function f(){clearTimeout(n),n=null,o?.remove(),o=null,h(),u=!1,d(e,"pointermove",g),d(e,"wheel",f),d(e,"pointercancel",f),d(e,"pointerup",y)}const w=new AbortController;return c(w.signal,e,"pointerdown",c=>{if(!c.isPrimary||Qt(c)!==e||ml(c))return void f();r(e,"pointermove",g),r(e,"wheel",f,!0),r(e,"pointercancel",f,!0),r(e,"pointerup",y,!0);const d=()=>{t[ct].selectedSet(null),u=!0,e.setPointerCapture(c.pointerId),s={x:c.clientX,y:c.clientY},l={x:c.clientX,y:c.clientY},o=m("rect"),o.style.cssText="rx:8px; fill: rgb(108 187 247 / 51%)",a(o,l),e.append(o)};2!==c.button?n=setTimeout(()=>{d(),p=m("circle"),i(p,"ative-elem"),p.style.cssText="r:10px; fill: rgb(108 187 247 / 51%)",a(p,{x:c.clientX,y:c.clientY}),e.append(p)},500):d()}),()=>{w.abort(),f()}}(t)),gl=t=>J(t,hl);const yl=-1!==window.navigator.userAgent.indexOf(" OPR"),ml=t=>yl&&0!==t.button,fl=(t,e,n,a,i)=>t.x<=a&&a<=t.x+e&&t.y<=i&&i<=t.y+n,wl=t=>{document.title=t??"DGRM - Flowchart editor"},vl=t=>{bl().style.display="none",kl(),(t=>{po(t),tt(t,co,()=>ho(t,(t,e)=>go(t,e)))})(t),(t=>{J(t,dl)})(t),(t=>{J(t,ll)})(t),Go(t),gl(t),ki(t),Kt(t),bi(t,!0),Xt(t)},xl=t=>{bl().style.display="",El(),(t=>{po(t),tt(t,co,()=>ho(t,uo))})(t),pl(t),rl(t),Xo(t),gl(t),ki(t),Kt(t),ul(t),bi(t,!1),Xt(t)},bl=()=>document.getElementsByTagName("ap-menu-shape")[0],kl=()=>w(f('<div id="rnl" style="position: fixed;bottom: 0;left: 0;padding: 15px;opacity: 0.4;">Read only mode</div>')),El=()=>n("rnl")?.remove(),$l=n("canvas");$l[ct]={data:{position:{x:0,y:0},scale:1,cell:24},shapeMap:function(e){const n=(t,n)=>pn(e,t,n);return{[he]:{create:t=>n(Cn(e,t),3)},1:{create:i=>n(function(e,n){n.r??=48,"Title"===n.title&&48===n.r&&(n.p=40);let i,s=n.r;const o=Nn(e,n,'<circle data-key="outer" data-evt-no data-evt-index="2" r="72" fill="transparent" stroke-width="0"/><circle data-key="main" class="dg-main" r="48" fill="#ff6600" stroke="#fff" stroke-width="1"/><foreignObject data-key="frg" width="98" height="98" x="-49" y="-49" style="border-radius:50%;cursor:pointer"><div data-key="dv" style="height:98px;width:98px;text-align:center"><i style="float:left;height:100%;width:50%;shape-outside:polygon(0 0,98% 0,50% 6%,23.4% 17.3%,6% 32.6%,0 50%,6% 65.6%,23.4% 82.7%,50% 94%,98% 100%,0 100%)"></i> <i style="float:right;height:100%;width:50%;shape-outside:polygon(2% 0,100% 0,100% 100%,2% 100%,50% 94%,76.6% 82.7%,94% 65.6%,100% 50%,94% 32.6%,76.6% 17.3%,50% 6%)"></i> <span contenteditable="plaintext-only" class="txt-edit" data-key="text" style="padding-top:40px"></span></div></foreignObject>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},()=>(i=F(n.position,-n.r),{x:n.r,y:n.r}),t=>{let o=Nt(e[ct].data,t).x-i.x;o<48&&(o=48);const l=48*Math.round(o/48)/2;n.r!==l&&(c(24),n.r<=l&&(n.r=l,n.position.x=i.x+l,n.position.y=i.y+l,p(),s=l));const r=o-n.r;a(t.target,{x:r,y:r})},null,()=>c(s)),l=e=>t(o.el,e);l("dv").addEventListener("pointerdown",t=>t.preventDefault());const r=l("text"),c=t=>{for(n.r=t,p();aa(r,t)>n.r;)n.r=n.r+24,p()};function d(){o.cons.right.position.x=n.r,o.cons.left.position.x=-n.r,o.cons.bottom.position.y=n.r,o.cons.top.position.y=-n.r,na(l("outer"),n.r+24),na(l("main"),n.r),ea(l("frg"),2*n.r+2)}const p=()=>{d(),o.drawTxt(),o.draw()};return 48!==n.r?(d(),o.draw(),o.drawTxtInit()):(o.draw(),o.drawTxtInit()),o.el[ne].patch=t=>{let e=an(o,t);null!=t.r&&n.r!==t.r&&(n.r=t.r,s=n.r,d(),e=!0),e&&o.draw(),t.styles&&(ta=[...t.styles])},o.el}(e,i),2)},2:{create:t=>n(oa(e,t),2)},3:{create:t=>n(Sa(e,t),2)},4:{create:s=>n(function(e,n){n.w??=96,"Title"===n.title&&96===n.w&&(n.p=48);let s,o=n.w;const l=Nn(e,n,'<path data-key="outer" data-evt-no data-evt-index="2" d="M-72 0 L0 -72 L72 0 L0 72 Z" stroke-width="0" fill="transparent"/><path data-key="border" class="dg-border" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="20" stroke="#fff" fill="transparent" stroke-linejoin="round"/><path data-key="main" class="dg-main" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="18" stroke-linejoin="round" stroke="#1D809F" fill="#1D809F"/><foreignObject data-key="frg" width="114" height="114" x="-57" y="-57" style="border-radius:50%;cursor:pointer"><div data-key="dv" style="height:114px;width:114px;text-align:center"><i style="float:left;height:100%;width:50%;shape-outside:conic-gradient(from 45deg at 0 50%,transparent 90deg,#fff)"></i> <i style="float:right;height:100%;width:50%;shape-outside:conic-gradient(from 225deg at 100% 50%,transparent 90deg,#fff)"></i> <span contenteditable="plaintext-only" class="txt-edit" data-key="text" style="padding-top:48px"></span></div></foreignObject>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},()=>{const t=n.w/2;return s=F(n.position,-t),{x:t,y:t}},t=>{let i=Nt(e[ct].data,t).x-s.x;i<48&&(i=48);const l=48*Math.round(i/48);if(n.w!==l&&(d(48),n.w<=l)){n.w=l;const t=l/2;n.position.x=s.x+t,n.position.y=s.y+t,h(),o=l}const r=i-n.w/2;a(t.target,{x:r,y:r})},null,()=>d(o));i(l.el,"shrhomb");const r=e=>t(l.el,e);r("dv").addEventListener("pointerdown",t=>t.preventDefault());const c=r("text"),d=t=>{for(n.w=t,h();Da(c,t)>n.w;)n.w=n.w+48,h()};function p(){const t=Aa(n.w,0);l.cons.right.position.x=t.r.x,l.cons.left.position.x=t.l.x,l.cons.bottom.position.y=t.b.y,l.cons.top.position.y=t.t.y;const e=Aa(n.w,9);Ia(l.el,"main",e),Ia(l.el,"border",e),Ia(l.el,"outer",Aa(n.w,-24)),ea(r("frg"),n.w+18)}const h=()=>{p(),l.drawTxt(),l.draw()};return 96!==n.w?(p(),l.draw(),l.drawTxtInit()):(l.draw(),l.drawTxtInit()),l.el[ne].patch=t=>{let e=an(l,t);null!=t.w&&n.w!==t.w&&(n.w=t.w,o=n.w,p(),e=!0),e&&l.draw(),t.styles&&(za=[...t.styles])},l.el}(e,s),2)},5:{create:t=>n(function(t,e){let n;e.w??=96,e.h??=96;const a=Yn(t,e,'<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="144" x="-72" y="-72" fill="transparent" stroke="transparent" stroke-width="0" />\n\t\t <rect data-key="selected" class="dg-selected" width="96" height="96" x="-48" y="-48" rx="15" ry="15" fill="none" stroke="transparent" stroke-width="20" style="pointer-events: stroke;" />\n\t\t <rect data-key="main" class="dg-main" width="96" height="96" x="-48" y="-48" rx="15" ry="15" stroke="transparent" stroke-width="1.8" style="pointer-events: none;" />',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},()=>{const t=ya(e);return n=t.tCanvas,t.bInner},a=>s(ua(t,n,e,a)),()=>s(ga(e,n)));i(a.el,"shbox");const s=t=>{a.cons.right.position.x=e.w+t.x,a.cons.left.position.x=t.x,a.cons.bottom.position.y=e.h+t.y,a.cons.top.position.y=t.y,pa(a.el,"main",e.w,e.h,t.x,t.y),pa(a.el,"selected",e.w,e.h,t.x,t.y),pa(a.el,"outer",e.w+48,e.h+48,t.x-24,t.y-24),a.draw()};return 96!==e.w||96!==e.h?s(ya(e).tInner):a.draw(),a.el[ne].patch=t=>{const n=(null!=t.w||null!=t.h)&&!la(e,t);n&&ra(e,t);const i=an(a,t);n?s(ya(e).tInner):i&&a.draw(),t.styles&&(ha=[...t.styles])},a.el}(e,t),1)},[ue]:{create:t=>n(Ca(e,t),0)},[ge]:{create:t=>n(function(t,e){const n=Yn(t,e,qi(e),{},null,null,null,jn,()=>{is(e.position)});return i(n.el,"shmrk"),n.el.style.mixBlendMode="multiply",n.draw(),n.el[ne].patch=t=>{sn(n,t)&&n.draw()},n.el}(e,t),4)},8:{create:a=>n(function(e,n){let a,s;n.w??=192,n.h??=216,n.d??="Planet | Moons\nEarth | 1\nMars | 2\nJupiter | 16\nSaturn | 21";const o=()=>{s&&(s.classList.value="",i(s,"dg-txtarea",...n.styles))},l=Yn(e,n,'<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="144" x="-72" y="-72" fill="transparent" stroke="transparent" stroke-width="0"/><rect data-key="selected" class="dg-selected" width="96" height="96" x="-48" y="-48" rx="15" ry="15" fill="none" stroke="transparent" stroke-width="20" style="pointer-events:stroke"/><rect data-key="main" class="dg-main shtbl-mn" width="96" height="96" x="-48" y="-48" rx="15" ry="15" stroke="rgb(26, 174, 229)" stroke-width="1.8" fill="#fff"/><rect data-key="hdr" width="96" height="63" x="-48" y="-48" fill="rgb(26, 174, 229)" rx="15" ry="15" style="clip-path:inset(0 0 15px 0)" class="shtbl-h"/><foreignObject data-key="frgn" width="96" height="96" x="-48" y="-48"><div style="padding:0 15px"><table data-key="tbl" style="width:100%;pointer-events:none;border-collapse:collapse;font-family:Arial,sans-serif;font-size:16px;color:#495057"></table></div></foreignObject>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},()=>{const t=ya(n);return a=t.tCanvas,t.bInner},t=>r(ua(e,a,n,t,48,96)),()=>r(ga(n,a)),Bn,null,(t,e)=>{2===e&&(s||(s=ls(l.el,n.d),o()))},()=>{if(!s)return;const t=s.value;if(s.remove(),s=null,n.d!==t){const a=()=>oe([l.el],!1,!1),i=a();n.d=t,c(),Me(e,i,a())}});i(l.el,"shtbl");const r=t=>{l.cons.right.position.x=n.w+t.x,l.cons.left.position.x=t.x,l.cons.bottom.position.y=n.h+t.y,l.cons.top.position.y=t.y,pa(l.el,"main",n.w,n.h,t.x,t.y),pa(l.el,"selected",n.w,n.h,t.x,t.y),pa(l.el,"hdr",n.w,63,t.x,t.y),pa(l.el,"frgn",n.w,n.h,t.x,t.y),pa(l.el,"outer",n.w+48,n.h+48,t.x-24,t.y-24),l.draw()},c=()=>os(t(l.el,"tbl"),n.d);return c(),96!==n.w||96!==n.h?r(ya(n).tInner):l.draw(),l.el[ne].patch=t=>{const e=(null!=t.w||null!=t.h)&&!la(n,t);e&&ra(n,t);const a=an(l,t);e?r(ya(n).tInner):a&&l.draw(),null!=t.d&&n.d!==t.d&&(n.d=t.d,c()),o(),t.styles&&(ss=[...t.styles])},l.el}(e,a),2)}}}($l),f:(t,e,n,a,i)=>{Ho&&(Ho.terminate(),Ho=null);const s="DGRM examples"===a;var o;s||!e?.i||e.e?xl(t):vl(t),wl(e?.n),zs(0,e,n,a,i),Qo(t,e,s),0===n?(o=Os(e.i),history.replaceState(null,null,o)):C(qe,Qe,"u")}};{const t=new URL(window.location.href),e=e=>t.searchParams.get(e);e("usr")&&(Cl=e("usr"),Ml=e("usrn"),Ll=parseInt(e("expr")),Hl="1"===e("subs"),localStorage.setItem("dgrm",q({l:Cl,n:Ml,e:Ll,s:Hl})),C("usr","usrn","expr","subs"))}var Cl,Ml,Ll,Hl,Tl,Sl;(t=>{const e=new il(t);e.id="menu",w(e)})($l),w(new Cs($l)),w(new sl($l)),$l.ownerSVGElement.addEventListener("contextmenu",async t=>{u(t)||t.preventDefault()}),function(t){let e,n,a;function i(t){t.isPrimary&&t.isTrusted&&(e&&Math.abs(e.x-t.clientX)<3&&Math.abs(e.y-t.clientY)<3?t.stopImmediatePropagation():(e=null,t[lt]=n?t.clientX-n:0,t[rt]=a?t.clientY-a:0,n=t.clientX,a=t.clientY))}t.addEventListener("pointerdown",s=>{e={x:s.clientX,y:s.clientY},n=null,a=null,t.addEventListener("pointermove",i,{capture:!0,passive:!0}),t.addEventListener("pointerup",()=>{d(t,"pointermove",i,!0)},{capture:!0,once:!0,passive:!0})},{capture:!0,passive:!0})}(document),(t=>{const e=(e,n)=>r(t,e,t=>{t[fs]||n(t)});e(ve,e=>hs(t,e.detail.newIds,e.detail.shapesToCreateData)),e(xe,e=>us(t,e.detail.delIds,e.detail.shapesToDelData)),e(be,e=>gs(t,e.detail.shapesBeforeUpdData,e.detail.shapesToUpdData)),e(ke,e=>ys(t,e.detail.delIds,e.detail.shapesToDelData,e.detail.newIds,e.detail.shapesToCreateData))})($l);{const t=new URL(window.location.href),n=e=>t.searchParams.get(e);if(n(qe)){pt(!0);const t=n(qe);try{const e=await At(t);li($l,t,e.n,e.e,e.m,e.l),Lo($l,t,e.d),Ls($l)}catch(e){alert("The link is broken or you do not have permission. Try to relogin."),await(Sl=t,new Promise(t=>Zs(Is(),Sl,()=>t()))),di($l),console.log(e)}pt(!1)}else if(n(Qe))try{const t=n(Qe),e=await(Tl=t,new Promise(t=>js(Is(),Tl,t)));e&&(ci($l,e.n,e.s),Ms($l,e.s))}catch{alert("The link is broken."),di($l)}else if(n("u"))try{const t=new URL(n("u")),e=Q(await Qa(await(await fetch(t)).blob()));ci($l,(t=>t.substring(t.lastIndexOf("/")+1))(t.href),e,t.hostname),Ms($l,e)}catch{yo(),di($l)}else di($l),Vs()||function(){const t=f('<div style="position:fixed;left:50%;top:30%;transform:translate(-50%,-30%);width:90%;max-width:400px"><a cl class="dg-a" style="display:inline-block;padding:10px">Close</a> <a href="https://dgrm.net/en/hints.html" target="_blank"><video src="/assets/intro.mp4" poster="/assets/intro.png" style="width:100%;padding-top:5px;display:block;border:1px solid #b3b3b3;border-radius:1.25rem;background-color:#fff" type="video/mp4" muted autoplay playsinline loop></video></a><a class="dg-a" href="https://dgrm.net/en/hints.html" target="_blank" style="margin-left:10px;display:inline-block">View hints and hotkeys</a></div>');function n(){t.remove(),d(document,"pointerdown",a),d(document,"wheel",n),d(document,"keydown",n),d(document,"dragover",n)}function a(e){t.contains(e.target)||n()}t.style.display="unset",r(document,"pointerdown",a),r(document,"wheel",n,!0),r(document,"keydown",n,!0),r(document,"dragover",n,!0),t.addEventListener("wheel",t=>t.preventDefault(),{once:!0}),r(e(t,"cl"),"click",()=>n(),!0),w(t)}()}
