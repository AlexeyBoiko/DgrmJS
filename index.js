!function(){"use strict";function t(t,e){if(!t)return null;let s;for(const n of t)e&&!e(n)||(s=n);return s}function e(t,e){if(!t)return!1;for(const s of t)if(!e||e(s))return!0;return!1}function s(t,e){const s=t.stateGet();s.has(e)||t.update({state:s.add(e)})}function n(t,e){const s=t.stateGet();var n,i;s.has(e)&&t.update({state:(n=s,i=e,n.delete(i),n)})}function i(t){const e=t.shape.postionGet(),s=t.innerPosition;return{templateKey:"connect-end",position:{x:e.x+s.x,y:e.y+s.y},postionIsIntoCanvas:!0,rotate:"out"===t.connectorType?"right"===t.dir?0:"left"===t.dir?180:"bottom"===t.dir?90:270:"right"===t.dir?180:"left"===t.dir?0:"bottom"===t.dir?270:90}}class o{constructor(t){this.t=t}add(t,e){const n=this.t.append("path",{templateKey:"path",start:{position:o.o(t),dir:t.dir},end:{position:o.o(e),dir:e.dir?e.dir:o.h(t.dir)}});n.start=t,n.end=e,s(e,"connected"),o.l(t.shape,n),o.l(e.shape,n)}replaceEnd(i,c){const a=t(i.shape.connectedPaths,(t=>t.end===i));a.update({end:{position:o.o(c),dir:c.dir?c.dir:i.dir}}),a.end=c,i.shape!==c.shape&&(a.start.shape!==i.shape&&i.shape.connectedPaths.delete(a),o.l(c.shape,a)),e(i.shape.connectedPaths,(t=>t.start===i||t.end===i))||n(i,"connected"),s(c,"connected")}updatePosition(t){if(!e(t.connectedPaths))return;const s=t.postionGet();for(const e of t.connectedPaths)e.update({start:e.start.shape===t?{position:{x:s.x+e.start.innerPosition.x,y:s.y+e.start.innerPosition.y}}:null,end:e.end.shape===t?{position:{x:s.x+e.end.innerPosition.x,y:s.y+e.end.innerPosition.y}}:null})}deleteByShape(t){if(e(t.connectedPaths))for(const e of t.connectedPaths)e.end.shape.connectedPaths.delete(e),n(e.end,"connected"),e.start.shape.connectedPaths.delete(e),n(e.start,"connected"),e.end.shape.connectable&&this.t.delete(e.end.shape),this.t.delete(e)}startConnectorGet(e){return t(e.shape.connectedPaths,(t=>t.end===e)).start}static l(t,e){t.connectedPaths||(t.connectedPaths=new Set),t.connectedPaths.add(e)}static o(t){const e=t.shape.postionGet();return{x:e.x+t.innerPosition.x,y:e.y+t.innerPosition.y}}static h(t){switch(t){case"bottom":return"top";case"top":return"bottom";case"left":return"right";case"right":return"left"}}}class c extends EventTarget{constructor(t,e){super(),this.t=t.on("pointermove",this).on("pointerdown",this).on("pointerup",this).on("pointerenter",this).on("pointerleave",this),this.p=e}on(t,e){return this.addEventListener(t,e),this}shapeAdd(t){return this.t.append("shape",t)}shapeDel(t){this.p.deleteByShape(t),this.t.delete(t)}shapeConnect(t){this.p.add(t.start.shape.connectors.get(t.start.connector),t.end.shape.connectors.get(t.end.connector))}handleEvent(t){switch(t.type){case"pointermove":if(this.u){const e={x:this.g.x+t.detail.offsetX,y:this.g.y+t.detail.offsetY};this.u.update({position:e}),this.p.updatePosition(this.u)}break;case"pointerdown":switch(t.detail.target.type){case"canvas":case"shape":this.v(t.detail.target,{x:t.detail.offsetX,y:t.detail.offsetY});break;case"connector":this.m(t)}break;case"pointerup":"connector"===t.detail.target.type&&this.k(t),this.C(),this._();break;case"pointerenter":this.u&&this.u.connectable&&("connector"===t.detail.target.type||"shape"===t.detail.target.type)&&this.T(t.detail.target);break;case"pointerleave":this._()}}m(t){switch(t.detail.target.connectorType){case"out":{const e=this.shapeAdd(i(t.detail.target));this.v(e,{x:t.detail.offsetX,y:t.detail.offsetY}),this.p.add(t.detail.target,e.defaultInConnector);break}case"in":if(t.detail.target.stateGet().has("connected")){if(!this.M("disconnect",{start:this.p.startConnectorGet(t.detail.target),end:t.detail.target}))return;const e=this.shapeAdd(i(t.detail.target));this.v(e,{x:t.detail.offsetX,y:t.detail.offsetY}),this.p.replaceEnd(t.detail.target,e.defaultInConnector)}}}k(t){this.u&&this.u.connectable&&"in"===t.detail.target.connectorType&&this.M("connect",{start:this.p.startConnectorGet(this.u.defaultInConnector),end:t.detail.target})&&(this.p.replaceEnd(this.u.defaultInConnector,t.detail.target),this.shapeDel(this.u))}S(t){t!==this.q&&(this.M("select",{target:t}),this.q&&n(this.q,"selected"),t&&s(t,"selected"),this.q=t)}v(t,e){this.u=t,this.u.connectable&&s(this.u,"disabled");const n=this.u.postionGet();this.g={x:n.x-e.x,y:n.y-e.y},this.S(this.u)}C(){this.u&&n(this.u,"disabled"),this.g=null,this.u=null}T(t){this.L=t,s(t,"hovered"),"connector"===t.type&&s(t.shape,"hovered")}_(){this.L&&(n(this.L,"hovered"),"connector"===this.L.type&&n(this.L.shape,"hovered"),this.L=null)}M(t,e){return this.dispatchEvent(new CustomEvent(t,{cancelable:!0,detail:e}))}}class a{constructor({svgEl:t,start:e,end:s}){this.svgEl=t,this.$=e,this.V=s,this.type="path",this.P()}update(t){t.start&&Object.assign(this.$,t.start),t.end&&Object.assign(this.V,t.end),this.P()}P(){this.svgEl.setAttribute("d",a.B(70,this.$,this.V))}static B(t,e,s){return`M ${e.position.x} ${e.position.y} C ${a.G(e.dir,e.position.x,t)} ${a.O(e.dir,e.position.y,t)}, ${a.G(s.dir,s.position.x,t)} ${a.O(s.dir,s.position.y,t)}, ${s.position.x} ${s.position.y}`}static G(t,e,s){return"right"===t||"left"===t?"right"===t?e+s:e-s:e}static O(t,e,s){return"right"===t||"left"===t?e:"bottom"===t?e+s:e-s}}function h(t,e,s){let n=function(t,e){for(const s of t)if(!e||e(s))return s;return null}(t.transform.baseVal,(t=>t.type===e));return n||(n=(t.ownerSVGElement||s).createSVGTransform(),t.transform.baseVal.appendItem(n)),n}function r(t){const e=h(t,SVGTransform.SVG_TRANSFORM_TRANSLATE).matrix;return{x:e.e,y:e.f}}class l{constructor({svgEl:t,connectorType:e,shape:s,key:n,innerPosition:i,dir:o}){this.j=t,this.A=new Set,this.type="connector",this.connectorType=e,this.shape=s,this.key=n,this.innerPosition=i,this.dir=o}stateGet(){return this.A}update(t){this.A=t.state,this.A.has("connected")?this.j.classList.add("connected"):this.j.classList.remove("connected"),this.A.has("hovered")?this.j.classList.add("hover"):this.j.classList.remove("hover")}}class d{constructor({svgEl:t,type:e=null,connectable:s=null,defaultInConnector:n=null}){this.A=new Set,this.svgEl=t,this.type=e||"shape",this.connectable=s,this.defaultInConnector=n,this.connectors=new Map}stateGet(){return this.A}postionGet(){return r(this.svgEl)}update(t){var e,s,n;t.position&&(e=this.svgEl,s=t.position,h(e,SVGTransform.SVG_TRANSFORM_TRANSLATE,n).setTranslate(s.x,s.y)),t.rotate&&function(t,e,s){h(t,SVGTransform.SVG_TRANSFORM_ROTATE,s).setRotate(e,0,0)}(this.svgEl,t.rotate),t.props&&d.D(this.svgEl,t.props),t.state&&(this.A=t.state,this.A.has("selected")?this.svgEl.classList.add("selected"):this.svgEl.classList.remove("selected"),this.A.has("hovered")?this.svgEl.classList.add("hover"):this.svgEl.classList.remove("hover"),this.A.has("disabled")?this.svgEl.style.pointerEvents="none":this.svgEl.style.pointerEvents="auto")}static D(t,e){Object.keys(e).forEach((s=>{const n="root"===s?t:t.querySelector(`[data-key='${s}'`);Object.keys(e[s]).forEach((t=>{if("textContent"===t)n.innerHTML=e[s][t]?e[s][t].toString().replaceAll("\n",'<tspan x="0" dy="1.2em">&ZeroWidthSpace;</tspan>'):"";else n.setAttribute(t,e[s][t].toString())}))}))}}function p(t,e){return new l({svgEl:t,connectorType:"in"===t.getAttribute("data-connect")?"in":"out",shape:e,key:t.getAttribute("data-key"),innerPosition:u(t),dir:t.getAttribute("data-connect-dir")})}function u(t){if(!t.getAttribute("data-connect-point"))return null;const e=t.getAttribute("data-connect-point").split(",");return{x:parseFloat(e[0]),y:parseFloat(e[1])}}class g extends EventTarget{constructor(t){super(),this.H=t,this.H.addEventListener("pointermove",this),this.H.addEventListener("pointerdown",this),this.H.addEventListener("pointerup",this),this.K=new WeakMap,this.I=t.querySelector('[data-key="canvas"]'),this.K.set(this.I,new d({svgEl:this.I,type:"canvas"}))}append(t,e){switch(t){case"shape":return function({svgCanvas:t,listener:e,svgElemToPresenterObj:s,createParams:n}){const i=t.ownerSVGElement.getElementsByTagName("defs")[0].querySelector(`[data-templ='${n.templateKey}']`).cloneNode(!0);t.append(i);const o=new d({svgEl:i});if(!n.postionIsIntoCanvas){const e=r(t);n.position.x-=e.x,n.position.y-=e.y}return o.update(n),o.connectable="true"===i.getAttribute("data-connectable"),u(i)&&(o.defaultInConnector=p(i,o)),i.addEventListener("pointerdown",e),i.querySelectorAll("[data-connect]").forEach((t=>{const n=p(t,o);t.addEventListener("pointerdown",e),s.set(t,n),o.connectors.set(n.key,n)})),s.set(i,o),o}({svgCanvas:this.I,svgElemToPresenterObj:this.K,listener:this,createParams:e});case"path":return function({svgCanvas:t,createParams:e}){const s=t.ownerSVGElement.getElementsByTagName("defs")[0].querySelector(`[data-templ='${e.templateKey}']`).cloneNode(!0);return t.append(s),new a({svgEl:s,start:e.start,end:e.end})}({svgCanvas:this.I,createParams:e})}}delete(t){this.K.delete(t.svgEl),t.svgEl.remove()}on(t,e){return this.addEventListener(t,e),this}handleEvent(t){switch(t.stopPropagation(),t.type){case"pointermove":this.U(t),this.M("pointermove",null,t.offsetX,t.offsetY);break;case"pointerdown":this.M(t.type,t.currentTarget,t.offsetX,t.offsetY);break;case"pointerup":this.M(t.type,document.elementFromPoint(t.clientX,t.clientY),t.offsetX,t.offsetY)}}U(t){const e=document.elementFromPoint(t.clientX,t.clientY);e!==this.R&&(this.R&&this.M("pointerleave",this.R,t.offsetX,t.offsetY),e&&this.M("pointerenter",e,t.offsetX,t.offsetY),this.R=e)}M(t,e,s,n){let i=null;e&&(i=this.K.get(e===this.H||e.ownerSVGElement!==this.H?this.I:e),i||(i=this.K.get(e.closest("[data-connect]"))),i||(i=this.K.get(e.closest("[data-templ]")))),this.dispatchEvent(new CustomEvent(t,{detail:{target:i,offsetX:s,offsetY:n}}))}}function v(t,e){return e&&"text"!==t?e.replaceAll("\n"," "):e}class f extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{overflow-x:auto;white-space:nowrap;display:flex;padding:0 5px}.menu svg{height:42px;display:inline-block;padding:15px 10px;stroke:#344767;stroke-width:2px;fill:#fff;width:42px;min-width:42px}.menu a{display:none;line-height:42px;padding:10px;font-size:large}.menu .big{width:62px;min-width:62px}.menu a:first-of-type,.menu svg:nth-of-type(2){padding-left:15px}.menu .itm{padding-right:15px;border-right:1px solid rgb(204 207 210);fill:rgba(58,65,111,.5)}@media only screen and (max-width:700px){.menu a{display:unset}.menu svg:last-of-type{padding-right:15px;border-right:1px solid rgb(204 207 210);fill:rgba(58,65,111,.5)}}</style><div class="menu"><svg class="itm" data-cmd="generateLink" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2048 2048"><path d="M1536 768v128q76 0 145 17t123 56 84 99 32 148q0 66-25 124t-69 101-102 69-124 26h-512q-66 0-124-25t-101-69-69-102-26-124q0-87 31-147t85-99 122-56 146-18V768h-64q-93 0-174 35t-142 96-96 142-36 175q0 93 35 174t96 142 142 96 175 36h512q93 0 174-35t142-96 96-142 36-175q0-93-35-174t-96-142-142-96-175-36h-64zm-640 512v-128q76 0 145-17t123-56 84-99 32-148q0-66-25-124t-69-101-102-69-124-26H448q-66 0-124 25t-101 69-69 102-26 124q0 87 31 147t85 99 122 56 146 18v128h-64q-93 0-174-35t-142-96-96-142T0 832q0-93 35-174t96-142 142-96 175-36h512q93 0 174 35t142 96 96 142 36 175q0 93-35 174t-96 142-142 96-175 36h-64z"></path></svg> <svg class="itm" data-cmd="settingsToggle" viewBox="0 0 612 612"><path d="M342.982,612h-73.975c-14.775,0-27.011-11.073-28.467-25.747l-7.584-45.446c-14.249-4.43-28.093-10.184-41.32-17.141\t\t\t\t\tl-38.064,27.183c-4.551,3.772-10.982,6.077-17.576,6.077c-7.646,0-14.825-2.982-20.236-8.393l-52.303-52.304\t\t\t\t\tc-10.446-10.446-11.255-26.93-1.901-38.357l26.778-37.508c-6.978-13.247-12.722-27.102-17.141-41.311l-46.114-7.695\t\t\t\t\tC11.083,370.014,0,357.777,0,342.982v-73.964c0-14.775,11.073-27.011,25.747-28.478l45.446-7.605\t\t\t\t\tc4.439-14.269,10.193-28.113,17.131-41.3l-27.173-38.064C52.191,142.7,53,126.217,63.457,115.78l52.313-52.323\t\t\t\t\tc10.083-10.062,27.345-10.901,38.327-1.921l37.559,26.789c13.177-6.947,27.021-12.691,41.3-17.131l7.675-46.104\t\t\t\t\tC241.997,11.073,254.243,0,269.018,0h73.974c14.755,0,26.991,11.063,28.478,25.727l7.595,45.467\t\t\t\t\tc14.259,4.439,28.103,10.184,41.29,17.131l38.074-27.183c4.541-3.762,10.973-6.058,17.565-6.058\t\t\t\t\tc7.646,0,14.825,2.973,20.226,8.373l52.303,52.323c10.437,10.406,11.275,26.879,1.941,38.317l-26.788,37.539\t\t\t\t\tc6.957,13.187,12.691,27.031,17.131,41.3l46.114,7.696C600.937,242.007,612,254.243,612,269.018v73.964\t\t\t\t\tc0,14.795-11.073,27.021-25.768,28.446l-45.426,7.595c-4.439,14.279-10.184,28.134-17.131,41.32l27.183,38.055\t\t\t\t\tc8.95,10.911,8.11,27.405-2.346,37.821l-52.293,52.293c-10.042,10.052-27.345,10.941-38.357,1.911l-37.508-26.769\t\t\t\t\tc-13.228,6.968-27.071,12.722-41.29,17.142l-7.706,46.124C369.983,600.927,357.747,612,342.982,612z M190.907,501.641\t\t\t\t\tc1.699,0,3.408,0.424,4.945,1.294c15.412,8.637,31.814,15.442,48.794,20.245c3.762,1.062,6.573,4.207,7.22,8.07l8.707,52.344\t\t\t\t\tc0.506,4.874,4.177,8.181,8.434,8.181h73.975c4.257,0,7.918-3.297,8.333-7.514l8.828-53.011c0.637-3.853,3.458-6.998,7.221-8.06\t\t\t\t\tc16.938-4.794,33.341-11.6,48.763-20.246c3.408-1.921,7.636-1.688,10.821,0.597l43.19,30.854c4.359,3.509,8.799,2.78,11.751-0.162\t\t\t\t\tl52.313-52.313c3.074-3.063,3.316-7.888,0.586-11.234l-31.268-43.718c-2.286-3.186-2.508-7.402-0.597-10.83\t\t\t\t\tc8.636-15.352,15.432-31.754,20.226-48.764c1.062-3.772,4.206-6.583,8.079-7.23l52.354-8.728c4.875-0.506,8.182-4.156,8.182-8.414\t\t\t\t\tv-73.964c0-4.257-3.297-7.928-7.514-8.343l-53.011-8.818c-3.873-0.647-7.009-3.458-8.08-7.23\t\t\t\t\tc-4.794-17.01-11.6-33.413-20.226-48.743c-1.911-3.429-1.688-7.646,0.597-10.831l30.874-43.211\t\t\t\t\tc3.125-3.863,2.872-8.677-0.182-11.731L481.91,77.797c-2.942-2.943-8.009-3.195-11.205-0.576l-43.747,31.278\t\t\t\t\tc-3.186,2.286-7.413,2.508-10.82,0.597c-15.361-8.626-31.765-15.432-48.764-20.246c-3.762-1.052-6.573-4.207-7.221-8.07\t\t\t\t\tl-8.717-52.343c-0.536-4.976-4.126-8.211-8.454-8.211h-73.975c-4.338,0-7.918,3.226-8.343,7.514l-8.798,53\t\t\t\t\tc-0.637,3.863-3.458,7.008-7.22,8.07c-17.03,4.824-33.433,11.62-48.753,20.246c-3.438,1.912-7.655,1.689-10.831-0.597\t\t\t\t\tl-43.232-30.874c-4.349-3.479-8.808-2.781-11.751,0.182L77.767,130.08c-3.054,3.054-3.287,7.868-0.556,11.195l31.258,43.758\t\t\t\t\tc2.286,3.195,2.508,7.412,0.597,10.831c-8.616,15.331-15.422,31.733-20.246,48.753c-1.052,3.762-4.207,6.574-8.07,7.221\t\t\t\t\tl-52.343,8.727c-4.956,0.526-8.181,4.116-8.181,8.455v73.964c0,4.328,3.216,7.908,7.493,8.322l53.021,8.818\t\t\t\t\tc3.863,0.638,7.008,3.459,8.07,7.23c4.783,16.919,11.589,33.332,20.246,48.784c1.912,3.418,1.689,7.625-0.597,10.811\t\t\t\t\tL77.605,470.14c-3.155,3.883-2.913,8.696,0.151,11.761l52.313,52.303c2.973,2.963,8.02,3.226,11.205,0.576l43.748-31.258\t\t\t\t\tC186.781,502.277,188.844,501.641,190.907,501.641z M306.01,427.049c-66.764,0-121.079-54.305-121.079-121.059\t\t\t\t\tc0-66.764,54.315-121.079,121.079-121.079c66.765,0,121.069,54.315,121.069,121.079\t\t\t\t\tC427.069,372.733,372.764,427.049,306.01,427.049z M306.01,205.136c-55.609,0-100.854,45.245-100.854,100.854\t\t\t\t\tc0,55.6,45.244,100.833,100.854,100.833c55.6,0,100.844-45.233,100.844-100.833C406.844,250.38,361.609,205.136,306.01,205.136z"/></svg> <svg data-shape="circle"><circle r="20" cx="21" cy="21"></circle></svg> <svg data-shape="rect" class="big"><rect x="1" y="1" width="60" height="40" rx="15" ry="15"></rect></svg> <svg data-shape="rhomb" class="big"><g transform="translate(1,1)"><path d="M0 20 L30 0 L60 20 L30 40 Z" stroke-width="2" stroke-linejoin="round"></path></g></svg> <svg data-shape="text"><text x="5" y="40" font-size="52px" fill="#344767" stroke-width="0">T</text></svg> <a href="https://github.com/AlexeyBoiko/DgrmJS" target="_blank">GitHub</a> <a href="https://linkedin.com/in/alexey-boyko-tech" target="_blank">LinkedIn</a> <a href="https://alexey-boyko.medium.com/" target="_blank">Blog</a> <a href="https://boyko.tech/" target="_blank">boyko.tech</a></div>',t.querySelectorAll("[data-shape]").forEach((t=>t.addEventListener("click",(t=>this.J(t))))),t.querySelectorAll(".itm").forEach((t=>t.addEventListener("click",(t=>this.N(t)))))}on(t,e){return this.addEventListener(t,e),this}J(t){this.M("shapeAddByKey",t.currentTarget.getAttribute("data-shape"))}N(t){this.M(t.currentTarget.getAttribute("data-cmd"))}M(t,e){this.dispatchEvent(new CustomEvent(t,{bubbles:!0,composed:!0,detail:e}))}}customElements.define("ap-menu",f);class m extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>textarea{box-sizing:border-box;width:100%;padding:.5rem .75rem;border:1px solid #d2d6da;border-radius:.5rem;font-size:16px;font-weight:400}textarea:focus,textarea:focus-visible,textarea:focus-within{outline:2px solid #e197d3}button{margin:0;padding:0;border:none;background:0 0}.settings{height:150px;border-bottom:1px solid rgb(204 207 210)}.form{padding:15px}.form footer{text-align:right;padding-top:15px}.form header{text-align:right;padding-bottom:15px}.notset{padding:23px 15px;text-align:center}.form{display:none}.selected .form{display:block}.selected .notset{display:none}</style><div class="settings" id="settings"><div class="notset">Select shape</div><div class="form"><header><button><svg height="26px" viewBox="0 0 482.428 482.429" style="enable-background:new 0 0 612 612;fill:#344767"><path d="M381.163,57.799h-75.094C302.323,25.316,274.686,0,241.214,0c-33.471,0-61.104,25.315-64.85,57.799h-75.098\t\t\t\t\t\t\t\t\tc-30.39,0-55.111,24.728-55.111,55.117v2.828c0,23.223,14.46,43.1,34.83,51.199v260.369c0,30.39,24.724,55.117,55.112,55.117\t\t\t\t\t\t\t\t\th210.236c30.389,0,55.111-24.729,55.111-55.117V166.944c20.369-8.1,34.83-27.977,34.83-51.199v-2.828\t\t\t\t\t\t\t\t\tC436.274,82.527,411.551,57.799,381.163,57.799z M241.214,26.139c19.037,0,34.927,13.645,38.443,31.66h-76.879\t\t\t\t\t\t\t\t\tC206.293,39.783,222.184,26.139,241.214,26.139z M375.305,427.312c0,15.978-13,28.979-28.973,28.979H136.096\t\t\t\t\t\t\t\t\tc-15.973,0-28.973-13.002-28.973-28.979V170.861h268.182V427.312z M410.135,115.744c0,15.978-13,28.979-28.973,28.979H101.266\t\t\t\t\t\t\t\t\tc-15.973,0-28.973-13.001-28.973-28.979v-2.828c0-15.978,13-28.979,28.973-28.979h279.897c15.973,0,28.973,13.001,28.973,28.979\t\t\t\t\t\t\t\t\tV115.744z"></path><path d="M171.144,422.863c7.218,0,13.069-5.853,13.069-13.068V262.641c0-7.216-5.852-13.07-13.069-13.07\t\t\t\t\t\t\t\t\tc-7.217,0-13.069,5.854-13.069,13.07v147.154C158.074,417.012,163.926,422.863,171.144,422.863z"></path><path d="M241.214,422.863c7.218,0,13.07-5.853,13.07-13.068V262.641c0-7.216-5.854-13.07-13.07-13.07\t\t\t\t\t\t\t\t\tc-7.217,0-13.069,5.854-13.069,13.07v147.154C228.145,417.012,233.996,422.863,241.214,422.863z"></path><path d="M311.284,422.863c7.217,0,13.068-5.853,13.068-13.068V262.641c0-7.216-5.852-13.07-13.068-13.07\t\t\t\t\t\t\t\t\tc-7.219,0-13.07,5.854-13.07,13.07v147.154C298.213,417.012,304.067,422.863,311.284,422.863z"></path></svg></button></header><textarea rows="3"></div></div>',t.querySelector("button").addEventListener("click",(t=>this.M("shapeDel"))),this.textField=t.querySelector("textarea"),this.textField.addEventListener("input",(t=>this.M("shapeType",this.textField.value))),this.textField.addEventListener("change",(t=>this.M("shapeType",this.textField.value))),this.settingsDiv=t.getElementById("settings")}on(t,e){return this.addEventListener(t,e),this}update(t){void 0!==t.text&&(this.textField.value=t.text),void 0!==t.disabled&&(this.textField.disabled=t.disabled),void 0!==t.selected&&(t.selected?this.settingsDiv.classList.add("selected"):this.settingsDiv.classList.remove("selected"))}M(t,e){this.dispatchEvent(new CustomEvent(t,{bubbles:!0,composed:!0,detail:e}))}}customElements.define("ap-shape-settings",m);class x extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.panel{position:fixed;bottom:0;box-shadow:0 0 58px 2px rgba(34,60,80,.2);border-radius:0 16px 0 0;background-color:rgba(255,255,255,.7)}@media only screen and (max-width:700px){.panel{width:100%;border-radius:0}.panel.open{border-radius:16px 16px 0 0}}ap-shape-settings{display:none}.panel.open ap-shape-settings{display:block}</style><div id="panel" class="panel"><ap-shape-settings id="shape-settings"></ap-shape-settings><ap-menu id="menu"></ap-menu></div>',this.panel=t.getElementById("panel"),this.shapeSettings=t.getElementById("shape-settings"),this.menu=t.getElementById("menu").on("settingsToggle",(t=>this.F()))}on(t,e){switch(t){case"shapeAddByKey":case"generateLink":this.menu.on(t,e);break;case"shapeDel":case"shapeType":this.shapeSettings.on(t,e)}return this}shapeSettingsUpdate(t){this.shapeSettings.update(t)}F(){this.panel.classList.contains("open")?this.panel.classList.remove("open"):this.panel.classList.add("open")}}customElements.define("ap-panel",x);const b=document.getElementById("panel").on("shapeAddByKey",(t=>{E({templateKey:t.detail,position:{x:120,y:120},detail:"Title"})})).on("shapeDel",(function(){if(!w)return;y.delete(w),k=k.filter((t=>t.start.shape!==w&&t.end.shape!==w)),C.shapeDel(w),_(null)})).on("shapeType",(t=>function(t){if(!w)return;y.get(w).detail=t,w.update({props:{text:{textContent:v(y.get(w).templateKey,t)}}})}(t.detail))).on("generateLink",(function(){const t=function(t,e){if(!t||0===t.size)return null;const s={s:[]},n=new Map;for(const e of t)e[1].position=e[0].postionGet(),n.set(e[0],s.s.push(e[1])-1);return e&&e.length>0&&(s.c=e.map((t=>({s:{i:n.get(t.start.shape),c:t.start.key},e:{i:n.get(t.end.shape),c:t.end.key}})))),JSON.stringify(s)}(y,k);if(t){const e=new URL(window.location.href);return e.hash=encodeURIComponent(t),void navigator.clipboard.writeText(`${e.toString()}`).then((t=>alert("Link to diagram copied to clipboard")))}alert("Nothing to save")})),y=new Map;let w,k=[];const C=function(t){const e=new g(t);return new c(e,new o(e))}(document.getElementById("diagram")).on("select",(t=>_(t.detail.target))).on("connect",(t=>k.push(t.detail))).on("disconnect",(t=>k.splice(k.findIndex((e=>{return s=e,n=t.detail,s.start.shape===n.start.shape&&s.start.key===n.start.key&&s.end.shape===n.end.shape&&s.end.key===n.end.key;var s,n})),1)));function E(t){t.props={text:{textContent:v(t.templateKey,t.detail)}};const e=C.shapeAdd(t);return y.set(e,{templateKey:t.templateKey,detail:t.detail}),e}function _(t){t&&"shape"===t.type?(w=t,y.has(t)?b.shapeSettingsUpdate({selected:!0,text:y.get(t).detail,disabled:!1}):b.shapeSettingsUpdate({selected:!0,text:null,disabled:!0})):(w=null,b.shapeSettingsUpdate({selected:!1}))}if(window.location.hash){const t=JSON.parse(decodeURIComponent(window.location.hash.substring(1)));if(t.s&&t.s.length>0){const e=[];for(const s of t.s)e.push(E(s));if(t.c&&t.c.length>0)for(const s of t.c)C.shapeConnect({start:{shape:e[s.s.i],connector:s.s.c},end:{shape:e[s.e.i],connector:s.e.c}}),k.push({start:{type:"connector",key:s.s.c,shape:e[s.s.i]},end:{type:"connector",key:s.e.c,shape:e[s.e.i]}})}history.replaceState(null,null," ")}}();
