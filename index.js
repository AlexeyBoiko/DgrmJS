!function(){"use strict";function t(t,e){if(!t)return null;let s;for(const i of t)e&&!e(i)||(s=i);return s}function e(t,e){for(const s of t)if(!e||e(s))return s;return null}function s(t,e){if(!t)return!1;for(const s of t)if(!e||e(s))return!0;return!1}function i(t,s,i){let n=e(t.transform.baseVal,(t=>t.type===s));return n||(n=(t.ownerSVGElement||i).createSVGTransform(),t.transform.baseVal.appendItem(n)),n}function n(t,e,s){i(t,SVGTransform.SVG_TRANSFORM_TRANSLATE,s).setTranslate(e.x,e.y)}function o(t){const s=e(t.transform.baseVal,(t=>t.type===SVGTransform.SVG_TRANSFORM_TRANSLATE));return s?{x:s.matrix.e,y:s.matrix.f}:{x:0,y:0}}function h(t,e,s,h){const a=o(t);n(t,{x:h/s*(a.x-e.x)+e.x,y:h/s*(a.y-e.y)+e.y}),i(t,SVGTransform.SVG_TRANSFORM_SCALE).setScale(h,h)}function a(t,e,s){t.innerHTML=function(t,e,s){return t.split("\n").map(((t,i)=>`<tspan x="${e}" dy="${0===i?".4em":`${s}px`}" ${0===t.length?'visibility="hidden"':""}>${0===t.length?".":function(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}(t).replaceAll(" ","&nbsp;")}</tspan>`)).join("")}(e,t.x?.baseVal[0]?.value??0,s.lineHeight),null!=s.verticalMiddle&&(t.y.baseVal[0].value=s.verticalMiddle-t.getBBox().height/2)}function r(t,e){if(!t.stateHas(e)){const s=t.stateGet();t.update({state:s.add(e)})}}function c(t,e){if(t.stateHas(e)){const n=t.stateGet();t.update({state:(s=n,i=e,s.delete(i),s)})}var s,i}function l(t,e,s){(s?r:c)(t,e)}function d(t,e,s){t.has(s)?e.classList.add(s):e.classList.remove(s)}function u(t,e){return t.getElementsByTagName("defs")[0].querySelector(`[data-templ='${e}']`)}function p(t,e){const s=u(t.ownerSVGElement??t,e).cloneNode(!0);return t.append(s),s}class f{constructor({svgEl:t,type:e=null,connectable:s=null,defaultInConnector:i=null}){this.o=new Set,this.svgEl=t,this.type=e||"shape",this.connectable=s,this.defaultInConnector=i,this.connectors=new Map}stateHas(t){return this.o.has(t)}stateGet(){return new Set(this.o)}positionGet(){return o(this.svgEl)}update(t){if(t.position&&n(this.svgEl,t.position),t.props&&f.h(this.svgEl,t.props),t.connectors&&Object.keys(t.connectors).forEach((e=>{const s=t.connectors[e],i=this.connectors.get(e);s.innerPosition&&(i.innerPosition=s.innerPosition),s.dir&&(i.dir=s.dir)})),t.state){this.o=t.state;for(const t of["selected","hovered","disabled","highlighted"])d(this.o,this.svgEl,t);this.connectors?.forEach((e=>{t.state.has("hovered")||c(e,"hovered")}))}}static h(t,e){Object.keys(e).forEach((s=>{const i="root"===s?t:t.querySelector(`[data-key='${s}'`);Object.keys(e[s]).forEach((t=>{if("textContent"===t)a(i,e[s][t]?.toString(),v(i));else i.setAttribute(t,e[s][t].toString())}))}))}}function v(t){return{lineHeight:parseInt(t.getAttribute("data-line-height")),verticalMiddle:t.hasAttribute("data-vertical-middle")?parseInt(t.getAttribute("data-vertical-middle")):null}}class g extends EventTarget{constructor(t,e){super(),this.u=e,this.p=t,this.p.addEventListener("pointermove",this),this.p.addEventListener("pointerdown",this),this.p.addEventListener("pointerup",this),this.p.addEventListener("pointerleave",this),this.v=new WeakMap,this.g=t.querySelector('[data-key="canvas"]'),this.v.set(this.g,new f({svgEl:this.g,type:"canvas"})),this.scale=1}scaleSet(t,e){h(this.g,e,this.scale,t),this.scale=t}set canvasPosition(t){n(this.g,t)}get canvasPosition(){return o(this.g)}append(t,e){return this.u(t,{svgCanvas:this.g,svgElemToPresenterObj:this.v,createParams:e})}delete(t){if(t.dispose&&t.dispose(),this.v.delete(t.svgEl),"shape"===t.type){for(const e of t.connectors)this.v.delete(e[1].svgEl);t.defaultInConnector&&this.v.delete(t.defaultInConnector.svgEl)}t.svgEl.remove()}handleEvent(t){switch(t.type){case"pointermove":(!this.m||Math.abs(this.m.x-t.clientX)>3||Math.abs(this.m.y-t.clientY)>3)&&(this.m=null,this.k(t),this.S(t,"pointermove",null));break;case"pointerdown":case"pointerup":this.m={x:t.clientX,y:t.clientY},this.S(t,t.type,g.$(t,!0));break;case"pointerleave":this.dispatchEvent(new CustomEvent("canvasleave"))}}k(t){const e=g.$(t,!1);e!==this.C&&(e&&this.S(t,"pointerenter",e),this.C=e)}static $(t,s){const i=document.elementsFromPoint(t.clientX,t.clientY);return s?e(i,(t=>t.hasAttribute("data-evt-z-index")&&!t.hasAttribute("data-evt-no-click")))??(i[0].hasAttribute("data-evt-no-click")?i[1]:i[0]):e(i,(t=>t.hasAttribute("data-evt-z-index")))??i[0]}on(t,e){return this.addEventListener(t,e),this}S(t,e,s){let i=null;s&&(i=this.v.get(s===this.p||s.ownerSVGElement!==this.p?this.g:s),i||(i=this.v.get(s.closest("[data-connect]"))),i||(i=this.v.get(s.closest("[data-templ]")))),this.dispatchEvent(new CustomEvent(e,{detail:{target:i,clientX:t.clientX,clientY:t.clientY}}))}}class m{constructor(t){this.M=t}add(t,e){const s=this.M.append("path",{templateKey:"path",start:{position:m._(t),dir:t.dir},end:{position:m._(e),dir:e.dir?e.dir:m.H(t.dir)},startConnector:t,endConnector:e});return r(e,"connected"),m.P(t.shape,s),m.P(e.shape,s),s}replaceEnd(t,e){const i=t.end;t.update({end:{position:m._(e),dir:e.dir?e.dir:t.end.dir},endConnector:e}),i.shape!==e.shape&&(t.start.shape!==i.shape&&i.shape.connectedPaths.delete(t),m.P(e.shape,t)),s(i.shape.connectedPaths,(t=>t.start===i||t.end===i))||c(i,"connected"),r(e,"connected")}updatePosition(t){if(!s(t.connectedPaths))return;const e=t.positionGet();for(const s of t.connectedPaths)s.update({start:s.start.shape===t?{position:{x:e.x+s.start.innerPosition.x,y:e.y+s.start.innerPosition.y}}:null,end:s.end.shape===t?{position:{x:e.x+s.end.innerPosition.x,y:e.y+s.end.innerPosition.y}}:null})}del(t){switch(t.type){case"shape":this.L(t);break;case"path":this.T(t)}}T(t){t.end.shape.connectedPaths.delete(t),s(t.end.shape.connectedPaths,(e=>e.end===t.end))||c(t.end,"connected"),t.start.shape.connectedPaths.delete(t),t.end.shape.connectable&&this.M.delete(t.end.shape),this.M.delete(t)}L(t){if(this.M.delete(t),s(t.connectedPaths))for(const e of t.connectedPaths)this.T(e)}static P(t,e){t.connectedPaths||(t.connectedPaths=new Set),t.connectedPaths.add(e)}static _(t){const e=t.shape.positionGet();return{x:e.x+t.innerPosition.x,y:e.y+t.innerPosition.y}}static H(t){switch(t){case"bottom":return"top";case"top":return"bottom";case"left":return"right";case"right":return"left"}}}class w extends EventTarget{constructor(t,e,s){super(),this.M=t.on("pointermove",this).on("pointerdown",this).on("pointerup",this).on("pointerenter",this).on("canvasleave",this),this.V=e,this.A=s(this)}get scale(){return this.M.scale}scaleSet(t,e){this.dispatch("scale"),this.M.scaleSet(t,e)}set canvasPosition(t){this.M.canvasPosition=t}get canvasPosition(){return this.M.canvasPosition}add(t,e){let s;switch(t){case"shape":s=this.M.append("shape",e);break;case"path":s=this.V.add(x(e.start),x(e.end))}return this.dispatch("add",s),s}shapeUpdate(t,e){t.update(e),(e.position||e.connectors)&&this.V.updatePosition(t)}del(t){this.dispatch("del",t),this.selected=null,this.V.del(t)}handleEvent(t){switch(t.type){case"pointermove":case"canvasleave":this.D(t);break;case"pointerdown":this.activeElement=t.detail.target,this.D(t);break;case"pointerup":this.D(t),this.activeElement=null;break;case"pointerenter":this.O&&this.D({type:"pointerleave",detail:{target:this.O,enterTo:t.detail.target}}),this.D(t),this.O=t.detail.target}}G(t){return e(this.A,(e=>e.canProcess(t)))}D(t){this.U?.process(this.j,t)}set activeElement(t){this.j=t,this.U=this.j?this.G(this.j):null}set selected(t){t!==this.B&&(this.B&&this.G(this.B).process(this.B,{type:"unselect"}),this.B=t,t&&(this.dispatch("select",t),r(t,"selected")))}get selected(){return this.B}on(t,e){return this.addEventListener(t,e),this}dispatch(t,e){return this.dispatchEvent(new CustomEvent(t,{cancelable:!0,detail:{target:e}}))}}function x(t){return t.type?t:t.shape.connectors.get(t.key)}class y{constructor({svgEl:t,connectorType:e,shape:s,key:i,innerPosition:n,dir:o}){this.svgEl=t,this.o=new Set,this.type="connector",this.connectorType=e,this.shape=s,this.key=i,this.innerPosition=n,this.dir=o}stateHas(t){return this.o.has(t)}stateGet(){return new Set(this.o)}update(t){this.o=t.state;for(const t of["connected","hovered","selected"])d(this.o,this.svgEl,t);t.state.has("hovered")&&r(this.shape,"hovered")}}function b(t,e){return new y({svgEl:t,connectorType:"in"===t.getAttribute("data-connect")?"in":"out",shape:e,key:t.getAttribute("data-key"),innerPosition:k(t),dir:t.getAttribute("data-connect-dir")})}function k(t){if(!t.getAttribute("data-connect-point"))return null;const e=t.getAttribute("data-connect-point").split(",");return{x:parseFloat(e[0]),y:parseFloat(e[1])}}class E{constructor({svgEl:t,start:e,end:s,startConnector:i,endConnector:n}){this.type="path",this.svgEl=t,this.R=t.querySelector('[data-key="path"]'),this.I=t.querySelector('[data-key="outer"]'),this.B=t.querySelector('[data-key="selected"]'),this.F=t.querySelector('[data-key="arrow"]'),this.o=new Set,this.K={},this.N={},this.update({start:e,end:s,startConnector:i,endConnector:n})}stateHas(t){return this.o.has(t)}stateGet(){return new Set(this.o)}update(t){if(t.start&&Object.assign(this.K,t.start),t.end&&(Object.assign(this.N,t.end),this.J()),(t.start||t.end)&&this.X(),t.endConnector&&this.end!==t.endConnector&&(this.end&&c(this.end,"selected"),this.end=t.endConnector,this.svgEl.parentNode.appendChild(this.svgEl)),t.startConnector&&(this.start=t.startConnector),t.state){this.o=t.state;for(const e of["selected","disabled"])d(this.o,this.svgEl,e),t.state.has(e)?r(this.end.shape.connectable?this.end.shape:this.end,e):c(this.end.shape.connectable?this.end.shape:this.end,e)}}X(){const t=E.Z(70,this.K,this.N);this.R.setAttribute("d",t),this.I.setAttribute("d",t),this.B.setAttribute("d",t)}J(){n(this.F,this.N.position),function(t,e,s){i(t,SVGTransform.SVG_TRANSFORM_ROTATE,s).setRotate(e,0,0)}(this.F,"right"===this.N.dir?180:"left"===this.N.dir?0:"bottom"===this.N.dir?270:90)}dispose(){this.R=null,this.I=null,this.B=null,this.F=null}static Z(t,e,s){return`M ${e.position.x} ${e.position.y} C ${E.q(e.dir,e.position.x,t)} ${E.W(e.dir,e.position.y,t)}, ${E.q(s.dir,s.position.x,t)} ${E.W(s.dir,s.position.y,t)}, ${s.position.x} ${s.position.y}`}static q(t,e,s){return"right"===t||"left"===t?"right"===t?e+s:e-s:e}static W(t,e,s){return"right"===t||"left"===t?e:"bottom"===t?e+s:e-s}}class S{constructor(t){this.svgElement=t,this.type=t.type,this.svgEl=this.svgElement.svgEl,this.svgElement.svgEl.addEventListener("pointerdown",this),this.svgElement.svgEl.addEventListener("pointerup",this),this.svgElement.svgEl.addEventListener("click",this)}update(t){t.state&&this.Y&&(this.Y=!1,this.onEditLeave()),t.state&&(this.tt=!1),this.svgElement.update(t)}dispose(){this.Y&&this.onEditLeave(),this.svgElement.dispose&&this.svgElement.dispose()}handleEvent(t){if(!t.target.hasAttribute("data-evt-no-click")&&document.elementFromPoint(t.clientX,t.clientY)===t.target)if("click"!==t.type){if(!this.Y)switch(t.type){case"pointerdown":this.tt=this.svgElement.stateGet().has("selected");break;case"pointerup":this.tt&&(this.Y=!0,this.onEdit(t))}}else this.onClick(t,this.Y)}onEdit(t){}onEditLeave(){}onClick(t,e){}}class $ extends S{constructor(t){super(t),this.connectable=this.svgElement.connectable,this.defaultInConnector=this.svgElement.defaultInConnector,this.connectors=this.svgElement.connectors}stateHas(t){return this.svgElement.stateHas(t)}stateGet(){return this.svgElement.stateGet()}positionGet(){return this.svgElement.positionGet()}update(t){t.state&&this.Y&&(this.Y=!1,this.onEditLeave()),super.update(t)}}function C(t,e,s,i,n){const o=t.getBBox(),h=o.width+20;e.width.baseVal.value=h+2*i+2,e.x.baseVal.value=o.x-i-("center"===n?10:0),e.height.baseVal.value=o.height+2*i+3,e.y.baseVal.value=o.y-i,s.style.width=`${h}px`,s.style.height=`${o.height}px`}function z(t,e,s,i,n){let o;switch(s.tagName){case"tspan":o=t.querySelector(`[data-text-for=${s.parentElement.getAttribute("data-key")}]`);break;case"text":o=t.querySelector(`[data-text-for=${s.getAttribute("data-key")}]`);break;default:s.getAttribute("data-text-for")&&(o=s)}if(!o)return;o.classList.remove("empty");const h=o.getAttribute("data-text-for"),r=t.querySelector(`[data-key=${h}]`);return function(t,e,s,i,n){const o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),h=document.createElement("textarea");h.style.caretColor=t.getAttribute("fill"),h.value=s,h.oninput=function(){a(t,h.value,e),C(t,o,h,c,r.textAlign),i(h.value)},h.onblur=function(){n(h.value)},h.onpointerdown=function(t){t.stopImmediatePropagation()},o.appendChild(h),t.parentElement.appendChild(o);const r=getComputedStyle(h),c=parseInt(r.padding)+parseInt(r.borderWidth);return C(t,o,h,c,r.textAlign),h.focus(),o}(r,v(r),e[h]?.textContent.toString(),(t=>{i(r,{[h]:{textContent:t}})}),(t=>{t?o.classList.remove("empty"):o.classList.add("empty"),n()}))}class M extends ${constructor(t,e){super(t),this.et=Object.assign({},e)}on(t,e){return this.st||(this.st=[]),this.st.push({t:t,l:e}),this.svgEl.addEventListener(t,e),this}dispose(){this.st?.forEach((t=>this.svgElement.svgEl.removeEventListener(t.t,t.l))),super.dispose()}update(t){var e,s;t.props&&Object.assign(this.et,t.props),t.state&&t.state.has("selected")&&!this.stateGet().has("selected")&&(e=this.svgEl,s=this.et,e.querySelectorAll("[data-text-for]").forEach((t=>{s[t.getAttribute("data-text-for")]?.textContent||t.classList.add("empty")}))),super.update(t)}onClick(t,e){e&&this.it(t)}onEditLeave(){this.nt()}it(t){this.ot||(this.ot=z(this.svgEl,this.et,t.target,((t,e)=>{Object.assign(this.et,e),this.onTextChange(t,e)}),(t=>{this.nt()})))}onTextChange(t,e){this.svgEl.dispatchEvent(new CustomEvent("txtUpd",{detail:{target:this,props:e}}))}nt(){this.ot&&!this.ht&&(this.ht=!0,this.ot.remove(),this.ot=null,this.ht=!1)}}const _=Symbol(0);function H(t,e,s,i){t[_]=document.createElement("div"),t[_].style.cssText=`position: fixed; left: ${e}px; top: ${s}px; padding: 10px; box-shadow: 0px 0px 58px 2px rgb(34 60 80 / 20%); border-radius: 16px; background-color: rgba(255,255,255, .9);`,t[_].innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z" fill="rgba(52,71,103,1)"/></svg>',t[_].onclick=function(){P(t),i()},document.body.append(t[_])}function P(t){t[_]&&(t[_].remove(),t[_]=null)}class L extends M{constructor(t,e,s){super(e,s),this.diagram=t}onEdit(t){this.svgEl.classList.add("highlighted"),this.rt()}onEditLeave(){super.onEditLeave(),this.svgEl.classList.remove("highlighted"),P(this)}rt(){H(this,0,0,(()=>{this.diagram.del(this)})),this.panelUpdPos()}panelUpdPos(){if(this[_]){const i=this.svgEl.getBoundingClientRect();t=this,e=i.left+10,s=i.top-35,t[_].style.top=`${window.scrollY+s}px`,t[_].style.left=`${e}px`}var t,e,s}}class T extends S{constructor(t,e){super(e),this.diagram=t}get end(){return this.svgElement.end}get start(){return this.svgElement.start}stateHas(t){return this.svgElement.stateHas(t)}stateGet(){return this.svgElement.stateGet()}onEdit(t){H(this,t.clientX-20,t.clientY-55,(()=>{this.diagram.del(this)}))}onEditLeave(){P(this)}}function V(t,e=0){const s=t.x-e,i=t.x+t.width+e,n=t.y-e,o=t.y+t.height+e;return[{x:s,y:n},{x:i,y:n},{x:s,y:o},{x:i,y:o}]}function A(t,e,s){return s<=t?t:t+Math.ceil((s-t)/e)*e}class D extends L{constructor(t,e,s){super(t,e,s),this.ct=60}update(t){super.update(t),void 0!==t.props?.text?.textContent&&this.lt(this.svgEl.querySelector('[data-key="text"]'))}onTextChange(t,e){super.onTextChange(t,e),this.lt(t)}lt(t){let e=0;for(const s of t.getElementsByTagName("tspan"))for(const t of V(s.getBBox())){const s=t.x**2+t.y**2;s>e&&(e=s)}const s=A(60,20,Math.sqrt(e));s!==this.ct&&(this.ct=s,this.dt(s),this.panelUpdPos())}dt(t){const e=-1*t,s={right:{cx:t},left:{cx:e},bottom:{cy:t},top:{cy:e}},i={right:{innerPosition:{x:t,y:0}},left:{innerPosition:{x:e,y:0}},bottom:{innerPosition:{x:0,y:t}},top:{innerPosition:{x:0,y:e}}};this.diagram.shapeUpdate(this,{props:{main:{r:t},outer:{r:t+20},outright:s.right,outleft:s.left,outbottom:s.bottom,outtop:s.top,inright:s.right,inleft:s.left,inbottom:s.bottom,intop:s.top},connectors:{outright:i.right,outleft:i.left,outbottom:i.bottom,outtop:i.top,inright:i.right,inleft:i.left,inbottom:i.bottom,intop:i.top}})}}class O extends L{constructor(t,e,s){super(t,e,s),this.ut=150,this.ft=150,this.vt=50,this.gt=50}update(t){super.update(t),void 0!==t.props?.text?.textContent&&this.lt(this.svgEl.querySelector('[data-key="text"]'))}onTextChange(t,e){super.onTextChange(t,e),this.lt(t)}lt(t){let e=0;for(const s of t.getElementsByTagName("tspan")){const t=s.getBBox().width+4;t>e&&(e=t)}const s=A(this.ft,40,e),i=A(this.gt,20,t.getBBox().height+4);s===this.ut&&i===this.vt||(this.ut=s,this.vt=i,this.dt(s,i),this.panelUpdPos())}dt(t,e){const s=G(this.ft,this.gt,t,e),i={r:{cx:t+s.x,cy:e/2+s.y},l:{cx:s.x,cy:e/2+s.y},b:{cx:t/2+s.x,cy:e+s.y},t:{cx:t/2+s.x,cy:s.y}},n={right:{innerPosition:{x:i.r.cx,y:i.r.cy}},left:{innerPosition:{x:i.l.cx,y:i.l.cy}},bottom:{innerPosition:{x:i.b.cx,y:i.b.cy}},top:{innerPosition:{x:i.t.cx,y:i.t.cy}}};this.diagram.shapeUpdate(this,{props:{main:s,outer:G(this.ft,this.gt,t+40,e+40),outright:i.r,outleft:i.l,outbottom:i.b,outtop:i.t,inright:i.r,inleft:i.l,inbottom:i.b,intop:i.t},connectors:{outright:n.right,outleft:n.left,outbottom:n.bottom,outtop:n.top,inright:n.right,inleft:n.left,inbottom:n.bottom,intop:n.top}})}}function G(t,e,s,i){return{y:(e-i)/2,x:(t-s)/2,width:s,height:i}}function U(t,e,s){const i=t.ownerSVGElement.createSVGPoint();return i.x=e,i.y=s,t.isPointInFill(i)||t.isPointInStroke(i)}class j extends L{constructor(t,e,s){super(t,e,s),this.wt=120}update(t){super.update(t),void 0!==t.props?.text?.textContent&&this.lt(this.svgEl.querySelector('[data-key="text"]'))}onTextChange(t,e){super.onTextChange(t,e),this.lt(t)}lt(t){this.xt||(this.xt=function(t,e){const s=t.querySelector(`[data-key="${e}"]`),i=s.cloneNode(!1);return i.style.fill="transparent",i.style.stroke="transparent",i.removeAttribute("data-key"),t.insertBefore(i,s),i}(this.svgEl,"main"));const e=function(t,e,s,i){let n=s;if(i(n)){do{n+=e}while(i(n));return n}if(t===n)return null;do{n-=e}while(t<=n&&!i(n));return n+=e,s!==n?n:null}(120,40,this.wt,(e=>(this.xt.setAttribute("d",R(120,70,e)),function(t,e,i=0){return s(t.getElementsByTagName("tspan"),(t=>{const s=t.getBBox(),n=s.x-i,o=s.x+s.width+i,h=s.y-i,a=s.y+s.height+i;return!(U(e,n,h)&&U(e,o,h)&&U(e,n,a)&&U(e,o,a))}))}(t,this.xt))));e&&(this.wt=e,this.dt(e),this.panelUpdPos())}dt(t){const e={d:R(120,70,t)},s=B(120,70,t+16),i={left:{cx:s.l.x},right:{cx:s.r.x},top:{cy:s.t.y},bottom:{cy:s.b.y}},n={left:{innerPosition:s.l},right:{innerPosition:s.r},top:{innerPosition:s.t},bottom:{innerPosition:s.b}};this.diagram.shapeUpdate(this,{props:{main:e,outer:{d:R(120,70,t+80)},border:e,outleft:i.left,outright:i.right,outtop:i.top,outbottom:i.bottom,inleft:i.left,inright:i.right,intop:i.top,inbottom:i.bottom},connectors:{outleft:n.left,outright:n.right,outtop:n.top,outbottom:n.bottom,inleft:n.left,inright:n.right,intop:n.top,inbottom:n.bottom}})}onEditLeave(){super.onEditLeave(),this.xt&&(this.xt.remove(),this.xt=null)}}function B(t,e,s){const i=(s-t)/2,n=-1*i;return{l:{x:n,y:e/2},t:{x:t/2,y:n},r:{x:t+i,y:e/2},b:{x:t/2,y:e+i}}}function R(t,e,s){const i=B(t,e,s);return`M${i.l.x} ${i.l.y} L${i.t.x} ${i.t.y} L${i.r.x} ${i.r.y} L${i.b.x} ${i.b.y} Z`}class I{constructor(t,e){this.yt=t,this.V=e}canProcess(t){return"canvas"===t.type||"shape"===t.type}process(t,s){switch(s.type){case"pointermove":K(this.yt,t,s);break;case"pointerup":if(!t[F])return void(this.yt.selected=X(t));if(t.connectable&&"in"===s.detail.target.connectorType){const i=e(t.connectedPaths);if(!this.yt.dispatch("connect",i))return;this.V.replaceEnd(i,s.detail.target),this.yt.del(t),c(i,"disabled"),t=null}this.bt(t);break;case"unselect":c(X(t),"selected");break;case"canvasleave":this.bt(t);break;case"pointerenter":t.connectable&&["connector","shape"].includes(s.detail.target.type)&&(r(s.detail.target,"hovered"),this.kt("shape"===s.detail.target.type?s.detail.target:s.detail.target.shape));break;case"pointerleave":if(!t.connectable)return;switch(s.detail.target.type){case"shape":s.detail.enterTo?.shape!==s.detail.target&&this.kt(null);break;case"connector":s.detail.target?.shape!==s.detail.enterTo?this.kt(null):c(s.detail.target,"hovered")}}}bt(t){t&&N(t),this.kt(null),this.yt.activeElement=null}kt(t){this.O&&this.O!==t&&c(this.O,"hovered"),this.O=t}}const F=Symbol(0);function K(t,e,s){const i="canvas"===e.type?1:t.scale;if(!e[F]){t.selected=null,J(e,!0);const n=e.positionGet();e[F]={x:n.x*i-s.detail.clientX,y:n.y*i-s.detail.clientY}}t.shapeUpdate(e,{position:{x:(e[F].x+s.detail.clientX)/i,y:(e[F].y+s.detail.clientY)/i}})}function N(t){J(t,!1),delete t[F]}function J(t,e){l(X(t),"disabled",e)}function X(t){return t.connectable?e(t.connectedPaths):t}class Z{constructor(t,e){this.yt=t,this.V=e}canProcess(t){return"connector"===t.type}process(e,s){switch(s.type){case"pointermove":switch(e.connectorType){case"out":{const t=this.yt.add("shape",q(e));this.yt.add("path",{start:e,end:t.defaultInConnector}),this.yt.activeElement=t;break}case"in":{const s="path"===this.yt.selected?.type&&this.yt.selected.end===e?this.yt.selected:t(e.shape.connectedPaths,(t=>t.end===e));if(!this.yt.dispatch("disconnect",s))return;const i=this.yt.add("shape",q(e));this.V.replaceEnd(s,i.defaultInConnector),this.yt.activeElement=i}}break;case"pointerup":if("in"!==e.connectorType)return;this.yt.selected=t(e.shape.connectedPaths,(t=>t.end===e))}}}function q(t){const e=t.shape.positionGet(),s=t.innerPosition;return{templateKey:"connect-end",position:{x:e.x+s.x,y:e.y+s.y}}}class W{constructor(t){this.yt=t}canProcess(t){return"path"===t.type}process(t,e){switch(e.type){case"pointerup":this.yt.selected=t;break;case"unselect":c(t,"selected")}}}function Y(t){const e=t.getAttribute("data-center").split(",");return{x:parseFloat(e[0]),y:parseFloat(e[1])}}const Q=Symbol(0),tt=Symbol(0);const et=Symbol(0),st=Symbol(0);class it extends class{constructor(t,e){this.Et=new Set,this.diagram=t.on("add",(t=>{"shape"===t.detail.target.type&&this.Et.add(t.detail.target)})).on("del",(t=>{const e="path"===t.detail.target.type&&t.detail.target.end.shape.connectable?t.detail.target.end.shape:t.detail.target;this.Et.delete(e),this.selectedShapes?.delete(e)})),this.p=e}canProcess(t){const e="canvas"===t.type||this.selectedShapes?.has(t);return e||this.onSelectedClean(),e}process(t,e){switch(e.type){case"pointermove":if(this.St(),this.$t=null,this.Ct)return this.zt(),void function(t,e){t[st]&&(t[st].remove(),delete t[st]);const s=e.detail.clientX-t[et].x,i=e.detail.clientY-t[et].y;t.width.baseVal.value=Math.abs(s),s<0&&(t.x.baseVal.value=e.detail.clientX);t.height.baseVal.value=Math.abs(i),i<0&&(t.y.baseVal.value=e.detail.clientY)}(this.Ct,e);if(this.Mt)return void this.selectedShapes.forEach((t=>K(this.diagram,t,e)));K(this.diagram,t,e);break;case"pointerdown":if(this.diagram.selected=null,this.$t=e.detail.target,this.Mt=this.selectedShapes?.has(e.detail.target),"canvas"!==t.type)return;this._t=setTimeout((s=>{this.St(),this.onSelectedClean();const i=t.positionGet();this.Et.forEach((t=>{t[tt]||(t[tt]=Y(t.svgEl));const e=t.positionGet();t[Q]=function(t,e,s){return{x:s.x*e+t.x,y:s.y*e+t.y}}(i,this.diagram.scale,{x:e.x+t[tt].x,y:e.y+t[tt].y})})),this.Ct=function(t,e){const s=p(t,"select");return s.x.baseVal.value=e.x,s.y.baseVal.value=e.y,s[et]=e,s[st]=p(t,"select-start"),s[st].cx.baseVal.value=e.x,s[st].cy.baseVal.value=e.y,s}(this.p,{x:e.detail.clientX,y:e.detail.clientY})}),500);break;case"canvasleave":case"pointerup":if(this.diagram.activeElement=null,this.St(),this.$t)return this.Ht(),"canvas"===this.$t.type?this.onSelectedClean():this.onShapeClick(e),void(this.$t=null);if(this.Ct)return void this.Pt();if(this.Mt)return this.selectedShapes.forEach((t=>N(t))),void(this.Mt=!1);N(t)}}onShapeClick(t){this.onSelectedClean()}onSelectedClean(){this.selectedShapes?.forEach((t=>c(t,"highlighted"))),this.selectedShapes=null}zt(t){const e=t?new Set:null;return this.Et.forEach((s=>{const i=document.elementFromPoint(s[Q].x,s[Q].y)===this.Ct;l(s,"highlighted",i),t&&i&&e.add(s)})),e?.size>0?e:null}Pt(){this.selectedShapes=this.zt(!0),1===this.selectedShapes?.size&&(c(e(this.selectedShapes),"highlighted"),this.selectedShapes=null),this.Ht()}Ht(){this.Ct&&(!function(t){t[st]&&(t[st].remove(),delete t[st]);t.remove()}(this.Ct),this.Ct=null)}St(){this._t&&clearTimeout(this._t),this._t=null}}{constructor(t,e){super(t,e),t.on("scale",(t=>P(this)))}onShapeClick(t){H(this,t.detail.clientX-20,t.detail.clientY-55,(()=>{for(const t of this.selectedShapes)this.diagram.del(t)}))}onSelectedClean(){P(this),super.onSelectedClean()}process(t,e){P(this),super.process(t,e)}}async function nt(t,e,s){return function(t,e,s){let i,n;const o=ot(t,e);if(o)i=new DataView(t,0,o.byteOffset-8),n=new DataView(t,o.byteOffset+o.byteLength+4);else{const e=t.byteLength-12;i=new DataView(t,0,e),n=new DataView(t,e)}const h=new DataView(new ArrayBuffer(8));return h.setUint32(0,s.length),h.setUint32(4,e),new Blob([i,h,s,new Uint32Array([0]),n],{type:"image/png"})}(await t.arrayBuffer(),ht(e),s)}function ot(t,e){const s=new DataView(t,8);let i,n=0,o=s.getUint32(4);for(;1229278788!==o;){if(i=s.getUint32(n),o===e)return new DataView(t,n+16,i);n=n+12+i,o=s.getUint32(n+4)}return null}function ht(t){return new DataView((new TextEncoder).encode(t).buffer).getUint32(0)}function at(t,s,i){const a=t.querySelector('[data-key="canvas"]'),r=a.getBoundingClientRect(),c=e(a.transform.baseVal,(t=>t.type===SVGTransform.SVG_TRANSFORM_SCALE))?.matrix.a??1,l=t.cloneNode(!0);l.querySelectorAll(".selected, .highlighted").forEach((t=>t.classList.remove("selected","highlighted")));const d=l.querySelector('[data-key="canvas"]'),u=o(d);n(d,{x:u.x+15*c-r.x,y:u.y+15*c-r.y}),h(d,{x:0,y:0},c,1),function(t,e,s,i){const n=new Image;n.width=e.width*s*window.devicePixelRatio,n.height=e.height*s*window.devicePixelRatio,n.onload=function(){const t=document.createElement("canvas");t.width=n.width,t.height=n.height,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`;const s=t.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(n,e.x,e.y,e.width,e.height,0,0,n.width,n.height),URL.revokeObjectURL(n.src),t.toBlob(i,"image/png")},t.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,n.width),t.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,n.height),n.src=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(t)],{type:"image/svg+xml;charset=utf-8"}))}(l,{x:0,y:0,height:r.height/c+30,width:r.width/c+30},3,i?async function(t){s(await nt(t,"dgRm",(new TextEncoder).encode(i)))}:s)}async function rt(t){const e=await async function(t,e){return ot(await t.arrayBuffer(),ht(e))}(t,"dgRm");return e?(new TextDecoder).decode(e):null}const ct={pngCreate(t){const e=this.dataGet();e?at(this.svg,t,JSON.stringify(e)):t(null)},async pngLoad(t){const e=await rt(t);return!!e&&(this.dataSet(JSON.parse(e)),!0)}};class lt extends EventTarget{constructor(t,e){super(),this.svg=t,this.Lt=new Map,this.yt=e.on("add",this).on("del",this)}handleEvent(t){switch(t.type){case"add":t.detail.target instanceof L&&t.detail.target.on("txtUpd",this);break;case"txtUpd":this.Lt.get(t.detail.target).detail=t.detail.props.text.textContent;break;case"del":this.Lt.delete(t.detail.target)}}shapeActiveAdd(t){const e=(s=this.yt.canvasPosition,i=this.yt.scale,{x:((n=t.position).x-s.x)/i,y:(n.y-s.y)/i});var s,i,n;const o=Y(u(this.svg,t.templateKey));t.position.x=e.x-o.x,t.position.y=e.y-o.y,this.yt.activeElement=this.Tt(t)}Tt(t){const e=this.yt.add("shape",t);return this.Lt.set(e,{templateKey:t.templateKey,detail:t.props.text?.textContent}),this.dispatchEvent(new CustomEvent("shapeAdd",{cancelable:!0,detail:e})),e}clear(){for(const t of this.Lt)this.yt.del(t[0]);this.yt.canvasPosition={x:0,y:0},this.yt.scaleSet(1,{x:0,y:0})}dataGet(){if(!s(this.Lt))return null;const t={s:[],c:[]},e=new Map;for(const s of this.Lt){const i=s[0].positionGet();i.x=Math.trunc(i.x),i.y=Math.trunc(i.y),s[1].position=i,e.set(s[0],t.s.push(s[1])-1)}const i=new Set;for(const n of this.Lt)if(s(n[0].connectedPaths))for(const s of n[0].connectedPaths)!i.has(s)&&s.end.key&&(i.add(s),t.c.push({s:{i:e.get(s.start.shape),c:s.start.key},e:{i:e.get(s.end.shape),c:s.end.key}}));return 0===i.size&&delete t.c,t}dataSet(t){if(this.clear(),!(t.s&&t.s.length>0))return;const e=[];for(const s of t.s){const t=this.Tt({templateKey:s.templateKey,position:s.position,props:{text:{textContent:s.detail}}});e.push(t)}if(t.c&&t.c.length>0)for(const s of t.c)this.yt.add("path",{start:{shape:e[s.s.i],key:s.s.c},end:{shape:e[s.e.i],key:s.e.c}})}on(t,e,s){return this.addEventListener(t,e,s),this}}Object.assign(lt.prototype,ct);const dt="https://dgrm.boyko.tech/api";class ut extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{overflow-x:auto;padding:0;position:fixed;bottom:15px;left:50%;transform:translateX(-50%);box-shadow:0 0 58px 2px rgba(34,60,80,.2);border-radius:16px;background-color:rgba(255,255,255,.9)}.content{white-space:nowrap;display:flex}[data-cmd]{cursor:pointer}.menu svg{height:42px;display:inline-block;padding:15px 10px;stroke:#344767;stroke-width:2px;fill:#fff;width:42px;min-width:42px}.menu .big{width:62px;min-width:62px}@media only screen and (max-width:700px){.menu{width:100%;border-radius:0;bottom:0;display:flex;flex-direction:column}.content{align-self:center}}</style><div id="menu" class="menu" style="touch-action:none"><div class="content"><svg data-cmd="shapeAdd" data-cmd-arg="circle" style="padding-left:20px"><circle r="20" cx="21" cy="21"></circle></svg> <svg data-cmd="shapeAdd" data-cmd-arg="rect" class="big"><rect x="1" y="1" width="60" height="40" rx="15" ry="15"></rect></svg> <svg data-cmd="shapeAdd" data-cmd-arg="rhomb" class="big"><g transform="translate(1,1)"><path d="M0 20 L30 0 L60 20 L30 40 Z" stroke-width="2" stroke-linejoin="round"></path></g></svg> <svg data-cmd="shapeAdd" data-cmd-arg="text"><text x="5" y="40" font-size="52px" fill="#344767" stroke-width="0">T</text></svg></div></div>';const e=t.getElementById("menu");e.querySelectorAll('[data-cmd="shapeAdd"]').forEach((t=>t.addEventListener("pointerdown",this))),e.addEventListener("pointerleave",this),e.addEventListener("pointerup",this),e.addEventListener("pointermove",this)}init(t){this.yt=t}handleEvent(t){switch(t.type){case"pointermove":if(!this.Vt){const e=document.elementFromPoint(t.clientX,t.clientY);if(e===this.C)return;this.At===this.C&&this.yt.svg.setPointerCapture(t.pointerId),this.C=e}break;case"pointerleave":this.Vt=!0,this.Dt&&this.yt.shapeActiveAdd({templateKey:this.Dt,position:{x:t.clientX,y:t.clientY},props:{text:{textContent:"Title"}}}),this.bt();break;case"pointerdown":this.Dt=t.currentTarget.getAttribute("data-cmd-arg"),this.At=document.elementFromPoint(t.clientX,t.clientY),this.C=this.At,this.Vt=null;break;case"pointerup":this.bt()}}bt(){this.Dt=null,this.At=null,this.C=null}}let pt;function ft(t,e){t?(pt||(pt=document.createElement("div"),pt.style.cssText="z-index: 2; position: fixed; left: 0; top: 0; width:100%; height:100%; background: #fff; opacity: 0",pt.innerHTML="<style>@keyframes blnk{0%{opacity:0}50%{opacity:.7}100%{opacity:0}}.blnk{animation:blnk 1.6s linear infinite}</style>",document.body.append(pt)),e?pt.classList.add("blnk"):pt.classList.remove("blnk")):!t&&pt&&(pt.remove(),pt=null)}customElements.define("ap-menu-shape",ut);class vt extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{position:fixed;top:15px;left:15px;cursor:pointer}.options{position:fixed;padding:15px;box-shadow:0 0 58px 2px rgb(34 60 80 / 20%);border-radius:16px;background-color:rgba(255,255,255,.9);top:0;left:0;z-index:1}.options a,.options div{color:#0d6efd;cursor:pointer;margin:10px 0;display:flex;align-items:center;line-height:25px;text-decoration:none}.options a svg,.options div svg{margin-right:10px}.load svg{animation:rot 1.2s linear infinite}@keyframes rot{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}</style><svg data-cmd="menu" class="menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(52,71,103,1)"/></svg><div class="options" style="visibility:hidden"><div data-cmd="menu" style="margin:0 0 15px"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(52,71,103,1)"/></svg></div><div data-cmd="new"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M9 2.003V2h10.998C20.55 2 21 2.455 21 2.992v18.016a.993.993 0 0 1-.993.992H3.993A1 1 0 0 1 3 20.993V8l6-5.997zM5.83 8H9V4.83L5.83 8zM11 4v5a1 1 0 0 1-1 1H5v10h14V4h-8z" fill="rgba(52,71,103,1)"/></svg>New diagram</div><div data-cmd="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 21a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h7.414l2 2H20a1 1 0 0 1 1 1v3h-2V7h-7.414l-2-2H4v11.998L5.5 11h17l-2.31 9.243a1 1 0 0 1-.97.757H3zm16.938-8H7.062l-1.5 6h12.876l1.5-6z" fill="rgba(52,71,103,1)"/></svg>Open diagram image</div><div data-cmd="save"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 19h18v2H3v-2zm10-5.828L19.071 7.1l1.414 1.414L12 17 3.515 8.515 4.929 7.1 11 13.17V2h2v11.172z" fill="rgba(52,71,103,1)"/></svg>Save diagram image</div><div data-cmd="link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13.06 8.11l1.415 1.415a7 7 0 0 1 0 9.9l-.354.353a7 7 0 0 1-9.9-9.9l1.415 1.415a5 5 0 1 0 7.071 7.071l.354-.354a5 5 0 0 0 0-7.07l-1.415-1.415 1.415-1.414zm6.718 6.011l-1.414-1.414a5 5 0 1 0-7.071-7.071l-.354.354a5 5 0 0 0 0 7.07l1.415 1.415-1.415 1.414-1.414-1.414a7 7 0 0 1 0-9.9l.354-.353a7 7 0 0 1 9.9 9.9z" fill="rgba(52,71,103,1)"/></svg>Copy link to diagram</div><a href="/donate.html" target="_blank" style="margin-bottom:0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0H24V24H0z"/><path d="M12.001 4.529c2.349-2.109 5.979-2.039 8.242.228 2.262 2.268 2.34 5.88.236 8.236l-8.48 8.492-8.478-8.492c-2.104-2.356-2.025-5.974.236-8.236 2.265-2.264 5.888-2.34 8.244-.228zm6.826 1.641c-1.5-1.502-3.92-1.563-5.49-.153l-1.335 1.198-1.336-1.197c-1.575-1.412-3.99-1.35-5.494.154-1.49 1.49-1.565 3.875-.192 5.451L12 18.654l7.02-7.03c1.374-1.577 1.299-3.959-.193-5.454z" fill="rgba(255,66,77,1)"/></svg>Donate</a></div>',t.querySelectorAll("[data-cmd]").forEach((t=>t.addEventListener("click",this))),this.Ot=t.querySelector(".options")}init(t){this.yt=t,document.body.addEventListener("dragover",(t=>{t.preventDefault()})),document.body.addEventListener("drop",(async e=>{e.preventDefault(),1===e.dataTransfer?.items?.length&&"file"===e.dataTransfer.items[0].kind&&"image/png"===e.dataTransfer.items[0].type&&await t.pngLoad(e.dataTransfer.items[0].getAsFile())||this.Gt()}))}async handleEvent(t){switch(t.currentTarget.getAttribute("data-cmd")){case"new":this.yt.clear();break;case"open":!function(t,e){const s=document.createElement("input");s.type="file",s.multiple=!1,s.accept=t,s.onchange=async function(){e(s.files?.length?s.files[0]:null)},s.click(),s.remove()}(".png",(async t=>{await this.yt.pngLoad(t)||this.Gt()}));break;case"save":this.yt.pngCreate((t=>{t?function(t,e){const s=document.createElement("a");s.download=e,s.href=URL.createObjectURL(t),s.click(),URL.revokeObjectURL(s.href),s.remove()}(t,"dgrm.png"):alert("Diagram is empty")}));break;case"link":{const e=this.yt.dataGet();if(!e)return void alert("Diagram is empty");const s=t.currentTarget;this.Ut(s,!0);const i=function(){const t=new Uint8Array(4);window.crypto.getRandomValues(t);const e=new Date;return`${e.getUTCFullYear()}${(e.getUTCMonth()+1).toString().padStart(2,"0")}${Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}`}(),n=new URL(window.location.href);n.searchParams.set("k",i),await navigator.clipboard.writeText(n.toString()),await async function(t,e){return await fetch(`${dt}/${t}`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)})}(i,e),this.Ut(s,!1),alert("Link to diagram copied to clipboard");break}}this.jt()}Ut(t,e){ft(e),e?t.classList.add("load"):t.classList.remove("load")}jt(){this.Ot.style.visibility="visible"===this.Ot.style.visibility?"hidden":"visible"}Gt(){alert("File cannot be read. Use the exact image file you got from the application.")}}customElements.define("ap-file-options",vt);const gt=document.getElementById("diagram"),mt=new lt(gt,function(t){let e=null;const s=new g(t,((t,s)=>{switch(t){case"shape":{let t=(i=s.svgCanvas,n=s.createParams,new f({svgEl:p(i,n.templateKey)}));switch(s.createParams.templateKey){case"circle":t=new D(e,t,s.createParams.props);break;case"rhomb":t=new j(e,t,s.createParams.props);break;case"rect":t=new O(e,t,s.createParams.props);break;case"text":t=new L(e,t,s.createParams.props)}return s.svgElemToPresenterObj.set(t.svgEl,t),function(t,e){e.connectable="true"===e.svgEl.getAttribute("data-connectable"),k(e.svgEl)&&(e.defaultInConnector=b(e.svgEl,e)),e.svgEl.querySelectorAll("[data-connect]").forEach((s=>{const i=b(s,e);t.set(s,i),e.connectors.set(i.key,i)})),t.set(e.svgEl,e)}(s.svgElemToPresenterObj,t),t.update(s.createParams),t}case"path":{const t=new T(e,function(t){return new E({svgEl:p(t.svgCanvas,t.createParams.templateKey),start:t.createParams.start,end:t.createParams.end,startConnector:t.createParams.startConnector,endConnector:t.createParams.endConnector})}(s));return s.svgElemToPresenterObj.set(t.svgEl,t),t}}var i,n})),i=new m(s);return e=new w(s,i,(e=>new Set([new it(e,t),new I(e,i),new Z(e,i),new W(e)]))),function(t,e){e.addEventListener("wheel",(e=>{e.preventDefault(),t.selected=null;const s=Math.abs(e.deltaY)<50?.05:.25,i=t.scale+(e.deltaY<0?s:-s);i<.25||i>4||t.scaleSet(i,{x:e.clientX,y:e.clientY})}))}(e,t),e}(gt)).on("shapeAdd",(function(){document.getElementById("tip").remove(),gt.style.removeProperty("pointer-events")}),{once:!0});document.getElementById("file-options").init(mt),document.getElementById("menu-shape").init(mt);let wt=new URL(window.location.href);wt.searchParams.get("k")?(ft(!0,!0),async function(t){return(await fetch(`${dt}/${t}`)).json()}(wt.searchParams.get("k")).then((t=>{wt.searchParams.delete("k"),mt.dataSet(t),history.replaceState(null,null,wt),ft(!1),wt=null}))):wt=null}();
