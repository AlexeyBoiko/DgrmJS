!function(){"use strict";const t=(t,n)=>t.querySelector(`[data-key="${n}"]`);function n(t,n){t.style.transform=`translate(${n.x}px, ${n.y}px)`}const e=(t,...n)=>t?.classList.add(...n),i=(t,...n)=>t?.classList.remove(...n),o=(t,n)=>t?.classList.contains(n);function a(t,n,o,a){n.styles||(n.styles=[]);const c=n.styles.findIndex((t=>t.startsWith(o)));c>-1&&(i(t,n.styles[c]),n.styles.splice(c,1)),n.styles.push(a),e(t,a)}const c=(t,n,e,i)=>t.addEventListener(n,e,{passive:!0,once:i}),s=(t,n,e,i)=>t?.removeEventListener(n,e,{capture:i});function r(t,n,e){t.querySelectorAll(n).forEach((t=>{t.onclick=e}))}const d=(t,n)=>t.currentTarget.getAttribute(n),l=t=>"TEXTAREA"===t.target.tagName.toUpperCase();function h(t,n){const e=document.createElementNS("http://www.w3.org/2000/svg",t);return n&&(e.innerHTML=n),e}function u(t){let n,e=0;for(const i of t.getElementsByTagName("tspan"))for(const t of p(i.getBBox())){const i=Math.abs(t.x)+Math.abs(t.y);e<i&&(n=t,e=i)}return n}const p=t=>[{x:t.x,y:t.y},{x:t.right,y:t.y},{x:t.x,y:t.bottom},{x:t.right,y:t.bottom}];function f(t,n,e){return t??=0,e<=t?t:t+Math.ceil((e-t)/n)*n}function v(t,n){let e=t.pop();for(;e;)n(e),e=t.pop()}function m(t,n,e){const i=e??1;return t.x+=i*n.x,t.y+=i*n.y,t}const g=(t,n)=>({x:t.x+n,y:t.y+n}),w=t=>JSON.parse(JSON.stringify(t));const y=Symbol("movementX"),x=Symbol("movementY"),b=Symbol("Canvas");function k(t,n,e,i,o,a,r){let d,l=!1,h=!1;function u(t){h&&(l||(e(t),h))&&(l=!0,i(t))}function p(t){l?o(t):a(t),m(!0)}function f(t){n.contains(t.target)||(m(),r())}function v(t){l&&o(t),m(),r()}function m(n){s(d,"pointercancel",p),s(d,"pointerup",p),s(d,"pointermove",u),s(t,"pointercancel",p),s(t,"pointerup",p),n||(s(t,"pointerdown",f),s(t,"wheel",v)),d=null,l=!1,h=!1}return c(n,"pointerdown",(function(n){!n[C]&&n.isPrimary&&(n[C]=!0,d=n.target,n.pointerId!==$&&d.setPointerCapture(n.pointerId),c(d,"pointercancel",p,!0),c(d,"pointerup",p,!0),c(t,"pointercancel",p,!0),c(t,"pointerup",p,!0),c(d,"pointermove",u),c(t,"wheel",v,!0),c(t,"pointerdown",f),h=!0)})),m}function M(t,n,e){t.x+=e[y]/n,t.y+=e[x]/n}const $=42;function H(t){t.ownerSVGElement.focus(),t.dispatchEvent(new PointerEvent("pointerdown",{isPrimary:!0,pointerId:$})),t.dispatchEvent(new PointerEvent("pointerup",{isPrimary:!0}))}const z=(t,n)=>t.dispatchEvent(new PointerEvent("pointerdown",n)),C=Symbol("processed"),V=(t,n,e)=>({x:(n-t.position.x)/t.scale,y:(e-t.position.y)/t.scale}),L=(t,n)=>V(t,n.clientX,n.clientY);function B(t,n){const e=n/2;function i(t){const i=Math.round(t/n)*n;return t-i>=0?i+e:i-e}return t.x=i(t.x),t.y=i(t.y),t}function E(t){return{x:t.clientX,y:t.clientY}}function S(t,n){return{id:t.pointerId,pos:E(t),shift:{x:n.position.x-t.clientX,y:n.position.y-t.clientY}}}function T(t){return D(t).find((t=>!t.hasAttribute("data-evt-no")))}function A(t){return D(t)[0]}function D(t){return document.elementsFromPoint(t.clientX,t.clientY).sort(((t,n)=>{const e=t.getAttribute("data-evt-index"),i=n.getAttribute("data-evt-index");return e===i?0:e>i?-1:1}))}const P=Symbol("routeed");let O,N;function Z(t){t&&!O?(O=document.createElement("div"),O.style.cssText="z-index: 2; position: fixed; left: 0; top: 0; width:100%; height:100%; background: #fff; opacity: 0",O.innerHTML="<style>@keyframes blnk{0%{opacity:0}50%{opacity:.7}100%{opacity:0}}.blnk{animation:blnk 1.6s linear infinite}</style>",O.classList.add("blnk"),document.body.append(O)):t||(O.remove(),O=null)}function R(t,n,e){function i(t,n){N.style.left=`${t}px`,N.style.top=window.scrollY+n-N.getBoundingClientRect().height+"px"}return N=document.createElement("div"),N.style.cssText="position: fixed; box-shadow: 0 4px 24px rgba(0,0,0,.12); border-radius: 8px; background-color: rgba(255,255,255, .9);",N.append(e),document.body.append(N),i(t,n),{position:i,del:()=>{N?.remove(),N=null}}}function U(t){const n=document.getElementById("tip");function e(){n.style.display="none",s(document,"pointerdown",i),s(document,"wheel",e),s(document,"keydown",e),s(document,"dragover",e)}function i(t){n.contains(t.target)||e()}t?(n.style.display="unset",c(document,"pointerdown",i),c(document,"wheel",e,!0),c(document,"keydown",e,!0),c(document,"dragover",e,!0)):e()}const I="https://dgrm.boyko.tech/api";const J=Symbol("path"),j=Symbol("shape");function F(t){for(G(t);t.firstChild;)(t.firstChild[j]||t.firstChild[J]).del();t[b].move(0,0,1)}function G(t){t[b].selectClear&&t[b].selectClear()}function K(t,n){t[b].selectClear=n}const X=t=>_([...t.children]);function _(t){const n={v:"1.1",s:[]};for(const e of t)if(e[j])n.s.push(e[j].data);else{function i(n){const e=t.indexOf(n.shape?.shapeEl);return-1!==e?{s:e,k:n.shape.connectorKey}:{p:n.data}}const o=e[J].data,a={type:0,s:i(o.s),e:i(o.e)};o.styles&&(a.c=o.styles),n.s.push(a)}return n}function Y(t,n,e){if("1.1"!==n.v)return alert("Wrong format"),null;e||F(t);const i=new Map;function o(n){let e=i.get(n);return e||(e=t[b].shapeMap[n.type].create(n),i.set(n,e)),e}const a=[];for(const e of n.s)switch(e.type){case 0:{const i=t=>{return t.p?{data:t.p}:{shape:{shapeEl:(e=t.s,o(n.s[e])),connectorKey:t.k}};var e},c=t[b].shapeMap[0].create({styles:e.c,s:i(e.s),e:i(e.e)});a.push(c);break}default:o(e)}return[...i.values(),...a]}function q(t,n){"showSaveFilePicker"in window?async function(t){try{const n=await(await window.showSaveFilePicker({types:[{description:"PNG Image",accept:{"image/png":[".png"]}}]})).createWritable();await n.write(t),await n.close()}catch{alert("File not saved")}}(t):function(t,n){const e=document.createElement("a");e.download=n,e.href=URL.createObjectURL(t),e.click(),URL.revokeObjectURL(e.href),e.remove()}(t,n)}const W='<svg data-cmd="del" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z" fill="rgb(52,71,103)"/></svg>',Q='<svg data-cmd="copy" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7 6V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1h-3v3c0 .552-.45 1-1.007 1H4.007A1.001 1.001 0 0 1 3 21l.003-14c0-.552.45-1 1.007-1H7zM5.003 8L5 20h10V8H5.003zM9 6h8v10h2V4H9v2z" fill="rgb(52,71,103)"/></svg>',tt='<svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 19h18v2H3v-2zm10-5.828L19.071 7.1l1.414 1.414L12 17 3.515 8.515 4.929 7.1 11 13.17V2h2v11.172z" fill="rgb(52,71,103)"/></svg>',nt="highlight-s",et="highlight-e",it="highlight",ot="select",at="data-connect";async function ct(t,n,e){return function(t,n,e){let i,o;const a=st(t,n);if(a)i=new DataView(t,0,a.byteOffset-8),o=new DataView(t,a.byteOffset+a.byteLength+4);else{const n=t.byteLength-12;i=new DataView(t,0,n),o=new DataView(t,n)}const c=new DataView(new ArrayBuffer(8));return c.setUint32(0,e.length),c.setUint32(4,n),new Blob([i,c,e,new Uint32Array([0]),o],{type:"image/png"})}(await t.arrayBuffer(),rt(n),e)}function st(t,n){const e=new DataView(t,8);let i,o=0,a=e.getUint32(4);for(;1229278788!==a;){if(i=e.getUint32(o),a===n)return new DataView(t,o+16,i);o=o+12+i,a=e.getUint32(o+4)}return null}function rt(t){return new DataView((new TextEncoder).encode(t).buffer).getUint32(0)}function dt(t,n,e,i){const a=t.ownerSVGElement.cloneNode(!0),c=a.querySelector("#canvas");let s;a.style.backgroundImage=null,e?(s=function(t){const n={x:1/0,y:1/0},e={x:-1/0,y:-1/0};for(const i of t){const t=i.getBoundingClientRect();n.x>t.x&&(n.x=t.x),n.y>t.y&&(n.y=t.y),e.x<t.right&&(e.x=t.right),e.y<t.bottom&&(e.y=t.bottom)}return{x:n.x,y:n.y,height:e.y-n.y,width:e.x-n.x}}(pt(t,lt)),function(t,n){for(let e=t.length-1;e>=0;--e)n(t[e])}(c.children,(t=>((t,n)=>n.some((n=>o(t,n))))(t,lt)?(ut(t),!0):(t.remove(),!1)))):(s=t.getBoundingClientRect(),pt(c,ht).forEach((t=>ut(t))));const r=a.getElementsByTagName("foreignObject");for(;r[0];)r[0].parentNode.removeChild(r[0]);const d=t[b].data,l=1/d.scale;c.style.transform=`matrix(1, 0, 0, 1, ${l*(d.position.x+15*d.scale-s.x)}, ${l*(d.position.y+15*d.scale-s.y)})`,function(t,n,e,i){const o=new Image;o.width=n.width*e*window.devicePixelRatio,o.height=n.height*e*window.devicePixelRatio,o.onload=function(){const t=document.createElement("canvas");t.width=o.width,t.height=o.height,t.style.width=`${o.width}px`,t.style.height=`${o.height}px`;const e=t.getContext("2d");e.imageSmoothingEnabled=!1,e.drawImage(o,n.x,n.y,n.width,n.height,0,0,o.width,o.height),URL.revokeObjectURL(o.src),t.toBlob(i,"image/png")},t.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,o.width),t.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,o.height),o.src=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(t)],{type:"image/svg+xml;charset=utf-8"}))}(a,{x:0,y:0,height:s.height/d.scale+30,width:s.width/d.scale+30},3,(async t=>i(n?await ct(t,"dgRm",(new TextEncoder).encode(n)):t)))}const lt=[ot,it],ht=[ot,it,et,nt],ut=t=>i(t,...ht),pt=(t,n)=>t.querySelectorAll(`.${n.join(", .")}`);async function ft(t){const n=await async function(t,n){return st(await t.arrayBuffer(),rt(n))}(t,"dgRm");return n?(new TextDecoder).decode(n):null}const vt="web text/dgrm";async function mt(t,n){const e=`web text/dgrm${JSON.stringify(_(n))}`;await async function(t){try{await navigator.clipboard.writeText(t)}catch(t){alert(t)}}(e),window.ClipboardItem&&dt(t,null,!0,(async t=>{try{await navigator.clipboard.write([new window.ClipboardItem({[t.type]:Promise.resolve(t),"text/plain":Promise.resolve(new Blob([e],{type:"text/plain"}))})])}catch{}}))}const gt=async()=>wt(await async function(){try{return await navigator.clipboard.readText()}catch(t){return alert(t),null}}());function wt(t){if(null==t||""===t.trim())return null;const n={txt:t};if(t.startsWith(vt))try{n.data=JSON.parse(t.slice(vt.length)),n.txt=null}catch{}return n}class yt extends HTMLElement{constructor(t,n,e,i,o){super(),this.i=t,this.o=n,this.u=e,this.m=i,this.g=o}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML=`<style>.ln{display:flex;align-items:center;color:#0d6efd;line-height:25px;padding:5px 10px;cursor:pointer;white-space:nowrap}.ln>*{margin-right:10px}</style><div id="clone" class="ln" style="padding-top:10px">${Q}Create copy</div><div id="copy" class="ln"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7 6V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1h-3v3c0 .552-.45 1-1.007 1H4.007A1.001 1.001 0 0 1 3 21l.003-14c0-.552.45-1 1.007-1H7zm2 0h8v10h2V4H9v2z" fill="rgb(52,71,103)"/></svg>Copy to clipboard</div><div id="save" class="ln">${tt}Save image</div><div id="del" class="ln" style="padding-bottom:10px">${W}Delete</div>`;const n=this.g;function e(e,i){c(t.getElementById(e),"click",(t=>{i(),n()}))}e("clone",this.m),e("copy",(async()=>await mt(this.i,this.o()))),e("save",(()=>dt(this.i,JSON.stringify(_(this.o())),!0,(async t=>q(t,"dgrm.png"))))),e("del",this.u)}}function xt(t,n,e,i){const o=V(t[b].data,e,i);B(o,t[b].data.cell);const a=m(o,function(t){const n=function(t){const n={x:1/0,y:1/0},e={x:-1/0,y:-1/0};return bt(t,(t=>{t&&(n.x>t.x&&(n.x=t.x),n.y>t.y&&(n.y=t.y),e.x<t.x&&(e.x=t.x),e.y<t.y&&(e.y=t.y))})),{min:n,max:e}}(t);return{x:n.min.x+(n.max.x-n.min.x)/2,y:n.min.y+(n.max.y-n.min.y)/2}}(n),-1);bt(n,(n=>{n&&B(m(n,a),t[b].data.cell)}))}function bt(t,n){t.s.forEach((t=>{0===t.type?(n(t.s.p?.position),n(t.e.p?.position)):n(t.position)}))}function kt(t,n,e,i){K(t,e);const o=function(t,n,e){async function i(e){return document.activeElement===t.ownerSVGElement&&(e.preventDefault(),mt(t,n()),!0)}async function o(t){await i(t)&&e()}return document.addEventListener("copy",i),document.addEventListener("cut",o),function(){s(document,"copy",i),s(document,"cut",o)}}(t,n,i);function a(t){l(t)||"Delete"!==t.key&&"Backspace"!==t.key||i()}return c(document,"keydown",a),function(){K(t,null),o(),s(document,"keydown",a)}}customElements.define("ap-grp-settings",yt);const Mt=(t,n)=>$t(t,w(_(n)));function $t(t,n,e,i){G(t),xt(t,n,null==e?window.innerWidth/2:e,null==i?window.innerHeight/2:i),Ht(t,Y(t,n,!0))}function Ht(t,n,o){const a=t=>!o||o(t.position),r={shapes:[],shapesPaths:[],pathEnds:[],pathEndsPaths:[],pathsFullSelected:[]};function d(t,n,i){return!n.shape&&a(n.data)?(r.pathEnds.push(n),e(t,i),1):n.shape&&a(n.shape.shapeEl[j].data)?2:0}for(const t of n)if(t[j])a(t[j].data)&&(e(t,it),r.shapes.push(t));else if(t[J]){const n=d(t,t[J].data.s,nt),i=d(t,t[J].data.e,et);1!==n&&1!==i||r.pathEndsPaths.push(t),2!==n&&2!==i||r.shapesPaths.push(t),0!==n&&0!==i&&(r.pathsFullSelected.push(t),e(t,it))}!function(t,n){if(1===n.shapes?.length&&!n.pathEnds?.length)return i(n.shapes[0],it),void H(n.shapes[0]);if(!n.shapes?.length&&1===n.pathEnds?.length)return void zt(n.pathEndsPaths[0]);if(!n.shapes?.length&&2===n.pathEnds?.length&&1===n.pathEndsPaths?.length)return zt(n.pathEndsPaths[0]),void H(n.pathEndsPaths[0]);const e=t.ownerSVGElement;let o,a=!1,r=!1;const d=()=>{o?.del(),o=null,s(e,"wheel",d)};function l(t){!t[C]&&t.isPrimary?(d(),r=n.shapes?.some((n=>n.contains(t.target)))||n.pathEnds?.some((n=>n.el.contains(t.target)))||n.shapesPaths?.some((n=>n.contains(t.target)))||n.pathEndsPaths?.some((n=>n.contains(t.target))),r||t.target===e?(r&&t.stopImmediatePropagation(),e.setPointerCapture(t.pointerId),c(e,"pointerup",f,!0),c(e,"pointermove",m)):g()):g()}function h(t){n.shapes?.forEach((n=>{t(n[j].data.position),n[j].drawPosition()})),n.pathEnds?.forEach((n=>t(n.data.position))),n.pathEndsPaths?.forEach((t=>t[J].draw()))}function u(){v(n.shapes,(t=>t[j].del())),v(n.pathEndsPaths,(t=>t[J].del())),g()}const p=()=>[...n.shapes,...n.pathsFullSelected];function f(n){if(!a){if(!r)return void g();o=R(n.clientX-10,n.clientY-10,new yt(t,p,u,(()=>Mt(t,p())),(()=>o?.del()))),c(e,"wheel",d,!0)}g(!0)}function m(n){r?(a=!0,h((e=>M(e,t[b].data.scale,n)))):g(!0)}function g(o){s(e,"pointerup",f),s(e,"pointermove",m),a&&(a=!1,h((n=>B(n,t[b].data.cell)))),r=!1,o||(w&&(w(),w=null),s(e,"pointerdown",l,!0),d(),v(n.shapes,(t=>i(t,it))),v(n.pathEndsPaths,(t=>zt(t))),v(n.shapesPaths,(t=>zt(t))))}e.addEventListener("pointerdown",l,{passive:!0,capture:!0});let w=kt(t,p,g,u)}(t,r)}function zt(t){i(t,it,nt,et)}const Ct=(t,n,e,i,o)=>t.x<=i&&i<=t.x+n&&t.y<=o&&o<=t.y+e;class Vt extends HTMLElement{constructor(t,n){super(),this.M=n,this.i=t}connectedCallback(){const t=this.M[J].data.styles,n=t=>this.M[J].data.styles?.includes(t)?'class="actv"':"",o=this.attachShadow({mode:"closed"});o.innerHTML=`<style>.ln{display:flex}.ln>*{height:24px;padding:10px;fill-opacity:.3;stroke-opacity:.3}[data-cmd]{cursor:pointer}.actv{fill-opacity:1;stroke-opacity:1}</style><ap-shape-edit id="edit" edit-btn="true"><div class="ln"><svg data-cmd data-cmd-arg="arw-s" ${n("arw-s")} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="arw-e" ${n("arw-e")} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="dash" ${n("dash")} viewBox="0 0 24 24" width="24" height="24"><path d="M 2,11 L 20,11" stroke="rgb(52,71,103)" style="stroke-dasharray:4,3;stroke-width:3"></path></svg></div></ap-shape-edit>`,c(o.getElementById("edit"),"cmd",(t=>{switch(t.detail.cmd){case"style":a(this.M,this.M[J].data,"cl-",t.detail.arg);break;case"del":this.M[J].del();break;case"copy":Mt(this.i,[this.M])}})),r(o,"[data-cmd]",(n=>{const o=d(n,"data-cmd-arg"),a=t.indexOf(o);a>-1?(i(this.M,o),t.splice(a,1),i(n.currentTarget,"actv")):(e(this.M,o),t.push(o),e(n.currentTarget,"actv"))}))}}function Lt(e){for(const i in e.cons)n(t(e.el,i),e.cons[i].position)}function Bt(t,n){const e=t.getBoundingClientRect(),i=R(e.left+10,e.top+10,n);return{del:i.del,updPos:()=>{const n=t.getBoundingClientRect();i.position(n.left+10,n.top+10)}}}customElements.define("ap-path-settings",Vt);const Et=(t,n)=>R(n.clientX-66,n.clientY-10,t);function St(n,a){const r=h("g",'<path data-key="outer" d="M0 0" stroke="transparent" stroke-width="20" fill="none"/><path data-key="path" class="path" d="M0 0" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"/><path data-key="selected" d="M0 0" stroke="transparent" stroke-width="10" fill="none" style="pointer-events:none"/><g data-key="start"><circle data-evt-index="1" class="path-end" r="10" stroke-width="0" fill="transparent"/><path class="path" d="M-7 7 l 7 -7 l -7 -7" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"></path></g><g data-key="end"><circle data-evt-index="1" class="path-end" r="10" stroke-width="0" fill="transparent"/><path class="path" d="M-7 7 l 7 -7 l -7 -7" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"></path></g>');e(r,"shpath"),a.s.el=t(r,"start"),a.e.el=t(r,"end"),a.styles=a.styles??["arw-e"];const d=Zt(r,"path","outer","selected");function l(){if(!a.s.shape||!a.e.shape){const t=function(t,n){const e=Math.atan2(n.y-t.y,n.x-t.x);return Rt(e,-.8,.8)?"left":Rt(e,.8,2.4)?"top":Rt(e,2.4,3.2)||Rt(e,-3.2,-2.4)?"right":"bottom"}(a.s.data.position,a.e.data.position);a.e.shape||(a.e.data.dir=t),a.s.shape||(a.s.data.dir=Nt(t))}const t=function(t){let n=.5*Math.hypot(t.s.data.position.x-t.e.data.position.x,t.s.data.position.y-t.e.data.position.y);function e(t){return"right"===t.dir||"left"===t.dir?"right"===t.dir?t.position.x+n:t.position.x-n:t.position.x}function i(t){return"right"===t.dir||"left"===t.dir?t.position.y:"bottom"===t.dir?t.position.y+n:t.position.y-n}return n=n>70?70:n<15?15:n,`M ${t.s.data.position.x} ${t.s.data.position.y} C ${e(t.s.data)} ${i(t.s.data)}, ${e(t.e.data)} ${i(t.e.data)}, ${t.e.data.position.x} ${t.e.data.position.y}`}(a);d.forEach((n=>n.setAttribute("d",t))),Dt(a.s),Dt(a.e)}function u(t){At(t.shape)?.pathDel(r)}function p(t){t.shape&&(t.data=At(t.shape).pathAdd(t.shape.connectorKey,r))}let f;function v(t){f||(f=Et(new Vt(n,r),t))}function m(){$(),H(),u(a.s),u(a.e),r.remove()}let g,w,y,x=0;function $(){x=0,i(r,ot),Pt(a.s,1),Pt(a.e,1),f?.del(),f=null,w&&(w(),w=null,r.style.pointerEvents="unset"),g&&(g(),g=null)}const H=k(n.ownerSVGElement,r,(t=>{$(),y=a.e.el.contains(t.target)?"e":a.s.el.contains(t.target)?"s":null,y&&(a[y].shape&&(a[y].shape.shapeEl!==a["s"===y?"e":"s"].shape?.shapeEl&&u(a[y]),a[y].shape=null,a[y].data={dir:a[y].data.dir,position:L(n[b].data,t)}),r.style.pointerEvents="none",w=function(t){let n=null;function a(t){const a=A(t);if(n!==a){o(a,"hovertrack")&&e(a,"hover");let t=!1;o(a?.parentElement,"hovertrack")&&(e(a.parentElement,"hover"),t=!0),i(n,"hover"),n?.parentElement===a?.parentElement&&t||i(n?.parentElement,"hover"),n=a}}return c(t,"pointermove",a),function(){s(t,"pointermove",a),i(n,"hover"),i(n?.parentElement,"hover"),n=null}}(r.parentElement))}),(t=>{y?(M(a[y].data.position,n[b].data.scale,t),l()):function(t,n,e,i){const o=n=>M(n,t.scale,i);Tt(n.s,o),Tt(n.e,o),n.s.shape||n.e.shape||e()}(n[b].data,a,l,t)}),(t=>{if(y){const e=A(t),i=e?.getAttribute(at);i?(a[y].shape={shapeEl:e.parentElement,connectorKey:i},p(a[y])):B(a[y].data.position,n[b].data.cell),l()}else!function(t,n,e){const i=n=>B(n,t.cell);Tt(n.s,i),Tt(n.e,i),n.s.shape&&n.e.shape||e()}(n[b].data,a,l);$()}),(function(t){switch(x){case 0:x=1,e(r,ot),Pt(a.s,2),Pt(a.e,2),g=kt(n,(()=>[r]),$,m);break;case 1:x=2,v(t);break;case 2:v(t)}}),$);return r[J]={draw:l,pointerCapture:t=>z(a.e.el,t),del:m,data:a},a.styles&&e(r,...a.styles),p(a.s),p(a.e),l(),r}function Tt(t,n){t.shape?(n(At(t.shape).data.position),At(t.shape).drawPosition()):n(t.data.position)}const At=t=>t?.shapeEl[j];function Dt(t){t.el.style.transform=`translate(${t.data.position.x}px, ${t.data.position.y}px) rotate(${Ot(t.data.dir)}deg)`}function Pt(t,n){t.el.firstElementChild.setAttribute("data-evt-index",n.toString())}const Ot=t=>"right"===t?180:"left"===t?0:"bottom"===t?270:90,Nt=t=>"left"===t?"right":"right"===t?"left":"top"===t?"bottom":"top";const Zt=(n,...e)=>e.map((e=>t(n,e))),Rt=(t,n,e)=>n<=t&&t<=e;function Ut(t,n,e){const i=function(t,n){let e=0;return{s:t.split("\n").map(((t,i)=>(e=i,`<tspan x="${n}" dy="${0===i?.41:1}em" ${0===t.length?'visibility="hidden"':""}>${0===t.length?".":function(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}(t).replaceAll(" ","&nbsp;")}</tspan>`))).join(""),c:e}}(e||"",t.x?.baseVal[0]?.value??0);t.innerHTML=i.s,null!=n&&t.y.baseVal[0].newValueSpecifiedUnits(t.y.baseVal[0].SVG_LENGTHTYPE_EMS,i.c>0?n-i.c/2:n)}const It=(t,n)=>Bt(n,jt(t,n)),Jt=(t,n,e)=>Et(jt(t,n),e);function jt(t,n){const e=new Ft;return c(e,"cmd",(e=>{switch(e.detail.cmd){case"style":a(n,n[j].data,"cl-",e.detail.arg);break;case"del":n[j].del();break;case"copy":Mt(t,[n])}})),e}class Ft extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML=`<style>.ln{display:flex}.ln>*{height:24px;padding:10px;cursor:pointer}#prop{padding-bottom:10px}.crcl{width:25px;height:25px;border-radius:50%}</style><div id="pnl"><div id="clr" style="display:none"><div class="ln"><div data-cmd="style" data-cmd-arg="cl-red"><div class="crcl" style="background:#e74c3c"></div></div><div data-cmd="style" data-cmd-arg="cl-orange"><div class="crcl" style="background:#f60"></div></div><div data-cmd="style" data-cmd-arg="cl-green"><div class="crcl" style="background:#19bc9b"></div></div></div><div class="ln"><div data-cmd="style" data-cmd-arg="cl-blue"><div class="crcl" style="background:#1aaee5"></div></div><div data-cmd="style" data-cmd-arg="cl-dblue"><div class="crcl" style="background:#1d809f"></div></div><div data-cmd="style" data-cmd-arg="cl-dgray"><div class="crcl" style="background:#495057"></div></div></div></div><div id="prop" style="display:none"><slot id="slot"></slot></div></div><div class="ln"><svg data-toggle="clr" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M19.228 18.732l1.768-1.768 1.767 1.768a2.5 2.5 0 1 1-3.535 0zM8.878 1.08l11.314 11.313a1 1 0 0 1 0 1.415l-8.485 8.485a1 1 0 0 1-1.414 0l-8.485-8.485a1 1 0 0 1 0-1.415l7.778-7.778-2.122-2.121L8.88 1.08zM11 6.03L3.929 13.1 11 20.173l7.071-7.071L11 6.029z" fill="rgb(52,71,103)"/></svg> <svg data-toggle="prop" ${this.getAttribute("edit-btn")?"":'style="display: none;"'} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12.9 6.858l4.242 4.243L7.242 21H3v-4.243l9.9-9.9zm1.414-1.414l2.121-2.122a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414l-2.122 2.121-4.242-4.242z" fill="rgb(52,71,103)"/></svg> ${Q} ${W}</div>`;{const n=t.getElementById("pnl");function e(t){var e;e=window.scrollY+t*n.getBoundingClientRect().height,N.style.top=`${N.getBoundingClientRect().top+e}px`}let i;r(t,"[data-toggle]",(n=>{i&&(e(1),Gt(i,!1));const o=t.getElementById(d(n,"data-toggle"));i!==o?(Gt(o,!0),e(-1),i=o):i=null}))}r(t,"[data-cmd]",(t=>{this.dispatchEvent(new CustomEvent("cmd",{detail:{cmd:d(t,"data-cmd"),arg:d(t,"data-cmd-arg")}}))}))}}function Gt(t,n){t.style.display=n?"unset":"none"}function Kt(n,e,i,o,a,c,s,r,d=0){const l=Xt(i,o),h={el:t(l,"text"),vMid:d};Ut(h.el,h.vMid,e.title);return{el:l,cons:o,draw:_t(n,l,e,o,h,r??It,(()=>s(h.el)),a,c,null).draw,titleSet:t=>{e.title=t,Ut(h.el,h.vMid,e.title),s(h.el)}}}customElements.define("ap-shape-edit",Ft);const Xt=(t,n)=>h("g",`${t}\n\t${Object.entries(n).map((t=>`<circle data-key="${t[0]}" data-connect="${t[1].dir}" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(${t[1].position.x}px,${t[1].position.y}px)"/>`)).join()}`);function _t(t,o,a,r,d,l,u,p,f,v){let m,g;function y(t){a.title=t,u()}const x=function(t,o,a,r,d,l,u,p,f){e(o,"hovertrack");const v=w(r),m=new Set;let g,y,x=0;function $(){y?.remove(),y=null}function z(){o.style.transform=`translate(${a.position.x}px, ${a.position.y}px)`;for(const t in r)v[t].position={x:r[t].position.x+a.position.x,y:r[t].position.y+a.position.y};for(const t of m)t[J].draw()}function C(t){l(),x=0,i(o,ot,it),g&&(g(),g=null),t||$()}const V=k(t.ownerSVGElement,o,(n=>{if(n.target===y)return C(!0),V(),void function(t,n,e,i){function o(n){s(t,"pointercancel",o),s(t,"pointerup",o),s(t,"wheel",o),s(document,"pointerdown",o),s(t,"pointermove",e),i(n)}c(t,"pointercancel",o,!0),c(t,"pointerup",o,!0),c(t,"wheel",o,!0),c(document,"pointerdown",o,!0),c(t,"pointermove",e),t.setPointerCapture(n.pointerId)}(y,n,p,(t=>{f&&f(),$(),H(o)}));C();const e=n.target.getAttribute(at);if(e){V();const i=St(t,{s:{shape:{shapeEl:o,connectorKey:e}},e:{data:{dir:Nt(v[e].dir),position:L(t[b].data,n)}}});o.parentNode.append(i),i[J].pointerCapture(n),m.add(i)}}),(n=>{M(a.position,t[b].data.scale,n),z()}),(n=>{B(a.position,t[b].data.cell),z()}),(a=>{switch(x){case 0:x=1,e(o,ot),g=kt(t,(()=>[o]),C,o[j].del),u&&(y=function(t,i){const o=h("circle");return o.setAttribute("data-evt-index","2"),e(o,"resizer"),n(o,i),t.append(o),o}(o,u()));break;case 1:x=2,i(o,ot),e(o,it),$()}d(a,x)}),C);return o[j]={pathAdd:function(t,n){return m.add(n),v[t]},pathDel:function(t){m.delete(t)},drawPosition:z,del:function(){C(),V();for(const t of m)t[J].del();o.remove()},data:a},z}(t,o,a,r,((n,e)=>{2===e&&(d&&!m&&(m=function(t,n,e,i,o){let a=h("foreignObject");const c=document.createElement("textarea"),s=()=>function(t,n,e,i,o){const a=t.getBBox(),c=a.width+20;n.width.baseVal.value=c+2*i+2,n.x.baseVal.value=a.x-i-("center"===o?10:"right"===o?20:0),n.height.baseVal.value=a.height+2*i+3,n.y.baseVal.value=a.y-i,e.style.width=`${c}px`,e.style.height=`${a.height}px`}(t,a,c,d,r.textAlign);c.value=e||"",c.oninput=function(){Ut(t,n,c.value),i(c.value),s()},c.onblur=function(){o(c.value)},c.onpointerdown=function(t){t.stopImmediatePropagation()},a.appendChild(c),t.parentElement.appendChild(a);const r=getComputedStyle(c),d=parseInt(r.paddingLeft)+parseInt(r.borderWidth);return s(),c.focus(),{dispose:()=>{a.remove(),a=null},draw:s}}(d.el,d.vMid,a.title,y,y)),g||(g=l(t,o,n)))}),(function(){m?.dispose(),m=null,g?.del(),g=null}),p,f,v);return a.styles&&e(o,...a.styles),{draw:()=>{x(),g?.updPos&&g?.updPos(),m?.draw()}}}function Yt(n,e,i){t(n,e).r.baseVal.value=i}const qt=(t,n)=>function(t,n,e){const i=u(t);return f(n,e,Math.sqrt(i.x**2+i.y**2))}(t,n,24);const Wt=(t,n)=>Bt(n,new Qt(t,n));class Qt extends HTMLElement{constructor(t,n){super(),this.$=n,this.i=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.ln{display:flex}.ln>*{height:24px;padding:10px;fill-opacity:.3;stroke-opacity:.3}[data-cmd]{cursor:pointer}.ta-1 [data-cmd-arg="1"],.ta-2 [data-cmd-arg="2"],.ta-3 [data-cmd-arg="3"]{fill-opacity:1;stroke-opacity:1}</style><ap-shape-edit id="edit" edit-btn="true"><div class="ln"><svg data-cmd data-cmd-arg="1" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 15h14v2H3v-2zm0-5h18v2H3v-2zm0-5h14v2H3V9z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="2" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm2 15h14v2H5v-2zm-2-5h18v2H3v-2zm2-5h14v2H5V9z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="3" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm4 15h14v2H7v-2zm-4-5h18v2H3v-2zm4-5h14v2H7V9z" fill="rgb(52,71,103)"/></svg></div></ap-shape-edit>';const n=this.$[j].data,o=t.getElementById("edit");e(o,`ta-${n.a}`),c(o,"cmd",(t=>{switch(t.detail.cmd){case"style":a(this.$,n,"cl-",t.detail.arg);break;case"del":this.$[j].del();break;case"copy":Mt(this.i,[this.$])}})),r(t,"[data-cmd]",(t=>{const a=Number.parseInt(d(t,"data-cmd-arg"));if(a===n.a)return;const c=n.a;n.a=a,this.$[j].draw(),i(o,`ta-${c}`),e(o,`ta-${n.a}`)}))}}function tn(o,a){a.w??=a.t?48:96,a.h??=48,a.a??=a.t?1:2;const c=a.t?{w:48,h:48}:{w:a.w,h:a.h};let s;const r=Kt(o,a,`<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="96" x="-72" y="-48" fill="transparent" stroke="transparent" stroke-width="0" />\n\t\t <rect data-key="main" width="96" height="48" x="-48" y="-24" rx="15" ry="15" fill="#1aaee5" stroke="#fff" stroke-width="1" />\n\t\t <text data-key="text" y="${a.t?an(a.h):0}" x="${on(a)}" style="pointer-events: none;" fill="#fff">&nbsp;</text>`,{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:24}},top:{dir:"top",position:{x:0,y:-24}}},a.t?null:()=>{const t=function(t){const n=t.w/2,e=t.h/2;return{t:{x:t.position.x-n,y:t.position.y-e},b:{x:n,y:e}}}(a);return s=t.t,t.b},(e=>{let i;(function(t,e,i,o,a){const c=m(L(t[b].data,o),e,-1),s={};let r=!1;function d(t){c[t]<48&&(c[t]=48);const n=48*Math.round(c[t]/48),o="x"===t?"w":"h";i[o]!==n&&(!a||a()[o]<=n)&&(i[o]=n,i.position[t]=e[t]+n/2,r=!0),s[t]=c[t]-i[o]/2}return d("x"),d("y"),n(o.target,s),r})(o,s,a,e,(()=>(i??=nn(t(r.el,"text"),a.t),i)))&&(c.w=a.w,c.h=a.h,u())}),(t=>{const n=nn(t,a.t,c);a.w===n.w&&a.h===n.h||(a.w=n.w,a.h=n.h,u())}),a.t?Wt:It,a.t?null:0);e(r.el,a.t?"shtxt":"shrect");let d=a.h,l=a.w,h=a.a;function u(n){if(function(t,n){const e=n.w/-2,i=n.h/-2;t.cons.right.position.x=-e,t.cons.left.position.x=e,t.cons.bottom.position.y=-i,t.cons.bottom.position.x=0,t.cons.top.position.y=i,t.cons.top.position.x=0,Lt(t),en(t.el,"main",n.w,n.h,e,i),en(t.el,"outer",n.w+48,n.h+48,e-24,i-24)}(r,a),n||h!==a.a||l!==a.w){const n=a.w/-2;let o,c;switch(a.a){case 1:o=n+8,c=(a.w-l)/2;break;case 2:o=0,c=0;break;case 3:o=-n-8,c=(a.w-l)/-2}const s=t(r.el,"text");s.x.baseVal[0].value=o,s.querySelectorAll("tspan").forEach((t=>{t.x.baseVal[0].value=o})),a.position.x+=c,i(r.el,`ta-${h}`),e(r.el,`ta-${a.a}`),h=a.a,l=a.w}a.t&&d!==a.h&&(t(r.el,"text").y.baseVal[0].value=an(a.h),a.position.y+=(a.h-d)/2,d=a.h),r.draw()}return e(r.el,`ta-${a.a}`),96!==a.w||48!==a.h?u(!0):r.draw(),r.el[j].draw=u,r.el[j].titleSet=r.titleSet,r.el}function nn(t,n,e){const i=t.getBBox();return{w:f(e?.w,48,i.width+(n?12:0)),h:f(e?.h,48,i.height+(n?14:0))}}customElements.define("ap-rect-txt-settings",Qt);const en=(n,e,i,o,a,c)=>{const s=t(n,e);s.width.baseVal.value=i,s.height.baseVal.value=o,s.x.baseVal.value=a,s.y.baseVal.value=c},on=t=>1===t.a?-40:2===t.a?0:40,an=t=>-t/2+24;function cn(t,i){let o;i.w??=96,i.h??=96;const a=function(t,n,e,i,o,a,c){const s=Xt(e,i);return{el:s,cons:i,draw:_t(t,s,n,i,null,Jt,null,o,a,c).draw}}(t,i,'<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="144" x="-72" y="-72" fill="transparent" stroke="transparent" stroke-width="0" />\n\t\t <rect data-key="selected" width="96" height="96" x="-48" y="-48" rx="15" ry="15" fill="none" stroke="transparent" stroke-width="10" style="pointer-events: none;" />\n\t\t <rect data-key="main" width="96" height="96" x="-48" y="-48" rx="15" ry="15" />',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},(()=>{const t=sn(i);return o=t.tCanvas,t.bInner}),(e=>c(function(t,e,i,o,a){const c=m(L(t[b].data,o),e,-1);i.w=c.x<48?48:c.x;const s=i.w/2;i.position.x=e.x+s,i.h=c.y<48?48:c.y;const r=i.h/2;return i.position.y=e.y+r,n(o.target,{x:s,y:r}),{x:-s,y:-r}}(t,o,i,e))),(t=>c(function(t,n){const e=t=>24*Math.round(t/24);t.w=e(t.w),t.h=e(t.h);const i=sn(t);return t.position.x=n.x-i.tInner.x,t.position.y=n.y-i.tInner.y,i.tInner}(i,o))));e(a.el,"shbox");const c=t=>{a.cons.right.position.x=i.w+t.x,a.cons.left.position.x=t.x,a.cons.bottom.position.y=i.h+t.y,a.cons.top.position.y=t.y,Lt(a),en(a.el,"main",i.w,i.h,t.x,t.y),en(a.el,"selected",i.w,i.h,t.x,t.y),en(a.el,"outer",i.w+48,i.h+48,t.x-24,t.y-24),a.draw()};return 96!==i.w||96!==i.h?c(sn(i).tInner):a.draw(),a.el}function sn(t){const n=24*Math.floor(t.w/2/24),e=24*Math.floor(t.h/2/24);return{tCanvas:{x:t.position.x-n,y:t.position.y-e},tInner:{x:-n,y:-e},bInner:{x:t.w-n,y:t.h-e}}}function rn(n,e,i){t(n,e).setAttribute("d",`M${i.l.x} ${i.l.y} L${i.t.x} ${i.t.y} L${i.r.x} ${i.r.y} L${i.b.x} ${i.b.y} Z`)}function dn(t,n){const e=t/2,i=n-e,o=e-n;return{l:{x:i,y:0},t:{x:0,y:i},r:{x:o,y:0},b:{x:0,y:o}}}const ln=(t,n)=>f(n,48,function(t){const n=u(t);return 2*(Math.abs(n.x)+Math.abs(n.y))}(t)-20);function hn(t,n,e,i){n?.data||n?.txt?n.data?$t(t,n.data,e,i):function(t,n,e,i){G(t);const o=tn(t,{type:3,t:!0,position:B(V(t[b].data,null==e?window.innerWidth/2:e,null==i?window.innerHeight/2:i),t[b].data.cell)});t.append(o),o[j].titleSet(n),H(o)}(t,n.txt,e,i):function(t){const n=document.createElement("div");n.style.cssText="\n\t\tmin-width: 150px;\n\t\tmargin-left: -75px;\n\t\tbackground-color: rgb(52,71,103);\n\t\tcolor: #fff;\n\t\ttext-align: center;\n\t\tborder-radius: 8px;\n\t\tpadding: 10px;\n\t\tposition: fixed;\n\t\tz-index: 1;\n\t\tleft: 50%;\n\t\tbottom: 30px;",n.className="toast",n.innerHTML=`<style>.toast{visibility:visible;animation:fadein .5s,fadeout .5s 2.5s}@keyframes fadein{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}@keyframes fadeout{from{bottom:30px;opacity:1}to{bottom:0;opacity:0}}</style>${t}`,document.body.append(n),setTimeout((t=>n.remove()),2800)}("Clipboard is empty")}class un extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML=`<style>.menu{position:fixed;top:5px;left:5px;cursor:pointer;padding:10px}#options{position:fixed;padding:10px 15px 15px 15px;box-shadow:0 4px 24px rgba(0,0,0,.12);border-radius:8px;background-color:rgba(255,255,255,.9);top:0;left:0;z-index:1}#options a,#options div{color:#0d6efd;cursor:pointer;padding:5px 0;display:flex;align-items:center;line-height:25px;text-decoration:none}#options a svg,#options div svg{margin-right:10px}</style><div id="menu" class="menu"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgb(52,71,103)"/></svg></div><div id="options" style="visibility:hidden"><div id="menu2"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgb(52,71,103)"/></svg></div><div id="new"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M9 2.003V2h10.998C20.55 2 21 2.455 21 2.992v18.016a.993.993 0 0 1-.993.992H3.993A1 1 0 0 1 3 20.993V8l6-5.997zM5.83 8H9V4.83L5.83 8zM11 4v5a1 1 0 0 1-1 1H5v10h14V4h-8z" fill="rgb(52,71,103)"/></svg>New diagram</div><div id="open"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 21a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h7.414l2 2H20a1 1 0 0 1 1 1v3h-2V7h-7.414l-2-2H4v11.998L5.5 11h17l-2.31 9.243a1 1 0 0 1-.97.757H3zm16.938-8H7.062l-1.5 6h12.876l1.5-6z" fill="rgb(52,71,103)"/></svg>Open diagram image</div><div id="save">${tt}Save diagram image</div><div id="link"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13.06 8.11l1.415 1.415a7 7 0 0 1 0 9.9l-.354.353a7 7 0 0 1-9.9-9.9l1.415 1.415a5 5 0 1 0 7.071 7.071l.354-.354a5 5 0 0 0 0-7.07l-1.415-1.415 1.415-1.414zm6.718 6.011l-1.414-1.414a5 5 0 1 0-7.071-7.071l-.354.354a5 5 0 0 0 0 7.07l1.415 1.415-1.415 1.414-1.414-1.414a7 7 0 0 1 0-9.9l.354-.353a7 7 0 0 1 9.9 9.9z" fill="rgb(52,71,103)"/></svg>Copy link to diagram</div><a href="/donate.html" target="_blank" style="margin-bottom:0"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0H24V24H0z"/><path d="M12.001 4.529c2.349-2.109 5.979-2.039 8.242.228 2.262 2.268 2.34 5.88.236 8.236l-8.48 8.492-8.478-8.492c-2.104-2.356-2.025-5.974.236-8.236 2.265-2.264 5.888-2.34 8.244-.228zm6.826 1.641c-1.5-1.502-3.92-1.563-5.49-.153l-1.335 1.198-1.336-1.197c-1.575-1.412-3.99-1.35-5.494.154-1.49 1.49-1.565 3.875-.192 5.451L12 18.654l7.02-7.03c1.374-1.577 1.299-3.959-.193-5.454z" fill="rgb(255,66,77)"/></svg>Donate</a></div>`;const n=t.getElementById("options");function e(){n.style.visibility="visible"===n.style.visibility?"hidden":"visible"}function i(n,i){t.getElementById(n).onclick=t=>{Z(!0),i(),e(),Z(!1)}}t.getElementById("menu").onclick=e,t.getElementById("menu2").onclick=e,i("new",(()=>{F(this.i)})),i("save",(()=>{const t=X(this.i);0!==t.s.length?dt(this.i,JSON.stringify(t),null,(t=>q(t,"dgrm.png"))):vn()})),i("open",(()=>function(t,n){const e=document.createElement("input");e.type="file",e.multiple=!1,e.accept=t,e.onchange=async function(){n(e.files?.length?e.files[0]:null)},e.click(),e.remove()}(".png",(async t=>await pn(this.i,t))))),i("link",(async()=>{const t=X(this.i);if(0===t.s.length)return void vn();const n=function(){const t=new Uint8Array(4);window.crypto.getRandomValues(t);const n=new Date;return`${n.getUTCFullYear()}${(n.getUTCMonth()+1).toString().padStart(2,"0")}${Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}`}(),e=new URL(window.location.href);e.searchParams.set("k",n),await navigator.clipboard.writeText(e.toString()),await async function(t,n){return await fetch(`${I}/${t}`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)})}(n,t),alert("Link to diagram copied to clipboard")}))}init(t){this.i=t,document.body.addEventListener("dragover",(t=>{t.preventDefault()})),document.body.addEventListener("drop",(async t=>{t.preventDefault(),1===t.dataTransfer?.items?.length&&"file"===t.dataTransfer.items[0].kind&&"image/png"===t.dataTransfer.items[0].type?await pn(this.i,t.dataTransfer.items[0].getAsFile()):fn()}))}}async function pn(t,n){const e=await ft(n);e?Y(t,JSON.parse(e)):fn()}customElements.define("ap-menu",un);const fn=()=>alert("File cannot be read. Use the exact image file you got from the application."),vn=()=>alert("Diagram is empty");class mn extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{overflow-x:auto;padding:0;position:fixed;top:50%;left:5px;transform:translateY(-50%);box-shadow:0 4px 24px rgba(0,0,0,.12);border-radius:8px;background-color:rgba(255,255,255,.9)}.content{white-space:nowrap;display:flex;flex-direction:column}[data-cmd]{cursor:pointer}.menu svg{padding:10px}.stroke{stroke:#344767;stroke-width:2px;fill:transparent}.menu .big{width:62px;min-width:62px}@media only screen and (max-width:700px){.menu{width:100%;border-radius:0;bottom:0;display:flex;flex-direction:column;top:unset;left:unset;transform:unset}.content{align-self:center;flex-direction:row}}</style><div id="menu" class="menu" style="touch-action:none"><div class="content"><svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="1" viewBox="0 0 24 24" width="24" height="24"><circle r="9" cx="12" cy="12"></circle></svg> <svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="4" viewBox="0 0 24 24" width="24" height="24"><path d="M2 12 L12 2 L22 12 L12 22 Z" stroke-linejoin="round"></path></svg> <svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="2" viewBox="0 0 24 24" width="24" height="24"><rect x="2" y="4" width="20" height="16" rx="3" ry="3"></rect></svg> <svg data-cmd="shapeAdd" data-cmd-arg="0" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13 8v8a3 3 0 0 1-3 3H7.83a3.001 3.001 0 1 1 0-2H10a1 1 0 0 0 1-1V8a3 3 0 0 1 3-3h3V2l5 4-5 4V7h-3a1 1 0 0 0-1 1z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="shapeAdd" data-cmd-arg="3" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13 6v15h-2V6H5V4h14v2z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="shapeAdd" data-cmd-arg="5" viewBox="0 0 24 24" width="24" height="24"><path d="M7.82929 20C7.41746 21.1652 6.30622 22 5 22C3.34315 22 2 20.6569 2 19C2 17.6938 2.83481 16.5825 4 16.1707V7.82929C2.83481 7.41746 2 6.30622 2 5C2 3.34315 3.34315 2 5 2C6.30622 2 7.41746 2.83481 7.82929 4H16.1707C16.5825 2.83481 17.6938 2 19 2C20.6569 2 22 3.34315 22 5C22 6.30622 21.1652 7.41746 20 7.82929V16.1707C21.1652 16.5825 22 17.6938 22 19C22 20.6569 20.6569 22 19 22C17.6938 22 16.5825 21.1652 16.1707 20H7.82929ZM7.82929 18H16.1707C16.472 17.1476 17.1476 16.472 18 16.1707V7.82929C17.1476 7.52801 16.472 6.85241 16.1707 6H7.82929C7.52801 6.85241 6.85241 7.52801 6 7.82929V16.1707C6.85241 16.472 7.52801 17.1476 7.82929 18ZM5 6C5.55228 6 6 5.55228 6 5C6 4.44772 5.55228 4 5 4C4.44772 4 4 4.44772 4 5C4 5.55228 4.44772 6 5 6ZM19 6C19.5523 6 20 5.55228 20 5C20 4.44772 19.5523 4 19 4C18.4477 4 18 4.44772 18 5C18 5.55228 18.4477 6 19 6ZM19 20C19.5523 20 20 19.5523 20 19C20 18.4477 19.5523 18 19 18C18.4477 18 18 18.4477 18 19C18 19.5523 18.4477 20 19 20ZM5 20C5.55228 20 6 19.5523 6 19C6 18.4477 5.55228 18 5 18C4.44772 18 4 18.4477 4 19C4 19.5523 4.44772 20 5 20Z" fill="rgba(52,71,103,1)"></path></svg></div></div>';const n=t.getElementById("menu");n.querySelectorAll('[data-cmd="shapeAdd"]').forEach((t=>c(t,"pointerdown",this))),c(n,"pointerleave",this),c(n,"pointerup",this),c(n,"pointermove",this)}init(t){this.i=t}handleEvent(t){switch(t.type){case"pointermove":if(!this.H){const n=document.elementFromPoint(t.clientX,t.clientY);if(n===this.C)return;this.V===this.C&&this.i.ownerSVGElement.setPointerCapture(t.pointerId),this.C=n}break;case"pointerleave":this.H=!0,null!=this.L&&this.B(t),this.S();break;case"pointerdown":this.L=parseInt(t.currentTarget.getAttribute("data-cmd-arg")),this.V=document.elementFromPoint(t.clientX,t.clientY),this.C=this.V,this.H=null;break;case"pointerup":this.S()}}B(t){const n=L(this.i[b].data,t),e=0===this.L?{s:{data:{dir:"right",position:{x:n.x-24,y:n.y}}},e:{data:{dir:"right",position:{x:n.x+24,y:n.y}}}}:{type:this.L,position:{x:n.x,y:n.y},title:"Title"},i=this.i[b].shapeMap[this.L].create(e);z(i,t)}S(){this.L=null,this.V=null,this.C=null}}customElements.define("ap-menu-shape",mn),U(!0);const gn=document.getElementById("canvas");gn[b]={data:{position:{x:0,y:0},scale:1,cell:24},shapeMap:function(i){const o=t=>(i.append(t),t);return{0:{create:t=>o(St(i,t))},1:{create:e=>o(function(e,i){i.r??=48;let o,a=i.r;const c=Kt(e,i,'<circle data-key="outer" data-evt-no data-evt-index="2" r="72" fill="transparent" stroke-width="0"/><circle data-key="main" r="48" fill="#ff6600" stroke="#fff" stroke-width="1"/><text data-key="text" x="0" y="0" text-anchor="middle" style="pointer-events:none" fill="#fff"> </text>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},(()=>(o=g(i.position,-i.r),{x:i.r,y:i.r})),(r=>{let d=L(e[b].data,r).x-o.x;d<48&&(d=48);const l=48*Math.round(d/48)/2;i.r!==l&&qt(t(c.el,"text"))<=l&&(i.r=l,i.position.x=o.x+l,i.position.y=o.y+l,s(),a=l);const h=d-i.r;n(r.target,{x:h,y:h})}),(t=>{const n=qt(t,a);n!==i.r&&(i.r=n,s())}));function s(){c.cons.right.position.x=i.r,c.cons.left.position.x=-i.r,c.cons.bottom.position.y=i.r,c.cons.top.position.y=-i.r,Lt(c),Yt(c.el,"outer",i.r+24),Yt(c.el,"main",i.r),c.draw()}return 48!==i.r?s():c.draw(),c.el}(i,e))},2:{create:t=>o(tn(i,t))},3:{create:t=>(t.t=!0,o(tn(i,t)))},4:{create:a=>o(function(i,o){o.w??=96;let a,c=o.w;const s=Kt(i,o,'<path data-key="outer" data-evt-no data-evt-index="2" d="M-72 0 L0 -72 L72 0 L0 72 Z" stroke-width="0" fill="transparent"/><path data-key="border" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="20" stroke="#fff" fill="transparent" stroke-linejoin="round"/><path data-key="main" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="18" stroke-linejoin="round" stroke="#1D809F" fill="#1D809F"/><text data-key="text" x="0" y="0" text-anchor="middle" style="pointer-events:none" fill="#fff"> </text>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},(()=>{const t=o.w/2;return a=g(o.position,-t),{x:t,y:t}}),(e=>{let d=L(i[b].data,e).x-a.x;d<48&&(d=48);const l=48*Math.round(d/48);if(o.w!==l&&ln(t(s.el,"text"))<=l){o.w=l;const t=l/2;o.position.x=a.x+t,o.position.y=a.y+t,r(),c=l}const h=d-o.w/2;n(e.target,{x:h,y:h})}),(t=>{const n=ln(t,c);n!==o.w&&(o.w=n,r())}));function r(){const t=dn(o.w,0);s.cons.right.position.x=t.r.x,s.cons.left.position.x=t.l.x,s.cons.bottom.position.y=t.b.y,s.cons.top.position.y=t.t.y,Lt(s);const n=dn(o.w,9);rn(s.el,"main",n),rn(s.el,"border",n),rn(s.el,"outer",dn(o.w,-24)),s.draw()}return e(s.el,"shrhomb"),96!==o.w?r():s.draw(),s.el}(i,a))},5:{create:t=>{return n=cn(i,t),i.prepend(n),n;var n}}}}(gn)},gn.ownerSVGElement.addEventListener("contextmenu",(async t=>{l(t)||t.preventDefault()})),function(t){let n,e,i;function o(t){t.isPrimary&&t.isTrusted&&(n&&Math.abs(n.x-t.clientX)<3&&Math.abs(n.y-t.clientY)<3?t.stopImmediatePropagation():(n=null,void 0===t.movementX?(t[y]=e?t.clientX-e:0,t[x]=i?t.clientY-i:0,e=t.clientX,i=t.clientY):(t[y]=t.movementX,t[x]=t.movementY)))}t.addEventListener("pointerdown",(a=>{n={x:a.clientX,y:a.clientY},e=null,i=null,t.addEventListener("pointermove",o,{capture:!0,passive:!0}),t.addEventListener("pointerup",(n=>{s(t,"pointermove",o,!0)}),{capture:!0,once:!0,passive:!0})}),{capture:!0,passive:!0})}(gn.ownerSVGElement),function(t){t.addEventListener("pointerdown",(t=>{if(!t.isPrimary||t[P]||!t.isTrusted)return;t.stopImmediatePropagation();const n=new PointerEvent("pointerdown",t);n[P]=!0,T(t).dispatchEvent(n)}),{capture:!0,passive:!0})}(gn.ownerSVGElement),function(t){c(document,"paste",(async n=>{l(n)||hn(t,wt(n.clipboardData.getData("text/plain")))}))}(gn),function(t){const i=t.ownerSVGElement;let o,a,r,d,l;function u(t){if(t[C]||!d)return void f();t[C]=!0,r&&(r.remove(),r=null);const n=t.clientX-a.x,e=t.clientY-a.y;d.width.baseVal.value=Math.abs(n),d.height.baseVal.value=Math.abs(e),n<0&&(l.x=t.clientX),e<0&&(l.y=t.clientY),d.style.transform=`translate(${l.x}px, ${l.y}px)`}function p(){if(d&&!r){const n=n=>Ct(V(t[b].data,l.x,l.y),d.width.baseVal.value/t[b].data.scale,d.height.baseVal.value/t[b].data.scale,n.x,n.y);Ht(t,t.children,n)}f()}function f(){clearTimeout(o),o=null,r?.remove(),r=null,d?.remove(),d=null,s(i,"pointermove",u),s(i,"wheel",f),s(i,"pointerup",p)}c(i,"pointerdown",(s=>{!s[C]&&s.isPrimary?(c(i,"pointermove",u),c(i,"wheel",f,!0),c(i,"pointerup",p,!0),o=setTimeout((o=>{G(t),r=h("circle"),e(r,"ative-elem"),r.style.cssText="r:10px; fill: rgb(108 187 247 / 51%)",n(r,{x:s.clientX,y:s.clientY}),i.append(r),a={x:s.clientX,y:s.clientY},l={x:s.clientX,y:s.clientY},d=h("rect"),d.style.cssText="rx:8px; fill: rgb(108 187 247 / 51%)",n(d,l),i.append(d)}),500)):f()}))}(gn),function(t){const n=t[b].data,e=function(t,n){let e;function i(n){e!==n&&(e=n,t.style.backgroundImage=`radial-gradient(rgb(73 80 87 / ${n}) 1px, transparent 0)`)}return i(.7),t.style.backgroundSize=`${n.cell}px ${n.cell}px`,function(){const e=n.cell*n.scale;n.scale<.5?i(0):n.scale<=.9?i(.3):i(.7),t.style.backgroundSize=`${e}px ${e}px`,t.style.backgroundPosition=`${n.position.x}px ${n.position.y}px`}}(t.ownerSVGElement,n);function i(){t.style.transform=`matrix(${n.scale}, 0, 0, ${n.scale}, ${n.position.x}, ${n.position.y})`,e()}function o(t,e){if(t<.25||t>4)return;const o=t/n.scale;n.scale=t,n.position.x=o*(n.position.x-e.x)+e.x,n.position.y=o*(n.position.y-e.y)+e.y,i()}!function(t,n,e,i){let o,a,r,d;function l(n){r=null,d=null,o?.id===n.pointerId&&(o=null),a?.id===n.pointerId&&(a=null),o||a||(s(t,"pointermove",h),s(t,"pointercancel",l),s(t,"pointerup",l))}function h(t){if(t[C])return;if(o&&!a||!o&&a)return n.position.x=t.clientX+(o||a).shift.x,n.position.y=t.clientY+(o||a).shift.y,void i();if(!a||!o||a?.id!==t.pointerId&&o?.id!==t.pointerId)return;const c=Math.hypot(o.pos.x-a.pos.x,o.pos.y-a.pos.y),s={x:(o.pos.x+a.pos.x)/2,y:(o.pos.y+a.pos.y)/2};r&&(n.position.x=n.position.x+s.x-d.x,n.position.y=n.position.y+s.y-d.y,e(n.scale/r*c,s)),r=c,d=s,o.id===t.pointerId&&(o=S(t,n)),a.id===t.pointerId&&(a=S(t,n))}c(t,"pointerdown",(e=>{e[C]||!o&&!e.isPrimary||o&&a||(t.setPointerCapture(e.pointerId),o||(c(t,"pointermove",h),c(t,"pointercancel",l),c(t,"pointerup",l)),o?a||(a=S(e,n)):o=S(e,n))}))}(t.ownerSVGElement,n,o,i),t.ownerSVGElement.addEventListener("wheel",(t=>{t.preventDefault();const e=t.deltaY||t.deltaX,i=Math.abs(e)<50?.05:.25;o(n.scale+(e<0?i:-i),E(t))})),t[b].move=function(t,e,o){n.position.x=t,n.position.y=e,n.scale=o,i()}}(gn),function(t){if(!navigator.clipboard.readText)return void t.ownerSVGElement.addEventListener("contextmenu",(async n=>{t.ownerSVGElement===T(n)&&n.preventDefault()}));const n=t.ownerSVGElement,e=t.ownerDocument;let i,o,a,r;function d(n){s(e,"pointermove",u),s(e,"pointerup",l),a||(a=function(t,n,e,i){const o=document.createElement("div");o.innerHTML='<style>.ln{display:flex;align-items:center;color:#0d6efd;line-height:25px;padding:10px;cursor:pointer;white-space:nowrap}.ln>*{margin-right:10px}</style><div class="ln"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7 4V2h10v2h3.007c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 21.007V4.993C3 4.445 3.445 4 3.993 4H7zm0 2H5v14h14V6h-2v2H7V6zm2-2v2h6V4H9z" fill="rgb(52,71,103)"/></svg>Paste</div>',c(o,"click",(async o=>{hn(e,await gt(),t,n),i()}));return{del:R(t-10,n-10,o).del,el:o}}(n.clientX,n.clientY,t,l),c(e,"pointerdown",h))}function l(){clearTimeout(i),i=null,a?.del(),a=null,s(e,"pointerdown",h),s(e,"pointerup",l),s(e,"wheel",l),s(e,"keydown",l),s(e,"pointerup",f),s(e,"pointercancel",f),s(e,"pointermove",p),o=!1,r=!1}function h(t){a.el.contains(t.target)||l()}function u(){l(),o=!0}function p(){r||l(),o=!0}function f(){r=!0}c(n,"pointerdown",(async function(t){!t[C]&&t.isPrimary?(l(),c(e,"pointermove",u,!0),c(e,"pointerup",l,!0),c(e,"wheel",l,!0),c(e,"keydown",l,!0),i=setTimeout((n=>{d(t),c(e,"pointerup",f,!0),c(e,"pointercancel",f,!0),c(e,"pointermove",p,!0)}),500)):l()})),n.addEventListener("contextmenu",(async t=>{n===T(t)&&(t.preventDefault(),o||d(t))}))}(gn),document.getElementById("menu").init(gn),document.getElementById("menu-shape").init(gn);let wn=new URL(window.location.href);wn.searchParams.get("k")?(Z(!0),async function(t){return(await fetch(`${I}/${t}`)).json()}(wn.searchParams.get("k")).then((t=>{wn.searchParams.delete("k"),Y(gn,t)&&U(!1),history.replaceState(null,null,wn),Z(!1),wn=null}))):wn=null}();
