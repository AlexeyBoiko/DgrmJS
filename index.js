!function(){"use strict";const t=(t,n)=>t.querySelector(`[data-key="${n}"]`);function n(t,n){t.style.transform=`translate(${n.x}px, ${n.y}px)`}const e=(t,n)=>t?.classList.add(n),o=(t,n)=>t?.classList.remove(n),i=(t,n)=>t?.classList.contains(n),a=(t,n,e,o)=>t.addEventListener(n,e,{passive:!0,once:o}),r=(t,n,e,o)=>t?.removeEventListener(n,e,{capture:o});function c(t){let n,e=0;for(const o of t.getElementsByTagName("tspan"))for(const t of s(o.getBBox())){const o=Math.abs(t.x)+Math.abs(t.y);e<o&&(n=t,e=o)}return n}const s=t=>[{x:t.x,y:t.y},{x:t.right,y:t.y},{x:t.x,y:t.bottom},{x:t.right,y:t.bottom}];function l(t,n,e){return e<=t?t:t+Math.ceil((e-t)/n)*n}function d(t,n){let e=t.pop();for(;e;)n(e),e=t.pop()}const h=Symbol("movementX"),p=Symbol("movementY");function u(t,n,e,o,i,c,s,l,d){let u,f=!1,v=!1;function m(t){v&&(f||(i(t),v))&&(o.x+=t[h]/e.scale,o.y+=t[p]/e.scale,f=!0,c(t))}function x(t){f?s(t):l(t),k(!0)}function w(t){n.contains(t.target)||(k(),d())}function y(){k(),d()}function k(n){r(u,"pointercancel",x),r(u,"pointerup",x),r(u,"pointermove",m),n||(r(t,"pointerdown",w),r(t,"wheel",y)),u=null,f=!1,v=!1}return a(n,"pointerdown",(function(n){!n[g]&&n.isPrimary&&(n[g]=!0,u=n.target,u.setPointerCapture(n.pointerId),a(u,"pointercancel",x,!0),a(u,"pointerup",x,!0),a(u,"pointermove",m),a(t,"wheel",y,!0),a(t,"pointerdown",w),v=!0)})),k}function f(t){return v(t)[0]}function v(t){return document.elementsFromPoint(t.clientX,t.clientY).sort(((t,n)=>{const e=t.getAttribute("data-evt-index"),o=n.getAttribute("data-evt-index");return e===o?0:e>o?-1:1}))}const g=Symbol("processed"),m=Symbol("routeed"),x=(t,n,e)=>({x:(n-t.position.x)/t.scale,y:(e-t.position.y)/t.scale});function w(t){return{x:t.clientX,y:t.clientY}}function y(t,n){return{id:t.pointerId,pos:w(t),shift:{x:n.position.x-t.clientX,y:n.position.y-t.clientY}}}const k=Symbol("Canvas");let b;function $(t){t&&!b?(b=document.createElement("div"),b.style.cssText="z-index: 2; position: fixed; left: 0; top: 0; width:100%; height:100%; background: #fff; opacity: 0",b.innerHTML="<style>@keyframes blnk{0%{opacity:0}50%{opacity:.7}100%{opacity:0}}.blnk{animation:blnk 1.6s linear infinite}</style>",b.classList.add("blnk"),document.body.append(b)):t||(b.remove(),b=null)}function M(t){document.getElementById("diagram").style.pointerEvents=t?"none":"unset",document.getElementById("tip").style.display=t?"unset":"none"}const z="https://dgrm.boyko.tech/api";function L(t,n,e){const o=new V;return o.addEventListener("cmd",e),H(t,n,o)}function H(t,n,e){const o=document.createElement("div");function i(t,n){o.style.left=`${t}px`,o.style.top=window.scrollY+n-o.getBoundingClientRect().height+"px"}return o.style.cssText="position: fixed; box-shadow: 0px 0px 58px 2px rgb(34 60 80 / 20%); border-radius: 16px; background-color: rgba(255,255,255, .9);",o.append(e),document.body.append(o),i(t,n),{position:i,del:()=>o.remove()}}class V extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML=`<style>.ln{display:flex}.ln>div,.ln>svg{height:24px;padding:10px}[data-cmd]{cursor:pointer}.crcl{width:25px;height:25px;border-radius:50%}.props{padding-bottom:10px}</style><div class="props" style="display:none"><div class="ln"><div data-cmd="style" data-cmd-arg="cl-red"><div class="crcl" style="background:#e74c3c"></div></div><div data-cmd="style" data-cmd-arg="cl-orange"><div class="crcl" style="background:#f60"></div></div><div data-cmd="style" data-cmd-arg="cl-green"><div class="crcl" style="background:#19bc9b"></div></div></div><div class="ln"><div data-cmd="style" data-cmd-arg="cl-blue"><div class="crcl" style="background:#1aaee5"></div></div><div data-cmd="style" data-cmd-arg="cl-dblue"><div class="crcl" style="background:#1d809f"></div></div><div data-cmd="style" data-cmd-arg="cl-dgray"><div class="crcl" style="background:#495057"></div></div></div></div><div class="ln"><svg data-cmd="toggle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12.9 6.858l4.242 4.243L7.242 21H3v-4.243l9.9-9.9zm1.414-1.414l2.121-2.122a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414l-2.122 2.121-4.242-4.242z" fill="rgba(52,71,103,1)"/></svg> ${S}</div>`,t.querySelectorAll("[data-cmd]").forEach((t=>a(t,"click",this))),this.o=t.host.parentElement,this.i=t.querySelector(".props")}handleEvent(t){const n=t.currentTarget.getAttribute("data-cmd");"toggle"!==n?this.dispatchEvent(new CustomEvent("cmd",{detail:{cmd:n,arg:t.currentTarget.getAttribute("data-cmd-arg")}})):this.p()}p(){"none"===this.i.style.display?(this.i.style.display="unset",this.o.style.top=this.o.getBoundingClientRect().top+window.scrollY-88+"px"):(this.i.style.display="none",this.o.style.top=`${this.o.getBoundingClientRect().top+window.scrollY+88}px`)}}customElements.define("ap-shape-settings",V);const S='<svg data-cmd="del" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z" fill="rgba(52,71,103,1)"/></svg>',E=Symbol("shape");function D(n,c,s){const l=document.createElementNS("http://www.w3.org/2000/svg","g");l.innerHTML='<path data-key="outer" d="M0 0" stroke="transparent" stroke-width="20" fill="none"/><path data-key="path" class="path" d="M0 0" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"/><path data-key="selected" d="M0 0" stroke="transparent" stroke-width="10" fill="none" style="pointer-events:none"/><g data-key="arrow"><circle r="10" stroke-width="0" fill="transparent" data-evt-index="1"/><path class="path" d="M-7 7 l 7 -7 l -7 -7" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"></path></g>';const d=t(l,"path"),h=t(l,"outer"),p=t(l,"selected"),v=t(l,"arrow");function g(){const t=function(t){let n=.5*Math.hypot(t.start.position.x-t.end.position.x,t.start.position.y-t.end.position.y);function e(t){return"right"===t.dir||"left"===t.dir?"right"===t.dir?t.position.x+n:t.position.x-n:t.position.x}function o(t){return"right"===t.dir||"left"===t.dir?t.position.y:"bottom"===t.dir?t.position.y+n:t.position.y-n}return n=n>70?70:n<15?15:n,`M ${t.start.position.x} ${t.start.position.y} C ${e(t.start)} ${o(t.start)}, ${e(t.end)} ${o(t.end)}, ${t.end.position.x} ${t.end.position.y}`}(s);var n;d.setAttribute("d",t),h.setAttribute("d",t),p.setAttribute("d",t),v.style.transform=`translate(${s.end.position.x}px, ${s.end.position.y}px) rotate(${n=s.end.dir,"right"===n?180:"left"===n?0:"bottom"===n?270:90}deg)`}let m,w;function y(){m?.del(),m=null,b(),s.startShape.shapeEl[E].pathDel(l),s.endShape?.shapeEl[E].pathDel(l),l.remove()}function k(){o(l,"select"),v.firstElementChild.setAttribute("data-evt-index","1"),m?.del(),m=null,w&&(w(),w=null,l.style.pointerEvents="unset")}const b=u(n,l,c,{get x(){return s.end.position.x},set x(t){s.end.position.x=t},get y(){return s.end.position.y},set y(t){s.end.position.y=t}},(t=>{k(),v.contains(t.target)?(s.endShape&&(s.endShape.shapeEl!==s.startShape.shapeEl&&s.endShape.shapeEl[E].pathDel(l),s.endShape=null,s.end={dir:s.end.dir,position:x(c,t.clientX,t.clientY)}),l.style.pointerEvents="none",w=function(t){let n=null;function c(t){const a=f(t);if(n!==a){i(a,"hovertrack")&&e(a,"hover");let t=!1;i(a?.parentElement,"hovertrack")&&(e(a.parentElement,"hover"),t=!0),o(n,"hover"),n?.parentElement===a?.parentElement&&t||o(n?.parentElement,"hover"),n=a}}return a(t,"pointermove",c),function(){r(t,"pointermove",c),o(n,"hover"),o(n?.parentElement,"hover"),n=null}}(l.parentElement)):b()}),g,(t=>{const n=f(t),e=n?.getAttribute("data-connect");e&&(s.endShape={shapeEl:n.parentElement,connectorKey:e},s.end=s.endShape.shapeEl[E].pathAdd(e,l),g()),k()}),(function(t){i(l,"select")&&m||(!i(l,"select")||m?(e(l,"select"),v.firstElementChild.setAttribute("data-evt-index","2")):m=L(t.clientX-10,t.clientY-10,(t=>{switch(t.detail.cmd){case"style":o(l,s.style),e(l,t.detail.arg),s.style=t.detail.arg;break;case"del":y()}})))}),k);return l[B]={draw:g,pointerCapture:t=>v.dispatchEvent(new PointerEvent("pointerdown",t)),del:y,data:s},s.style&&e(l,s.style),s.startShape&&(s.start=s.startShape.shapeEl[E].pathAdd(s.startShape.connectorKey,l)),s.endShape&&(s.end=s.endShape.shapeEl[E].pathAdd(s.endShape.connectorKey,l)),g(),l}const B=Symbol("path");function C(t){for(;t.firstChild;)t.firstChild[E]?.del();t[k].move(0,0,1)}function T(t){const n={v:"1",s:[]},e=[...t.children];for(const t of e)if(t[E])n.s.push(t[E].data);else{const o=t[B].data,i={type:0,s:e.indexOf(o.startShape.shapeEl),sk:o.startShape.connectorKey};o.endShape?(i.e=e.indexOf(o.endShape.shapeEl),i.ek=o.endShape.connectorKey):i.ep=o.end,o.style&&(i.c=o.style),n.s.push(i)}return n}function A(t,n,e){if("1"!==e.v)return alert("Wrong format"),!1;C(t);const o=new Map;function i(e){let i=o.get(e);return i||(i=n[e.type].create(e),t.append(i),o.set(e,i)),i}const a=t=>i(e.s[t]);for(const o of e.s)switch(o.type){case 0:{const e=o,i={startShape:{shapeEl:a(e.s),connectorKey:e.sk},style:e.c};e.ep?i.end=e.ep:i.endShape={shapeEl:a(e.e),connectorKey:e.ek},t.append(n[0].create(i));break}default:i(o)}return!0}function O(t,n,e){const o=function(t,n){let e=0;return{s:t.split("\n").map(((t,o)=>(e=o,`<tspan x="${n}" dy="${0===o?.41:1}em" ${0===t.length?'visibility="hidden"':""}>${0===t.length?".":function(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}(t).replaceAll(" ","&nbsp;")}</tspan>`))).join(""),c:e}}(e||"",t.x?.baseVal[0]?.value??0);t.innerHTML=o.s,t.y.baseVal[0].newValueSpecifiedUnits(t.y.baseVal[0].SVG_LENGTHTYPE_EMS,o.c>0?n-o.c/2:n)}function U(t,n,e,o,i){const a=t.getBBox(),r=a.width+20;n.width.baseVal.value=r+2*o+2,n.x.baseVal.value=a.x-o-("center"===i?10:0),n.height.baseVal.value=a.height+2*o+3,n.y.baseVal.value=a.y-o,e.style.width=`${r}px`,e.style.height=`${a.height}px`}function P(t,n,a,r,c,s,l){let d,h;function p(){d&&(d(),d=null),h?.del(),h=null}function f(t){r.title=t,l()}const v=function(t,n,a,r,c,s,l){const d=JSON.parse(JSON.stringify(c)),h=new Set;function p(){a.style.transform=`translate(${r.position.x}px, ${r.position.y}px)`;for(const t in c)d[t].position={x:c[t].position.x+r.position.x,y:c[t].position.y+r.position.y};for(const t of h)t[B].draw()}function f(){i(a,"highlight")&&l(),o(a,"select"),o(a,"highlight")}const v=u(t,a,n,r.position,(e=>{f();const o=e.target.getAttribute("data-connect");if(o){v();const i=D(t,n,{startShape:{shapeEl:a,connectorKey:o},end:{dir:N(d[o].dir),position:x(n,e.clientX,e.clientY)}});a.parentNode.append(i),i[B].pointerCapture(e),h.add(i)}}),p,(t=>{R(r.position,n.cell),p()}),(t=>{if(!i(a,"highlight"))return i(a,"select")&&!i(a,"highlight")?(o(a,"select"),e(a,"highlight"),void s()):void e(a,"select")}),f);return a[E]={pathAdd:function(t,n){return h.add(n),d[t]},pathDel:function(t){h.delete(t)},drawPosition:p,data:r},{drawPosition:p,del:()=>{v();for(const t of h)t[B].del()}}}(t,n,a,r,c,(()=>{d=function(t,n,e,o,i){let a=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");const r=document.createElement("textarea");r.value=e||"",r.oninput=function(){O(t,n,r.value),U(t,a,r,s,c.textAlign),o(r.value)},r.onblur=function(){i(r.value)},r.onpointerdown=function(t){t.stopImmediatePropagation()},a.appendChild(r),t.parentElement.appendChild(a);const c=getComputedStyle(r),s=parseInt(c.paddingLeft)+parseInt(c.borderWidth);return U(t,a,r,s,c.textAlign),r.focus(),()=>{a.remove(),a=null}}(s.el,s.vMid,r.title,f,f);const t=a.getBoundingClientRect();h=L(t.left+10,t.top+10,m)}),p);function g(){p(),v.del(),a.remove()}function m(t){switch(t.detail.cmd){case"style":o(a,r.style),e(a,t.detail.arg),r.style=t.detail.arg;break;case"del":g()}}return r.style&&e(a,r.style),a[E].del=g,{draw:()=>{if(h){const t=a.getBoundingClientRect();h.position(t.left+10,t.top+10)}v.drawPosition()}}}function R(t,n){const e=n/2;function o(t){const o=Math.round(t/n)*n;return t-o>0?o+e:o-e}t.x=o(t.x),t.y=o(t.y)}function N(t){return"left"===t?"right":"right"===t?"left":"top"===t?"bottom":"top"}const j=(t,n,e,o,i)=>t.x<=o&&o<=t.x+n&&t.y<=i&&i<=t.y+e;function F(e,o,i){const a=document.createElementNS("http://www.w3.org/2000/svg","g");a.classList.add("hovertrack"),a.innerHTML='<circle data-key="outer" data-evt-no data-evt-index="2" r="72" fill="transparent" stroke-width="0"/><circle data-key="main" r="48" fill="#ff6600" stroke="#fff" stroke-width="1"/><text data-key="text" x="0" y="0" text-anchor="middle" style="pointer-events:none" fill="#fff"> </text><circle data-key="right" data-connect="right" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(48px,0)"/><circle data-key="left" data-connect="left" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(-48px,0)"/><circle data-key="bottom" data-connect="bottom" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(0,48px)"/><circle data-key="top" data-connect="top" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(0,-48px)"/>';const r={right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},s={el:t(a,"text"),vMid:0},d=P(e,o,a,i,r,s,(()=>{const t=function(t,n,e){const o=c(t);return l(n,e,Math.sqrt(o.x**2+o.y**2))}(s.el,48,24);t!==i.r&&(i.r=t,h())}));function h(){r.right.position.x=i.r,r.left.position.x=-i.r,r.bottom.position.y=i.r,r.top.position.y=-i.r;for(const e in r)n(t(a,e),r[e].position);I(a,"outer",i.r+24),I(a,"main",i.r),d.draw()}return i.r&&48!==i.r?h():d.draw(),O(s.el,s.vMid,i.title),a}function I(n,e,o){t(n,e).r.baseVal.value=o}function J(o,i,a){const r=document.createElementNS("http://www.w3.org/2000/svg","g");e(r,"hovertrack"),a.t&&e(r,"shtxt"),r.innerHTML=`<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="96" x="-72" y="-48" fill="transparent" stroke="transparent" stroke-width="0"/><rect data-key="main" width="96" height="48" x="-48" y="-24" rx="15" ry="15" fill="#1aaee5" stroke="#fff" stroke-width="1"/><text data-key="text" y="0" ${a.t?'x="-40"':'x="0" text-anchor="middle"'} style="pointer-events:none" fill="#fff"> </text><circle data-key="right" data-connect="right" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(48px,0)"/><circle data-key="left" data-connect="left" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(-48px,0)"/><circle data-key="bottom" data-connect="bottom" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(0,24px)"/><circle data-key="top" data-connect="top" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(0,-24px)"/>`,a.w=a.w??96,a.h=a.h??48;const c={right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:24}},top:{dir:"top",position:{x:0,y:-24}}},s={el:t(r,"text"),vMid:0},d=P(o,i,r,a,c,s,(()=>{const t=s.el.getBBox(),n=l(96,48,t.width+(a.t?6:0)),e=l(48,48,t.height);a.w===n&&a.h===e||(a.w=n,a.h=e,h())}));function h(){const e=a.t?-48:a.w/-2,o=a.h/-2,i=a.t?a.w/2-48:0;c.right.position.x=a.t?a.w-48:-e,c.left.position.x=e,c.bottom.position.y=-o,c.bottom.position.x=i,c.top.position.y=o,c.top.position.x=i;for(const e in c)n(t(r,e),c[e].position);Z(r,"main",a.w,a.h,e,o),Z(r,"outer",a.w+48,a.h+48,e-24,o-24),d.draw()}return!a.w||96===a.w&&48===a.h?d.draw():h(),O(s.el,s.vMid,a.title),r}function Z(n,e,o,i,a,r){const c=t(n,e);c.width.baseVal.value=o,c.height.baseVal.value=i,c.x.baseVal.value=a,c.y.baseVal.value=r}function K(o,i,a){const r=document.createElementNS("http://www.w3.org/2000/svg","g");e(r,"shrhomb"),e(r,"hovertrack"),r.innerHTML='<path data-key="outer" data-evt-no data-evt-index="2" d="M-72 0 L0 -72 L72 0 L0 72 Z" stroke-width="0" fill="transparent"/><path data-key="border" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="20" stroke="#fff" fill="transparent" stroke-linejoin="round"/><path data-key="main" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="18" stroke-linejoin="round" stroke="#1D809F" fill="#1D809F"/><text data-key="text" x="0" y="0" text-anchor="middle" style="pointer-events:none" fill="#fff"> </text><circle data-key="right" data-connect="right" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(48px,0)"/><circle data-key="left" data-connect="left" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(-48px,0)"/><circle data-key="bottom" data-connect="bottom" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(0,48px)"/><circle data-key="top" data-connect="top" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(0,-48px)"/>';const s={right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},d={el:t(r,"text"),vMid:0},h=P(o,i,r,a,s,d,(()=>{const t=l(96,48,function(t){const n=c(t);return 2*(Math.abs(n.x)+Math.abs(n.y))}(d.el)-20);t!==a.w&&(a.w=t,p())}));function p(){const e=G(a.w,0);s.right.position.x=e.r.x,s.left.position.x=e.l.x,s.bottom.position.y=e.b.y,s.top.position.y=e.t.y;for(const e in s)n(t(r,e),s[e].position);const o=G(a.w,9);_(r,"main",o),_(r,"border",o),_(r,"outer",G(a.w,-24)),h.draw()}return a.w&&96!==a.w?p():h.draw(),O(d.el,d.vMid,a.title),r}function _(n,e,o){t(n,e).setAttribute("d",`M${o.l.x} ${o.l.y} L${o.t.x} ${o.t.y} L${o.r.x} ${o.r.y} L${o.b.x} ${o.b.y} Z`)}function G(t,n){const e=t/2,o=n-e,i=e-n;return{l:{x:o,y:0},t:{x:0,y:o},r:{x:i,y:0},b:{x:0,y:i}}}async function X(t,n,e){return function(t,n,e){let o,i;const a=q(t,n);if(a)o=new DataView(t,0,a.byteOffset-8),i=new DataView(t,a.byteOffset+a.byteLength+4);else{const n=t.byteLength-12;o=new DataView(t,0,n),i=new DataView(t,n)}const r=new DataView(new ArrayBuffer(8));return r.setUint32(0,e.length),r.setUint32(4,n),new Blob([o,r,e,new Uint32Array([0]),i],{type:"image/png"})}(await t.arrayBuffer(),W(n),e)}function q(t,n){const e=new DataView(t,8);let o,i=0,a=e.getUint32(4);for(;1229278788!==a;){if(o=e.getUint32(i),a===n)return new DataView(t,i+16,o);i=i+12+o,a=e.getUint32(i+4)}return null}function W(t){return new DataView((new TextEncoder).encode(t).buffer).getUint32(0)}function Y(t,n,e,o){const i=t.getBoundingClientRect(),a=t.ownerSVGElement.cloneNode(!0);a.style.backgroundImage=null,a.querySelectorAll(".select, .highlight").forEach((t=>t.classList.remove("select","highlight")));const r=a.getElementsByTagName("foreignObject");for(;r[0];)r[0].parentNode.removeChild(r[0]);const c=a.children[1],s=1/n.scale;c.style.transform=`matrix(1, 0, 0, 1, ${s*(n.position.x+15*n.scale-i.x)}, ${s*(n.position.y+15*n.scale-i.y)})`,function(t,n,e,o){const i=new Image;i.width=n.width*e*window.devicePixelRatio,i.height=n.height*e*window.devicePixelRatio,i.onload=function(){const t=document.createElement("canvas");t.width=i.width,t.height=i.height,t.style.width=`${i.width}px`,t.style.height=`${i.height}px`;const e=t.getContext("2d");e.imageSmoothingEnabled=!1,e.drawImage(i,n.x,n.y,n.width,n.height,0,0,i.width,i.height),URL.revokeObjectURL(i.src),t.toBlob(o,"image/png")},t.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,i.width),t.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,i.height),i.src=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(t)],{type:"image/svg+xml;charset=utf-8"}))}(a,{x:0,y:0,height:i.height/n.scale+30,width:i.width/n.scale+30},3,(async t=>o(await X(t,"dgRm",(new TextEncoder).encode(e)))))}async function Q(t){const n=await async function(t,n){return q(await t.arrayBuffer(),W(n))}(t,"dgRm");return n?(new TextDecoder).decode(n):null}function tt(t,n){"showSaveFilePicker"in window?async function(t){try{const n=await(await window.showSaveFilePicker({types:[{description:"PNG Image",accept:{"image/png":[".png"]}}]})).createWritable();await n.write(t),await n.close()}catch{alert("File not saved")}}(t):function(t,n){const e=document.createElement("a");e.download=n,e.href=URL.createObjectURL(t),e.click(),URL.revokeObjectURL(e.href),e.remove()}(t,n)}class nt extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{position:fixed;top:15px;left:15px;cursor:pointer}#options{position:fixed;padding:15px;box-shadow:0 0 58px 2px rgb(34 60 80 / 20%);border-radius:16px;background-color:rgba(255,255,255,.9);top:0;left:0;z-index:1}#options a,#options div{color:#0d6efd;cursor:pointer;margin:10px 0;display:flex;align-items:center;line-height:25px;text-decoration:none}#options a svg,#options div svg{margin-right:10px}</style><svg id="menu" class="menu" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(52,71,103,1)"/></svg><div id="options" style="visibility:hidden"><div id="menu2" style="margin:0 0 15px"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(52,71,103,1)"/></svg></div><div id="new"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M9 2.003V2h10.998C20.55 2 21 2.455 21 2.992v18.016a.993.993 0 0 1-.993.992H3.993A1 1 0 0 1 3 20.993V8l6-5.997zM5.83 8H9V4.83L5.83 8zM11 4v5a1 1 0 0 1-1 1H5v10h14V4h-8z" fill="rgba(52,71,103,1)"/></svg>New diagram</div><div id="open"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 21a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h7.414l2 2H20a1 1 0 0 1 1 1v3h-2V7h-7.414l-2-2H4v11.998L5.5 11h17l-2.31 9.243a1 1 0 0 1-.97.757H3zm16.938-8H7.062l-1.5 6h12.876l1.5-6z" fill="rgba(52,71,103,1)"/></svg>Open diagram image</div><div id="save"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 19h18v2H3v-2zm10-5.828L19.071 7.1l1.414 1.414L12 17 3.515 8.515 4.929 7.1 11 13.17V2h2v11.172z" fill="rgba(52,71,103,1)"/></svg>Save diagram image</div><div id="link"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13.06 8.11l1.415 1.415a7 7 0 0 1 0 9.9l-.354.353a7 7 0 0 1-9.9-9.9l1.415 1.415a5 5 0 1 0 7.071 7.071l.354-.354a5 5 0 0 0 0-7.07l-1.415-1.415 1.415-1.414zm6.718 6.011l-1.414-1.414a5 5 0 1 0-7.071-7.071l-.354.354a5 5 0 0 0 0 7.07l1.415 1.415-1.415 1.414-1.414-1.414a7 7 0 0 1 0-9.9l.354-.353a7 7 0 0 1 9.9 9.9z" fill="rgba(52,71,103,1)"/></svg>Copy link to diagram</div><a href="/donate.html" target="_blank" style="margin-bottom:0"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0H24V24H0z"/><path d="M12.001 4.529c2.349-2.109 5.979-2.039 8.242.228 2.262 2.268 2.34 5.88.236 8.236l-8.48 8.492-8.478-8.492c-2.104-2.356-2.025-5.974.236-8.236 2.265-2.264 5.888-2.34 8.244-.228zm6.826 1.641c-1.5-1.502-3.92-1.563-5.49-.153l-1.335 1.198-1.336-1.197c-1.575-1.412-3.99-1.35-5.494.154-1.49 1.49-1.565 3.875-.192 5.451L12 18.654l7.02-7.03c1.374-1.577 1.299-3.959-.193-5.454z" fill="rgba(255,66,77,1)"/></svg>Donate</a></div>';const n=t.getElementById("options");function e(){n.style.visibility="visible"===n.style.visibility?"hidden":"visible"}function o(n,o){t.getElementById(n).onclick=t=>{$(!0),o(),e(),$(!1)}}t.getElementById("menu").onclick=e,t.getElementById("menu2").onclick=e,o("new",(()=>{C(this.u),M(!0)})),o("save",(()=>{const t=T(this.u);0!==t.s.length?Y(this.u,this.g,JSON.stringify(t),(t=>tt(t,"dgrm.png"))):it()})),o("open",(()=>function(t,n){const e=document.createElement("input");e.type="file",e.multiple=!1,e.accept=t,e.onchange=async function(){n(e.files?.length?e.files[0]:null)},e.click(),e.remove()}(".png",(async t=>await et(this.u,this.m,t))))),o("link",(async()=>{const t=T(this.u);if(0===t.s.length)return void it();const n=function(){const t=new Uint8Array(4);window.crypto.getRandomValues(t);const n=new Date;return`${n.getUTCFullYear()}${(n.getUTCMonth()+1).toString().padStart(2,"0")}${Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}`}(),e=new URL(window.location.href);e.searchParams.set("k",n),await navigator.clipboard.writeText(e.toString()),await async function(t,n){return await fetch(`${z}/${t}`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)})}(n,t),alert("Link to diagram copied to clipboard")}))}init(t,n,e){this.u=t,this.g=n,this.m=e,document.body.addEventListener("dragover",(t=>{t.preventDefault()})),document.body.addEventListener("drop",(async t=>{t.preventDefault(),1===t.dataTransfer?.items?.length&&"file"===t.dataTransfer.items[0].kind&&"image/png"===t.dataTransfer.items[0].type?await et(this.u,this.m,t.dataTransfer.items[0].getAsFile()):ot()}))}}async function et(t,n,e){const o=await Q(e);o?A(t,n,JSON.parse(o))&&M(!1):ot()}customElements.define("ap-menu",nt);const ot=()=>alert("File cannot be read. Use the exact image file you got from the application."),it=()=>alert("Diagram is empty");class at extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{overflow-x:auto;padding:0;position:fixed;bottom:15px;left:50%;transform:translateX(-50%);box-shadow:0 0 58px 2px rgba(34,60,80,.2);border-radius:16px;background-color:rgba(255,255,255,.9)}.content{white-space:nowrap;display:flex}[data-cmd]{cursor:pointer}.menu svg{height:42px;display:inline-block;padding:15px 10px;stroke:#344767;stroke-width:2px;fill:#fff;width:42px;min-width:42px}.menu .big{width:62px;min-width:62px}@media only screen and (max-width:700px){.menu{width:100%;border-radius:0;bottom:0;display:flex;flex-direction:column}.content{align-self:center}}</style><div id="menu" class="menu" style="touch-action:none"><div class="content"><svg data-cmd="shapeAdd" data-cmd-arg="1" style="padding-left:20px"><circle r="20" cx="21" cy="21"></circle></svg> <svg data-cmd="shapeAdd" data-cmd-arg="2" class="big"><rect x="1" y="1" width="60" height="40" rx="15" ry="15"></rect></svg> <svg data-cmd="shapeAdd" data-cmd-arg="4" class="big"><g transform="translate(1,1)"><path d="M0 20 L30 0 L60 20 L30 40 Z" stroke-width="2" stroke-linejoin="round"></path></g></svg> <svg data-cmd="shapeAdd" data-cmd-arg="3"><text x="5" y="40" font-size="52px" fill="#344767" stroke-width="0">T</text></svg></div></div>';const n=t.getElementById("menu");n.querySelectorAll('[data-cmd="shapeAdd"]').forEach((t=>a(t,"pointerdown",this))),a(n,"pointerleave",this),a(n,"pointerup",this),a(n,"pointermove",this)}init(t,n,e){this.u=t,this.g=n,this.m=e}handleEvent(t){switch(t.type){case"pointermove":if(!this.k){const n=document.elementFromPoint(t.clientX,t.clientY);if(n===this.$)return;this.M===this.$&&this.u.ownerSVGElement.setPointerCapture(t.pointerId),this.$=n}break;case"pointerleave":this.k=!0,this.L&&this.H(t),this.V();break;case"pointerdown":this.L=parseInt(t.currentTarget.getAttribute("data-cmd-arg")),this.M=document.elementFromPoint(t.clientX,t.clientY),this.$=this.M,this.k=null;break;case"pointerup":this.V()}}H(t){M(!1);const n=x(this.g,t.clientX,t.clientY),e=this.m[this.L].create({type:this.L,position:{x:n.x,y:n.y},title:"Title"});this.u.append(e),e.dispatchEvent(new PointerEvent("pointerdown",t))}V(){this.L=null,this.M=null,this.$=null}}customElements.define("ap-menu-shape",at);const rt=document.getElementById("canvas"),ct={position:{x:0,y:0},scale:1,cell:24},st=function(t,n){return{0:{create:e=>D(t,n,e)},1:{create:e=>F(t,n,e)},2:{create:e=>J(t,n,e)},3:{create:e=>(e.t=!0,J(t,n,e))},4:{create:e=>K(t,n,e)}}}(rt.ownerSVGElement,ct);!function(t){let n,e,o;function i(t){t.isPrimary&&t.isTrusted&&(n&&Math.abs(n.x-t.clientX)<3&&Math.abs(n.y-t.clientY)<3?t.stopImmediatePropagation():(n=null,void 0===t.movementX?(t[h]=e?t.clientX-e:0,t[p]=o?t.clientY-o:0,e=t.clientX,o=t.clientY):(t[h]=t.movementX,t[p]=t.movementY)))}t.addEventListener("pointerdown",(a=>{n={x:a.clientX,y:a.clientY},e=null,o=null,t.addEventListener("pointermove",i,{capture:!0,passive:!0}),t.addEventListener("pointerup",(n=>{r(t,"pointermove",i,!0)}),{capture:!0,once:!0,passive:!0})}),{capture:!0,passive:!0})}(rt.ownerSVGElement),rt.ownerSVGElement.addEventListener("pointerdown",(t=>{if(!t.isPrimary||t[m]||!t.isTrusted)return;t.stopImmediatePropagation();const n=new PointerEvent("pointerdown",t);n[m]=!0,function(t){return v(t).find((t=>!t.hasAttribute("data-evt-no")))}(t).dispatchEvent(n)}),{capture:!0,passive:!0}),function(t,n){const i=t.ownerSVGElement;let c,s,l,u,f,v;function m(t){if(t[g]||!u)return void y();t[g]=!0,l&&(l.remove(),l=null);const n=t.clientX-s.x,e=t.clientY-s.y;u.width.baseVal.value=Math.abs(n),u.height.baseVal.value=Math.abs(e),n<0&&(f.x=t.clientX),e<0&&(f.y=t.clientY),u.style.transform=`translate(${f.x}px, ${f.y}px)`}function w(c){if(u){const c=x(n,f.x,f.y),s=u.width.baseVal.value/n.scale,l=u.height.baseVal.value/n.scale,g=[];for(const n of t.children){const t=n[E];t&&j(c,s,l,t.data.position.x,t.data.position.y)&&(e(n,"highlight"),g.push(n))}v=function(t,n,e){let i,c=!1,s=!1;const l=()=>{i?.del(),i=null};function u(e){l(),s=n.some((t=>t.contains(e.target))),s||e.target===t?(s&&e.stopImmediatePropagation(),t.setPointerCapture(e.pointerId),a(t,"pointerup",f,!0),a(t,"pointermove",v)):g()}function f(t){if(c)for(const t of n)R(t[E].data.position,e.cell),t[E].drawPosition();else{if(!s)return void g();i=function(t,n,e){const o=document.createElement("div");return o.style.cssText="height: 24px; padding:10px;",o.onclick=e,o.innerHTML=S,H(t,n,o)}(t.clientX-10,t.clientY-10,(()=>{d(n,(t=>t[E].del())),g()}))}g(!0)}function v(t){if(s){c=!0;for(const o of n)o[E].data.position.x+=t[h]/e.scale,o[E].data.position.y+=t[p]/e.scale,o[E].drawPosition()}else g(!0)}function g(e){r(t,"pointerup",f),r(t,"pointermove",v),c=!1,s=!1,e||(r(t,"pointerdown",u,!0),l(),d(n,(t=>o(t,"highlight"))))}return t.addEventListener("pointerdown",u,{passive:!0,capture:!0}),g}(i,g,n)}y()}function y(){clearTimeout(c),c=null,l?.remove(),l=null,u?.remove(),u=null,r(i,"pointermove",m),r(i,"wheel",y),r(i,"pointerup",w)}a(i,"pointerdown",(t=>{!t[g]&&t.isPrimary?(a(i,"pointermove",m),a(i,"wheel",y,!0),a(i,"pointerup",w,!0),c=setTimeout((n=>{v&&(v(),v=null),l=document.createElementNS("http://www.w3.org/2000/svg","circle"),e(l,"ative-elem"),l.style.cssText="r:10px; fill: rgb(108 187 247 / 51%)",l.style.transform=`translate(${t.clientX}px, ${t.clientY}px)`,i.append(l),s={x:t.clientX,y:t.clientY},f={x:t.clientX,y:t.clientY},u=document.createElementNS("http://www.w3.org/2000/svg","rect"),u.style.cssText="rx:10px; fill: rgb(108 187 247 / 51%)",u.style.transform=`translate(${f.x}px, ${f.y}px)`,i.append(u)}),500)):y()}))}(rt,ct),function(t,n){const e=function(t,n){let e;function o(n){e!==n&&(e=n,t.style.backgroundImage=`radial-gradient(rgb(73 80 87 / ${n}) 1px, transparent 0)`)}return o(.7),t.style.backgroundSize=`${n.cell}px ${n.cell}px`,function(){const e=n.cell*n.scale;n.scale<.5?o(0):n.scale<=.9?o(.3):o(.7),t.style.backgroundSize=`${e}px ${e}px`,t.style.backgroundPosition=`${n.position.x}px ${n.position.y}px`}}(t.ownerSVGElement,n);function o(){t.style.transform=`matrix(${n.scale}, 0, 0, ${n.scale}, ${n.position.x}, ${n.position.y})`,e()}function i(t,e){if(t<.25||t>4)return;const i=t/n.scale;n.scale=t,n.position.x=i*(n.position.x-e.x)+e.x,n.position.y=i*(n.position.y-e.y)+e.y,o()}!function(t,n,e,o){let i,c,s,l;function d(n){s=null,l=null,i?.id===n.pointerId&&(i=null),c?.id===n.pointerId&&(c=null),i||c||(r(t,"pointermove",h),r(t,"pointercancel",d),r(t,"pointerup",d))}function h(t){if(t[g])return;if(i&&!c||!i&&c)return n.position.x=t.clientX+(i||c).shift.x,n.position.y=t.clientY+(i||c).shift.y,void o();if(!c||!i||c?.id!==t.pointerId&&i?.id!==t.pointerId)return;const a=Math.hypot(i.pos.x-c.pos.x,i.pos.y-c.pos.y),r={x:(i.pos.x+c.pos.x)/2,y:(i.pos.y+c.pos.y)/2};s&&(n.position.x=n.position.x+r.x-l.x,n.position.y=n.position.y+r.y-l.y,e(n.scale/s*a,r)),s=a,l=r,i.id===t.pointerId&&(i=y(t,n)),c.id===t.pointerId&&(c=y(t,n))}a(t,"pointerdown",(e=>{e[g]||!i&&!e.isPrimary||i&&c||(t.setPointerCapture(e.pointerId),i||(a(t,"pointermove",h),a(t,"pointercancel",d),a(t,"pointerup",d)),i?c||(c=y(e,n)):i=y(e,n))}))}(t.ownerSVGElement,n,i,o),t.ownerSVGElement.addEventListener("wheel",(t=>{t.preventDefault();const e=t.deltaY||t.deltaX,o=Math.abs(e)<50?.05:.25;i(n.scale+(e<0?o:-o),w(t))})),t[k]={move:(t,e,i)=>{n.position.x=t,n.position.y=e,n.scale=i,o()}}}(rt,ct),document.getElementById("menu").init(rt,ct,st),document.getElementById("menu-shape").init(rt,ct,st);let lt=new URL(window.location.href);lt.searchParams.get("k")?($(!0),async function(t){return(await fetch(`${z}/${t}`)).json()}(lt.searchParams.get("k")).then((t=>{lt.searchParams.delete("k"),A(rt,st,t)&&M(!1),history.replaceState(null,null,lt),$(!1),lt=null}))):lt=null}();
