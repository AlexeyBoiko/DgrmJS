const t=(t,n)=>t.querySelector(`[data-key="${n}"]`),n=(t,n)=>t.querySelector(`[${n}]`),e=t=>document.getElementById(t);function i(t,n){t.style.transform=`translate(${n.x}px, ${n.y}px)`}const o=(t,...n)=>t?.classList.add(...n),a=(t,...n)=>t?.classList.remove(...n),s=(t,n)=>t?.classList.contains(n),c=(t,n,e,i)=>(t.addEventListener(n,e,{passive:!0,once:i}),e),r=(t,n,e,i)=>t?.removeEventListener(n,e,{capture:i}),l=(t,n,e)=>t.querySelectorAll(n).forEach((t=>c(t,"click",e))),d=(t,n)=>t.currentTarget.getAttribute(n),h=t=>"TEXTAREA"===t.target.tagName.toUpperCase(),u=t=>"mouse"===t.pointerType;function p(t,n){const e=document.createElementNS("http://www.w3.org/2000/svg",t);return n&&(e.innerHTML=n),e}const f=t=>t.parentElement.appendChild(t),m=(t,n)=>{const e=document.createElement("div");return t&&(e.innerHTML=t),e.style.cssText=n,e},g=(...t)=>document.body.append(...t);function v(t){let n,e=0;for(const i of t.getElementsByTagName("tspan"))for(const t of w(i.getBBox())){const i=Math.abs(t.x)+Math.abs(t.y);e<i&&(n=t,e=i)}return n}const w=t=>[{x:t.x,y:t.y},{x:t.right,y:t.y},{x:t.x,y:t.bottom},{x:t.right,y:t.bottom}],y=async(t,n)=>{let e;(n=n||{}).credentials="include";try{e=await fetch(t,n)}catch(t){throw console.log(t),t}if(!e.ok)throw 401===e.status&&alert("You have to relogin."),new Error;return e},x=(t,n)=>y(t,{method:"POST",body:n?F(n):null}),b=(t,n)=>{const e=new URL(window.location.href);return e.searchParams.set(t,n),e.toString()},k=(...t)=>{const n=new URL(window.location.href);t?.forEach((t=>n.searchParams.delete(t))),history.replaceState(null,null,n.toString())};function C(t,n,e,i){function o(n){r(t,"pointercancel",o),r(t,"pointerup",o),r(t,"wheel",o),r(document,"pointerdown",o),r(t,"pointermove",e),i(n)}c(t,"pointercancel",o,!0),c(t,"pointerup",o,!0),c(t,"wheel",o,!0),c(document,"pointerdown",o,!0),c(t,"pointermove",e),t.setPointerCapture(n.pointerId)}const $=(t,n)=>H(t.ownerSVGElement,t,n),M=(t,n,e,i)=>H(t,n,e,i);function H(t,n,e,i){const o=()=>{r(t,"pointercancel",a),r(t,"wheel",a),r(t,"pointerdown",a)},a=t=>{i&&i(t),n.contains(t.target)||(o(),e(t))};return c(t,"pointercancel",a),c(t,"wheel",a),c(t,"pointerdown",a),o}const A=(t,n,e)=>new CustomEvent(t,{detail:n,cancelable:e}),z=(t,n)=>t.dispatchEvent(n),V=(t,n)=>{let e,i,o=!1;return function a(){if(o)return e=arguments,void(i=this);t.apply(this,arguments),o=!0,setTimeout((function(){o=!1,e&&(a.apply(i,e),e=i=null)}),n)}};function L(t,n,e){return t??=0,e<=t?t:t+Math.ceil((e-t)/n)*n}const S=t=>Math.round(100*(t+Number.EPSILON))/100,B=(t,n,e)=>{let i=!1;return n>e?n>t&&(i=!0,e*=t/n,n=t):e>t&&(i=!0,n*=t/e,e=t),{w:n,h:e,c:i}};function E(t,n){for(let e=t.length-1;e>=0;--e)n(t[e])}const I=t=>t.values().next().value;function T(t,n,e){const i=e??1;return t.x+=i*n.x,t.y+=i*n.y,t}const D=(t,n)=>({x:t.x+n,y:t.y+n}),Z=(t,n)=>Y(t,n.x,n.y),Y=(t,n,e)=>(t.x=n,t.y=e,t),R=t=>({x:t.x,y:t.y}),U=(t,n)=>t?.x===n?.x&&t?.y===n?.y;function J(){const t=new Uint8Array(4);return window.crypto.getRandomValues(t),Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}const P=t=>t?.substring(0,t.lastIndexOf("."))||t,O=t=>N(F(t)),j=t=>t&&!!Object.keys(t).length,F=t=>JSON.stringify(t),N=t=>JSON.parse(t),K=(t,n,e,i)=>{let o,a;const s=()=>{a=setTimeout((async t=>{await e(),o||s()}),t)};s();const c=setTimeout((t=>{r(),i&&i()}),n),r=()=>{o=!0,clearTimeout(a),clearTimeout(c)};return r};function X(t,n,e){t.x+=e[_]/n,t.y+=e[G]/n}const _=Symbol("movementX"),G=Symbol("movementY"),Q=Symbol("Canvas"),W=(t,n,e)=>({x:(n-t.position.x)/t.scale,y:(e-t.position.y)/t.scale}),q=(t,n)=>W(t,n.clientX,n.clientY);function tt(t,n){const e=n/2;function i(t){const i=Math.round(t/n)*n;return t-i>=0?i+e:i-e}return t.x=i(t.x),t.y=i(t.y),t}function nt(t){return{x:t.clientX,y:t.clientY}}function et(t,n){return{id:t.pointerId,pos:nt(t),shift:{x:n.position.x-t.clientX,y:n.position.y-t.clientY}}}let it;function ot(t){t&&!it?(it=m("<style>@keyframes blnk{0%{opacity:0}50%{opacity:.7}100%{opacity:0}}.blnk{animation:blnk 1.6s linear infinite}</style>","z-index: 2; position: fixed; left: 0; top: 0; width:100%; height:100%; background: #fff; opacity: 0"),it.classList.add("blnk"),g(it)):t||(it?.remove(),it=null)}function at(t,n,e){const i=m(null,"position: fixed; left: 50%; top: 30%; box-shadow: 0 4px 24px rgba(0,0,0,.12); border-radius: 8px; background-color: rgb(255,255,255);");function o(t,n){i&&(i.style.left=`${t}px`,i.style.top=window.scrollY+n-i.getBoundingClientRect().height+"px")}return i.setAttribute("ap-modal",""),i.append(t),g(i),null!=n?o(n,e):i.style.transform="translate(-50%, -30%)",i[ht]={position:o,del:()=>{i?.remove()}},i}const st=t=>((t,n)=>{const e=t=>t&&t!==document&&t!==window?t.closest(n)||e(t.getRootNode().host):null;return e(t)})(t,"[ap-modal]"),ct=()=>{for(;;){const t=document.querySelector("[ap-modal]");if(!t)return;t[ht]?.del()}};function rt(t,n,e,i){const o=m(null,"z-index: 2; position: fixed; left: 0; top: 0; width:100%; height:100%; "+(i?"background-color: rgba(52,71,103,.05);":""));g(o);const a=at(t,n,e);o.append(a);const s=M(o,a,(t=>{"pointerdown"===t.type?c(o,"click",(t=>{t.stopImmediatePropagation(),l()}),!0):l()}),(t=>t.stopImmediatePropagation())),r=a[ht].del,l=()=>{r(),s(),o.remove()};return a[ht].del=l,a}function lt(t,n,e){const i=at(t,n,e),o=i[ht].del,a=M(document,i,(t=>s())),s=()=>{o(),a()};return i[ht].del=s,i}function dt(t,e,i){const o=m('<style>.btn,button,input{cursor:pointer;color:#0d6efd;font-size:16px;padding:10px;border-radius:8px;border:none;background-color:#f2f2f2;display:flex;align-items:center;justify-content:center}button[disabled]{color:rgba(52,71,103,.6)}input{background-color:#fff;border:solid rgba(52,71,103,.4) 1px;color:unset;cursor:auto}input:focus{outline-color:currentcolor}.btn-del{color:#e74c3c}.w100{width:100%;box-sizing:border-box}.mb20{margin-bottom:20px}.mb10{margin-bottom:10px}.mb5{margin-bottom:5px}.txt-c{text-align:center}.mds{width:85vw;max-width:220px}.mdm{width:85vw;max-width:370px}</style><div class="mb20"><a ap-close>Close</a></div>',"display: flex; flex-flow: column; padding: 15px;");o.className=e??"mds",o.append(t);const a=i?rt(o,null,null,!0):lt(o);return c(n(o,"ap-close"),"click",(t=>a[ht].del())),a}const ht=Symbol(0);function ut(t){const n=m(`<style>.toast{visibility:visible;animation:fadein .5s,fadeout .5s 2.5s}@keyframes fadein{from{top:0;opacity:0}to{top:30px;opacity:1}}@keyframes fadeout{from{top:30px;opacity:1}to{top:0;opacity:0}}</style>${t}`,"min-width: 150px;\n\t\tbackground-color: rgb(52,71,103);\n\t\tcolor: #fff;\n\t\ttext-align: center;\n\t\tborder-radius: 8px;\n\t\tpadding: 10px;\n\t\tposition: fixed;\n\t\tz-index: 1;\n\t\tleft: 50%;\n\t\ttop: 30px;\n\t\ttransform: translate(-50%, -30%)");n.className="toast",g(n),setTimeout((t=>n.remove()),2800)}const pt="https://api.dgrm.net/api/",ft=`${pt}s/`,mt=async t=>{const n=await y(`${ft}${t}`);return{e:n.headers.has("X-Dgrm-edit"),m:n.headers.has("X-Dgrm-manage"),p:n.headers.has("X-Dgrm-pers"),n:decodeURIComponent(n.headers.get("X-Dgrm-name")),d:await n.json()}};const gt=async(t,n)=>{return(await(e=`${ft}a/n/${t}`,i=n,y(e,{method:"POST",body:i}))).text();var e,i};function vt(t){return yt(t).find((t=>!t.hasAttribute("data-evt-no")))}function wt(t){return yt(t)[0]}function yt(t){return document.elementsFromPoint(t.clientX,t.clientY).sort(((t,n)=>{const e=t.getAttribute("data-evt-index"),i=n.getAttribute("data-evt-index");return e===i?0:e>i?-1:1}))}const xt=Symbol("path"),bt=Symbol("shape"),kt="1.2",Ct=t=>$t([...t.children],!1);function $t(t,n,e){const i={v:kt,s:{}};if(!t?.length)return i;const o=new Map,a=t=>{let e=o.get(t);if(!e){const a=O(t[bt].data);n&&(a.id=J(),e=a.id),o.set(t,e),i.s[a.id]=a}return e},s=o=>{if(i.s[o[xt].data.id])return;const s=i=>{return n?(o=i.shape?.shapeEl,-1!==t.indexOf(o)?{s:a(i.shape.shapeEl),k:i.shape.connectorKey}:{p:O(i.data)}):i.shape?(e&&a(i.shape.shapeEl),{s:i.shape.shapeEl[bt].data.id,k:i.shape.connectorKey}):{p:O(i.data)};var o},c=o[xt].data,r={id:n?J():c.id,type:0,s:s(c.s),e:s(c.e)};c.styles&&(r.c=O(c.styles)),i.s[r.id]=r};for(const n of t)n[bt]?(a(n),e&&n[bt].paths?.forEach(s)):s(n);return i}function Mt(t){return{v:kt,s:{[t.id]:0!==t.type?t:(n=t,{id:n.id,type:0,s:{p:n.s.data},e:{p:n.e.data},c:n.styles})}};var n}const Ht=(t,n)=>At(t,"1.1"===n.v?function(t){const n={v:kt,s:{}};return t.s.forEach(((t,e)=>{switch(t.type){case 0:{const i=t,o={id:e.toString(),type:0,c:i.c?.map((t=>"d-"+t)),s:{s:i.s.s?.toString(),k:i.s.k,p:i.s.p},e:{s:i.e.s?.toString(),k:i.e.k,p:i.e.p}};n.s[o.id]=o;break}default:{const i=t;i.id=e.toString(),i.styles=i.styles?.map((t=>"d-"+t)),n.s[i.id]=i;break}}})),n}(n):n);function At(t,n){if(n.v!==kt)return alert("Wrong format"),null;const i=new Map;function o(n){let e=i.get(n);return e||(e=Vt(t,n),i.set(n,e)),e}const a=t=>n.s[t]?o(n.s[t]):e(t),s=[];for(const e in n.s)switch(n.s[e].type){case 0:{const i=Lt(t,n.s[e],a);i&&s.push(i);break}default:o(n.s[e])}return[...i.values(),...s]}function zt(t,n){const i=e(n.id);return i?((i[bt]||i[xt]).patch(n),i):t[Q].shapeMap[n.type].create(n)}const Vt=(t,n)=>zt(t,O(n)),Lt=(t,n,e)=>{const i=function(t,n){const e=t=>{const e=n(t.s);return e?{shape:{shapeEl:e,connectorKey:t.k}}:null},i=t=>t.p?{data:{dir:t.p.dir,position:R(t.p.position)}}:e(t),o={type:0,id:t.id,styles:t.c,s:i(t.s),e:i(t.e)};return o.e&&o.s?o:null}(n,e);return i?zt(t,i):null};const St=(t,n,e)=>z(t,Bt(n,e)),Bt=(t,n)=>A("dgrmc",{newIds:t,shapesToCreateData:n}),Et=(t,n)=>A("dgrmd",{delIds:t,shapesToDelData:n}),It=(t,n,e)=>z(t,Tt(n,e)),Tt=(t,n)=>A("dgrmu",{shapesBeforeUpdData:t,shapesToUpdData:n});function Dt(t,n,e,i){const o=T(((t,n,e)=>{const i=W(t,n,e);return tt(i,t.cell),i})(t[Q].data,e,i),function(t){const n=function(t){const n={x:1/0,y:1/0},e={x:-1/0,y:-1/0};return Zt(t,(t=>{t&&(n.x>t.x&&(n.x=t.x),n.y>t.y&&(n.y=t.y),e.x<t.x&&(e.x=t.x),e.y<t.y&&(e.y=t.y))})),{min:n,max:e}}(t);return{x:n.min.x+(n.max.x-n.min.x)/2,y:n.min.y+(n.max.y-n.min.y)/2}}(n),-1);Zt(n,(n=>{n&&tt(T(n,o),t[Q].data.cell)}))}function Zt(t,n){for(const e in t.s)0===t.s[e].type?(n(t.s[e].s.p?.position),n(t.s[e].e.p?.position)):n(t.s[e].position)}const Yt=(t,n)=>t[Q].select(Rt(t,$t(n,!0),!0));function Rt(t,n,e,i,o){return Dt(t,n,null==i?window.innerWidth/2:i,null==o?window.innerHeight/2:o),e&&St(t,Object.keys(n.s),O(n)),t[Q].select(null),At(t,n)}function Ut(t,n){((t,n,e)=>{z(t,Et(n,e))})(t,n.map((t=>(t[bt]||t[xt]).data.id)),$t(n,!1,!0)),n.forEach((t=>(t[bt]||t[xt]).del()))}const Jt='<svg data-cmd="del" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z" fill="rgb(52,71,103)"/></svg>',Pt='<svg data-cmd="copy" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7 6V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1h-3v3c0 .552-.45 1-1.007 1H4.007A1.001 1.001 0 0 1 3 21l.003-14c0-.552.45-1 1.007-1H7zM5.003 8L5 20h10V8H5.003zM9 6h8v10h2V4H9v2z" fill="rgb(52,71,103)"/></svg>',Ot='<svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 19h18v2H3v-2zm10-5.828L19.071 7.1l1.414 1.414L12 17 3.515 8.515 4.929 7.1 11 13.17V2h2v11.172z" fill="rgb(52,71,103)"/></svg>';function jt(n){for(const e in n.cons)i(t(n.el,e),n.cons[e].position)}function Ft(t,n){const e=t.getBoundingClientRect(),i=at(n,e.left+10,e.top+10);return{del:i[ht].del,updPos:()=>{const n=t.getBoundingClientRect();i[ht].position(n.left+10,n.top+10)}}}const Nt=(t,n)=>({del:at(t,n.clientX-66,n.clientY-10)[ht].del}),Kt=(t,n,e)=>{const i=$t([n],!1,!1);(n[bt]??n[xt]).patch(e),It(t,i,$t([n],!1,!1))};function Xt(t,n){return function(t,n){const e=t.el[bt].data;null!=n.title&&e.title!==n.title&&(e.title=n.title,t.drawTxt());n.styles&&(e.styles=n.styles,Qt(t.el))}(t,n),_t(t,n)}function _t(t,n){const e=n.position&&!U(t.el[bt].data.position,n.position);return e&&Z(t.el[bt].data.position,n.position),e}const Gt=t=>t.forEach((t=>{const n=e(t);n&&(n[bt]||n[xt]).del()}));function Qt(t){const n=(t[bt]??t[xt]).data;n.styles||(n.styles=[]),E(t.classList,(n=>{n?.startsWith("d-")&&t.classList.remove(n)})),o(t,...n.styles)}const Wt=(t,n,e)=>{const i=(n[bt]??n[xt]).data;i.styles||(i.styles=[]);const o={styles:O(i.styles)};Kt(t,n,function(t,n){const e=t.styles.findIndex((t=>t.startsWith("d-cl-")));e>-1&&t.styles.splice(e,1);n&&t.styles.push(n);return t}(o,e))};function qt(t,n){const e=e=>{const i=t.querySelectorAll(e);i?.length?i[i.length-1].after(n):t.prepend(n)};switch(n.getAttribute("bg")){case"0":e('[bg="0"]');break;case"1":e("[bg]")}}class tn extends HTMLElement{constructor(t,n){super(),this.o=n,this.g=t}connectedCallback(){const t=t=>this.o[xt].data.styles?.includes(t)?'class="actv"':"",n=this.attachShadow({mode:"closed"});n.innerHTML=`<style>.ln{display:flex}.ln>*{height:24px;padding:10px;fill-opacity:.3;stroke-opacity:.3}[data-cmd]{cursor:pointer}.actv{fill-opacity:1;stroke-opacity:1}</style><ap-shape-edit id="edit" edit-btn="true"><div class="ln"><svg data-cmd data-cmd-arg="d-arw-s" ${t("d-arw-s")} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="d-arw-e" ${t("d-arw-e")} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="d-dash" ${t("d-dash")} viewBox="0 0 24 24" width="24" height="24"><path d="M 2,11 L 20,11" stroke="rgb(52,71,103)" style="stroke-dasharray:4,3;stroke-width:3"></path></svg></div></ap-shape-edit>`,c(n.getElementById("edit"),"cmd",(t=>{switch(t.detail.cmd){case"style":Wt(this.g,this.o,t.detail.arg);break;case"del":Ut(this.g,[this.o]);break;case"copy":Yt(this.g,[this.o])}})),l(n,"[data-cmd]",(t=>{const n=d(t,"data-cmd-arg"),e={styles:this.o[xt].data.styles?O(this.o[xt].data.styles):[]},i=e.styles.indexOf(n);i>-1?(e.styles.splice(i,1),a(t.currentTarget,"actv")):(e.styles.push(n),o(t.currentTarget,"actv")),Kt(this.g,this.o,e)}))}}function nn(t,n,e,i){const o=rn(t,n);o.shape={shapeEl:e,connectorKey:i},an(t,o)}function en(t,n,e){const i=rn(t,n);i.shape.shapeEl!==ln(t,i)&&sn(t,i),i.shape=null,i.data={dir:i.data.dir,position:e}}function on(t,n){const e=t[xt].data,i=i=>{const o=e[i],a=n[i];o.shape?null==a.shape||o.shape.shapeEl===a.shape.shapeEl&&o.shape.connectorKey===a.shape.connectorKey?a.data&&en(t,i,a.data.position):function(t,n,e,i){const o=rn(t,n);if(o.shape.shapeEl===e&&o.shape.connectorKey===i)return;o.shape.shapeEl!==e&&o.shape.shapeEl!==ln(t,o)&&sn(t,o);o.shape={shapeEl:e,connectorKey:i},an(t,o)}(t,i,a.shape.shapeEl,a.shape.connectorKey):null!=a.shape?nn(t,i,a.shape.shapeEl,a.shape.connectorKey):Z(o.data.position,a.data.position)};i("s"),i("e")}function an(t,n){n.data=cn(n.shape).pathAdd(n.shape.connectorKey,t)}customElements.define("ap-path-settings",tn);const sn=(t,n)=>cn(n.shape)?.pathDel(t),cn=t=>t?.shapeEl[bt],rn=(t,n)=>t[xt].data[n],ln=(t,n)=>(t[xt].data.e===n?t[xt].data.s:t[xt].data.e).shape?.shapeEl;function dn(n,e){const i=p("g",'<path data-key="outer" d="M0 0" stroke="transparent" stroke-width="20" fill="none"/><path data-key="path" class="path" d="M0 0" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"/><path data-key="selected" d="M0 0" stroke="transparent" stroke-width="10" fill="none" style="pointer-events:none"/><g data-key="start"><circle data-evt-index="1" class="path-end" r="10" stroke-width="0" fill="transparent"/><path class="path arr" d="M 0 0 -8 -4 -8 4 z" stroke="#495057" stroke-width="1.8" fill="#495057" style="pointer-events:none"></path></g><g data-key="end"><circle data-evt-index="1" class="path-end" r="10" stroke-width="0" fill="transparent"/><path class="path arr" d="M 0 0 -8 -4 -8 4 z" stroke="#495057" stroke-width="1.8" fill="#495057" style="pointer-events:none"></path></g>');i.id=e.id,o(i,"shpath"),e.s.el=t(i,"start"),e.e.el=t(i,"end"),e.styles=e.styles??["d-arw-e"];const s=vn(i,"path","outer","selected");function c(){if(!e.s.shape||!e.e.shape){const t=function(t,n){const e=Math.atan2(n.y-t.y,n.x-t.x);return wn(e,-.8,.8)?"left":wn(e,.8,2.4)?"top":wn(e,2.4,3.2)||wn(e,-3.2,-2.4)?"right":"bottom"}(e.s.data.position,e.e.data.position);e.e.shape||(e.e.data.dir=t),e.s.shape||(e.s.data.dir=gn(t))}const t=function(t){let n=.5*Math.hypot(t.s.data.position.x-t.e.data.position.x,t.s.data.position.y-t.e.data.position.y);function e(t){return"right"===t.dir||"left"===t.dir?"right"===t.dir?t.position.x+n:t.position.x-n:t.position.x}function i(t){return"right"===t.dir||"left"===t.dir?t.position.y:"bottom"===t.dir?t.position.y+n:t.position.y-n}n=n>70?70:n<15?15:n;const o=(n,e,i,o)=>t.styles.includes(i)?n.position[e]+(o[n.dir]??0):n.position[e],a=(t,n)=>o(t,"x",n,{left:-6,right:6}),s=(t,n)=>o(t,"y",n,{top:-6,bottom:6});return`M ${a(t.s.data,"d-arw-s")} ${s(t.s.data,"d-arw-s")} C ${e(t.s.data)} ${i(t.s.data)}, ${e(t.e.data)} ${i(t.e.data)}, ${a(t.e.data,"d-arw-e")} ${s(t.e.data,"d-arw-e")}`}(e);s.forEach((n=>n.setAttribute("d",t))),pn(e.s),pn(e.e)}let r,l;let d,h=0;function m(t){switch(h){case 0:h=1,o(i,"s"===l?"highlight-s":"e"===l?"highlight-e":"select"),fn(e.s,2),fn(e.e,2),f(i);break;case 1:h=2,d=$(i,(t=>g(!0))),function(t){r||(r=Nt(new tn(n,i),t))}(t)}}function g(t){t||(l=null),h=0,a(i,"select","highlight-s","highlight-e"),fn(e.s,1),fn(e.e,1),r?.del(),r=null,d&&(d(),d=null)}return i[xt]={data:e,drawPosition:c,click:(t,n)=>{if(0===h||l){const i=n||t?yn(e,n??vt(t)):null;xn(l,i)||g(),l=i}m(t)},patch:t=>{e.styles&&(e.styles=t.styles,Qt(i)),t.s&&on(i,t),c()},moveCapture:(t,o,a)=>{g(!0);const s=a?null:$t([i],!1,!0),r=t=>{g(!0),s?It(n,s,$t([i],!1,!0)):St(n,[e.id],$t([i],!1,!0)),u(t)||m()},l=yn(e,o);l?un(n,i,c,t,l,r):function(t,n,e,i,o){C(n,i,(i=>{!function(t,n,e,i){const o=n=>X(n,t.scale,i);hn(n.s,o),n.s.shape?.shapeEl&&n.s.shape?.shapeEl===n.e.shape?.shapeEl||hn(n.e,o);n.s.shape||n.e.shape||e()}(t[Q].data,n[xt].data,e,i)}),(i=>{!function(t,n,e){const i=n=>tt(n,t.cell);hn(n.s,i),hn(n.e,i),n.s.shape&&n.e.shape||e()}(t[Q].data,n[xt].data,e),o(i)}))}(n,i,c,t,r)},unselect:g,del:function(){g(),sn(i,e.s),sn(i,e.e),i.remove()}},e.styles&&o(i,...e.styles),e.s.shape&&an(i,e.s),e.e.shape&&an(i,e.e),c(),i}function hn(t,n){t.shape?(n(cn(t.shape).data.position),cn(t.shape).drawPosition()):n(t.data.position)}const un=(t,n,e,i,l,d)=>{n[xt].data[l].shape&&en(n,l,q(t[Q].data,i)),n.style.pointerEvents="none";const h=function(t){let n=null;function e(t){const e=wt(t);if(n!==e){s(e,"hovertrack")&&o(e,"hover");let t=!1;s(e?.parentElement,"hovertrack")&&(o(e.parentElement,"hover"),t=!0),a(n,"hover"),n?.parentElement===e?.parentElement&&t||a(n?.parentElement,"hover"),n=e}}return c(t,"pointermove",e),function(){r(t,"pointermove",e),a(n,"hover"),a(n?.parentElement,"hover"),n=null}}(n.parentElement);C(n[xt].data[l].el,i,(i=>{X(n[xt].data[l].data.position,t[Q].data.scale,i),e()}),(i=>{const o=wt(i),a=o?.getAttribute("data-connect");a?nn(n,l,o.parentElement,a):tt(n[xt].data[l].data.position,t[Q].data.cell),e(),h(),n.style.pointerEvents="unset",d(i)}))};function pn(t){t.el.style.transform=`translate(${t.data.position.x}px, ${t.data.position.y}px) rotate(${mn(t.data.dir)}deg)`}function fn(t,n){t.el.firstElementChild.setAttribute("data-evt-index",n.toString())}const mn=t=>"right"===t?180:"left"===t?0:"bottom"===t?270:90,gn=t=>"left"===t?"right":"right"===t?"left":"top"===t?"bottom":"top";const vn=(n,...e)=>e.map((e=>t(n,e))),wn=(t,n,e)=>n<=t&&t<=e,yn=(t,n)=>t.e.el.contains(n)?"e":t.s.el.contains(n)?"s":null,xn=(t,n)=>!t||t===n;function bn(t,n,e){const i=function(t,n){let e=0;return{s:t.split("\n").map(((t,i)=>(e=i,`<tspan x="${n}" dy="${0===i?.41:1}em" ${0===t.length?'visibility="hidden"':""}>${0===t.length?".":function(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}(t).replaceAll(" ","&nbsp;")}</tspan>`))).join(""),c:e}}(e||"",t.x?.baseVal[0]?.value??0);t.innerHTML=i.s,null!=n&&t.y.baseVal[0].newValueSpecifiedUnits(t.y.baseVal[0].SVG_LENGTHTYPE_EMS,i.c>0?n-i.c/2:n)}const kn=(t,n)=>Ft(n,$n(t,n)),Cn=(t,n,e)=>Nt($n(t,n),e);function $n(t,n){const e=new Mn;return c(e,"cmd",(e=>{switch(e.detail.cmd){case"style":Wt(t,n,e.detail.arg);break;case"del":Ut(t,[n]);break;case"copy":Yt(t,[n])}})),e}class Mn extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML=`<style>.ln{display:flex}.ln>*{height:24px;padding:10px;cursor:pointer}#prop{padding-bottom:10px}.crcl{width:25px;height:25px;border-radius:50%}</style><div id="pnl"><div id="clr" style="display:none"><div class="ln"><div data-cmd="style" data-cmd-arg="d-cl-red"><div class="crcl" style="background:#e74c3c"></div></div><div data-cmd="style" data-cmd-arg="d-cl-orange"><div class="crcl" style="background:#f60"></div></div><div data-cmd="style" data-cmd-arg="d-cl-green"><div class="crcl" style="background:#19bc9b"></div></div></div><div class="ln"><div data-cmd="style" data-cmd-arg="d-cl-blue"><div class="crcl" style="background:#1aaee5"></div></div><div data-cmd="style" data-cmd-arg="d-cl-dblue"><div class="crcl" style="background:#1d809f"></div></div><div data-cmd="style" data-cmd-arg="d-cl-dgray"><div class="crcl" style="background:#495057"></div></div></div></div><div id="prop" style="display:none"><slot id="slot"></slot></div></div><div class="ln"><svg data-toggle="clr" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M19.228 18.732l1.768-1.768 1.767 1.768a2.5 2.5 0 1 1-3.535 0zM8.878 1.08l11.314 11.313a1 1 0 0 1 0 1.415l-8.485 8.485a1 1 0 0 1-1.414 0l-8.485-8.485a1 1 0 0 1 0-1.415l7.778-7.778-2.122-2.121L8.88 1.08zM11 6.03L3.929 13.1 11 20.173l7.071-7.071L11 6.029z" fill="rgb(52,71,103)"/></svg> <svg data-toggle="prop" ${this.getAttribute("edit-btn")?"":'style="display: none;"'} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12.9 6.858l4.242 4.243L7.242 21H3v-4.243l9.9-9.9zm1.414-1.414l2.121-2.122a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414l-2.122 2.121-4.242-4.242z" fill="rgb(52,71,103)"/></svg> ${Pt} ${Jt}</div>`;{const n=t.getElementById("pnl");let e;l(t,"[data-toggle]",(i=>{const o=t=>{const e=st(this);e.style.top=`${e.getBoundingClientRect().top+window.scrollY+t*n.getBoundingClientRect().height}px`};e&&(o(1),Hn(e,!1));const a=t.getElementById(d(i,"data-toggle"));e!==a?(Hn(a,!0),o(-1),e=a):e=null}))}l(t,"[data-cmd]",(t=>{this.dispatchEvent(new CustomEvent("cmd",{detail:{cmd:d(t,"data-cmd"),arg:d(t,"data-cmd-arg")}}))}))}}function Hn(t,n){t.style.display=n?"unset":"none"}function An(n,e,i,o,a,s,c,r,l=0){const d=Vn(e.id,i,o),h={el:t(d,"text"),vMid:l},u=()=>bn(h.el,h.vMid,e.title);u();const p=Ln(n,d,e,o,(t=>{1===t&&f(d)}),h,r??kn,(()=>c(h.el)),a,s,null);return{el:d,cons:o,draw:p.draw,drawTxt:u}}function zn(t,n,e,i,o,a,s,c){const r=Vn(n.id,e,i),l=Ln(t,r,n,i,(n=>{1===n&&qt(t,r)}),null,c??Cn,null,o,a,s);return{el:r,cons:i,draw:l.draw}}customElements.define("ap-shape-edit",Mn);const Vn=(t,n,e)=>{const i=p("g",`${n}\n\t${Object.entries(e).map((t=>`<circle data-key="${t[0]}" data-connect="${t[1].dir}" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(${t[1].position.x}px,${t[1].position.y}px)"/>`)).join()}`);return i.id=t,i};function Ln(t,n,e,s,c,r,l,d,h,f,m){let g,v,w,y;e.styles??=[];const x=()=>$t([n],!1,!1);function b(t){e.title=t,d()}const k=function(t,n,e,s,c,r,l,d,h){o(n,"hovertrack");const f=O(s),m=new Set;let g,v,w=0;function y(){g?.remove(),g=null}function x(){n.style.transform=`translate(${e.position.x}px, ${e.position.y}px)`;for(const t in s)f[t].position={x:s[t].position.x+e.position.x,y:s[t].position.y+e.position.y};for(const t of m)t[xt].drawPosition()}function b(){w=1,o(n,"select"),l&&(g=function(t,n){const e=p("circle");return e.setAttribute("data-evt-index","2"),o(e,"resizer"),i(e,n),t.append(e),e}(n,l()))}function k(t){r(),w=0,a(n,"select","highlight"),t||y(),v&&(v(),v=null)}const M=t=>{switch(w){case 0:b();break;case 1:w=2,a(n,"select"),o(n,"highlight"),y(),v=$(n,(t=>k()))}c(t,w)},H=(e,i,o)=>{if(i===g){k(!0);const i=$t([n],!1,!1);return void C(g,e,d,(e=>{h&&h(),y(),b(),It(t,i,$t([n],!1,!1))}))}k();const a=i.getAttribute("data-connect");if(a){const i=dn(t,{id:J(),type:0,s:{shape:{shapeEl:n,connectorKey:a}},e:{data:{dir:gn(f[a].dir),position:q(t[Q].data,e)}}});return n.parentNode.append(i),t[Q].select(u(e)?null:[i]),i[xt].moveCapture(e,i[xt].data.e.el,!0),void m.add(i)}A(e,o)},A=(i,o)=>{const a=o?null:$t([n],!1,!1);C(n,i,(n=>{X(e.position,t[Q].data.scale,n),x()}),(i=>{tt(e.position,t[Q].data.cell),x(),a?It(t,a,$t([n],!1,!1)):St(t,[e.id],$t([n],!1)),u(i)||b()}))};return n[bt]={data:e,drawPosition:x,click:M,moveCapture:H,unselect:k,del:function(){k();for(const t of m)t[xt].del();n.remove()},paths:m,pathAdd:function(t,n){return m.add(n),f[t]},pathDel:function(t){m.delete(t)}},x}(t,n,e,s,((i,o)=>{c&&c(o),2===o&&(r&&!g&&(w=e.title,v=x(),g=function(t,n,e,i,o){let a=p("foreignObject");const s=document.createElement("textarea"),c=()=>function(t,n,e,i,o){const a=t.getBBox(),s=a.width+20;n.width.baseVal.value=s+2*i+2,n.x.baseVal.value=a.x-i-("center"===o?10:"right"===o?20:0),n.height.baseVal.value=a.height+2*i+3,n.y.baseVal.value=a.y-i,e.style.width=`${s}px`,e.style.height=`${a.height}px`}(t,a,s,l,r.textAlign);s.value=e||"",s.oninput=function(){bn(t,n,s.value),i(s.value),c()},o&&(s.onblur=function(){o(s.value)}),s.onpointerdown=function(t){t.stopImmediatePropagation()},a.appendChild(s),t.parentElement.appendChild(a);const r=getComputedStyle(s),l=parseInt(r.paddingLeft)+parseInt(r.borderWidth);return c(),s.focus(),{dispose:()=>{a.remove(),a=null},draw:c}}(r.el,r.vMid,e.title,b)),y||(y=l(t,n,i)))}),(function(){g?.dispose(),g=null,y?.del(),y=null,v&&w!==e.title&&It(t,v,x()),v=null,w=null}),h,f,m);return e.styles&&o(n,...e.styles),{draw:()=>{k(),y?.updPos&&y?.updPos(),g?.draw()}}}function Sn(n,e,i){t(n,e).r.baseVal.value=i}const Bn=(t,n)=>function(t,n,e){const i=v(t);return L(n,e,Math.sqrt(i.x**2+i.y**2))}(t,n,24);function En(n,e){e.w??=96,e.h??=48;const a={w:e.w,h:e.h};let s;const c=An(n,e,'<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="96" x="-72" y="-48" fill="transparent" stroke="transparent" stroke-width="0" />\n\t\t <rect data-key="main" width="96" height="48" x="-48" y="-24" rx="15" ry="15" fill="#1aaee5" stroke="#fff" stroke-width="1" />\n\t\t <text data-key="text" y="0" x="0" text-anchor="middle" style="pointer-events: none;" fill="#fff">&nbsp;</text>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:24}},top:{dir:"top",position:{x:0,y:-24}}},(()=>{const t=function(t){const n=t.w/2,e=t.h/2;return{t:{x:t.position.x-n,y:t.position.y-e},b:{x:n,y:e}}}(e);return s=t.t,t.b}),(o=>{let l;(function(t,n,e,o,a){const s=T(q(t[Q].data,o),n,-1),c={};let r=!1;function l(t){s[t]<48&&(s[t]=48);const i=48*Math.round(s[t]/48),o="x"===t?"w":"h";e[o]!==i&&(!a||a()[o]<=i)&&(e[o]=i,e.position[t]=n[t]+i/2,r=!0),c[t]=s[t]-e[o]/2}return l("x"),l("y"),i(o.target,c),r})(n,s,e,o,(()=>(l??=Dn(t(c.el,"text")),l)))&&(Tn(a,e),r())}),(t=>{const n=Dn(t,a);In(e,n)||(Tn(e,n),r())}));function r(){!function(t,n){const e=n.w/-2,i=n.h/-2;t.cons.right.position.x=-e,t.cons.left.position.x=e,t.cons.bottom.position.y=-i,t.cons.top.position.y=i,jt(t),Zn(t.el,"main",n.w,n.h,e,i),Zn(t.el,"outer",n.w+48,n.h+48,e-24,i-24)}(c,e),c.draw()}return o(c.el,"shrect"),96!==e.w||48!==e.h?r():c.draw(),c.el[bt].patch=t=>{const n=Xt(c,t),i=(null!=t.w||null!=t.h)&&!In(e,t);i&&Tn(e,t),i?r():n&&c.draw()},c.el}const In=(t,n)=>t.w===n.w&&t.h===n.h,Tn=(t,n)=>{t.h=n.h,t.w=n.w};function Dn(t,n){const e=t.getBBox();return{w:L(n?.w,48,e.width),h:L(n?.h,48,e.height)}}const Zn=(n,e,i,o,a,s)=>{const c=t(n,e);c.width.baseVal.value=i,c.height.baseVal.value=o,c.x.baseVal.value=a,c.y.baseVal.value=s};function Yn(t,n){let e;n.w??=96,n.h??=96;const a=zn(t,n,'<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="144" x="-72" y="-72" fill="transparent" stroke="transparent" stroke-width="0" />\n\t\t <rect data-key="selected" width="96" height="96" x="-48" y="-48" rx="15" ry="15" fill="none" stroke="transparent" stroke-width="20" style="pointer-events: stroke;" />\n\t\t <rect data-key="main" width="96" height="96" x="-48" y="-48" rx="15" ry="15" stroke="transparent" stroke-width="10" style="pointer-events: none;" />',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},(()=>{const t=Rn(n);return e=t.tCanvas,t.bInner}),(o=>s(function(t,n,e,o){const a=T(q(t[Q].data,o),n,-1);e.w=a.x<48?48:a.x;const s=e.w/2;e.position.x=n.x+s,e.h=a.y<48?48:a.y;const c=e.h/2;return e.position.y=n.y+c,i(o.target,{x:s,y:c}),{x:-s,y:-c}}(t,e,n,o))),(t=>s(function(t,n){const e=t=>24*Math.round(t/24);t.w=e(t.w),t.h=e(t.h);const i=Rn(t);return t.position.x=n.x-i.tInner.x,t.position.y=n.y-i.tInner.y,i.tInner}(n,e))));o(a.el,"shbox"),a.el.setAttribute("bg","0");const s=t=>{a.cons.right.position.x=n.w+t.x,a.cons.left.position.x=t.x,a.cons.bottom.position.y=n.h+t.y,a.cons.top.position.y=t.y,jt(a),Zn(a.el,"main",n.w,n.h,t.x,t.y),Zn(a.el,"selected",n.w,n.h,t.x,t.y),Zn(a.el,"outer",n.w+48,n.h+48,t.x-24,t.y-24),a.draw()};return 96!==n.w||96!==n.h?s(Rn(n).tInner):a.draw(),a.el[bt].patch=t=>{const e=Xt(a,t),i=(null!=t.w||null!=t.h)&&!In(n,t);i&&Tn(n,t),i?s(Rn(n).tInner):e&&a.draw()},a.el}function Rn(t){const n=t=>24*Math.floor(t/2/24),e=n(t.w),i=n(t.h);return{tCanvas:{x:t.position.x-e,y:t.position.y-i},tInner:{x:-e,y:-i},bInner:{x:t.w-e,y:t.h-i}}}function Un(t,n){return On?async function(t,n){try{const e=await window.showSaveFilePicker({suggestedName:n,types:[Fn]}),i=await e.createWritable();return await i.write(t),await i.close(),e}catch(t){"AbortError"!==t.name&&jn()}}(t,n):function(t,n){const e=document.createElement("a");e.download=n,e.href=URL.createObjectURL(t),e.click(),URL.revokeObjectURL(e.href),e.remove()}(t,n)}async function Jn(t){const n="AbortError";try{return Pn?await async function(t){const[n]=await window.showOpenFilePicker({types:[t]});return{h:n,f:await n.getFile()}}(t):await new Promise(((e,i)=>{!function(t,n,e){const i=document.createElement("input");i.type="file",i.multiple=!1,i.accept=t,c(i,"cancel",(t=>e(t)),!0),c(i,"change",(async()=>n(i.files?.length?i.files[0]:null)),!0),i.click(),i.remove()}(t.inputAccept,(t=>{e({f:t})}),(t=>i(Error(n))))}))}catch(t){if(t.name===n||t.message===n)return null;throw t}}const Pn="showOpenFilePicker"in window,On="showSaveFilePicker"in window,jn=()=>alert("File not saved"),Fn={accept:{"image/png":[".png"]},inputAccept:"image/png"},Nn={accept:{"image/*":[".png",".gif",".jpeg",".jpg"]},inputAccept:"image/*"};function Kn(t,n,e,i){Xn(n,(n=>t[Q].select(Rt(t,Mt(n),!0,e,i))))}function Xn(t,n){!function(t,n,e){const i=new Image;i.onload=function(){const o=B(n,i.width,i.height);if(!o.c){URL.revokeObjectURL(i.src);const n=new FileReader;return n.onloadend=function(){e(n.result,o.w,o.h)},void n.readAsDataURL(t)}const a=document.createElement("canvas");a.width=o.w,a.height=o.h;const s=a.getContext("2d");s.imageSmoothingEnabled=!1,s.imageSmoothingQuality="high",s.drawImage(i,0,0,o.w,o.h),URL.revokeObjectURL(i.src),e(a.toDataURL(),o.w,o.h)},i.src=URL.createObjectURL(t)}(t,2040,((t,e,i)=>{const o=B(Math.min(document.body.clientHeight/2,264),e,i),a={id:J(),type:6,position:{x:0,y:0},w:o.w,h:o.h,r:S(i/e),d:t};Gn(a),n(a)}))}function _n(t,n){let e;n.w??=96,n.h??=72,n.r??=n.h/n.w,n.d??="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABICAYAAAAJZ/BjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACuSURBVHgB7dFBAQAQAAAxxND/rZUcxLjPVmFzn/sGmTVICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYgJiAmICYh9O4cDPKIk1kIAAAAASUVORK5CYII=";const a=zn(t,n,`<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="120" x="-72" y="-48" fill="transparent" stroke="transparent" stroke-width="0" />\n\t\t <rect data-key="selected" width="96" height="72" x="-48" y="-24" rx="15" ry="15" fill="none" stroke="transparent" stroke-width="20" style="pointer-events: stroke;" />\n\t\t <image data-key="main" x="-48" y="-24" style="clip-path: inset(0% round 15px);" decoding="async" width="96" height="72" href="${n.d}" />`,{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-24}}},(()=>{const t=Rn(n);return e=t.tCanvas,t.bInner}),(o=>s(function(t,n,e,o){const a=T(q(t[Q].data,o),n,-1);e.w=a.x<48?48:a.x;const s=e.w/2;e.position.x=n.x+s,e.h=e.r*e.w;const c=e.h/2;return e.position.y=n.y+c,i(o.target,{x:s,y:c}),{x:-s,y:-c}}(t,e,n,o))),(t=>s(function(t,n){Gn(t);const e=Rn(t);return t.position.x=n.x-e.tInner.x,t.position.y=n.y-e.tInner.y,e.tInner}(n,e))),Qn);o(a.el,"shimg"),a.el.setAttribute("bg","1");const s=t=>{a.cons.right.position.x=n.w+t.x,a.cons.left.position.x=t.x,a.cons.bottom.position.y=n.h+t.y,a.cons.top.position.y=t.y,jt(a),Zn(a.el,"main",n.w,n.h,t.x,t.y),Zn(a.el,"selected",n.w,n.h,t.x,t.y),Zn(a.el,"outer",n.w+48,n.h+48,t.x-24,t.y-24),a.draw()};return s(Rn(n).tInner),a.el[bt].patch=t=>{const e=_t(a,t),i=(null!=t.w||null!=t.h)&&!In(n,t);i&&Tn(n,t),i?s(Rn(n).tInner):e&&a.draw()},a.el}function Gn(t){t.w=24*Math.round(t.w/24),t.h=S(t.r*t.w)}function Qn(t,n,e){const i=m(`<style>.ln{display:flex}.ln>*{height:24px;padding:10px}[data-cmd]{cursor:pointer}</style><div class="ln">${Pt} ${Jt}</div>`);return l(i,"[data-cmd]",(e=>{switch(d(e,"data-cmd")){case"del":Ut(t,[n]);break;case"copy":Yt(t,[n])}})),Nt(i,e)}const Wn=(t,n)=>Ft(n,new qn(t,n));class qn extends HTMLElement{constructor(t,n){super(),this.C=n,this.g=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.ln{display:flex}.ln>*{height:24px;padding:10px;fill-opacity:.3;stroke-opacity:.3}[data-cmd]{cursor:pointer}.d-b [data-cmd-arg=d-b],.d-h [data-cmd-arg=d-h],.ta-1 [data-cmd-arg="1"],.ta-2 [data-cmd-arg="2"],.ta-3 [data-cmd-arg="3"]{fill-opacity:1;stroke-opacity:1}</style><ap-shape-edit id="edit" edit-btn="true"><div class="ln"><svg data-cmd="s" data-cmd-arg="d-h" viewBox="0 0 24 24" width="24" height="24"><path d="M17 11V4H19V21H17V13H7V21H5V4H7V11H17Z" fill="rgb(52,71,103)"></path></svg> <svg data-cmd="s" data-cmd-arg="d-b" viewBox="0 0 24 24" width="24" height="24"><path d="M8 11H12.5C13.8807 11 15 9.88071 15 8.5C15 7.11929 13.8807 6 12.5 6H8V11ZM18 15.5C18 17.9853 15.9853 20 13.5 20H6V4H12.5C14.9853 4 17 6.01472 17 8.5C17 9.70431 16.5269 10.7981 15.7564 11.6058C17.0979 12.3847 18 13.837 18 15.5ZM8 13V18H13.5C14.8807 18 16 16.8807 16 15.5C16 14.1193 14.8807 13 13.5 13H8Z" fill="rgb(52,71,103)"></path></svg></div><div class="ln"><svg data-cmd="a" data-cmd-arg="1" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 15h14v2H3v-2zm0-5h18v2H3v-2zm0-5h14v2H3V9z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="a" data-cmd-arg="2" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm2 15h14v2H5v-2zm-2-5h18v2H3v-2zm2-5h14v2H5V9z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="a" data-cmd-arg="3" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm4 15h14v2H7v-2zm-4-5h18v2H3v-2zm4-5h14v2H7V9z" fill="rgb(52,71,103)"/></svg></div></ap-shape-edit>';const n=this.C[bt].data,e=t.getElementById("edit");c(e,"cmd",(t=>{switch(t.detail.cmd){case"style":Wt(this.g,this.C,t.detail.arg);break;case"del":Ut(this.g,[this.C]);break;case"copy":Yt(this.g,[this.C])}}));const i=t=>Kt(this.g,this.C,t);o(e,`ta-${n.a}`),l(t,'[data-cmd="a"]',(t=>{const s=Number.parseInt(d(t,"data-cmd-arg"));s!==n.a&&(a(e,`ta-${n.a}`),o(e,`ta-${s}`),i({a:s}))})),["d-h","d-b"].forEach((t=>{n.styles?.includes(t)&&o(e,t)})),l(t,'[data-cmd="s"]',(t=>{const s=d(t,"data-cmd-arg"),c={styles:n.styles?O(n.styles):[]};c.styles?.includes(s)?(!function(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}(c.styles,s),a(e,s)):(c.styles??=[],c.styles.push(s),o(e,s)),i(c)}))}}function te(n,e){e.w??=48,e.h??=48,e.a??=1;const i=An(n,e,`<rect data-key="outer" data-evt-no data-evt-index="2" width="96" height="96" x="-48" y="-48" fill="transparent" stroke="transparent" stroke-width="0" />\n\t\t <rect data-key="main" width="48" height="48" x="-24" y="-24" rx="15" ry="15" fill="#1aaee5" stroke="#fff" stroke-width="1" />\n\t\t <text data-key="text" data-evt-no y="${ie(e.h)}" x="${ee(e)}" fill="#fff">&nbsp;</text>`,{right:{dir:"right",position:{x:24,y:0}},left:{dir:"left",position:{x:-24,y:0}},bottom:{dir:"bottom",position:{x:0,y:24}},top:{dir:"top",position:{x:0,y:-24}}},null,null,(t=>s(t)),Wn,null);o(i.el,"shtxt"),o(i.el,`ta-${e.a}`);const a=()=>t(i.el,"text"),s=t=>{const n=ne(t);In(e,n)||(Tn(e,n),h())};let c,r,l;function d(){r=e.w,c=e.h,l=e.a}function h(t){if(function(t,n){const e=n.w/-2,i=n.h/-2;t.cons.left.position.y=i+24,t.cons.left.position.x=e,t.cons.top.position.y=i,t.cons.bottom.position.y=-i,t.cons.right.position.y=i+24,t.cons.right.position.x=-e,jt(t),Zn(t.el,"main",n.w,n.h,e,i),Zn(t.el,"outer",n.w+48,n.h+48,e-24,i-24)}(i,e),t||l!==e.a||r!==e.w){const t=e.w/-2;let n,o;switch(e.a){case 1:n=t+8,o=(e.w-r)/2;break;case 2:n=0,o=0;break;case 3:n=-t-8,o=(e.w-r)/-2}const s=a();s.x.baseVal[0].value=n,s.querySelectorAll("tspan").forEach((t=>{t.x.baseVal[0].value=n})),e.position.x+=o,l!==e.a&&(oe(i.el,l,e.a),l=e.a),r=e.w}c!==e.h&&(a().y.baseVal[0].value=ie(e.h),e.position.y+=(e.h-c)/2,c=e.h),i.draw()}return d(),48!==e.w||48!==e.h?h(!0):i.draw(),i.el[bt].patch=t=>{const n=t.position&&!U(e.position,t.position);n&&Z(e.position,t.position);let o=!1;t.styles&&(e.styles=t.styles,Qt(i.el),o=!0),null!=t.title&&e.title!==t.title&&(e.title=t.title,i.drawTxt(),o=!0);let s=!1;if(null==t.w&&o){const t=ne(a());In(e,t)||(Tn(e,t),s=!0)}null==t.w||In(e,t)||(Tn(e,t),d(),s=!0),null!=t.a&&e.a!==t.a&&(oe(i.el,e.a,t.a),e.a=t.a,l=e.a,s=!0),s?(a().y.baseVal[0].value=ie(e.h),h(!0)):n&&i.draw()},i.el}function ne(t){const n=t.getBBox();return{w:L(0,48,n.width+12),h:L(0,48,n.height+14)}}customElements.define("ap-rect-txt-settings",qn);const ee=t=>1===t.a?-16:2===t.a?0:16,ie=t=>-t/2+24;function oe(t,n,e){a(t,`ta-${n}`),o(t,`ta-${e}`)}function ae(n,e,i){t(n,e).setAttribute("d",`M${i.l.x} ${i.l.y} L${i.t.x} ${i.t.y} L${i.r.x} ${i.r.y} L${i.b.x} ${i.b.y} Z`)}function se(t,n){const e=t/2,i=n-e,o=e-n;return{l:{x:i,y:0},t:{x:0,y:i},r:{x:o,y:0},b:{x:0,y:o}}}const ce=(t,n)=>L(n,48,function(t){const n=v(t);return 2*(Math.abs(n.x)+Math.abs(n.y))}(t)-20);const re=()=>{if(!document.cookie.includes("dgrma=1"))return null;const t=N(localStorage.getItem("dgrm"));return t&&new Date(t.e)>new Date?t:null},le=()=>{const t=re()?.n;if(t)return t;const n=`User${Math.floor(100*Math.random())}`,e=prompt("Your name",n);return null==e?null:e?.substring(0,25)??n},de=t=>document.getElementById("menu").bage(t),he=t=>{const n=ue(t),e=document.createElement("div");return e.innerHTML=`<svg viewBox="0 0 24 24" width="24" height="24"><path d="M2.89945 2.30007L21.7052 8.56867C21.9672 8.65599 22.1088 8.93915 22.0215 9.20112C21.975 9.34065 21.8694 9.45262 21.7328 9.50725L13.0002 13.0003L8.57501 21.8506C8.45151 22.0976 8.15118 22.1977 7.90419 22.0742C7.77883 22.0115 7.68553 21.8991 7.64703 21.7644L2.26058 2.91177C2.18472 2.64626 2.33846 2.36951 2.60398 2.29365C2.70087 2.26597 2.80386 2.26821 2.89945 2.30007Z" fill="${n}"></path></svg> <span style="background-color:rgba(255,255,255,.5);border-radius:5px;padding:2px">${t}</span>`,e.style.cssText=`position: fixed; top:0; color:${n}; pointer-events: none;`,e.style.transform="translate(-9999px, 0px)",g(e),e},ue=t=>`hsl(${[...t].reduce(((t,n)=>n.charCodeAt(0)+((t<<5)-t)),0)%360}, 97%, 47%)`,pe=(t,n,e,i)=>{const o=((t,n,e)=>({x:t.position.x+n*t.scale,y:t.position.y+e*t.scale}))(t[Q].data,e,i);n.style.transform=`translate(${o.x}px, ${o.y}px)`},fe=(t,n,e)=>{const i=t=>e(F(t)),o=c(t,"dgrmc",(t=>i([4,t.detail.shapesToCreateData]))),a=c(t,"dgrmu",(t=>i([4,t.detail.shapesToUpdData]))),s=c(t,"dgrmd",(t=>i([5,t.detail.delIds])));let l=!0;const d=c(t.ownerSVGElement,"pointermove",V((e=>{if(l){const o=W(t[Q].data,e.clientX,e.clientY);i([6,n,o.x,o.y])}}),60));return()=>{l=!1,r(t,"dgrmc",o),r(t,"dgrmu",a),r(t,"dgrmd",s),r(t.ownerSVGElement,"pointermove",d)}},me=(t,n)=>{At(t,n),z(t,new CustomEvent(ve,{detail:n,cancelable:!1}))},ge=(t,n)=>{Gt(n),z(t,new CustomEvent(we,{detail:n,cancelable:!1}))},ve="dgrmcu",we="dgrmcd";async function ye(t,n,e){return function(t,n,e){let i,o;const a=xe(t,n);if(a)i=new DataView(t,0,a.byteOffset-8),o=new DataView(t,a.byteOffset+a.byteLength+4);else{const n=t.byteLength-12;i=new DataView(t,0,n),o=new DataView(t,n)}const s=new DataView(new ArrayBuffer(8));return s.setUint32(0,e.length),s.setUint32(4,n),new Blob([i,s,e,new Uint32Array([0]),o],{type:"image/png"})}(await t.arrayBuffer(),be(n),e)}function xe(t,n){const e=new DataView(t,8);let i,o=0,a=e.getUint32(4);for(;1229278788!==a;){if(i=e.getUint32(o),a===n)return new DataView(t,o+16,i);o=o+12+i,a=e.getUint32(o+4)}return null}function be(t){return new DataView((new TextEncoder).encode(t).buffer).getUint32(0)}const ke=()=>"undefined"!=typeof navigator&&(/iPad|iPhone|iPod/.test(navigator.userAgent||"")||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1);function Ce(t,n,e,i){const o=t.ownerSVGElement.cloneNode(!0),a=o.querySelector("#canvas");let c;o.style.backgroundImage=null,e?(c=function(t){const n={x:1/0,y:1/0},e={x:-1/0,y:-1/0};for(const i of t){const t=i.getBoundingClientRect();n.x>t.x&&(n.x=t.x),n.y>t.y&&(n.y=t.y),e.x<t.right&&(e.x=t.right),e.y<t.bottom&&(e.y=t.bottom)}return{x:n.x,y:n.y,height:e.y-n.y,width:e.x-n.x}}(Ae(t,$e)),E(a.children,(t=>((t,n)=>n.some((n=>s(t,n))))(t,$e)?(He(t),!0):(t.remove(),!1)))):(c=t.getBoundingClientRect(),Ae(a,Me).forEach((t=>He(t))));const r=o.getElementsByTagName("foreignObject");for(;r[0];)r[0].parentNode.removeChild(r[0]);const l=t[Q].data,d=1/l.scale;a.style.transform=`matrix(1, 0, 0, 1, ${d*(l.position.x+15*l.scale-c.x)}, ${d*(l.position.y+15*l.scale-c.y)})`,function(t,n,e,i){const o=B(ke()?4096:10836,n.width*e*window.devicePixelRatio,n.height*e*window.devicePixelRatio),a=new Image;a.width=n.width,a.height=n.height,a.onload=function(){const t=document.createElement("canvas");t.width=o.w,t.height=o.h,t.style.width=`${o.w}px`,t.style.height=`${o.h}px`;const e=t.getContext("2d");e.imageSmoothingEnabled=!1,e.drawImage(a,n.x,n.y,n.width,n.height,0,0,o.w,o.h),URL.revokeObjectURL(a.src),t.toBlob(i,"image/png")},t.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,a.width),t.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,a.height),a.src=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(t)],{type:"image/svg+xml;charset=utf-8"}))}(o,{x:0,y:0,height:c.height/l.scale+30,width:c.width/l.scale+30},3,(async t=>i(n?await ye(t,"dgRm",(new TextEncoder).encode(n)):t)))}const $e=["select","highlight"],Me=["select","highlight","highlight-e","highlight-s"],He=t=>{a(t,...Me),t.querySelector(".resizer")?.remove()},Ae=(t,n)=>t.querySelectorAll(`.${n.join(", .")}`);async function ze(t){const n=await async function(t,n){return xe(await t.arrayBuffer(),be(n))}(t,"dgRm");return n?(new TextDecoder).decode(n):null}const Ve=(t,n,e,i,o)=>{t[Te]={k:n,n:e,e:i,m:o},Ee(e)},Le=(t,n)=>{const e=P(n.name);t[Te]={f:n,n:e},Ee(e)},Se=t=>{t[Te]=void 0,Ee()},Be=t=>t[Te],Ee=t=>{document.title=t??"DGRM - Flowchart editor"},Ie=t=>t?.replace(/[/\\?%*:|"<>]/g,"-"),Te=Symbol(0),De=async t=>{const n=Be(t);n?.f?Oe(t,(async e=>{const i=await n.f.createWritable();await i.write(e),await i.close(),je(t)})):n?.k?n.e?Fe((async()=>await Re(t,n.k))):alert('You do not have access to edit this diagram. Use "Save As" to make your own copy.'):Ze(t)};function Ze(t,e){const i=re(),o=m(`<div class="mb20"><input nm type="text" class="w100" placeholder="Name" minlength="4" maxlength="45" value="${e??""}"></div><div class="mb10">${i?"":'<div style="margin-bottom:5px;"><small>Log in to access cloud storage.</small></div>'} <button cl class="w100" ${i?"":"disabled"}>Save to cloud</button></div><div><button dvc class="w100">Save to device</button></div>`),a=dt(o,"mdm"),s=(t,e)=>c(n(o,t),"click",(t=>{a[ht].del(),e()})),r=()=>Ie(n(o,"nm").value);s("dvc",(n=>Ye(t,r()))),s("cl",(async n=>{Fe((async()=>{const n=r(),e=Be(t);if(e?.k&&e.n===n&&e.m)return void await Re(t,e.k);const i=function(){const t=new Date;return`${t.getUTCFullYear()}${(t.getUTCMonth()+1).toString().padStart(2,"0")}${J()}`}();Ve(t,i,await async function(t,n,e){const i=new URL(`${ft}a/c`);return i.searchParams.set("k",t),i.searchParams.set("n",n),(await x(i.toString(),e)).text()}(i,n,Ct(t)),!0,!0),je(t)}))}))}const Ye=(t,n)=>Oe(t,(async e=>{const i=Un(e,n??"dgrm.png");if(i){const n=await i;n&&(Le(t,n),je(t))}else je(t)})),Re=async(t,n)=>{let e;if(Ue(t)){const i=$t(t[Pe].u.size?[...document.querySelectorAll([...t[Pe].u].map((t=>`[id="${t}"]`)).join(","))]:null,!1);t[Pe].d.forEach((t=>{i.s[t]=null})),e=await(async(t,n)=>(await x(`${ft}u/${t}`,n)).json())(n,i)}else e=(await mt(n)).d;At(t,e),je(t)},Ue=t=>t[Pe].u.size||t[Pe].d.size,Je=t=>{t[Pe].u.clear(),t[Pe].d.clear()},Pe=Symbol(0),Oe=(t,n)=>Ce(t,F(Ct(t)),null,n),je=t=>{Je(t),ut("Saved")},Fe=async t=>{try{ot(!0),await t()}catch{jn()}finally{ot(!1)}},Ne=navigator.clipboard.readText;async function Ke(t,n){const e=`web text/dgrm${F($t(n,!0))}`;await async function(t){try{await navigator.clipboard.writeText(t)}catch(t){alert(t)}}(e),window.ClipboardItem&&Ce(t,null,!0,(async t=>{try{await navigator.clipboard.write([new window.ClipboardItem({[t.type]:Promise.resolve(t),"text/plain":Promise.resolve(new Blob([e],{type:"text/plain"}))})])}catch{}}))}const Xe=t=>{if(!t?.startsWith("web text/dgrm"))return null;try{return N(t.slice("web text/dgrm".length))}catch{return null}};function _e(t){return!!We(t)&&(t.c[t.i].u(),t.i-=1,!0)}function Ge(t){const n=Qe(t);return null!==n&&(t.i=n,t.c[n].r(),!0)}const Qe=t=>{if(!t)return null;const n=t.i+1;return n<=t.c.length-1?n:null},We=t=>t&&t.i>=0,qe=(t,n,e)=>oi(t,(()=>{ei(t,Et(n,e)),At(t,e),Gt(n)}),(()=>{ei(t,Bt(n,e)),At(t,e)})),ti=(t,n,e)=>oi(t,(()=>{ei(t,Bt(n,e)),At(t,e)}),(()=>{ei(t,Et(n,e)),Gt(n)})),ni=(t,n,e)=>oi(t,(()=>{ei(t,Tt(e,n)),At(t,n)}),(()=>{ei(t,Tt(n,e)),At(t,e)})),ei=(t,n)=>{n[ii]=!0,z(t,n)},ii=Symbol(0);function oi(t,n,e){t[di]??={c:[],i:-1},function(t,n,e){15===t.c.length&&(t.c.splice(0,1),t.i--),t.c.splice(t.i+1),t.i=t.c.push({u:n,r:e})-1}(t[di],n,e),ri(t)}function ai(t,n){n(t[di])&&(t[Q].select(null),ri(t))}const si=t=>ai(t,_e),ci=t=>ai(t,Ge);const ri=t=>{return z(t,A(li,(n=t[di],{u:We(n),r:null!==Qe(n)})));var n},li="dgrmh",di=Symbol("h");function hi(t,n,e,i){const o=n=>t[Q].select(Rt(t,n,!0,e,i));if(n?.data)o(function(t){if(!t)return null;const n=new Map,e=t=>{const e=J();return n.set(t,e),e},i=[];for(const n in t.s){const o=e(t.s[n].id);t.s[o]=t.s[n],t.s[o].id=o,delete t.s[n],0===t.s[o].type&&i.push(t.s[o])}return i.forEach((t=>{t.s.s=n.get(t.s.s),t.e.s=n.get(t.e.s)})),t}(n.data));else if(n?.img)Xn(n.img,(t=>o(Mt(t))));else if(n?.txt){const e=function(t,n){const e=p("text");bn(e,null,n),e.style.visibility="hidden",t.append(e);const i=ne(e);return e.remove(),i}(t,n.txt);o(Mt({id:J(),type:3,position:{x:0,y:0},title:n.txt,w:e.w,h:e.h}))}else ut("Clipboard is empty")}class ui extends HTMLElement{constructor(t){super(),this.g=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{position:fixed;top:5px;left:60px;white-space:nowrap;display:flex;flex-direction:row}svg{padding:10px;fill:#344767;opacity:.4}.actv{opacity:1;cursor:pointer}</style><div class="menu"><svg id="u" width="24" height="24" viewBox="0 0 24 24"><path d="m6.907 6.68 2.734-2.73a6.66 6.66 0 1 1 9.42 9.42l-8.338 8.338a1 1 0 0 1-1.415-1.415l8.339-8.336A4.66 4.66 0 0 0 11.229 5.2l-.174.166-3.641 3.633H12a1 1 0 0 1 .993.884L13 10a1 1 0 0 1-.883.993l-.117.006-7.06-.001-.095-.01-.112-.024-.131-.047-.082-.04-.102-.064a.996.996 0 0 1-.125-.107l-.092-.105-.074-.114-.046-.093-.038-.105-.016-.058-.016-.081-.007-.062L4 10V3.002a1 1 0 0 1 1.993-.116L6 3.002v4.584l3.641-3.635L6.907 6.68Z"></path></svg> <svg id="r" width="24" height="24" fill="none" viewBox="0 0 24 24"><path d="M18 7.586 14.36 3.951a6.66 6.66 0 1 0-9.42 9.42l8.339 8.337a1 1 0 0 0 1.414-1.415l-8.339-8.336A4.66 4.66 0 0 1 12.771 5.2l.174.166 3.64 3.633H12a1 1 0 0 0-.993.884L11 10a1 1 0 0 0 .883.993l.117.006h7a1 1 0 0 0 .993-.883L20 10V3.002a1 1 0 0 0-1.993-.116L18 3.002v4.584L14.36 3.951 18 7.586Z"/></svg></div>';const n=t.getElementById("u"),e=t.getElementById("r");c(this.g,li,(t=>{const i=(t,n)=>n?o(t,"actv"):a(t,"actv");i(n,t.detail.u),i(e,t.detail.r)})),c(n,"click",(t=>si(this.g))),c(e,"click",(t=>ci(this.g)))}}function pi(t,n){Ht(t,n),function(t){const n=t.getBoundingClientRect(),e=window.innerWidth/2,i=window.innerHeight/2;t[Q].move(e-n.width/2-n.x,i-n.height/2-n.y,1);const o=t=>t>1?1:Math.max(t,.25),a=Math.min(o(window.innerWidth/n.width),o(window.innerHeight/n.height));a<1&&t[Q].scale(a,{x:e,y:i})}(t)}function fi(t,n){const e=function(t,n){async function e(e){if(document.activeElement===t.ownerSVGElement){const i=n();if(i?.length)return e.preventDefault(),Ke(t,i),i}return null}async function i(n){const i=await e(n);i&&Ut(t,i)}return document.addEventListener("copy",e),document.addEventListener("cut",i),function(){r(document,"copy",e),r(document,"cut",i)}}(t,n);function i(e){if(!h(e)&&("Delete"===e.key||"Backspace"===e.key)){const e=n();e?.length&&Ut(t,e)}}return c(document,"keydown",i),function(){e(),r(document,"keydown",i)}}customElements.define("ap-history",ui);class mi extends HTMLElement{constructor(t,n){super(),this.g=t,this.$=n}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML=`<style>.ln{display:flex;align-items:center;color:#0d6efd;line-height:25px;padding:5px 10px;cursor:pointer;white-space:nowrap}.ln>*{margin-right:10px}</style><div id="clone" class="ln" style="padding-top:10px">${Pt}Create copy</div><div id="copy" class="ln"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7 6V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1h-3v3c0 .552-.45 1-1.007 1H4.007A1.001 1.001 0 0 1 3 21l.003-14c0-.552.45-1 1.007-1H7zm2 0h8v10h2V4H9v2z" fill="rgb(52,71,103)"/></svg>Copy to clipboard</div><div id="save" class="ln">${Ot}Save image</div><div id="del" class="ln" style="padding-bottom:10px">${Jt}Delete</div>`;const n=()=>st(this)[ht].del();function e(e,i){c(t.getElementById(e),"click",(t=>{n(),i()}))}e("clone",(()=>Yt(this.g,this.$()))),e("copy",(async()=>await Ke(this.g,this.$()))),e("save",(()=>Ce(this.g,F($t(this.$(),!1)),!0,(async t=>Un(t,"dgrm.png"))))),e("del",(()=>Ut(this.g,this.$())))}}customElements.define("ap-grp-settings",mi);const gi=Symbol("p");const vi=(t,n,e)=>{if(e[gi])return;const i=vt(e),o=Ti(i);if(!o)return void Hi(n);const a=Li(n,i),s=Ei(n);if(s&&a)Di(o,e);else{if(e.shiftKey){if(s){const t=Bi(n);Zi(t),Ci(n,t)}return a?$i(n,o):Ci(n,o),void zi(n,e)}a?lt(new mi(t,(()=>Ai(n))),e.clientX-10,e.clientY-10):(Hi(n),Ci(n,o),zi(n,e))}},wi=(t,n,e,i)=>{if(e[gi])return;if(i===t.ownerSVGElement)return void t[Q].moveCapture();const o=Li(n,i);if(!o&&!u(e))return void t[Q].moveCapture();if(!o&&u(e))return Hi(n),void Yi(Ti(i),e,i);const a=Ei(n);o&&a?Yi(Ti(i),e,i):o&&!a&&yi(t,n,e)},yi=(t,n,e)=>{const i=()=>xi(n),o=t=>bi(n,t),a=i();C(t.ownerSVGElement,e,(n=>o((e=>X(e,t[Q].data.scale,n)))),(n=>{o((n=>tt(n,t[Q].data.cell))),It(t,a,i())}))},xi=t=>$t([...t.shapesToMove,...Ri(t.pathEndsToMove)],!1,!0),bi=(t,n)=>{t.shapesToMove?.forEach((t=>{n(t[bt].data.position),t[bt].drawPosition()})),t.pathEndsToMove?.forEach((t=>{n(t.data.position),Ui(t)[xt].drawPosition()}))},ki=()=>({shapes:new Set,paths:new Set,pathEnds:new Set,shapesToMove:new Set,pathEndsToMove:new Set}),Ci=(t,n)=>{if(n.shape)t.shapes.add(n.shape),o(n.shape,"highlight");else if(n.path)t.paths.add(n.path),o(n.path,"highlight"),a(n.path,"highlight-s","highlight-e"),t.pathEnds.delete(n.path[xt].data.s),t.pathEnds.delete(n.path[xt].data.e);else if(n.pathEnd){const e=Ui(n.pathEnd);if(t.paths.has(e))return;t.pathEnds.add(n.pathEnd),o(e,Oi(n.pathEnd))}},$i=(t,n)=>{if(n.shape)t.shapes.delete(n.shape),a(n.shape,"highlight");else if(n.path)t.paths.delete(n.path),t.pathEnds.delete(n.path[xt].data.s),t.pathEnds.delete(n.path[xt].data.e),a(n.path,"highlight","highlight-s","highlight-e");else if(n.pathEnd){const e=Ui(n.pathEnd);if(t.paths.delete(e)){a(e,"highlight","highlight-s","highlight-e");const i=Pi(n.pathEnd);t.pathEnds.add(i),o(e,Oi(i))}else t.pathEnds.delete(n.pathEnd),a(e,Oi(n.pathEnd))}},Mi=t=>{const n=t=>a(t,"highlight","highlight-s","highlight-e");t.shapes.forEach((t=>n(t))),t.paths.forEach((t=>n(t))),t.pathEnds.forEach((t=>n(Ui(t))))},Hi=t=>{Mi(t);const n=Bi(t);n&&Zi(n),t.pathEnds.clear(),t.pathEndsToMove.clear(),t.paths.clear(),t.shapes.clear(),t.shapesToMove.clear()},Ai=t=>[...t.shapes,...t.paths,...Ri(t.pathEnds)],zi=(t,n)=>{Vi(t);const e=Si(t);e&&(Mi(t),Di(e,n))},Vi=t=>{t.shapesToMove=new Set(t.shapes),t.pathEndsToMove=new Set;const n=n=>{n.shape?t.shapesToMove.add(n.shape.shapeEl):t.pathEndsToMove.add(n)};t.paths?.forEach((t=>{n(t[xt].data.s),n(t[xt].data.e)})),t.pathEnds?.forEach(n)},Li=(t,n)=>[...t.shapes,...[...t.pathEnds].map((t=>t.el)),...t.paths].some((t=>t.contains(n))),Si=t=>Ii(t)?Bi(t):{},Bi=t=>1!==t.shapes.size||t.paths.size||t.pathEnds.size?t.shapes.size||1!==t.paths.size||t.pathEnds.size?t.shapes.size||t.paths.size||1!==t.pathEnds.size?null:{pathEnd:I(t.pathEnds)}:{path:I(t.paths)}:{shape:I(t.shapes)},Ei=t=>!!Bi(t),Ii=t=>t.shapes.size||t.pathEnds.size||t.paths.size,Ti=t=>{const n=t[bt]?{shape:t}:t.parentElement[bt]?{shape:t.parentElement}:t.parentElement.parentElement[bt]?{shape:t.parentElement.parentElement}:null;if(n)return n;const e=t[xt]?{path:t}:t.parentElement[xt]?{path:t.parentElement}:null;if(e)return e;const i=Ji(t);return i?{pathEnd:i}:null},Di=(t,n)=>{t.shape?t.shape[bt].click(n):t.path?t.path[xt].click(n):t.pathEnd&&Ui(t.pathEnd)[xt].click(n,t.pathEnd.el)},Zi=t=>{t.shape?t.shape[bt].unselect():t.path?t.path[xt].unselect():t.pathEnd&&Ui(t.pathEnd)[xt].unselect()},Yi=(t,n,e)=>{t.shape?t.shape[bt].moveCapture(n,e):t.path?t.path[xt].moveCapture(n,e):t.pathEnd&&Ui(t.pathEnd)[xt].moveCapture(n,e)},Ri=t=>[...t].map(Ui),Ui=t=>t.el.parentNode,Ji=t=>{const n=t.hasAttribute("data-key")?t:t.parentElement.hasAttribute("data-key")?t.parentElement:null;if(!n)return null;const e=n.parentNode[xt].data;return e.s.el===n?e.s:e.e},Pi=t=>{const n=Ui(t)[xt].data;return n.s===t?n.e:n.s},Oi=t=>Ui(t)[xt].data.s===t?"highlight-s":"highlight-e";const ji=-1!==window.navigator.userAgent.indexOf(" OPR"),Fi=t=>ji&&0!==t.button,Ni=(t,n,e,i,o)=>t.x<=i&&i<=t.x+n&&t.y<=o&&o<=t.y+e,Ki={iceServers:[{urls:"stun:stun3.l.google.com:19302"}]},Xi=`${pt}m/`;async function _i(t,n,e,i){const o=le();if(null==o)return e(),null;ot(!0);const a=J(),s=new Map,c=await async function(t,n,e,i,o){const a=await async function(t,n,e){const i=new RTCPeerConnection(Ki),o=i.createDataChannel("dgrm");return o.onopen=n=>t(o,n),o.onmessage=t=>n(o,t),o.onerror=t=>{i.close(),e()},await i.setLocalDescription(),new Promise(((t,n)=>{i.onicecandidate=n=>{n.candidate||t(i)}}))}(e,i,o);await((t,n,e)=>x(`${Xi}o`,{m:t,c:n,s:e}))(n,t,a.localDescription.sdp);const s=K(3e3,15e3,(async()=>{try{const e=await(async(t,n)=>(await y(`${Xi}a?m=${t}&c=${n}`)).text())(n,t);e&&(s(),a.setRemoteDescription({sdp:e,type:"answer"}))}catch{c(),o()}}),o),c=()=>{s(),a.close(),ot(!1)};return c}(a,n,((t,n)=>t.send(F([0,a,o]))),((n,e)=>{const i=N(e.data);switch(i[0]){case 6:pe(t,s.get(i[1]),i[2],i[3]);break;case 4:me(t,i[1]);break;case 5:ge(t,i[1]);break;case 0:s.set(i[1],he(i[2]));break;case 7:s.get(i[1]).remove(),s.delete(i[1]);break;case 2:pi(t,i[1]),l(n);break;case 3:t[Q].move(i[1],i[2],1),l(n)}}),(()=>{d(),i()}));let r;const l=n=>{r=fe(t,a,(t=>n.send(t))),ot(!1)},d=()=>{s.forEach((t=>t.remove())),r&&r(),c(),ot(!1)};return d}async function Gi(t,n,e){const i=le();if(null==i)return n(),null;const o=J(),a=J(),s=new Map,c=(t,n)=>s.forEach(((e,i)=>i!==n?i.send(t):null)),r=await async function(t,n,e,i,o){const a=J();await((t,n)=>x(`${Xi}c`,{m:t,k:n}))(t,a);const s=new Set,c=K(5e3,72e5,(async()=>{try{const o=await(async(t,n)=>{const e=await(await y(`${Xi}o?m=${t}&k=${n}`)).json();return e?Object.entries(e):void 0})(t,a);if(!o?.length)return;o.forEach((async o=>{const c=await async function(t,n,e,i){const o=new RTCPeerConnection(Ki);return o.ondatachannel=t=>{const a=t.channel;a.onopen=t=>n(a,t),a.onmessage=t=>e(a,t),a.onerror=t=>{o.close(),i(o,a,t)}},await o.setRemoteDescription({sdp:t,type:"offer"}),await o.setLocalDescription(),new Promise(((t,n)=>{o.onicecandidate=n=>{n.candidate||t(o)}}))}(o[1],((t,e)=>n(o[0],t,e)),e,((t,n,e)=>{s.delete(t),i(n,e)}));s.add(c),await((t,n,e,i)=>x(`${Xi}a`,{m:t,k:n,c:e,s:i}))(t,a,o[0],c.localDescription.sdp)}))}catch{r(),o()}})),r=()=>{c(),s?.forEach((t=>t.close()))};return r}(o,((n,e,o)=>{e.send(F([0,a,i]));const c=Ct(t);e.send(F(j(c.s)?[2,c]:[3,t[Q].data.position.x,t[Q].data.position.y])),s.forEach((t=>e.send(F([0,t.i,t.n]))))}),((n,e)=>{const i=N(e.data);switch(i[0]){case 6:pe(t,s.get(n).c,i[2],i[3]),c(e.data,n);break;case 4:me(t,i[1]),c(e.data,n);break;case 5:ge(t,i[1]),c(e.data,n);break;case 0:s.set(n,{i:i[1],n:i[2],c:he(i[2])}),c(e.data,n)}}),((t,n)=>{const e=s.get(t);c(F([7,e.i]),t),e.c.remove(),s.delete(t)}),(()=>{d(),e()})),l=fe(t,a,c),d=()=>{l(),s.forEach((t=>t.c.remove())),r()};return{dispose:d,id:o}}function Qi(t,e,i){const o=m(`<div class="mb20 txt-c">Live collaboration in progress</div><div class="mb10"><button mshare class="w100">Share invitation link</button></div><div><button mstop class="w100 btn-del">${i?"Disconnect":"Stop collaboration"}</button></div>`),a=dt(o),s=(t,e)=>c(n(o,t),"click",(t=>{a[ht].del(),e()}));s("mstop",e),s("mshare",(async n=>{await navigator.clipboard.writeText(b("m",t)),ut("Link copied to clipboard")}))}const Wi=t=>{t[to]?.dispose(),t[to]=void 0,de(!1)},qi=t=>{Wi(t),alert("Live collaboration disabled")},to=Symbol(0);function no(t){z(t,A("dgrmn",null,!0))&&(!function(t){for(t[Q].select(null);t.firstChild;)(t.firstChild[bt]||t.firstChild[xt]).del();t[Q].move(0,0,1)}(t),function(t){var n;(n=t[di])&&(n.c=[],n.i=-1),ri(t)}(t),Se(t))}async function eo(t){re()?async function(t){let e;ot(!0);try{e=await(async()=>{const t=await y(`${ft}a/l`);let n;try{n=await t.json()}catch{}return n})()}catch{return alert("Error"),void ot(!1)}const i=dt(m(`<style>.mdhc{display:flex;flex-flow:column;height:100%;max-height:670px;padding:15px;box-sizing:border-box;width:100%;max-width:450px}.mdh{padding:0!important;height:100%}.cnt{overflow-y:overlay;margin-bottom:15px}.cnt div{border-bottom:solid rgba(52,71,103,.4) 1px;margin-bottom:10px;padding-bottom:10px}@media only screen and (max-height:700px){.mdhc{transform:unset!important;top:0!important;left:0!important;border-radius:unset!important;max-height:unset}}@media only screen and (max-width:700px){.mdhc{max-height:unset;max-width:unset}}.dfl{display:flex}.plr10{padding:0 10px}.tcl{color:#344767}</style><div class="cnt">${j(e)?Object.entries(e).map((t=>`<div class="dfl" dgr="${t[0]}"><a class="tcl w100" href="${b("k",t[0])}"><span nm>${t[1].n}</span><br/><small>${new Date(t[1].d).toLocaleDateString()}</small></a> <a edt="${t[0]}"><svg class="plr10" viewBox="0 0 24 24" width="24" height="24"><path d="M4.5 10.5C3.675 10.5 3 11.175 3 12C3 12.825 3.675 13.5 4.5 13.5C5.325 13.5 6 12.825 6 12C6 11.175 5.325 10.5 4.5 10.5ZM19.5 10.5C18.675 10.5 18 11.175 18 12C18 12.825 18.675 13.5 19.5 13.5C20.325 13.5 21 12.825 21 12C21 11.175 20.325 10.5 19.5 10.5ZM12 10.5C11.175 10.5 10.5 11.175 10.5 12C10.5 12.825 11.175 13.5 12 13.5C12.825 13.5 13.5 12.825 13.5 12C13.5 11.175 12.825 10.5 12 10.5Z" fill="rgb(13,110,253)"></path></svg></a></div>`)).join(""):'<div class="txt-c" style="border-bottom:none;">No cloud items</div>'}</div><div style="margin-top:auto"><button dvc class="w100">Open from device</button></div>`,"display: flex; flex-flow: column; height: 100%; overflow-y: overlay;"),"mdh");o(st(i),"mdhc"),c(n(i,"dvc"),"click",(async n=>{i[ht].del(),await io(t)}));const a=t=>i.querySelector(`[dgr='${t}']`),s=async t=>{try{ot(!0),await t()}catch{alert("Error")}finally{ot(!1)}};l(i,"[edt]",(i=>{const o=i.currentTarget.getAttribute("edt");!function(t,e,i,o){const a=e.currentTarget.getBoundingClientRect(),s=rt(m('<style>.opt{padding:10px;cursor:pointer;display:block}</style><a rn class="opt">Rename</a> <a del class="opt" style="color:#e74c3c">Delete</a>'),a.x-30,a.y+70),r=(t,e)=>c(n(s,t),"click",(t=>{s[ht].del(),e()}));r("rn",(e=>function(t,e){const i=dt(m(`<div class="mb20"><input nm type="text" class="w100" placeholder="Name" minlength="4" maxlength="45" value="${t??""}"></div><div class="mb10"><button sv class="w100">Save</button></div>`),"mdm",!0);c(n(i,"sv"),"click",(t=>{i[ht].del(),e(Ie(n(i,"nm").value))}))}(t.n,i))),r("del",(t=>o()))}(e[o],i,(n=>{e[o].n!==n&&s((async()=>{e[o].n=await gt(o,n),a(o).querySelector("[nm]").textContent=e[o].n,o===Be(t)?.k&&((t,n)=>{t[Te].n=n,Ee(n)})(t,e[o].n)}))}),(()=>{confirm("Delete?")&&s((async()=>{var n;await(n=o,x(`${ft}a/d/${n}`)),delete e[o],a(o).remove(),o===Be(t)?.k&&Se(t)}))}))})),ot(!1)}(t):io(t)}async function io(t){try{const n=await Jn(Fn);if(!n)return;if(!await ao(t,n.f))return void so();n.h?Le(t,n.h):Se(t)}catch(t){console.log(t),so()}}async function oo(t,n,e){return!!await ao(t,n)||(Kn(t,n,e.clientX,e.clientY),!1)}async function ao(t,n){if("image/png"!==n.type)return!1;const e=await ze(n);return!!e&&(no(t),pi(t,N(e)),!0)}const so=()=>alert("File cannot be read. Use the exact image file you got from the application.");async function co(t){let e=!0,i={v:!0};const o=Be(t),a=o?.k;a&&(i={},re()&&(i=await(async t=>(await y(`${ft}p/${t}`)).json())(o.k),e=!i.m));const s=m(`<style>.ch{display:flex;align-items:center;cursor:pointer}.ch input{width:20px;height:20px;margin-right:10px}.mt5{margin-top:5px}.mt10{margin-top:10px}.mt20{margin-top:20px}</style><div class="mb10">Anyone with a link can:</div><div class="mb10"><label class="ch"><input v type="checkbox" name="view" ${e?"disabled":""} ${i?.v?"checked":""}/> View</label></div><div><label class="ch"><input e type="checkbox" name="edit" ${e?"disabled":""} ${i?.e?"checked":""}/> Edit</label></div>${a&&e?'<div class="mt10"><small>You do not have access to manage permissions.</small></div>':""}<div class="mt20"><button s class="w100" ${a?"":"disabled"}>Share link</button> ${a?"":'<div class="mt5"><small>To share, save diagram to the cloud.</small></div>'}</div>`),r=dt(s),l=n(s,"v"),d=n(s,"e"),h=async()=>{try{ot(!0),await(t=o.k,n={v:l.checked,e:d.checked},x(`${ft}p/s/${t}`,n))}catch{alert("Error")}finally{ot(!1)}var t,n};c(l,"change",(async t=>{l.checked||(d.checked=!1),await h()})),c(d,"change",(async t=>{d.checked&&(l.checked=!0),await h()})),c(n(s,"s"),"click",(async t=>{await navigator.clipboard.writeText(b("k",o.k)),ut("Link copied to clipboard"),r[ht].del()}))}class ro extends HTMLElement{constructor(t){super(),this.g=t}connectedCallback(){const t=re(),e=t||Pn,i=this.attachShadow({mode:"closed"});i.innerHTML=`<style>.menu{position:fixed;top:5px;left:5px;cursor:pointer;padding:10px}[options]{position:fixed;padding:10px 15px 15px 15px;box-shadow:0 4px 24px rgba(0,0,0,.12);border-radius:8px;background-color:#fff;top:0;left:0;z-index:1;max-height:100%;overflow-y:overlay;box-sizing:border-box}[options] a,[options] div{color:#0d6efd;cursor:pointer;padding:5px 0;display:flex;align-items:center;line-height:25px}[options] a svg,[options] div svg{margin-right:10px}.about{margin-left:auto;font-size:smaller}[options] .hr{border-bottom:solid rgba(52,71,103,.4) 1px;padding-bottom:15px;margin-bottom:10px}@media only screen and (min-width:700px){.about{display:none!important}}.bage::after{position:absolute;right:2px;top:5px;min-width:4px;min-height:4px;padding:4px;background-color:#e74c3c;border-radius:8px;content:'';border:solid 1px #e74c3c}[options] .bage{position:relative}[options] .bage::after{right:-7px;top:-2px}</style><div menu class="menu"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgb(52,71,103)"/></svg></div><div options style="visibility:hidden"><div menu2><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgb(52,71,103)"/></svg><a class="about" href="https://dgrm.net/en/hints.html" target="_blank">Help</a></div><div new><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M9 2.003V2h10.998C20.55 2 21 2.455 21 2.992v18.016a.993.993 0 0 1-.993.992H3.993A1 1 0 0 1 3 20.993V8l6-5.997zM5.83 8H9V4.83L5.83 8zM11 4v5a1 1 0 0 1-1 1H5v10h14V4h-8z" fill="rgb(52,71,103)"/></svg>New</div><div open><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 21a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h7.414l2 2H20a1 1 0 0 1 1 1v3h-2V7h-7.414l-2-2H4v11.998L5.5 11h17l-2.31 9.243a1 1 0 0 1-.97.757H3zm16.938-8H7.062l-1.5 6h12.876l1.5-6z" fill="rgb(52,71,103)"/></svg>Open</div>${e?'<div save><svg viewBox="0 0 24 24" width="24" height="24"><path d="M7 19V13H17V19H19V7.82843L16.1716 5H5V19H7ZM4 3H17L21 7V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM9 15V19H15V15H9Z" fill="rgba(52,71,103,1)"></path></svg>Save</div>':""}<div saveas class="hr">${Ot}Save${On||e?" as":""}</div><div link><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13.06 8.11l1.415 1.415a7 7 0 0 1 0 9.9l-.354.353a7 7 0 0 1-9.9-9.9l1.415 1.415a5 5 0 1 0 7.071 7.071l.354-.354a5 5 0 0 0 0-7.07l-1.415-1.415 1.415-1.414zm6.718 6.011l-1.414-1.414a5 5 0 1 0-7.071-7.071l-.354.354a5 5 0 0 0 0 7.07l1.415 1.415-1.415 1.414-1.414-1.414a7 7 0 0 1 0-9.9l.354-.353a7 7 0 0 1 9.9 9.9z" fill="rgb(52,71,103)"/></svg>Share diagram</div><div collab class="hr"><svg viewBox="0 0 24 24" width="24" height="24"><path d="M2 22C2 17.5817 5.58172 14 10 14C14.4183 14 18 17.5817 18 22H16C16 18.6863 13.3137 16 10 16C6.68629 16 4 18.6863 4 22H2ZM10 13C6.685 13 4 10.315 4 7C4 3.685 6.685 1 10 1C13.315 1 16 3.685 16 7C16 10.315 13.315 13 10 13ZM10 11C12.21 11 14 9.21 14 7C14 4.79 12.21 3 10 3C7.79 3 6 4.79 6 7C6 9.21 7.79 11 10 11ZM18.2837 14.7028C21.0644 15.9561 23 18.752 23 22H21C21 19.564 19.5483 17.4671 17.4628 16.5271L18.2837 14.7028ZM17.5962 3.41321C19.5944 4.23703 21 6.20361 21 8.5C21 11.3702 18.8042 13.7252 16 13.9776V11.9646C17.6967 11.7222 19 10.264 19 8.5C19 7.11935 18.2016 5.92603 17.041 5.35635L17.5962 3.41321Z" fill="rgba(52,71,103,1)"></path></svg>Live collaboration</div><div login><svg viewBox="0 0 24 24" width="24" height="24"><path d="M10 11V8L15 12L10 16V13H1V11H10ZM2.4578 15H4.58152C5.76829 17.9318 8.64262 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C8.64262 4 5.76829 6.06817 4.58152 9H2.4578C3.73207 4.94289 7.52236 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C7.52236 22 3.73207 19.0571 2.4578 15Z" fill="rgba(52,71,103,1)"></path></svg> ${t?t.n:"Log in"}</div></div>`;const o=t=>n(i,t);this.M=o;const a=o("options");function s(){a.style.visibility="visible"===a.style.visibility?"hidden":"visible"}function l(t,n){c(o(t),"click",(async t=>{s(),await n(t)}))}c(o("menu"),"click",(t=>{s(),c(document,"pointerdown",(t=>{this.contains(t.target)||(a.style.visibility="hidden")}),!0)})),c(o("menu2"),"click",(t=>s())),l("new",(()=>{no(this.g)})),e&&l("save",(async()=>await De(this.g))),l("saveas",(()=>Ze(this.g))),l("open",(async()=>await eo(this.g))),l("collab",(async t=>await async function(t){const n=()=>Wi(t),e=()=>qi(t);try{switch(t[to]?.clientType){case 1:Qi(t[to].id,n);break;case 2:Qi(t[to].id,n,!0);break;default:{const i=await Gi(t,n,e);if(!i)return;c(t,"dgrmn",e,!0),t[to]={clientType:1,id:i.id,dispose:()=>{r(t,"dgrmn",e),i.dispose()}},de(!0),Qi(t[to].id,n);break}}}catch{e()}}(this.g))),l("login",(t=>function(){const t=re();dt(m(t?`<div class="mb20 txt-c">${t.n}<br/><small>${t.l}</small></div><div><a href="${pt}login/out" class="btn mb10">Log out</a> <a href="${pt}login/del" onclick='return confirm("Delete account and data?")' class="btn btn-del mb5">Delete account</a> <small>Delete account and all data. Disable auto payment for subscription.</small></div>`:'<div class="mb20 txt-c">Log in to access<br/>cloud storage</div><div><a href="https://oauth.yandex.ru/authorize?response_type=code&client_id=97eecc7396ca470bb10e92b12f11bab8&force_confirm=yes" class="btn"><svg width="24" height="24" fill="none" style="margin-right:5px"><path d="M2.04 12c0-5.523 4.476-10 10-10 5.522 0 10 4.477 10 10s-4.478 10-10 10c-5.524 0-10-4.477-10-10z" fill="#FC3F1D"></path><path d="M13.32 7.666h-.924c-1.694 0-2.585.858-2.585 2.123 0 1.43.616 2.1 1.881 2.959l1.045.704-3.003 4.487H7.49l2.695-4.014c-1.55-1.111-2.42-2.19-2.42-4.015 0-2.288 1.595-3.85 4.62-3.85h3.003v11.868H13.32V7.666z" fill="#fff"></path></svg> Log in with Yandex</a></div>'))}())),l("link",(t=>co(this.g)))}bage(t){const n=t?o:a;n(this.M("menu"),"bage"),n(this.M("collab"),"bage")}}customElements.define("ap-menu",ro);class lo extends HTMLElement{constructor(t){super(),this.g=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{overflow-x:auto;padding:0;position:fixed;top:50%;left:5px;transform:translateY(-50%);box-shadow:0 4px 24px rgba(0,0,0,.12);border-radius:8px;background-color:rgba(255,255,255,.9)}.content{white-space:nowrap;display:flex;flex-direction:column}[data-cmd]{cursor:move}.menu svg{padding:10px}.stroke{stroke:#344767;stroke-width:2px;fill:transparent}.menu .big{width:62px;min-width:62px}@media only screen and (max-width:700px){.menu{width:100%;border-radius:0;bottom:0;display:flex;flex-direction:column;top:unset;left:unset;transform:unset}.content{align-self:center;flex-direction:row}}</style><div id="menu" class="menu" style="touch-action:none"><div class="content"><svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="1" viewBox="0 0 24 24" width="24" height="24"><circle r="9" cx="12" cy="12"></circle></svg> <svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="4" viewBox="0 0 24 24" width="24" height="24"><path d="M2 12 L12 2 L22 12 L12 22 Z" stroke-linejoin="round"></path></svg> <svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="2" viewBox="0 0 24 24" width="24" height="24"><rect x="2" y="4" width="20" height="16" rx="3" ry="3"></rect></svg> <svg data-cmd="shapeAdd" data-cmd-arg="0" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13 8v8a3 3 0 0 1-3 3H7.83a3.001 3.001 0 1 1 0-2H10a1 1 0 0 0 1-1V8a3 3 0 0 1 3-3h3V2l5 4-5 4V7h-3a1 1 0 0 0-1 1z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="shapeAdd" data-cmd-arg="3" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13 6v15h-2V6H5V4h14v2z" fill="rgb(52,71,103)"/></svg> <svg data-cmd="shapeAdd" data-cmd-arg="5" viewBox="0 0 24 24" width="24" height="24"><path d="M7.82929 20C7.41746 21.1652 6.30622 22 5 22C3.34315 22 2 20.6569 2 19C2 17.6938 2.83481 16.5825 4 16.1707V7.82929C2.83481 7.41746 2 6.30622 2 5C2 3.34315 3.34315 2 5 2C6.30622 2 7.41746 2.83481 7.82929 4H16.1707C16.5825 2.83481 17.6938 2 19 2C20.6569 2 22 3.34315 22 5C22 6.30622 21.1652 7.41746 20 7.82929V16.1707C21.1652 16.5825 22 17.6938 22 19C22 20.6569 20.6569 22 19 22C17.6938 22 16.5825 21.1652 16.1707 20H7.82929ZM7.82929 18H16.1707C16.472 17.1476 17.1476 16.472 18 16.1707V7.82929C17.1476 7.52801 16.472 6.85241 16.1707 6H7.82929C7.52801 6.85241 6.85241 7.52801 6 7.82929V16.1707C6.85241 16.472 7.52801 17.1476 7.82929 18ZM5 6C5.55228 6 6 5.55228 6 5C6 4.44772 5.55228 4 5 4C4.44772 4 4 4.44772 4 5C4 5.55228 4.44772 6 5 6ZM19 6C19.5523 6 20 5.55228 20 5C20 4.44772 19.5523 4 19 4C18.4477 4 18 4.44772 18 5C18 5.55228 18.4477 6 19 6ZM19 20C19.5523 20 20 19.5523 20 19C20 18.4477 19.5523 18 19 18C18.4477 18 18 18.4477 18 19C18 19.5523 18.4477 20 19 20ZM5 20C5.55228 20 6 19.5523 6 19C6 18.4477 5.55228 18 5 18C4.44772 18 4 18.4477 4 19C4 19.5523 4.44772 20 5 20Z" fill="rgb(52,71,103)"></path></svg></div></div>';const n=t.getElementById("menu");n.querySelectorAll('[data-cmd="shapeAdd"]').forEach((t=>{c(t,"pointerdown",this),c(t,"click",this)})),c(n,"pointerleave",this),c(n,"pointerup",this),c(n,"pointermove",this)}handleEvent(t){switch(t.type){case"pointermove":if(!this.H){const n=document.elementFromPoint(t.clientX,t.clientY);if(n===this.A)return;this.V===this.A&&this.g.ownerSVGElement.setPointerCapture(t.pointerId),this.A=n}break;case"pointerleave":if(this.H=!0,null!=this.L){const n=ho(this.g,this.L,!1,t.clientX,t.clientY)[0];u(t)||this.g[Q].select([n]),n[bt]?n[bt]?.moveCapture(t,n,!0):n[xt]?.moveCapture(t,n,!0)}this.S();break;case"pointerdown":this.L=parseInt(d(t,"data-cmd-arg")),this.V=document.elementFromPoint(t.clientX,t.clientY),this.A=this.V,this.H=null;break;case"pointerup":this.S();break;case"click":this.g.ownerSVGElement.focus(),this.g[Q].select(ho(this.g,parseInt(d(t,"data-cmd-arg")),!0))}}S(){this.L=null,this.V=null,this.A=null}}customElements.define("ap-menu-shape",lo);const ho=(t,n,e,i,o)=>Rt(t,Mt(0===n?{id:J(),type:0,s:{data:{dir:"right",position:{x:-24,y:0}}},e:{data:{dir:"right",position:{x:24,y:0}}}}:{id:J(),type:n,position:{x:0,y:0},title:"Title"}),e,i,o);const uo=document.getElementById("canvas");var po,fo,mo;uo[Q]={data:{position:{x:0,y:0},scale:1,cell:24},shapeMap:function(n){const e=t=>(n.append(t),t),a=t=>(qt(n,t),t);return{0:{create:t=>e(dn(n,t))},1:{create:o=>e(function(n,e){e.r??=48;let o,a=e.r;const s=An(n,e,'<circle data-key="outer" data-evt-no data-evt-index="2" r="72" fill="transparent" stroke-width="0"/><circle data-key="main" r="48" fill="#ff6600" stroke="#fff" stroke-width="1"/><text data-key="text" x="0" y="0" text-anchor="middle" style="pointer-events:none" fill="#fff"></text>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},(()=>(o=D(e.position,-e.r),{x:e.r,y:e.r})),(r=>{let l=q(n[Q].data,r).x-o.x;l<48&&(l=48);const d=48*Math.round(l/48)/2;e.r!==d&&Bn(t(s.el,"text"))<=d&&(e.r=d,e.position.x=o.x+d,e.position.y=o.y+d,c(),a=d);const h=l-e.r;i(r.target,{x:h,y:h})}),(t=>{const n=Bn(t,a);n!==e.r&&(e.r=n,c())}));function c(){s.cons.right.position.x=e.r,s.cons.left.position.x=-e.r,s.cons.bottom.position.y=e.r,s.cons.top.position.y=-e.r,jt(s),Sn(s.el,"outer",e.r+24),Sn(s.el,"main",e.r),s.draw()}return 48!==e.r?c():s.draw(),s.el[bt].patch=t=>{const n=Xt(s,t),i=null!=t.r&&e.r!==t.r;i&&(e.r=t.r),i?c():n&&s.draw()},s.el}(n,o))},2:{create:t=>e(En(n,t))},3:{create:t=>e(te(n,t))},4:{create:a=>e(function(n,e){e.w??=96;let a,s=e.w;const c=An(n,e,'<path data-key="outer" data-evt-no data-evt-index="2" d="M-72 0 L0 -72 L72 0 L0 72 Z" stroke-width="0" fill="transparent"/><path data-key="border" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="20" stroke="#fff" fill="transparent" stroke-linejoin="round"/><path data-key="main" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="18" stroke-linejoin="round" stroke="#1D809F" fill="#1D809F"/><text data-key="text" x="0" y="0" text-anchor="middle" style="pointer-events:none" fill="#fff"></text>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},(()=>{const t=e.w/2;return a=D(e.position,-t),{x:t,y:t}}),(o=>{let l=q(n[Q].data,o).x-a.x;l<48&&(l=48);const d=48*Math.round(l/48);if(e.w!==d&&ce(t(c.el,"text"))<=d){e.w=d;const t=d/2;e.position.x=a.x+t,e.position.y=a.y+t,r(),s=d}const h=l-e.w/2;i(o.target,{x:h,y:h})}),(t=>{const n=ce(t,s);n!==e.w&&(e.w=n,r())}));function r(){const t=se(e.w,0);c.cons.right.position.x=t.r.x,c.cons.left.position.x=t.l.x,c.cons.bottom.position.y=t.b.y,c.cons.top.position.y=t.t.y,jt(c);const n=se(e.w,9);ae(c.el,"main",n),ae(c.el,"border",n),ae(c.el,"outer",se(e.w,-24)),c.draw()}return o(c.el,"shrhomb"),96!==e.w?r():c.draw(),c.el[bt].patch=t=>{const n=Xt(c,t),i=null!=t.w&&e.w!==t.w;i&&(e.w=t.w),i?r():n&&c.draw()},c.el}(n,a))},5:{create:t=>a(Yn(n,t))},6:{create:t=>a(_n(n,t))}}}(uo)},uo.ownerSVGElement.addEventListener("contextmenu",(async t=>{h(t)||t.preventDefault()})),function(t){let n,e,i;function o(t){t.isPrimary&&t.isTrusted&&(n&&Math.abs(n.x-t.clientX)<3&&Math.abs(n.y-t.clientY)<3?t.stopImmediatePropagation():(n=null,void 0===t.movementX?(t[_]=e?t.clientX-e:0,t[G]=i?t.clientY-i:0,e=t.clientX,i=t.clientY):(t[_]=t.movementX,t[G]=t.movementY)))}t.addEventListener("pointerdown",(a=>{n={x:a.clientX,y:a.clientY},e=null,i=null,t.addEventListener("pointermove",o,{capture:!0,passive:!0}),t.addEventListener("pointerup",(n=>{r(t,"pointermove",o,!0)}),{capture:!0,once:!0,passive:!0})}),{capture:!0,passive:!0})}(document),function(t){c(document,"paste",(async n=>{h(n)||hi(t,(t=>{const n=t.getData("text/plain"),e=Xe(n);return e?{data:e}:t.files?.length&&t.files.item(0).type?.startsWith("image/")?{img:t.files.item(0)}:n?{txt:n}:null})(n.clipboardData))}));const n=V((async()=>await De(t)),500);document.addEventListener("keydown",(async e=>{if((e.ctrlKey||e.metaKey)&&"KeyS"===e.code&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&!e.repeat&&!h(e))switch(e.code){case"KeyZ":ct(),si(t);break;case"KeyY":ct(),ci(t);break;case"KeyS":ct(),e.shiftKey?Ze(t):n()}}))}(uo),function(t){const n=t.ownerSVGElement;let e,a,s,l,d;const h=()=>{d?.remove(),d=null};let u=!1;function f(t){if(t[gi]||!s)return void g();t[gi]=!0,u&&(h(),u=!1);const n=t.clientX-a.x,e=t.clientY-a.y;s.width.baseVal.value=Math.abs(n),s.height.baseVal.value=Math.abs(e),n<0&&(l.x=t.clientX),e<0&&(l.y=t.clientY),s.style.transform=`translate(${l.x}px, ${l.y}px)`}function m(n){if(s&&!u){n[gi]=!0;const e=n=>Ni(W(t[Q].data,l.x,l.y),s.width.baseVal.value/t[Q].data.scale,s.height.baseVal.value/t[Q].data.scale,n.x,n.y);!function(t,n,e,i){const o=ki(),a=t=>Ci(o,t),s=t=>t.shape&&e(t.shape.shapeEl)||i(t);for(const t of n)if(t[bt])e(t)&&a({shape:t});else if(t[xt]){const n=s(t[xt].data.s),e=s(t[xt].data.e);n&&e?a({path:t}):n?a({pathEnd:t[xt].data.s}):e&&a({pathEnd:t[xt].data.e})}t[Q].selectedSet(o)}(t,t.children,(t=>e(t[bt].data.position)),(t=>e(t.data.position)))}g()}function g(){clearTimeout(e),e=null,s?.remove(),s=null,h(),u=!1,r(n,"pointermove",f),r(n,"wheel",g),r(n,"pointercancel",g),r(n,"pointerup",m)}c(n,"pointerdown",(r=>{if(!r.isPrimary||vt(r)!==n||Fi(r))return void g();c(n,"pointermove",f),c(n,"wheel",g,!0),c(n,"pointercancel",g,!0),c(n,"pointerup",m,!0);const h=()=>{t[Q].selectedSet(null),u=!0,n.setPointerCapture(r.pointerId),a={x:r.clientX,y:r.clientY},l={x:r.clientX,y:r.clientY},s=p("rect"),s.style.cssText="rx:8px; fill: rgb(108 187 247 / 51%)",i(s,l),n.append(s)};2!==r.button?e=setTimeout((t=>{h(),d=p("circle"),o(d,"ative-elem"),d.style.cssText="r:10px; fill: rgb(108 187 247 / 51%)",i(d,{x:r.clientX,y:r.clientY}),n.append(d)}),500):h()}))}(uo),function(t){const n=t.ownerSVGElement;let e,i,o=ki();c(n,"pointerdown",(a=>{if(!a.isPrimary)return r(n,"pointermove",e),r(n,"pointerup",i),void t[Q].moveCapture();i=i=>{r(n,"pointermove",e),vi(t,o,i)},c(n,"pointerup",i,!0),e=e=>{r(n,"pointerup",i),wi(t,o,e,vt(a))},0===a.button&&c(n,"pointermove",e,!0)})),fi(t,(()=>Ai(o)));const a=t=>{Hi(o),o=t??ki(),zi(o,null)};t[Q].selectedSet=a,t[Q].select=t=>{const n=ki();t?.forEach((t=>Ci(n,Ti(t)))),a(n)}}(uo),function(t){const n=t[Q].data,e=function(t,n){let e;function i(n){e!==n&&(e=n,t.style.backgroundImage=`radial-gradient(rgb(73 80 87 / ${n}) 1px, transparent 0)`)}return i(.6),t.style.backgroundSize=`${n.cell}px ${n.cell}px`,function(){const e=n.cell*n.scale;n.scale<.5?i(0):n.scale<=.9?i(.2):i(.6),t.style.backgroundSize=`${e}px ${e}px`,t.style.backgroundPosition=`${n.position.x}px ${n.position.y}px`}}(t.ownerSVGElement,n);function i(){t.style.transform=`matrix(${n.scale}, 0, 0, ${n.scale}, ${n.position.x}, ${n.position.y})`,e()}function o(t,e){if(t<.25||t>4)return;const o=t/n.scale;n.scale=t,n.position.x=o*(n.position.x-e.x)+e.x,n.position.y=o*(n.position.y-e.y)+e.y,i()}!function(t,n,e,i){let o,a,s,l,d=!1;function h(t){s=null,l=null,o?.id===t.pointerId&&(o=null),a?.id===t.pointerId&&(a=null),o||a||(r(document,"pointermove",u),r(document,"pointercancel",h),r(document,"pointerup",h),d=!1)}function u(t){if(d){if(o&&!a||!o&&a)return n.position.x=t.clientX+(o||a).shift.x,n.position.y=t.clientY+(o||a).shift.y,void i();if(!a||!o||a?.id!==t.pointerId&&o?.id!==t.pointerId)return;const c=Math.hypot(o.pos.x-a.pos.x,o.pos.y-a.pos.y),r={x:(o.pos.x+a.pos.x)/2,y:(o.pos.y+a.pos.y)/2};s&&(n.position.x=n.position.x+r.x-l.x,n.position.y=n.position.y+r.y-l.y,e(n.scale/s*c,r)),s=c,l=r}o?.id===t.pointerId&&(o=et(t,n)),a?.id===t.pointerId&&(a=et(t,n))}c(t.ownerSVGElement,"pointerdown",(t=>{!o&&!t.isPrimary||o&&a||(o||(c(document,"pointermove",u),c(document,"pointercancel",h),c(document,"pointerup",h),o=et(t,n)),a||o?.id===t.pointerId||(a=et(t,n)))})),t[Q].moveCapture=()=>{d=!0}}(t,n,o,i),t.ownerSVGElement.addEventListener("wheel",(t=>{t.preventDefault();const e=t.deltaY||t.deltaX,i=Math.abs(e)<50?.05:.25;o(n.scale+(e<0?i:-i),nt(t))})),t[Q].move=function(t,e,o){n.position.x=t,n.position.y=e,n.scale=o,i()},t[Q].scale=o}(uo),function(t){const e=t.ownerSVGElement,i=t.ownerDocument;let o,a,s,l;function d(e){r(i,"pointermove",p),r(i,"pointerup",h),s||(s=function(t,e,i,o){const a=m(`<style>.ln{display:flex;align-items:center;color:#0d6efd;line-height:25px;padding:5px 10px;cursor:pointer;white-space:nowrap}.ln>*{margin-right:10px}</style>${Ne?'<div p class="ln" style="padding-top: 10px;"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7 4V2h10v2h3.007c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 21.007V4.993C3 4.445 3.445 4 3.993 4H7zm0 2H5v14h14V6h-2v2H7V6zm2-2v2h6V4H9z" fill="rgb(52,71,103)"/></svg>Paste</div>':""}<div i class="ln" ${Ne?'style="padding-bottom: 10px;"':""}><svg viewBox="0 0 24 24" width="24" height="24" fill="rgba(52,71,103,1)"><path d="M2.9918 21C2.44405 21 2 20.5551 2 20.0066V3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44495 22 3.9934V20.0066C22 20.5552 21.5447 21 21.0082 21H2.9918ZM20 15V5H4V19L14 9L20 15ZM20 17.8284L14 11.8284L6.82843 19H20V17.8284ZM8 11C6.89543 11 6 10.1046 6 9C6 7.89543 6.89543 7 8 7C9.10457 7 10 7.89543 10 9C10 10.1046 9.10457 11 8 11Z"></path></svg>Add image</div>`),s=(t,e)=>{c(n(a,t),"click",(async t=>{await e(),o()}))};Ne&&s("p",(async()=>hi(i,await(async()=>{let t;try{t=await(navigator.clipboard?.read())}catch{}if(!t?.length)return null;const n=t[0],e=n.types.includes("text/plain")?await(await n.getType("text/plain")).text():null,i=Xe(e);if(i)return{data:i};const o=n.types.find((t=>t.startsWith("image/")));return o?{img:await n.getType(o)}:e?{txt:e}:null})(),t,e)));s("i",(async()=>async function(t,n,e){const i=await Jn(Nn);i&&Kn(t,i.f,n,e)}(i,t,e)));return{del:lt(a,t-10,e-10)[ht].del,el:a}}(e.clientX,e.clientY,t,h),c(i,"pointerdown",u))}function h(){clearTimeout(o),o=null,s?.del(),s=null,r(i,"pointerdown",u),r(i,"pointerup",h),r(i,"wheel",h),r(i,"keydown",h),r(i,"pointerup",g),r(i,"pointercancel",g),r(i,"pointermove",f),a=!1,l=!1}function u(t){s.el.contains(t.target)||h()}function p(){h(),a=!0}function f(){l||h(),a=!0}function g(){l=!0}c(e,"pointerdown",(async function(t){t.isPrimary&&vt(t)===e?(h(),c(i,"pointermove",p,!0),c(i,"pointerup",h,!0),c(i,"wheel",h,!0),c(i,"keydown",h,!0),2!==t.button&&(o=setTimeout((n=>{d(t),c(i,"pointerup",g,!0),c(i,"pointercancel",g,!0),c(i,"pointermove",f,!0)}),500))):h()})),e.addEventListener("contextmenu",(async t=>{e===vt(t)&&(t.preventDefault(),a||d(t))}))}(uo),(t=>{const n=(n,e)=>c(t,n,(t=>{t[ii]||e(t)}));n("dgrmc",(n=>qe(t,n.detail.newIds,n.detail.shapesToCreateData))),n("dgrmd",(n=>ti(t,n.detail.delIds,n.detail.shapesToDelData))),n("dgrmu",(n=>ni(t,n.detail.shapesBeforeUpdData,n.detail.shapesToUpdData)))})(uo),function(t){document.body.addEventListener("dragover",(t=>{t.preventDefault()})),document.body.addEventListener("drop",(async n=>{if(n.preventDefault(),1===n.dataTransfer?.items?.length&&"file"===n.dataTransfer.items[0].kind&&n.dataTransfer.items[0].type.startsWith("image/"))if("getAsFileSystemHandle"in n.dataTransfer.items[0]){const e=await n.dataTransfer.items[0].getAsFileSystemHandle();await oo(t,await e.getFile(),n)&&Le(t,e)}else{const e=n.dataTransfer.items[0].getAsFile();await oo(t,e,n)&&Ee(P(e.name))}else so()}))}(uo),(t=>{t[Pe]={u:new Set,d:new Set};const n=n=>{t[Pe].u.add(n),t[Pe].d.delete(n)},e=t=>Object.keys(t.s).forEach(n),i=n=>n?.forEach((n=>{t[Pe].d.add(n),t[Pe].u.delete(n)}));c(t,"dgrmc",(t=>{t.detail.newIds?.forEach(n)})),c(t,"dgrmu",(t=>e(t.detail.shapesToUpdData))),c(t,"dgrmd",(t=>i(t.detail.delIds))),c(t,ve,(t=>e(t.detail))),c(t,we,(t=>i(t.detail))),t.addEventListener("dgrmn",(n=>{!Ue(t)||window.confirm("Changes you made may not be saved. Continue?")?Je(t):n.preventDefault()})),window.addEventListener("beforeunload",(n=>{Ue(t)&&n.preventDefault()}))})(uo);{const t=new URL(window.location.href),n=n=>t.searchParams.get(n);n("usr")&&(po=n("usr"),fo=n("usrn"),mo=parseInt(n("expr")),localStorage.setItem("dgrm",F({l:po,n:fo,e:mo})),k("usr","usrn","expr"))}(t=>{const n=new ro(t);n.id="menu",g(n)})(uo),g(new ui(uo)),g(new lo(uo));{const t=new URL(window.location.href),e=n=>t.searchParams.get(n);if(e("k")){ot(!0);try{const t=e("k"),n=await mt(t);pi(uo,n.d),n.p&&Ve(uo,t,n.n,n.e,n.m)}catch{alert("The link is broken or you do not have permission. Try to relogin.")}k("k"),ot(!1)}else if(e("m")){const t=e("m");k("m"),await async function(t,n){const e=()=>qi(t);try{const i=await _i(t,n,(()=>Wi(t)),e);if(!i)return;c(t,"dgrmn",e,!0),t[to]={clientType:2,id:n,dispose:()=>{r(t,"dgrmn",e),i()}},de(!0)}catch{e()}}(uo,t)}else re()||function(){const t=m('<div style="position:fixed;left:50%;top:30%;transform:translate(-50%,-30%);width:90%;max-width:400px"><a cl style="display:inline-block;padding:10px">Close</a> <a href="https://dgrm.net/en/hints.html" target="_blank"><video src="/assets/intro.mp4" poster="/assets/intro.png" style="width:100%;padding-top:5px;display:block;border:1px solid #b3b3b3;border-radius:1.25rem;background-color:#fff" type="video/mp4" muted autoplay playsinline loop></video></a><a href="https://dgrm.net/en/hints.html" target="_blank" style="margin-left:10px;display:inline-block">View hints and hotkeys</a></div>');function e(){t.remove(),r(document,"pointerdown",i),r(document,"wheel",e),r(document,"keydown",e),r(document,"dragover",e)}function i(n){t.contains(n.target)||e()}t.style.display="unset",c(document,"pointerdown",i),c(document,"wheel",e,!0),c(document,"keydown",e,!0),c(document,"dragover",e,!0),c(n(t,"cl"),"click",(t=>e()),!0),g(t)}()}
